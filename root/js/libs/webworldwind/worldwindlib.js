/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 * Copyright (C) 2014 United States Government as represented by the Administrator of the
 * National Aeronautics and Space Administration. All Rights Reserved.
 */

/*
 * Copyright (C) 2015 United States Government as represented by the Administrator of the
 * National Aeronautics and Space Administration. All Rights Reserved.
 */

/*
 * @license
 * Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 * Copyright 2014, Google Inc. All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice including the dates of first publication and
 * either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 * shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Original Code. The Original Code is: OpenGL Sample Implementation,
 * Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 * Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 * Copyright in any portions created by third parties is as indicated
 * elsewhere herein. All Rights Reserved.
 */

!function(t,e){"function"==typeof define&&define.amd?define([],e):t.WorldWind=e()}(this,function(){var t,e,i;!function(r){function o(t,e){return v.call(t,e)}function n(t,e){var i,r,o,n,s,a,h,l,u,c,d,g=e&&e.split("/"),p=y.map,f=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(g=g.slice(0,g.length-1),t=t.split("/"),s=t.length-1,y.nodeIdCompat&&S.test(t[s])&&(t[s]=t[s].replace(S,"")),t=g.concat(t),u=0;u<t.length;u+=1)if(d=t[u],"."===d)t.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((g||f)&&p){for(i=t.split("/"),u=i.length;u>0;u-=1){if(r=i.slice(0,u).join("/"),g)for(c=g.length;c>0;c-=1)if(o=p[g.slice(0,c).join("/")],o&&(o=o[r])){n=o,a=u;break}if(n)break;!h&&f&&f[r]&&(h=f[r],l=u)}!n&&h&&(n=h,a=l),n&&(i.splice(0,a,n),t=i.join("/"))}return t}function s(t,e){return function(){var i=L.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),g.apply(r,i.concat([t,e]))}}function a(t){return function(e){return n(e,t)}}function h(t){return function(e){m[t]=e}}function l(t){if(o(E,t)){var e=E[t];delete E[t],_[t]=!0,d.apply(r,e)}if(!o(m,t)&&!o(_,t))throw new Error("No "+t);return m[t]}function u(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,g,p,f,m={},E={},y={},_={},v=Object.prototype.hasOwnProperty,L=[].slice,S=/\.js$/;p=function(t,e){var i,r=u(t),o=r[0];return t=r[1],o&&(o=n(o,e),i=l(o)),o?t=i&&i.normalize?i.normalize(t,a(e)):n(t,e):(t=n(t,e),r=u(t),o=r[0],t=r[1],o&&(i=l(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:i}},f={require:function(t){return s(t)},exports:function(t){var e=m[t];return"undefined"!=typeof e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:c(t)}}},d=function(t,e,i,n){var a,u,c,d,g,y,v=[],L=typeof i;if(n=n||t,"undefined"===L||"function"===L){for(e=!e.length&&i.length?["require","exports","module"]:e,g=0;g<e.length;g+=1)if(d=p(e[g],n),u=d.f,"require"===u)v[g]=f.require(t);else if("exports"===u)v[g]=f.exports(t),y=!0;else if("module"===u)a=v[g]=f.module(t);else if(o(m,u)||o(E,u)||o(_,u))v[g]=l(u);else{if(!d.p)throw new Error(t+" missing "+u);d.p.load(d.n,s(n,!0),h(u),{}),v[g]=m[u]}c=i?i.apply(m[t],v):void 0,t&&(a&&a.exports!==r&&a.exports!==m[t]?m[t]=a.exports:c===r&&y||(m[t]=c))}else t&&(m[t]=i)},t=e=g=function(t,e,i,o,n){if("string"==typeof t)return f[t]?f[t](e):l(p(t,e).f);if(!t.splice){if(y=t,y.deps&&g(y.deps,y.callback),!e)return;e.splice?(t=e,e=i,i=null):t=r}return e=e||function(){},"function"==typeof i&&(i=o,o=n),o?d(r,t,e,i):setTimeout(function(){d(r,t,e,i)},4),g},g.config=function(t){return g(t)},t._defined=m,i=function(t,e,i){e.splice||(i=e,e=[]),o(m,t)||o(E,t)||(E[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("../tools/almond",function(){}),i("error/AbstractError",[],function(){"use strict";var t=function(t,e){this.name=t,this.message=e};return t.prototype.toString=function(){var t=this.name+": "+this.message;return this.stack&&(t+="\n"+this.stack.toString()),t},t}),i("geom/Angle",[],function(){"use strict";var t={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,normalizedDegrees:function(t){var e=t%360;return e>180?e-360:-180>e?360+e:e},normalizedDegreesLatitude:function(t){var e=t%180;return e>90?180-e:-90>e?-180-e:e},normalizedDegreesLongitude:function(t){var e=t%360;return e>180?e-360:-180>e?360+e:e},normalizedRadians:function(t){var e=t%this.TWO_PI;return e>Math.PI?e-this.TWO_PI:e<-Math.PI?this.TWO_PI+e:e},normalizedRadiansLatitude:function(t){var e=t%Math.PI;return e>this.HALF_PI?Math.PI-e:e<-this.HALF_PI?-Math.PI-e:e},normalizedRadiansLongitude:function(t){var e=t%this.TWO_PI;return e>Math.PI?e-this.TWO_PI:e<-Math.PI?this.TWO_PI+e:e},isValidLatitude:function(t){return t>=-90&&90>=t},isValidLongitude:function(t){return t>=-180&&180>=t},toString:function(t){return t.toString()+"°"},toDecimalDegreesString:function(t){return t.toString()+"°"},toDMSString:function(t){var e,i,r,o,n;return e=0>t?-1:1,i=e*t,r=Math.floor(i),i=60*(i-r),o=Math.floor(i),i=60*(i-o),n=Math.round(i),60==n&&(o++,n=0),60==o&&(r++,o=0),(-1==e?"-":"")+r+"° "+o+"’ "+n+"”"},toDMString:function(t){var e,i,r,o,n,s;return e=0>t?-1:1,i=e*t,r=Math.floor(i),i=60*(i-r),o=Math.floor(i),i=60*(i-o),n=Math.round(i),60==n&&(o++,n=0),60==o&&(r++,o=0),s=0==n?o:o+n/60,(-1==e?"-":"")+r+"° "+s+"’"}};return t}),i("error/ArgumentError",["../error/AbstractError"],function(t){"use strict";var e=function(e){t.call(this,"ArgumentError",e);var i;try{throw new Error}catch(r){i=r.stack}this.stack=i};return e.prototype=Object.create(t.prototype),e}),i("util/Logger",[],function(){"use strict";var t={LEVEL_NONE:0,LEVEL_SEVERE:1,LEVEL_WARNING:2,LEVEL_INFO:3,setLoggingLevel:function(t){e=t},getLoggingLevel:function(){return e},log:function(i,r){r&&i>0&&e>=i&&(i===t.LEVEL_SEVERE?console.error(r):i===t.LEVEL_WARNING?console.warn(r):i===t.LEVEL_INFO?console.info(r):console.log(r))},makeMessage:function(t,e,i){var r=this.messageTable[i]?this.messageTable[i]:i;return t+"."+e+": "+r},logMessage:function(t,e,i,r){var o=this.makeMessage(e,i,r);return this.log(t,o),o},messageTable:{abstractInvocation:"The function called is abstract and must be overridden in a subclass.",indexOutOfRange:"The specified index is out of range.",invalidHeight:"The specified height is zero or negative.",invalidWidth:"The specified width is zero or negative.",invalidSize:"The specified size is zero or negative.",missingAltitudeMode:"The specified altitude mode is null or undefined.",missingAttributeName:"The specified DBase attribute file name is null or undefined.",missingArray:"The specified array is null, undefined or of insufficient length.",missingBoundaries:"The specified boundaries array is null or undefined.",missingBuffer:"The specified buffer descriptor is null or undefined.",missingColor:"The specified color is null or undefined.",missingDc:"The specified draw context is null or undefined.",missingDomElement:"The specified DOM element is null or undefined.",missingEntry:"The specified entry is null or undefined.",missingFont:"The specified font is null or undefined.",missingFrustum:"The specified frustum is null or undefined.",missingFunction:"The specified function is null or undefined.",missingGlContext:"The specified WebGL rendering context is null or undefined.",missingGlobe:"The specified globe is null or undefined.",missingImage:"The specified image is null or undefined.",missingIndices:"The specified indices array is null or undefined.",missingKey:"The specified key is null or undefined.",missingLevel:"The specified level is null or undefined.",missingLine:"The specified line is null or undefined.",missingList:"The specified list is null or undefined.",missingListener:"The specified listener is null or undefined",missingLocation:"The specified location is null or undefined.",missingMatrix:"The specified matrix is null or undefined.",missingNavigatorState:"The specified navigator state is null or undefined.",missingOffset:"The specified offset is null or undefined.",missingPath:"The specified path is null or undefined.",missingPlacename:"The specified place name is null or undefined.",missingPlane:"The specified plane is null or undefined.",missingPoint:"The specified point is null or undefined.",missingPoints:"The specified points array is null or undefined.",missingPosition:"The specified position is null or undefined.",missingPositions:"The specified positions array is null or undefined.",missingProgram:"The specified program is null or undefined.",missingProjection:"The specified projection is null or undefined.",missingRectangle:"The specified rectangle is null or undefined.",missingRenderable:"The specified renderable is null or undefined.",missingResource:"The specified resource is null or undefined.",missingResult:"The specified result variable is null or undefined.",missingResults:"The specified results array is null or undefined.",missingSector:"The specified sector is null or undefined.",missingShapeType:"The specified shape type is null or undefined.",missingSize:"The specified size is null or undefined.",missingText:"The specified text is null or undefined.",missingTexture:"The specified texture is null or undefined.",missingTile:"The specified tile is null or undefined.",missingType:"The specified type is null or undefined.",missingUrl:"The specified URL is null or undefined",missingVector:"The specified vector is null or undefined.",missingVertex:"The specified vertex is null or undefined.",missingViewport:"The specified viewport is null or undefined.",missingWorldWindow:"The specified World Window is null or undefined.",notYetImplemented:"This function is not yet implemented"}},e=1;return t}),i("util/Color",["../util/Logger"],function(t){"use strict";var e=function(t,e,i,r){this.red=t,this.green=e,this.blue=i,this.alpha=r};return e.WHITE=new e(1,1,1,1),e.BLACK=new e(0,0,0,1),e.RED=new e(1,0,0,1),e.GREEN=new e(0,1,0,1),e.BLUE=new e(0,0,1,1),e.CYAN=new e(0,1,1,1),e.YELLOW=new e(1,1,0,1),e.MAGENTA=new e(1,0,1,1),e.LIGHT_GRAY=new e(.75,.75,.75,1),e.MEDIUM_GRAY=new e(.5,.5,.5,1),e.DARK_GRAY=new e(.25,.25,.25,1),e.TRANSPARENT=new e(0,0,0,0),e.prototype.set=function(t,e,i,r){return this.red=t,this.green=e,this.blue=i,this.alpha=r,this},e.prototype.copy=function(e){if(!e)throw new ArgumentError(t.logMessage(t.LEVEL_SEVERE,"Color","copy","missingColor"));return this.red=e.red,this.green=e.green,this.blue=e.blue,this.alpha=e.alpha,this},e.prototype.clone=function(){return new e(this.red,this.green,this.blue,this.alpha)},e.prototype.premultipliedComponents=function(t){var e=this.alpha;return t[0]=this.red*e,t[1]=this.green*e,t[2]=this.blue*e,t[3]=e,t},e.colorFromByteArray=function(t){return new e(t[0]/255,t[1]/255,t[2]/255,t[3]/255)},e.colorFromBytes=function(t,i,r,o){return new e(t/255,i/255,r/255,o/255)},e.prototype.nextColor=function(){var t=Math.round(255*this.red),e=Math.round(255*this.green),i=Math.round(255*this.blue);return 255>t?this.red=(t+1)/255:255>e?(this.red=0,this.green=(e+1)/255):255>i?(this.red=0,this.green=0,this.blue=(i+1)/255):(this.red=1/255,this.green=0,this.blue=0),this},e.prototype.equals=function(t){var e=Math.round(255*this.red),i=Math.round(255*this.green),r=Math.round(255*this.blue),o=Math.round(255*this.alpha),n=Math.round(255*t.red),s=Math.round(255*t.green),a=Math.round(255*t.blue),h=Math.round(255*t.alpha);return e===n&&i===s&&r===a&&o===h},e.prototype.equalsBytes=function(t){var e=Math.round(255*this.red),i=Math.round(255*this.green),r=Math.round(255*this.blue),o=Math.round(255*this.alpha);return e===t[0]&&i===t[1]&&r===t[2]&&o===t[3]},e.prototype.toByteString=function(){var t=Math.round(255*this.red),e=Math.round(255*this.green),i=Math.round(255*this.blue),r=Math.round(255*this.alpha);return"("+t+","+e+","+i+","+r+")"},e.prototype.toHexString=function(t){var e=Math.ceil(255*this.red).toString(16),i=Math.ceil(255*this.green).toString(16),r=Math.ceil(255*this.blue).toString(16),o=Math.ceil(255*this.alpha).toString(16),n="#";return n+=e.length<2?"0"+e:e,n+=i.length<2?"0"+i:i,n+=r.length<2?"0"+r:r,t&&(n+=o.length<2?"0"+o:o),n},e}),i("shaders/GpuShader",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i,r,o){if(r!==i.VERTEX_SHADER&&r!==i.FRAGMENT_SHADER)throw new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","The specified shader type is unrecognized."));if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","The specified shader source is null or undefined."));var n=i.createShader(r);if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","Unable to create shader of type "+(r==i.VERTEX_SHADER?"VERTEX_SHADER.":"FRAGMENT_SHADER.")));if(!this.compile(i,n,r,o)){var s=i.getShaderInfoLog(n);throw i.deleteShader(n),new t(e.logMessage(e.LEVEL_SEVERE,"GpuShader","constructor","Unable to compile shader: "+s))}this.shaderId=n};return i.prototype.compile=function(t,e,i,r){return t.shaderSource(e,r),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)},i.prototype.dispose=function(t){this.shaderId&&(t.deleteShader(this.shaderId),delete this.shaderId)},i}),i("shaders/GpuProgram",["../error/ArgumentError","../util/Color","../shaders/GpuShader","../util/Logger"],function(t,e,i,r){"use strict";var o=function(e,o,n,s){if(!o||!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","The specified shader source is null or undefined."));var a,h,l;try{h=new i(e,e.VERTEX_SHADER,o),l=new i(e,e.FRAGMENT_SHADER,n)}catch(u){throw h&&h.dispose(e),l&&l.dispose(e),u}if(a=e.createProgram(),!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to create shader program."));if(e.attachShader(a,h.shaderId),e.attachShader(a,l.shaderId),s)for(var c=0,d=s.length;d>c;c++)e.bindAttribLocation(a,c,s[c]);if(!this.link(e,a)){var g=e.getProgramInfoLog(a);throw e.detachShader(a,h.shaderId),e.detachShader(a,l.shaderId),e.deleteProgram(a),h.dispose(e),l.dispose(e),new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to link shader program: "+g))}this.programId=a,this.attributeLocations={},this.uniformLocations={},this.vertexShader=h,this.fragmentShader=l,this.size=o.length+n.length,this.scratchArray=new Float32Array(16)};return o.prototype.dispose=function(t){this.programId&&(this.vertexShader&&t.detachShader(this.programId,this.vertexShader.shaderId),this.fragmentShader&&t.detachShader(this.programId,this.fragmentShader.shaderId),t.deleteProgram(this.programId),delete this.programId),this.vertexShader&&(this.vertexShader.dispose(t),delete this.vertexShader),this.fragmentShader&&(this.fragmentShader.dispose(t),delete this.fragmentShader),this.attributeLocations={},this.uniformLocations={}},o.prototype.attributeLocation=function(e,i){if(!i||0==i.length)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","attributeLocation","The specified attribute name is null, undefined or empty."));var o=this.attributeLocations[i];return o||(o=e.getAttribLocation(this.programId,i),this.attributeLocations[i]=o),o},o.prototype.uniformLocation=function(e,i){if(!i||0==i.length)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","uniformLocation","The specified uniform name is null, undefined or empty."));var o=this.uniformLocations[i];return o||(o=e.getUniformLocation(this.programId,i),this.uniformLocations[i]=o),o},o.prototype.link=function(t,e){return t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)},o.prototype.loadUniformMatrix=function(e,i,o){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformMatrix","missingMatrix"));var n=i.columnMajorComponents(this.scratchArray);e.uniformMatrix4fv(o,!1,n)},o.prototype.loadUniformColor=function(e,i,o){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformColor","missingColor"));var n=i.premultipliedComponents(this.scratchArray);e.uniform4f(o,n[0],n[1],n[2],n[3])},o.prototype.loadUniformColorComponents=function(t,e,i,r,o,n){t.uniform4f(n,e*o,i*o,r*o,o)},o}),i("shaders/BasicProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(t,e,i,r){"use strict";var o=function(t){var e="attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;}",r="precision mediump float;\nuniform vec4 color;\nvoid main() {gl_FragColor = color;}";i.call(this,t,e,r),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.colorLocation=this.uniformLocation(t,"color")};return o.key="WorldWindGpuBasicProgram",o.prototype=Object.create(i.prototype),o.prototype.loadModelviewProjection=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,i,this.mvpMatrixLocation)},o.prototype.loadColor=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadColor","missingColor"));this.loadUniformColor(e,i,this.colorLocation)},o.prototype.loadColorComponents=function(t,e,i,r,o){this.loadUniformColorComponents(t,e,i,r,o,this.colorLocation)},o}),i("shaders/BasicTextureProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(t,e,i,r){"use strict";var o=function(t){var e="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nattribute vec4 normalVector;\nuniform mat4 mvpMatrix;\nuniform mat4 mvInverseMatrix;\nuniform mat4 texCoordMatrix;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;\ntexCoord = (texCoordMatrix * vertexTexCoord).st;\nif (applyLighting) {normal = mvInverseMatrix * normalVector;}\n}",r="precision mediump float;\nuniform float opacity;\nuniform vec4 color;\nuniform bool enableTexture;\nuniform bool modulateColor;\nuniform sampler2D textureSampler;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {\nvec4 textureColor = texture2D(textureSampler, texCoord);\nfloat ambient = 0.15; vec4 lightDirection = vec4(0, 0, 1, 0);\nif (enableTexture && !modulateColor)\n    gl_FragColor = textureColor * color * opacity;\nelse if (enableTexture && modulateColor)\n    gl_FragColor = color * floor(textureColor.a + 0.5);\nelse\n    gl_FragColor = color * opacity;\nif (gl_FragColor.a == 0.0) {discard; return;}\nif (applyLighting) {\n    vec4 n = normal * (gl_FrontFacing ? 1.0 : -1.0);\n    gl_FragColor.rgb *= clamp(ambient + dot(lightDirection, n), 0.0, 1.0);\n}\n}",o=["vertexPoint","normalVector","vertexTexCoord"];i.call(this,t,e,r,o),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.normalVectorLocation=this.attributeLocation(t,"normalVector"),this.vertexTexCoordLocation=this.attributeLocation(t,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.mvInverseMatrixLocation=this.uniformLocation(t,"mvInverseMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.textureEnabledLocation=this.uniformLocation(t,"enableTexture"),this.modulateColorLocation=this.uniformLocation(t,"modulateColor"),this.textureUnitLocation=this.uniformLocation(t,"textureSampler"),this.textureMatrixLocation=this.uniformLocation(t,"texCoordMatrix"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.applyLightingLocation=this.uniformLocation(t,"applyLighting")};return o.key="WorldWindGpuBasicTextureProgram",o.prototype=Object.create(i.prototype),o.prototype.loadModelviewInverse=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewInverse","missingMatrix"));this.loadUniformMatrix(e,i,this.mvInverseMatrixLocation)},o.prototype.loadModelviewProjection=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,i,this.mvpMatrixLocation)},o.prototype.loadColor=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadColor","missingColor"));this.loadUniformColor(e,i,this.colorLocation)},o.prototype.loadTextureEnabled=function(t,e){t.uniform1i(this.textureEnabledLocation,e?1:0)},o.prototype.loadModulateColor=function(t,e){t.uniform1i(this.modulateColorLocation,e?1:0)},o.prototype.loadTextureUnit=function(t,e){t.uniform1i(this.textureUnitLocation,e-t.TEXTURE0)},o.prototype.loadTextureMatrix=function(t,e){this.loadUniformMatrix(t,e,this.textureMatrixLocation)},o.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},o.prototype.loadApplyLighting=function(t,e){t.uniform1i(this.applyLightingLocation,e)},o}),i("geom/Vec3",["../util/Logger","../error/ArgumentError"],function(t,e){"use strict";var i=function(t,e,i){this[0]=t,this[1]=e,this[2]=i};return i.prototype=new Float64Array(3),i.ZERO=new i(0,0,0),i.average=function(i,r){if(!i||i.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","average","missingArray"));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","average","missingResult"));var o,n=i.length;r[0]=0,r[1]=0,r[2]=0;for(var s=0,a=i.length;a>s;s++)o=i[s],r[0]+=o[0]/n,r[1]+=o[1]/n,r[2]+=o[2]/n;return r},i.averageOfBuffer=function(i,r){if(!i||i.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","averageBuffer","missingArray"));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","averageBuffer","missingResult"));var o=i.length/3;r[0]=0,r[1]=0,r[2]=0;for(var n=0;o>n;n++)r[0]+=i[3*n]/o,r[1]+=i[3*n+1]/o,r[2]+=i[3*n+2]/o;return r},i.areColinear=function(i,r,o){if(!i||!r||!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var n=r.subtract(i).normalize(),s=o.subtract(r).normalize();return Math.abs(n.dot(s))>.999},i.computeTriangleNormal=function(r,o,n){if(!r||!o||!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var s=(o[1]-r[1])*(n[2]-r[2])-(o[2]-r[2])*(n[1]-r[1]),a=(o[2]-r[2])*(n[0]-r[0])-(o[0]-r[0])*(n[2]-r[2]),h=(o[0]-r[0])*(n[1]-r[1])-(o[1]-r[1])*(n[0]-r[0]),l=s*s+a*a+h*h;return 0===l?new i(s,a,h):(l=Math.sqrt(l),new i(s/l,a/l,h/l))},i.findThreeIndependentVertices=function(t,e){var r=e&&e>0?e:3;if(!t||t.length<3*r)return null;for(var o=new i(t[0],t[1],t[2]),n=null,s=null,a=r;a<t.length&&(n=new i(t[a],t[a+1],t[a+2]),n[0]===o[0]&&n[1]===o[1]&&n[2]===o[2]);a+=r)n=null;if(!n)return null;for(a+=r;a<t.length&&(s=new i(t[a],t[a+1],t[a+2]),s[0]===o[0]&&s[1]===o[1]&&s[2]===o[2]||s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]||i.areColinear(o,n,s));a+=r)s=null;return s?[o,n,s]:null},i.computeBufferNormal=function(t,e){var r=i.findThreeIndependentVertices(t,e);return r?i.computeTriangleNormal(r[0],r[1],r[2]):null},i.prototype.set=function(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this},i.prototype.copy=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","copy","missingVector"));return this[0]=i[0],this[1]=i[1],this[2]=i[2],this},i.prototype.equals=function(t){return this[0]===t[0]&&this[1]===t[1]&&this[2]===t[2]},i.prototype.add=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","add","missingVector"));return this[0]+=i[0],this[1]+=i[1],this[2]+=i[2],this},i.prototype.subtract=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","subtract","missingVector"));return this[0]-=i[0],this[1]-=i[1],this[2]-=i[2],this},i.prototype.multiply=function(t){return this[0]*=t,this[1]*=t,this[2]*=t,this},i.prototype.divide=function(t){return this[0]/=t,this[1]/=t,this[2]/=t,this},i.prototype.multiplyByMatrix=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","multiplyByMatrix","missingMatrix"));var r=i[0]*this[0]+i[1]*this[1]+i[2]*this[2]+i[3],o=i[4]*this[0]+i[5]*this[1]+i[6]*this[2]+i[7],n=i[8]*this[0]+i[9]*this[1]+i[10]*this[2]+i[11],s=i[12]*this[0]+i[13]*this[1]+i[14]*this[2]+i[15];return this[0]=r/s,this[1]=o/s,this[2]=n/s,this},i.prototype.mix=function(i,r){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","mix","missingVector"));var o=1-r,n=r;return this[0]=this[0]*o+i[0]*n,this[1]=this[1]*o+i[1]*n,this[2]=this[2]*o+i[2]*n,this},i.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this},i.prototype.dot=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","dot","missingVector"));return this[0]*i[0]+this[1]*i[1]+this[2]*i[2]},i.prototype.cross=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","cross","missingVector"));var r=this[1]*i[2]-this[2]*i[1],o=this[2]*i[0]-this[0]*i[2],n=this[0]*i[1]-this[1]*i[0];return this[0]=r,this[1]=o,this[2]=n,this},i.prototype.magnitudeSquared=function(){return this.dot(this)},i.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},i.prototype.normalize=function(){var t=this.magnitude(),e=1/t;return this[0]*=e,this[1]*=e,this[2]*=e,this},i.prototype.distanceToSquared=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","distanceToSquared","missingVector"));var r=this[0]-i[0],o=this[1]-i[1],n=this[2]-i[2];return r*r+o*o+n*n},i.prototype.distanceTo=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec3","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(i))},i.prototype.swap=function(t){var e=this[0];return this[0]=t[0],t[0]=e,e=this[1],this[1]=t[1],t[1]=e,e=this[2],this[2]=t[2],t[2]=e,this},i.prototype.toString=function(){return"("+this[0]+", "+this[1]+", "+this[2]+")"},i}),i("geom/Line",["../error/ArgumentError","../util/Logger","../geom/Vec3"],function(t,e,i){"use strict";var r=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","constructor","Origin is null or undefined."));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","constructor","Direction is null or undefined."));this.origin=i,this.direction=r};return r.fromSegment=function(o,n){if(!o||!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","fromSegment","missingPoint"));var s=new i(o[0],o[1],o[2]),a=new i(n[0]-o[0],n[1]-o[1],n[2]-o[2]);return new r(s,a)},r.prototype.pointAt=function(i,r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Line","pointAt","missingResult."));return r[0]=this.origin[0]+this.direction[0]*i,r[1]=this.origin[1]+this.direction[1]*i,r[2]=this.origin[2]+this.direction[2]*i,r},r}),i("geom/Plane",["../error/ArgumentError","../geom/Line","../util/Logger","../geom/Vec3"],function(t,e,i,r){"use strict";var o=function(t,e,i,o){this.normal=new r(t,e,i),this.distance=o};return o.fromPoints=function(e,n,s){if(!e||!n||!s)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","fromPoints","missingVector"));var a=new r(n[0],n[1],n[2]);a.subtract(e);var h=new r(s[0],s[1],s[2]);h.subtract(e),a.cross(h),a.normalize();var l=-a.dot(e);return new o(a[0],a[1],a[2],l)},o.prototype.dot=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","dot","missingVector"));return this.normal.dot(e)+this.distance},o.prototype.distanceToPoint=function(t){return this.dot(t)},o.prototype.transformByMatrix=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","transformByMatrix","missingMatrix"));var r=e[0]*this.normal[0]+e[1]*this.normal[1]+e[2]*this.normal[2]+e[3]*this.distance,o=e[4]*this.normal[0]+e[5]*this.normal[1]+e[6]*this.normal[2]+e[7]*this.distance,n=e[8]*this.normal[0]+e[9]*this.normal[1]+e[10]*this.normal[2]+e[11]*this.distance,s=e[12]*this.normal[0]+e[13]*this.normal[1]+e[14]*this.normal[2]+e[15]*this.distance;return this.normal[0]=r,this.normal[1]=o,this.normal[2]=n,this.distance=s,this},o.prototype.normalize=function(){var t=this.normal.magnitude();return 0===t?this:(this.normal.divide(t),this.distance/=t,this)},o.prototype.intersectsSegment=function(t,e){var i=this.dot(t),r=this.dot(e);return 0>=i*r},o.prototype.intersectsSegmentAt=function(t,e,i){var r=this.dot(t),o=this.dot(e);if(0===r&&0===o)return i[0]=t[0],i[1]=t[1],i[2]=t[2],!0;if(r===o)return!1;var n=-r/(o-r),s=1-n;return i[0]=n*t[0]+s*e[0],i[1]=n*t[1]+s*e[1],i[2]=n*t[2]+s*e[2],0>=r*o},o.prototype.onSameSide=function(e,r){if(!e||!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","onSameSide","missingPoint"));var o=this.distanceToPoint(e),n=this.distanceToPoint(r);return 0>o&&0>n?-1:o>0&&n>0?1:0},o.prototype.clip=function(o,n){if(!o||!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"Plane","clip","missingPoint"));if(o.equals(n))return null;var s,a,h,l=e.fromSegment(o,n),u=this.normal.dot(l.direction);return 0===u?(s=this.dot(l.origin),0===s?[o,n]:null):(a=-this.dot(l.origin)/u,0>a||a>1?null:(h=l.pointAt(a,new r(0,0,0)),u>0?[h,n]:[o,h]))},o}),i("geom/Rectangle",["../util/Logger"],function(t){"use strict";var e=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r};return e.prototype.set=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},e.prototype.getMinX=function(){return this.x},e.prototype.getMinY=function(){return this.y},e.prototype.getMaxX=function(){return this.x+this.width},e.prototype.getMaxY=function(){return this.y+this.height},e.prototype.containsPoint=function(t){return t[0]>=this.x&&t[0]<=this.x+this.width&&t[1]>=this.y&&t[1]<=this.y+this.height},e.prototype.intersects=function(t){return t.x+t.width<this.x?!1:t.x>this.x+this.width?!1:t.y+t.height<this.y?!1:t.y>this.y+this.height?!1:!0},e.prototype.intersectsRectangles=function(t){if(t)for(var e=0;e<t.length;e++)if(this.intersects(t[e]))return!0;return!1},e.prototype.toString=function(){return this.x+", "+this.y+", "+this.width+", "+this.height},e}),i("util/WWMath",["../geom/Angle","../error/ArgumentError","../geom/Line","../util/Logger","../geom/Rectangle","../geom/Vec3"],function(t,e,i,r,o,n){"use strict";var s={clamp:function(t,e,i){return e>t?e:t>i?i:t},interpolate:function(t,e,i){return(1-t)*e+t*i},cbrt:function(t){return"function"==typeof Math.cbrt?Math.cbrt(t):Math.pow(t,1/3)},computeEllipsoidalGlobeIntersection:function(t,i,o,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingLine"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingResult"));var s,a=t.direction[0],h=t.direction[1],l=t.direction[2],u=t.origin[0],c=t.origin[1],d=t.origin[2],g=i/o,p=g*g,f=i*i,m=a*a+p*h*h+l*l,E=2*(u*a+p*c*h+d*l),y=u*u+p*c*c+d*d-f,_=E*E-4*m*y;return 0>_?!1:(s=(-E-Math.sqrt(_))/(2*m),n[0]=u+a*s,n[1]=c+h*s,n[2]=d+l*s,!0)},computeTriangleIntersection:function(t,i,o,n,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingLine"));if(!i||!o||!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingVertex"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingResult"));var a=t.direction[0],h=t.direction[1],l=t.direction[2],u=t.origin[0],c=t.origin[1],d=t.origin[2],g=1e-5,p=o[0]-i[0],f=o[1]-i[1],m=o[2]-i[2],E=n[0]-i[0],y=n[1]-i[1],_=n[2]-i[2],v=h*_-l*y,L=l*E-a*_,S=a*y-h*E,T=p*v+f*L+m*S;if(T>-g&&g>T)return!1;var b=1/T,w=u-i[0],M=c-i[1],R=d-i[2],x=b*(w*v+M*L+R*S);if(-g>x||x>1+g)return!1;var C=M*m-R*f,A=R*p-w*m,P=w*f-M*p,I=b*(a*C+h*A+l*P);if(-g>I||x+I>1+g)return!1;var N=b*(E*C+y*A+_*P);return 0>N?!1:(s[0]=u+a*N,s[1]=c+h*N,s[2]=d+l*N,!0)},computeIndexedTrianglesIntersection:function(t,i,o,a){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingLine"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingPoints"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingIndices"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingResults"));for(var h=new n(0,0,0),l=new n(0,0,0),u=new n(0,0,0),c=new n(0,0,0),d=0,g=o.length;g>d;d+=3){var p=3*o[d],f=3*o[d+1],m=3*o[d+2];h[0]=i[p],h[1]=i[p+1],h[2]=i[p+2],l[0]=i[f],l[1]=i[f+1],l[2]=i[f+2],u[0]=i[m],u[1]=i[m+1],u[2]=i[m+2],s.computeTriangleIntersection(t,h,l,u,c)&&(a.push(c),c=new n(0,0,0))}return a.length>0},computeTriStripIntersections:function(t,i,o,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingLine"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingPoints"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingIndices"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingResults"));var a,h,l,u,c,d,g,p,f,m,E,y,_,v,L,S,T,b,w,M,R,x,C,A,P,I,N,O,V,D,F=t.direction[0],G=t.direction[1],W=t.direction[2],k=t.origin[0],B=t.origin[1],U=t.origin[2],j=1e-5;D=3*o[0],u=i[D++],c=i[D++],d=i[D],D=3*o[1],g=i[D++],p=i[D++],f=i[D];for(var z=2,q=o.length;q>z;z++)a=u,h=c,l=d,u=g,c=p,d=f,D=3*o[z],g=i[D++],p=i[D++],f=i[D],m=u-a,E=c-h,y=d-l,_=g-a,v=p-h,L=f-l,S=G*L-W*v,T=W*_-F*L,b=F*v-G*_,O=m*S+E*T+y*b,O>-j&&j>O||(V=1/O,w=k-a,M=B-h,R=U-l,P=V*(w*S+M*T+R*b),-j>P||P>1+j||(x=M*y-R*E,C=R*m-w*y,A=w*E-M*m,I=V*(F*x+G*C+W*A),-j>I||P+I>1+j||(N=V*(_*x+v*C+L*A),N>=0&&s.push(new n(k+F*N,B+G*N,U+W*N)))))},fabs:function(t){
return t>=0?t:-t},fmod:function(t,e){return 0===e?0:t-Math.floor(t/e)*e},fract:function(t){return t-Math.floor(t)},mod:function(t,e){return(t%e+e)%e},max:function(t,e){return t>e?t:e},localCoordinateAxesAtPoint:function(t,i,o,n,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingVector"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingGlobe"));if(!o||!n||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingResult"));var a=t[0],h=t[1],l=t[2];i.surfaceNormalAtPoint(a,h,l,s),i.northTangentAtPoint(a,h,l,n),o.set(n[0],n[1],n[2]),o.cross(s),o.normalize(),n.set(s[0],s[1],s[2]),n.cross(o),n.normalize()},horizonDistanceForGlobeRadius:function(t,i){if(0>t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","horizontalDistanceForGlobeRadius","The specified globe radius is negative."));return t>0&&i>0?Math.sqrt(i*(2*t+i)):0},perspectiveNearDistanceForFarDistance:function(t,i,o){if(0>t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified distance is negative."));if(0>i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified resolution is negative."));if(1>o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified depth bits is negative."));var n=(1<<o)-1;return t/(n/(1-i/t)-n+1)},perspectiveNearDistance:function(t,i,o){if(0>=t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidWidth"));if(0>=i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidHeight"));if(0>o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","The specified distance is negative."));var n=i/t;return 2*o/Math.sqrt(n*n+5)},perspectiveFrustumRectangle:function(t,i,n){if(0>=t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidWidth"));if(0>=i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidHeight"));if(0>n)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","The specified distance is negative."));var s=n,a=n*i/t;return new o(-s/2,-a/2,s,a)},perspectivePixelSize:function(t,i,o){if(0>=t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidWidth"));if(0>=i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidHeight"));if(0>o)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","The specified distance is negative."));var n=s.perspectiveFrustumRectangle(t,i,o).height;return n/i},boundingRectForUnitQuad:function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WWMath","boundingRectForUnitQuad","missingMatrix"));var i=t,n=i[3],s=i[7],a=i[0]+i[3],h=i[4]+i[7],l=i[1]+i[3],u=i[5]+i[7],c=i[0]+i[1]+i[3],d=i[4]+i[5]+i[7],g=Math.min(Math.min(n,a),Math.min(l,c)),p=Math.max(Math.max(n,a),Math.max(l,c)),f=Math.min(Math.min(s,h),Math.min(u,d)),m=Math.max(Math.max(s,h),Math.max(u,d));return new o(g,f,p-g,m-f)},isPowerOfTwo:function(t){return 0!=t&&0===(t&t-1)},signum:function(t){return t>0?1:0>t?-1:0},gudermannianInverse:function(e){return Math.log(Math.tan(Math.PI/4+e*t.DEGREES_TO_RADIANS/2))/Math.PI},epsg3857ToEpsg4326:function(e,i){var r=6378100,o=Math.PI/2-2*Math.atan(Math.exp(-i/r)),n=e/r;return[s.clamp(o*t.RADIANS_TO_DEGREES,-90,90),s.clamp(n*t.RADIANS_TO_DEGREES,-180,180)]}};return s}),i("geom/Location",["../geom/Angle","../error/ArgumentError","../util/Logger","../geom/Plane","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n){"use strict";var s=function(t,e){this.latitude=t,this.longitude=e};return s.ZERO=new s(0,0),s.fromRadians=function(e,i){return new s(e*t.RADIANS_TO_DEGREES,i*t.RADIANS_TO_DEGREES)},s.prototype.copy=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","copy","missingLocation"));return this.latitude=t.latitude,this.longitude=t.longitude,this},s.prototype.set=function(t,e){return this.latitude=t,this.longitude=e,this},s.prototype.equals=function(t){return t&&t.latitude===this.latitude&&t.longitude===this.longitude},s.interpolateAlongPath=function(t,r,o,n,s){if(!o||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateAlongPath","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateAlongPath","missingResult"));return t===WorldWind.GREAT_CIRCLE?this.interpolateGreatCircle(r,o,n,s):t&&t===WorldWind.RHUMB_LINE?this.interpolateRhumb(r,o,n,s):this.interpolateLinear(r,o,n,s)},s.interpolateGreatCircle=function(t,r,o,s){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingResult"));if(r.equals(o))return s.latitude=r.latitude,s.longitude=r.longitude,s;var a=n.clamp(t,0,1),h=this.greatCircleAzimuth(r,o),l=this.greatCircleDistance(r,o);return this.greatCircleLocation(r,h,a*l,s)},s.greatCircleAzimuth=function(r,o){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleAzimuth","missingLocation"));var n,s,a,h=r.latitude*t.DEGREES_TO_RADIANS,l=o.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,c=o.longitude*t.DEGREES_TO_RADIANS;return h==l&&u==c?0:u==c?h>l?180:0:(s=Math.cos(l)*Math.sin(c-u),n=Math.cos(h)*Math.sin(l)-Math.sin(h)*Math.cos(l)*Math.cos(c-u),a=Math.atan2(s,n),isNaN(a)?0:a*t.RADIANS_TO_DEGREES)},s.greatCircleDistance=function(r,o){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleDistance","missingLocation"));var n,s,a,h,l=r.latitude*t.DEGREES_TO_RADIANS,u=o.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,d=o.longitude*t.DEGREES_TO_RADIANS;return l==u&&c==d?0:(n=Math.sin((u-l)/2),s=Math.sin((d-c)/2),a=n*n+Math.cos(l)*Math.cos(u)*s*s,h=2*Math.asin(Math.sqrt(a)),isNaN(h)?0:h)},s.greatCircleLocation=function(r,o,n,s){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleLocation","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleLocation","missingResult"));if(0==n)return s.latitude=r.latitude,s.longitude=r.longitude,s;var a,h,l=r.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,c=o*t.DEGREES_TO_RADIANS;return a=Math.asin(Math.sin(l)*Math.cos(n)+Math.cos(l)*Math.sin(n)*Math.cos(c)),h=u+Math.atan2(Math.sin(n)*Math.sin(c),Math.cos(l)*Math.cos(n)-Math.sin(l)*Math.sin(n)*Math.cos(c)),isNaN(a)||isNaN(h)?(s.latitude=r.latitude,s.longitude=r.longitude):(s.latitude=t.normalizedDegreesLatitude(a*t.RADIANS_TO_DEGREES),s.longitude=t.normalizedDegreesLongitude(h*t.RADIANS_TO_DEGREES)),s},s.interpolateRhumb=function(t,r,o,s){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateRhumb","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateRhumb","missingResult"));if(r.equals(o))return s.latitude=r.latitude,s.longitude=r.longitude,s;var a=n.clamp(t,0,1),h=this.rhumbAzimuth(r,o),l=this.rhumbDistance(r,o);return this.rhumbLocation(r,h,a*l,s)},s.rhumbAzimuth=function(r,o){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbAzimuth","missingLocation"));var s,a,h,l=r.latitude*t.DEGREES_TO_RADIANS,u=o.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,d=o.longitude*t.DEGREES_TO_RADIANS;return l==u&&c==d?0:(s=d-c,a=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(l/2+Math.PI/4)),n.fabs(s)>Math.PI&&(s=s>0?-(2*Math.PI-s):2*Math.PI+s),h=Math.atan2(s,a),isNaN(h)?0:h*t.RADIANS_TO_DEGREES)},s.rhumbDistance=function(r,o){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbDistance","missingLocation"));var s,a,h,l,u,c=r.latitude*t.DEGREES_TO_RADIANS,d=o.latitude*t.DEGREES_TO_RADIANS,g=r.longitude*t.DEGREES_TO_RADIANS,p=o.longitude*t.DEGREES_TO_RADIANS;return c==d&&g==p?0:(s=d-c,a=p-g,h=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),l=s/h,(isNaN(h)||isNaN(l))&&(l=Math.cos(c)),n.fabs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),u=Math.sqrt(s*s+l*l*a*a),isNaN(u)?0:u)},s.rhumbLocation=function(r,o,s,a){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbLocation","missingLocation"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","rhumbLocation","missingResult"));if(0==s)return a.latitude=r.latitude,a.longitude=r.longitude,a;var h,l,u=r.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,d=o*t.DEGREES_TO_RADIANS,g=u+s*Math.cos(d),p=Math.log(Math.tan(g/2+Math.PI/4)/Math.tan(u/2+Math.PI/4)),f=(g-u)/p;return(isNaN(p)||isNaN(f)||!isFinite(f))&&(f=Math.cos(u)),h=s*Math.sin(d)/f,n.fabs(g)>Math.PI/2&&(g=g>0?Math.PI-g:-Math.PI-g),l=n.fmod(c+h+Math.PI,2*Math.PI)-Math.PI,isNaN(g)||isNaN(l)?(a.latitude=r.latitude,a.longitude=r.longitude):(a.latitude=t.normalizedDegreesLatitude(g*t.RADIANS_TO_DEGREES),a.longitude=t.normalizedDegreesLongitude(l*t.RADIANS_TO_DEGREES)),a},s.interpolateLinear=function(t,r,o,s){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateLinear","missingLocation"));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","interpolateLinear","missingResult"));if(r.equals(o))return s.latitude=r.latitude,s.longitude=r.longitude,s;var a=n.clamp(t,0,1),h=this.linearAzimuth(r,o),l=this.linearDistance(r,o);return this.linearLocation(r,h,a*l,s)},s.linearAzimuth=function(r,o){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearAzimuth","missingLocation"));var s,a,h,l=r.latitude*t.DEGREES_TO_RADIANS,u=o.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,d=o.longitude*t.DEGREES_TO_RADIANS;return l==u&&c==d?0:(s=d-c,a=u-l,n.fabs(s)>Math.PI&&(s=s>0?-(2*Math.PI-s):2*Math.PI+s),h=Math.atan2(s,a),isNaN(h)?0:h*t.RADIANS_TO_DEGREES)},s.linearDistance=function(r,o){if(!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearDistance","missingLocation"));var s,a,h,l=r.latitude*t.DEGREES_TO_RADIANS,u=o.latitude*t.DEGREES_TO_RADIANS,c=r.longitude*t.DEGREES_TO_RADIANS,d=o.longitude*t.DEGREES_TO_RADIANS;return l==u&&c==d?0:(s=u-l,a=d-c,n.fabs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),h=Math.sqrt(s*s+a*a),isNaN(h)?0:h)},s.linearLocation=function(r,o,s,a){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearLocation","missingLocation"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","linearLocation","missingResult"));if(0==s)return a.latitude=r.latitude,a.longitude=r.longitude,a;var h,l=r.latitude*t.DEGREES_TO_RADIANS,u=r.longitude*t.DEGREES_TO_RADIANS,c=o*t.DEGREES_TO_RADIANS,d=l+s*Math.cos(c);return n.fabs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d),h=n.fmod(u+s*Math.sin(c)+Math.PI,2*Math.PI)-Math.PI,isNaN(d)||isNaN(h)?(a.latitude=r.latitude,a.longitude=r.longitude):(a.latitude=t.normalizedDegreesLatitude(d*t.RADIANS_TO_DEGREES),a.longitude=t.normalizedDegreesLongitude(h*t.RADIANS_TO_DEGREES)),a},s.locationsCrossDateLine=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","locationsCrossDateline","missingLocation"));for(var r=null,o=0,s=t.length;s>o;o+=1){var a=t[o];if(null!=r&&n.signum(r.longitude)!=n.signum(a.longitude)){var h=Math.abs(r.longitude-a.longitude);if(h>180&&360>h)return!0}r=a}return!1},s.greatCircleArcExtremeLocations=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocations","missingLocation"));for(var r=null,o=null,n=null,a=0,h=t.length;h>a;a+=1){var l=t[a];if(null!=n){var u=s.greatCircleArcExtremeForTwoLocations(n,l);if(null==u)continue;(null==r||r.latitude>u[0].latitude)&&(r=u[0]),(null==o||o.latitude<u[1].latitude)&&(o=u[1])}n=l}return[r,o]},s.greatCircleArcExtremeForTwoLocations=function(t,r){if(!t||!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleArcExtremeForTwoLocations","missingLocation"));var o,a,h,l=null,u=null,c=90,d=-90,g=[t,r];for(o=0,a=g.length;a>o;o+=1)h=g[o],c>=h.latitude&&(c=h.latitude,l=h),d<=h.latitude&&(d=h.latitude,u=h);var p=s.greatCircleAzimuth(t,r),f=s.greatCircleDistance(t,r),m=s.greatCircleExtremeLocationsUsingAzimuth(t,p);for(o=0,a=m.length;a>o;o+=1){h=m[o];var E=s.greatCircleAzimuth(t,h),y=s.greatCircleDistance(t,h);n.signum(E)==n.signum(p)&&y>=0&&f>=y&&(c>=h.latitude&&(c=h.latitude,l=h),d<=h.latitude&&(d=h.latitude,u=h))}return[l,u]},s.greatCircleExtremeLocationsUsingAzimuth=function(r,o){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocationsUsingAzimuth","missingLocation"));var n=r.latitude,a=o*t.DEGREES_TO_RADIANS,h=-Math.tan(n)/Math.cos(a),l=Math.atan(h),u=l+Math.PI/2,c=l-Math.PI/2;return[s.greatCircleLocation(r,o,u,new s(0,0)),s.greatCircleLocation(r,o,c,new s(0,0))]},s.intersectionWithMeridian=function(t,e,i,n){var s=n.computePointFromLocation(t.latitude,t.longitude,new o(0,0,0)),a=n.computePointFromLocation(e.latitude,e.longitude,new o(0,0,0)),h=n.computePointFromLocation(90,i,new o(0,0,0)),l=n.computePointFromLocation(0,i,new o(0,0,0)),u=r.fromPoints(h,l,o.ZERO),c=new o(0,0,0);if(!u.intersectsSegmentAt(s,a,c))return null;var d=new WorldWind.Position(0,0,0);return n.computePositionFromPoint(c[0],c[1],c[2],d),d.latitude},s.poles={NONE:0,NORTH:1,SOUTH:2},s}),i("geom/Sector",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n){"use strict";var s=function(t,e,i,r){this.minLatitude=t,this.maxLatitude=e,this.minLongitude=i,this.maxLongitude=r};return s.ZERO=new s(0,0,0,0),s.FULL_SPHERE=new s(-90,90,-180,180),s.prototype.copy=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","copy","missingSector"));return this.minLatitude=t.minLatitude,this.maxLatitude=t.maxLatitude,this.minLongitude=t.minLongitude,this.maxLongitude=t.maxLongitude,this},s.prototype.isEmpty=function(){return this.minLatitude===this.maxLatitude&&this.minLongitude===this.maxLongitude},s.prototype.deltaLatitude=function(){return this.maxLatitude-this.minLatitude},s.prototype.deltaLongitude=function(){return this.maxLongitude-this.minLongitude},s.prototype.centroidLatitude=function(){return.5*(this.minLatitude+this.maxLatitude)},s.prototype.centroidLongitude=function(){return.5*(this.minLongitude+this.maxLongitude)},s.prototype.centroid=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","centroid","missingResult"));return t.latitude=this.centroidLatitude(),t.longitude=this.centroidLongitude(),t},s.prototype.minLatitudeRadians=function(){return this.minLatitude*t.DEGREES_TO_RADIANS},s.prototype.maxLatitudeRadians=function(){return this.maxLatitude*t.DEGREES_TO_RADIANS},s.prototype.minLongitudeRadians=function(){return this.minLongitude*t.DEGREES_TO_RADIANS},s.prototype.maxLongitudeRadians=function(){return this.maxLongitude*t.DEGREES_TO_RADIANS},s.prototype.setToBoundingSector=function(t){if(!t||t.length<2)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","setToBoundingSector","missingArray"));for(var i=90,o=-90,n=180,s=-180,a=0,h=t.length;h>a;a+=1){var l=t[a];l&&(i=Math.min(i,l.latitude),o=Math.max(o,l.latitude),n=Math.min(n,l.longitude),s=Math.max(s,l.longitude))}return this.minLatitude=i,this.maxLatitude=o,this.minLongitude=n,this.maxLongitude=s,this},s.splitBoundingSectors=function(t){if(!t||t.length<2)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","splitBoundingSectors","missingArray"));for(var i=90,o=180,a=-90,h=-180,l=null,u=0,c=t.length;c>u;u+=1){var d=t[u],g=d.latitude;i>g&&(i=g),g>a&&(a=g);var p=d.longitude;if(p>=0&&o>p&&(o=p),0>=p&&p>h&&(h=p),null!=l){var f=l.longitude;n.signum(p)!=n.signum(f)&&Math.abs(p-f)<180&&(h=0,o=0)}l=d}return i===a&&o===h?null:[new s(i,a,o,180),new s(i,a,-180,h)]},s.prototype.intersects=function(t){return t&&this.minLongitude<=t.maxLongitude&&this.maxLongitude>=t.minLongitude&&this.minLatitude<=t.maxLatitude&&this.maxLatitude>=t.minLatitude},s.prototype.overlaps=function(t){return t&&this.minLongitude<t.maxLongitude&&this.maxLongitude>t.minLongitude&&this.minLatitude<t.maxLatitude&&this.maxLatitude>t.minLatitude},s.prototype.contains=function(t){return t&&this.minLatitude<=t.minLatitude&&this.maxLatitude>=t.maxLatitude&&this.minLongitude<=t.minLongitude&&this.maxLongitude>=t.maxLongitude},s.prototype.containsLocation=function(t,e){return this.minLatitude<=t&&this.maxLatitude>=t&&this.minLongitude<=e&&this.maxLongitude>=e},s.prototype.intersection=function(t){if(!t instanceof s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","intersection","missingSector"));return this.minLatitude<t.minLatitude&&(this.minLatitude=t.minLatitude),this.maxLatitude>t.maxLatitude&&(this.maxLatitude=t.maxLatitude),this.minLongitude<t.minLongitude&&(this.minLongitude=t.minLongitude),this.maxLongitude>t.maxLongitude&&(this.maxLongitude=t.maxLongitude),this.maxLatitude<this.minLatitude&&(this.maxLatitude=this.minLatitude),this.maxLongitude<this.minLongitude&&(this.maxLongitude=this.minLongitude),this},s.prototype.union=function(t){if(!t instanceof s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Sector","union","missingSector"));return this.minLatitude>t.minLatitude&&(this.minLatitude=t.minLatitude),this.maxLatitude<t.maxLatitude&&(this.maxLatitude=t.maxLatitude),this.minLongitude>t.minLongitude&&(this.minLongitude=t.minLongitude),this.maxLongitude<t.maxLongitude&&(this.maxLongitude=t.maxLongitude),this},s}),i("util/AbsentResourceList",[],function(){"use strict";var t=function(t,e){this.maxTrys=t,this.minCheckInterval=e,this.tryAgainInterval=6e4,this.possiblyAbsent={}};return t.prototype.isResourceAbsent=function(t){var e=this.possiblyAbsent[t];if(!e)return!1;if(e.permanent)return!0;var i=Date.now()-e.timeOfLastMark;return i>this.tryAgainInterval?(delete this.possiblyAbsent[t],!1):i<this.minCheckInterval||e.numTrys>this.maxTrys},t.prototype.markResourceAbsent=function(t){var e=this.possiblyAbsent[t];e||(e={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[t]=e),e.numTrys=e.numTrys+1,e.timeOfLastMark=Date.now()},t.prototype.markResourceAbsentPermanently=function(t){var e=this.possiblyAbsent[t];e||(e={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[t]=e),e.numTrys=e.numTrys+1,e.timeOfLastMark=Date.now(),e.permanent=!0},t.prototype.unmarkResourceAbsent=function(t){var e=this.possiblyAbsent[t];e&&delete this.possiblyAbsent[t]},t}),i("geom/Position",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../util/WWMath"],function(t,e,i,r,o){"use strict";var n=function(t,e,i){this.latitude=t,this.longitude=e,this.altitude=i};return n.ZERO=new n(0,0,0),n.fromRadians=function(e,i,r){return new n(e*t.RADIANS_TO_DEGREES,i*t.RADIANS_TO_DEGREES,r)},n.prototype.copy=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","copy","missingPosition"));return this.latitude=t.latitude,this.longitude=t.longitude,this.altitude=t.altitude,this},n.prototype.equals=function(t){return t&&t.latitude===this.latitude&&t.longitude===this.longitude&&t.altitude===this.altitude},n.interpolateGreatCircle=function(t,n,s,a){if(!n||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingPosition"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingResult"));var h=o.clamp(t,0,1);return a.altitude=o.interpolate(h,n.altitude,s.altitude),i.interpolateGreatCircle(h,n,s,a),a},n.interpolateRhumb=function(t,n,s,a){if(!n||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingPosition"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingResult"));var h=o.clamp(t,0,1);return a.altitude=o.interpolate(h,n.altitude,s.altitude),i.interpolateRhumb(h,n,s,a),a},n.interpolateLinear=function(t,n,s,a){if(!n||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingPosition"));if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingResult"));var h=o.clamp(t,0,1);return a.altitude=o.interpolate(h,n.altitude,s.altitude),i.interpolateLinear(h,n,s,a),a},n.prototype.toString=function(){return"("+this.latitude.toString()+"°, "+this.longitude.toString()+"°, "+this.altitude.toString()},n}),i("render/Texture",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(t,e,i){"use strict";var r=function(r,o){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"Texture","constructor","missingImage"));var n=r.createTexture(),s=i.isPowerOfTwo(o.width)&&i.isPowerOfTwo(o.height);this.imageWidth=o.width,this.imageHeight=o.height,this.size=o.width*o.height*4,this.originalImageWidth=this.imageWidth,this.originalImageHeight=this.imageHeight,r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,s?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var a=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");a&&r.texParameteri(r.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,4),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),s&&r.generateMipmap(r.TEXTURE_2D),this.textureId=n,this.creationTime=new Date};return r.prototype.dispose=function(t){t.deleteTexture(this.textureId),delete this.textureId},r.prototype.bind=function(t){return t.currentGlContext.bindTexture(t.currentGlContext.TEXTURE_2D,this.textureId),t.frameStatistics.incrementTextureLoadCount(1),!0},r}),i("geom/Matrix",["../geom/Angle","../error/ArgumentError","../util/Logger","../geom/Plane","../geom/Position","../geom/Rectangle","../render/Texture","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h){"use strict";var l=function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f){this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=o,this[5]=n,this[6]=s,this[7]=a,this[8]=h,this[9]=l,this[10]=u,this[11]=c,this[12]=d,this[13]=g,this[14]=p,this[15]=f};return l.prototype=new Float64Array(16),l.fromIdentity=function(){return new l(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},l.principalAxesFromPoints=function(t,r,o,n){if(!t||t.length<1)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","missingPoints"));if(!r||!o||!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","An axis argument is null or undefined."));var s=l.fromIdentity();s.setToCovarianceOfPoints(t),s.eigensystemFromSymmetricMatrix(r,o,n),r.normalize(),o.normalize(),n.normalize()},l.prototype.set=function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f){return this[0]=t,this[1]=e,this[2]=i,this[3]=r,this[4]=o,this[5]=n,this[6]=s,this[7]=a,this[8]=h,this[9]=l,this[10]=u,this[11]=c,this[12]=d,this[13]=g,this[14]=p,this[15]=f,this},l.prototype.setToIdentity=function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},l.prototype.copy=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","copy","missingMatrix"));this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15]},l.prototype.equals=function(t){return t&&this[0]==t[0]&&this[1]==t[1]&&this[2]==t[2]&&this[3]==t[3]&&this[4]==t[4]&&this[5]==t[5]&&this[6]==t[6]&&this[7]==t[7]&&this[8]==t[8]&&this[9]==t[9]&&this[10]==t[10]&&this[11]==t[11]&&this[12]==t[12]&&this[13]==t[13]&&this[14]==t[14]&&this[15]==t[15]},l.prototype.columnMajorComponents=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","columnMajorComponents","missingResult"));return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t},l.prototype.setToTranslation=function(t,e,i){return this[0]=1,this[1]=0,this[2]=0,this[3]=t,this[4]=0,this[5]=1,this[6]=0,this[7]=e,this[8]=0,this[9]=0,this[10]=1,this[11]=i,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},l.prototype.setTranslation=function(t,e,i){return this[3]=t,this[7]=e,this[11]=i,this},l.prototype.setToScale=function(t,e,i){return this[0]=t,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=e,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=i,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},l.prototype.setScale=function(t,e,i){return this[0]=t,this[5]=e,this[10]=i,this},l.prototype.setToTransposeOfMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToTransposeOfMatrix","missingMatrix"));return this[0]=t[0],this[1]=t[4],this[2]=t[8],this[3]=t[12],this[4]=t[1],this[5]=t[5],this[6]=t[9],this[7]=t[13],this[8]=t[2],this[9]=t[6],this[10]=t[10],this[11]=t[14],this[12]=t[3],this[13]=t[7],this[14]=t[11],this[15]=t[15],this},l.prototype.setToMultiply=function(t,r){if(!t||!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToMultiply","missingMatrix"));var o=t,n=r;return this[0]=o[0]*n[0]+o[1]*n[4]+o[2]*n[8]+o[3]*n[12],this[1]=o[0]*n[1]+o[1]*n[5]+o[2]*n[9]+o[3]*n[13],this[2]=o[0]*n[2]+o[1]*n[6]+o[2]*n[10]+o[3]*n[14],this[3]=o[0]*n[3]+o[1]*n[7]+o[2]*n[11]+o[3]*n[15],this[4]=o[4]*n[0]+o[5]*n[4]+o[6]*n[8]+o[7]*n[12],this[5]=o[4]*n[1]+o[5]*n[5]+o[6]*n[9]+o[7]*n[13],this[6]=o[4]*n[2]+o[5]*n[6]+o[6]*n[10]+o[7]*n[14],this[7]=o[4]*n[3]+o[5]*n[7]+o[6]*n[11]+o[7]*n[15],this[8]=o[8]*n[0]+o[9]*n[4]+o[10]*n[8]+o[11]*n[12],this[9]=o[8]*n[1]+o[9]*n[5]+o[10]*n[9]+o[11]*n[13],this[10]=o[8]*n[2]+o[9]*n[6]+o[10]*n[10]+o[11]*n[14],this[11]=o[8]*n[3]+o[9]*n[7]+o[10]*n[11]+o[11]*n[15],this[12]=o[12]*n[0]+o[13]*n[4]+o[14]*n[8]+o[15]*n[12],this[13]=o[12]*n[1]+o[13]*n[5]+o[14]*n[9]+o[15]*n[13],this[14]=o[12]*n[2]+o[13]*n[6]+o[14]*n[10]+o[15]*n[14],this[15]=o[12]*n[3]+o[13]*n[7]+o[14]*n[11]+o[15]*n[15],this},l.prototype.setToCovarianceOfPoints=function(t){if(!t||t.length<1)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToCovarianceOfPoints","missingArray"));var r,o,n,s,h=0,l=0,u=0,c=0,d=0,g=0,p=0,f=new a(0,0,0);r=a.averageOfBuffer(t,new a(0,0,0));for(var m=0,E=t.length/3;E>m;m++)f[0]=t[3*m],f[1]=t[3*m+1],f[2]=t[3*m+2],o=f[0]-r[0],n=f[1]-r[1],s=f[2]-r[2],++h,l+=o*o,u+=n*n,c+=s*s,d+=o*n,g+=o*s,p+=n*s;return this[0]=l/h,this[1]=d/h,this[2]=g/h,this[3]=0,this[4]=d/h,this[5]=u/h,this[6]=p/h,this[7]=0,this[8]=g/h,this[9]=p/h,this[10]=c/h,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=0,this},l.prototype.multiplyByTranslation=function(t,e,i){return this.multiply(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},l.prototype.multiplyByRotation=function(e,i,r,o){var n=Math.cos(o*t.DEGREES_TO_RADIANS),s=Math.sin(o*t.DEGREES_TO_RADIANS);return this.multiply(n+(1-n)*e*e,(1-n)*e*i-s*r,(1-n)*e*r+s*i,0,(1-n)*e*i+s*r,n+(1-n)*i*i,(1-n)*i*r-s*e,0,(1-n)*e*r-s*i,(1-n)*i*r+s*e,n+(1-n)*r*r,0,0,0,0,1),this},l.prototype.multiplyByScale=function(t,e,i){return this.multiply(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},l.prototype.setToUnitYFlip=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=-1,this[6]=0,this[7]=1,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},l.prototype.multiplyByLocalCoordinateTransform=function(t,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","Origin vector is null or undefined"));if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","missingGlobe"));var o=new a(0,0,0),n=new a(0,0,0),s=new a(0,0,0);return h.localCoordinateAxesAtPoint(t,r,o,n,s),this.multiply(o[0],n[0],s[0],t[0],o[1],n[1],s[1],t[1],o[2],n[2],s[2],t[2],0,0,0,1),this},l.prototype.multiplyByTextureTransform=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByTextureTransform","missingTexture"));var r=t.originalImageWidth/t.imageWidth,o=t.originalImageHeight/t.imageHeight;return this.multiply(r,0,0,0,0,-o,0,o,0,0,1,0,0,0,0,1),this},l.prototype.extractTranslation=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractTranslation","missingResult"));return t[0]=this[3],t[1]=this[7],t[2]=this[11],t},l.prototype.extractRotationAngles=function(r){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractRotationAngles","missingResult"));var o=Math.atan2(this[6],this[10]),n=Math.atan2(-this[2],Math.sqrt(this[0]*this[0]+this[1]*this[1])),s=Math.cos(o),a=Math.sin(o),h=Math.atan2(a*this[8]-s*this[4],s*this[5]-a*this[9]);return r[0]=o*t.RADIANS_TO_DEGREES,r[1]=n*t.RADIANS_TO_DEGREES,r[2]=h*t.RADIANS_TO_DEGREES,r},l.prototype.multiplyByFirstPersonModelview=function(r,o,n,s,l){if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingPosition"));if(!l)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingGlobe"));var u,c,d,g,p,f,m,E,y,_,v,L,S,T,b=new a(0,0,0),w=new a(0,0,0),M=new a(0,0,0),R=new a(0,0,0);return u=Math.cos(s*t.DEGREES_TO_RADIANS),c=Math.sin(s*t.DEGREES_TO_RADIANS),this.multiply(u,c,0,0,-c,u,0,0,0,0,1,0,0,0,0,1),u=Math.cos(n*t.DEGREES_TO_RADIANS),c=Math.sin(n*t.DEGREES_TO_RADIANS),this.multiply(1,0,0,0,0,u,c,0,0,-c,u,0,0,0,0,1),u=Math.cos(o*t.DEGREES_TO_RADIANS),c=Math.sin(o*t.DEGREES_TO_RADIANS),this.multiply(u,-c,0,0,c,u,0,0,0,0,1,0,0,0,0,1),l.computePointFromPosition(r.latitude,r.longitude,r.altitude,b),d=b[0],g=b[1],p=b[2],h.localCoordinateAxesAtPoint(b,l,w,M,R),f=w[0],m=w[1],E=w[2],y=M[0],_=M[1],v=M[2],L=R[0],S=R[1],T=R[2],this.multiply(f,m,E,-f*d-m*g-E*p,y,_,v,-y*d-_*g-v*p,L,S,T,-L*d-S*g-T*p,0,0,0,1),this},l.prototype.multiplyByLookAtModelview=function(t,r,o,n,s,a){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingPosition"));if(0>r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","Range is less than zero"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingGlobe"));return this.multiplyByTranslation(0,0,-r),this.multiplyByFirstPersonModelview(t,o,n,s,a),this},l.prototype.setToPerspectiveProjection=function(t,r,o,n){if(0>=t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidWidth"));if(0>=r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidHeight"));if(o===n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near and far distance are the same."));if(0>=o||0>=n)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near or far distance is less than or equal to zero."));var s=h.perspectiveFrustumRectangle(t,r,o),a=s.getMinX(),l=s.getMaxX(),u=s.getMinY(),c=s.getMaxY();return this[0]=2*o/(l-a),this[1]=0,this[2]=(l+a)/(l-a),this[3]=0,this[4]=0,this[5]=2*o/(c-u),this[6]=(c+u)/(c-u),this[7]=0,this[8]=0,this[9]=0,this[10]=-(n+o)/(n-o),this[11]=-2*o*n/(n-o),this[12]=0,this[13]=0,this[14]=-1,this[15]=0,this},l.prototype.setToScreenProjection=function(t,r){if(0>=t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidWidth"));if(0>=r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidHeight"));return this[0]=2/t,this[1]=0,this[2]=0,this[3]=-1,this[4]=0,this[5]=2/r,this[6]=0,this[7]=-1,this[8]=0,this[9]=0,this[10]=2,this[11]=-1,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},l.prototype.extractEyePoint=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractEyePoint","missingResult"));return t[0]=-(this[0]*this[3])-this[4]*this[7]-this[8]*this[11],t[1]=-(this[1]*this[3])-this[5]*this[7]-this[9]*this[11],t[2]=-(this[2]*this[3])-this[6]*this[7]-this[10]*this[11],t},l.prototype.extractForwardVector=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractForwardVector","missingResult"));return t[0]=-this[8],t[1]=-this[9],t[2]=-this[10],t},l.prototype.extractViewingParameters=function(r,n,s,a){
if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractViewingParameters","The specified origin is null or undefined."));if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingGlobe"));if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingResult"));var h,u,c,d,g,p,f,m,E,y=new o(0,0,0),_=l.fromIdentity();return s.computePositionFromPoint(r[0],r[1],r[2],y),_.copy(this),_.multiplyByLocalCoordinateTransform(r,s),h=-_[11],u=_[10],c=Math.sqrt(_[2]*_[2]+_[6]*_[6]),d=Math.atan2(c,u)*t.RADIANS_TO_DEGREES,g=Math.cos(n*t.DEGREES_TO_RADIANS),p=Math.sin(n*t.DEGREES_TO_RADIANS),f=g*_[0]-p*_[4],m=p*_[5]-g*_[1],E=Math.atan2(m,f)*t.RADIANS_TO_DEGREES,a.origin=y,a.range=h,a.heading=E,a.tilt=d,a.roll=n,a},l.prototype.offsetProjectionDepth=function(t){return this[10]*=1+t,this},l.prototype.multiplyMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","multiplyMatrix","missingMatrix"));var r,o,n,s,a=this,h=t;return r=a[0],o=a[1],n=a[2],s=a[3],a[0]=r*h[0]+o*h[4]+n*h[8]+s*h[12],a[1]=r*h[1]+o*h[5]+n*h[9]+s*h[13],a[2]=r*h[2]+o*h[6]+n*h[10]+s*h[14],a[3]=r*h[3]+o*h[7]+n*h[11]+s*h[15],r=a[4],o=a[5],n=a[6],s=a[7],a[4]=r*h[0]+o*h[4]+n*h[8]+s*h[12],a[5]=r*h[1]+o*h[5]+n*h[9]+s*h[13],a[6]=r*h[2]+o*h[6]+n*h[10]+s*h[14],a[7]=r*h[3]+o*h[7]+n*h[11]+s*h[15],r=a[8],o=a[9],n=a[10],s=a[11],a[8]=r*h[0]+o*h[4]+n*h[8]+s*h[12],a[9]=r*h[1]+o*h[5]+n*h[9]+s*h[13],a[10]=r*h[2]+o*h[6]+n*h[10]+s*h[14],a[11]=r*h[3]+o*h[7]+n*h[11]+s*h[15],r=a[12],o=a[13],n=a[14],s=a[15],a[12]=r*h[0]+o*h[4]+n*h[8]+s*h[12],a[13]=r*h[1]+o*h[5]+n*h[9]+s*h[13],a[14]=r*h[2]+o*h[6]+n*h[10]+s*h[14],a[15]=r*h[3]+o*h[7]+n*h[11]+s*h[15],this},l.prototype.multiply=function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f){var m,E,y,_,v=this;return m=v[0],E=v[1],y=v[2],_=v[3],v[0]=m*t+E*o+y*h+_*d,v[1]=m*e+E*n+y*l+_*g,v[2]=m*i+E*s+y*u+_*p,v[3]=m*r+E*a+y*c+_*f,m=v[4],E=v[5],y=v[6],_=v[7],v[4]=m*t+E*o+y*h+_*d,v[5]=m*e+E*n+y*l+_*g,v[6]=m*i+E*s+y*u+_*p,v[7]=m*r+E*a+y*c+_*f,m=v[8],E=v[9],y=v[10],_=v[11],v[8]=m*t+E*o+y*h+_*d,v[9]=m*e+E*n+y*l+_*g,v[10]=m*i+E*s+y*u+_*p,v[11]=m*r+E*a+y*c+_*f,m=v[12],E=v[13],y=v[14],_=v[15],v[12]=m*t+E*o+y*h+_*d,v[13]=m*e+E*n+y*l+_*g,v[14]=m*i+E*s+y*u+_*p,v[15]=m*r+E*a+y*c+_*f,this},l.prototype.invertMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","invertMatrix","missingMatrix"));var r=[[],[],[],[]];r[0][0]=t[0],r[0][1]=t[1],r[0][2]=t[2],r[0][3]=t[3],r[1][0]=t[4],r[1][1]=t[5],r[1][2]=t[6],r[1][3]=t[7],r[2][0]=t[8],r[2][1]=t[9],r[2][2]=t[10],r[2][3]=t[11],r[3][0]=t[12],r[3][1]=t[13],r[3][2]=t[14],r[3][3]=t[15];var o,n,s=[],a=l.ludcmp(r,s);for(o=0;4>o;o+=1)a*=r[o][o];if(Math.abs(a)<1e-8)return null;var h=[[],[],[],[]],u=[];for(n=0;4>n;n+=1){for(o=0;4>o;o+=1)u[o]=0;for(u[n]=1,l.lubksb(r,s,u),o=0;4>o;o+=1)h[o][n]=u[o]}return this[0]=h[0][0],this[1]=h[0][1],this[2]=h[0][2],this[3]=h[0][3],this[4]=h[1][0],this[5]=h[1][1],this[6]=h[1][2],this[7]=h[1][3],this[8]=h[2][0],this[9]=h[2][1],this[10]=h[2][2],this[11]=h[2][3],this[12]=h[3][0],this[13]=h[3][1],this[14]=h[3][2],this[15]=h[3][3],this},l.lubksb=function(t,e,i){var r,o,n,s=-1;for(r=0;4>r;r+=1){var a=e[r];if(n=i[a],i[a]=i[r],-1!=s)for(o=s;r-1>=o;o+=1)n-=t[r][o]*i[o];else 0!=n&&(s=r);i[r]=n}for(r=3;r>=0;r-=1){for(n=i[r],o=r+1;4>o;o+=1)n-=t[r][o]*i[o];i[r]=n/t[r][r]}},l.ludcmp=function(t,e){var i,r,o,n,s,a,h,l,u=1e-20,c=[],d=1;for(r=0;4>r;r+=1){for(s=0,o=0;4>o;o+=1)(i=Math.abs(t[r][o]))>s&&(s=i);if(0==s)return 0;c[r]=1/s}for(o=0;4>o;o+=1){for(r=0;o>r;r+=1){for(a=t[r][o],n=0;r>n;n+=1)a-=t[r][n]*t[n][o];t[r][o]=a}for(s=0,h=-1,r=o;4>r;r+=1){for(a=t[r][o],n=0;o>n;n++)a-=t[r][n]*t[n][o];t[r][o]=a,(l=c[r]*Math.abs(a))>=s&&(s=l,h=r)}if(o!=h){for(n=0;4>n;n+=1)l=t[h][n],t[h][n]=t[o][n],t[o][n]=l;d=-d,c[h]=c[o]}if(e[o]=h,0==t[o][o]&&(t[o][o]=u),3!=o)for(l=1/t[o][o],r=o+1;4>r;r+=1)t[r][o]*=l}return d},l.prototype.invertOrthonormalMatrix=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","invertOrthonormalMatrix","missingMatrix"));var r=t;return this[0]=r[0],this[1]=r[4],this[2]=r[8],this[3]=0-r[0]*r[3]-r[4]*r[7]-r[8]*r[11],this[4]=r[1],this[5]=r[5],this[6]=r[9],this[7]=0-r[1]*r[3]-r[5]*r[7]-r[9]*r[11],this[8]=r[2],this[9]=r[6],this[10]=r[10],this[11]=0-r[2]*r[3]-r[6]*r[7]-r[10]*r[11],this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},l.prototype.eigensystemFromSymmetricMatrix=function(t,r,o){if(!t||!r||!o)throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","missingResult"));if(this[1]!=this[4]||this[2]!=this[8]||this[6]!=this[9])throw new e(i.logMessage(i.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","Matrix is not symmetric"));for(var n,s,a,l,u,c,d,g,p,f,m,E=1e-10,y=this[0],_=this[1],v=this[2],L=this[5],S=this[6],T=this[10],b=[[1,0,0],[0,1,0],[0,0,1]],w=32,M=0;w>M&&!(h.fabs(_)<E&&h.fabs(v)<E&&h.fabs(S)<E);M++){if(0!=_)for(n=.5*(L-y)/_,s=n*n,a=s+1,l=a!=s?(0>n?-1:1)*(Math.sqrt(a)-h.fabs(n)):.5/n,u=1/Math.sqrt(l*l+1),c=u*l,y-=l*_,L+=l*_,_=0,d=u*v-c*S,S=c*v+u*S,v=d,g=0;3>g;g++)d=u*b[g][0]-c*b[g][1],b[g][1]=c*b[g][0]+u*b[g][1],b[g][0]=d;if(0!=v)for(n=.5*(T-y)/v,s=n*n,a=s+1,l=a!=s?(0>n?-1:1)*(Math.sqrt(a)-h.fabs(n)):.5/n,u=1/Math.sqrt(l*l+1),c=u*l,y-=l*v,T+=l*v,v=0,d=u*_-c*S,S=c*_+u*S,_=d,g=0;3>g;g++)d=u*b[g][0]-c*b[g][2],b[g][2]=c*b[g][0]+u*b[g][2],b[g][0]=d;if(0!=S)for(n=.5*(T-L)/S,s=n*n,a=s+1,l=a!=s?(0>n?-1:1)*(Math.sqrt(a)-h.fabs(n)):.5/n,u=1/Math.sqrt(l*l+1),c=u*l,L-=l*S,T+=l*S,S=0,d=u*_-c*v,v=c*_+u*v,_=d,g=0;3>g;g++)d=u*b[g][1]-c*b[g][2],b[g][2]=c*b[g][1]+u*b[g][2],b[g][1]=d}p=0,f=1,m=2,L>y&&(d=y,y=L,L=d,d=p,p=f,f=d),T>L&&(d=L,L=T,T=d,d=f,f=m,m=d),L>y&&(d=y,y=L,L=d,d=p,p=f,f=d),t[0]=b[0][p],t[1]=b[1][p],t[2]=b[2][p],r[0]=b[0][f],r[1]=b[1][f],r[2]=b[2][f],o[0]=b[0][m],o[1]=b[1][m],o[2]=b[2][m],t.normalize(),r.normalize(),o.normalize(),t.multiply(y),r.multiply(L),o.multiply(T)},l.prototype.upper3By3=function(){var t=l.fromIdentity();return t[0]=this[0],t[1]=this[1],t[2]=this[2],t[4]=this[4],t[5]=this[5],t[6]=this[6],t[8]=this[8],t[9]=this[9],t[10]=this[10],t},l}),i("geom/Frustum",["../error/ArgumentError","../geom/Matrix","../geom/Plane","../util/Logger"],function(t,e,i,r){"use strict";var o=function(e,i,o,n,s,a){if(!(e&&i&&o&&n&&s&&a))throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","constructor","missingPlane"));this._left=e,this._right=i,this._bottom=o,this._top=n,this._near=s,this._far=a,this._planes=[this._left,this._right,this._top,this._bottom,this._near,this._far]};return Object.defineProperties(o.prototype,{left:{get:function(){return this._left}},right:{get:function(){return this._right}},bottom:{get:function(){return this._bottom}},top:{get:function(){return this._top}},near:{get:function(){return this._near}},far:{get:function(){return this._far}}}),o.prototype.transformByMatrix=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","transformByMatrix","missingMatrix"));return this._left.transformByMatrix(e),this._right.transformByMatrix(e),this._bottom.transformByMatrix(e),this._top.transformByMatrix(e),this._near.transformByMatrix(e),this._far.transformByMatrix(e),this},o.prototype.normalize=function(){return this._left.normalize(),this._right.normalize(),this._bottom.normalize(),this._top.normalize(),this._near.normalize(),this._far.normalize(),this},o.unitFrustum=function(){return new o(new i(1,0,0,1),new i(-1,0,0,1),new i(0,1,1,1),new i(0,-1,0,1),new i(0,0,-1,1),new i(0,0,1,1))},o.fromProjectionMatrix=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","fromProjectionMatrix","missingMatrix"));var n,s,a,h,l,u,c,d,g,p,f;return n=e[12]+e[0],s=e[13]+e[1],a=e[14]+e[2],h=e[15]+e[3],l=Math.sqrt(n*n+s*s+a*a),u=new i(n/l,s/l,a/l,h/l),n=e[12]-e[0],s=e[13]-e[1],a=e[14]-e[2],h=e[15]-e[3],l=Math.sqrt(n*n+s*s+a*a),c=new i(n/l,s/l,a/l,h/l),n=e[12]+e[4],s=e[13]+e[5],a=e[14]+e[6],h=e[15]+e[7],l=Math.sqrt(n*n+s*s+a*a),g=new i(n/l,s/l,a/l,h/l),n=e[12]-e[4],s=e[13]-e[5],a=e[14]-e[6],h=e[15]-e[7],l=Math.sqrt(n*n+s*s+a*a),d=new i(n/l,s/l,a/l,h/l),n=e[12]+e[8],s=e[13]+e[9],a=e[14]+e[10],h=e[15]+e[11],l=Math.sqrt(n*n+s*s+a*a),p=new i(n/l,s/l,a/l,h/l),n=e[12]-e[8],s=e[13]-e[9],a=e[14]-e[10],h=e[15]-e[11],l=Math.sqrt(n*n+s*s+a*a),f=new i(n/l,s/l,a/l,h/l),new o(u,c,g,d,p,f)},o.prototype.containsPoint=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));return this._far.dot(e)<=0?!1:this._left.dot(e)<=0?!1:this._right.dot(e)<=0?!1:this._top.dot(e)<=0?!1:this._bottom.dot(e)<=0?!1:this._near.dot(e)<=0?!1:!0},o.prototype.intersectsSegment=function(e,i){if(!e||!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));if(this.containsPoint(e)||this.containsPoint(i))return!0;if(e.equals(i))return!1;for(var o=0,n=this._planes.length;n>o;o++){if(this._planes[o].onSameSide(e,i)<0)return!1;if(null!=this._planes[o].clip(e,i))return!0}return!1},o}),i("error/NotYetImplementedError",["../error/AbstractError"],function(t){"use strict";var e=function(e){t.call(this,"NotYetImplementedError",e);var i;try{throw new Error}catch(r){i=r.stack}this.stack=i};return e.prototype=Object.create(t.prototype),e}),i("util/WWUtil",["../error/ArgumentError","../geom/Line","../util/Logger","../geom/Rectangle","../geom/Vec3"],function(t,e,i,r,o){"use strict";var n={latLonRegex:/^(\-?\d+(\.\d+)?),\s*(\-?\d+(\.\d+)?)$/,suffixForMimeType:function(t){return"image/png"===t?"png":"image/jpeg"===t?"jpg":"application/bil16"===t?"bil":"application/bil32"===t?"bil":null},currentUrlSansFilePart:function(){for(var t=window.location.protocol,e=window.location.host,i=window.location.pathname,r=i.split("/"),o="",n=0,s=r.length;s-1>n;n++)r[n].length>0&&(o=o+"/"+r[n]);return t+"//"+e+o},worldwindlibLocation:function(){for(var t=document.getElementsByTagName("script"),e="/worldwindlib.",i=0;i<t.length;i++){var r=t[i].src.indexOf(e);if(r>=0)return t[i].src.substring(0,r)+"/"}return null},urlPath:function(t){if(!t)return"";for(var e=t.split("/"),i="",r=0,o=e.length;o>r;r++){var n=e[r];n&&0!==n.length&&-1==n.indexOf(":")&&"."!==n&&".."!==n&&"null"!==n&&"undefined"!==n&&(0!==i.length&&(i+="/"),i+=n)}return i},fillArray:function(t,e){if(t)for(var i=0,r=t.length;r>i;i++)t[i]=e},multiplyArray:function(t,e){if(t)for(var i=0,r=t.length;r>i;i++)t[i]*=e},jsonpCounter:0,jsonp:function(t,e,i){var r="gov_nasa_worldwind_jsonp_"+n.jsonpCounter++;window[r]=function(t){delete window[r],i(t)};var o=t+(-1===t.indexOf("?")?"?":"&");o+=e+"="+r;var s=document.createElement("script");s.async=!0,s.src=o;var a=document.getElementsByTagName("head")[0],h=function(){s.onload=void 0,s.onerror=void 0,a.removeChild(s)};s.onload=h,s.onerror=h,a.appendChild(s)}};return n}),i("geom/BoundingBox",["../error/ArgumentError","../shaders/BasicProgram","../geom/Frustum","../util/Logger","../geom/Matrix","../error/NotYetImplementedError","../geom/Plane","../geom/Sector","../geom/Vec3","../util/WWMath","../util/WWUtil"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(){this.center=new h(0,0,0),this.bottomCenter=new h(-.5,0,0),this.topCenter=new h(.5,0,0),this.r=new h(1,0,0),this.s=new h(0,1,0),this.t=new h(0,0,1),this.radius=Math.sqrt(3),this.tmp1=new h(0,0,0),this.tmp2=new h(0,0,0),this.tmp3=new h(0,0,0),this.scratchElevations=new Float64Array(9),this.scratchPoints=new Float64Array(3*this.scratchElevations.length)};return c.scratchMatrix=o.fromIdentity(),c.prototype.setToPoints=function(e){if(!e||e.length<3)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToPoints","missingArray"));var i,n,s,a,l,u,c,d,g,p,f,m,E,y,_,v=+Number.MAX_VALUE,L=-Number.MAX_VALUE,S=+Number.MAX_VALUE,T=-Number.MAX_VALUE,b=+Number.MAX_VALUE,w=-Number.MAX_VALUE,M=this.r,R=this.s,x=this.t,C=new h(0,0,0);o.principalAxesFromPoints(e,M,R,x);for(var A=0,P=e.length/3;P>A;A++)C[0]=e[3*A],C[1]=e[3*A+1],C[2]=e[3*A+2],i=C.dot(M),v>i&&(v=i),i>L&&(L=i),n=C.dot(R),S>n&&(S=n),n>T&&(T=n),s=C.dot(x),b>s&&(b=s),s>w&&(w=s);return L===v&&(L=v+1),T===S&&(T=S+1),w===b&&(w=b+1),a=L-v,l=T-S,u=w-b,c=L+v,d=T+S,g=w+b,p=.5*M[0]*a,f=.5*M[1]*a,m=.5*M[2]*a,E=.5*(M[0]*c+R[0]*d+x[0]*g),y=.5*(M[1]*c+R[1]*d+x[1]*g),_=.5*(M[2]*c+R[2]*d+x[2]*g),this.center[0]=E,this.center[1]=y,this.center[2]=_,this.topCenter[0]=E+p,this.topCenter[1]=y+f,this.topCenter[2]=_+m,this.bottomCenter[0]=E-p,this.bottomCenter[1]=y-f,this.bottomCenter[2]=_-m,M.multiply(a),R.multiply(l),x.multiply(u),this.radius=.5*Math.sqrt(a*a+l*l+u*u),this},c.prototype.setToSector=function(e,i,o,n){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingSector"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingGlobe"));var s=this.scratchElevations,a=this.scratchPoints;u.fillArray(s,n),s[0]=s[2]=s[6]=s[8]=o,i.computePointsForGrid(e,3,3,s,h.ZERO,a);var c=12;this.tmp1.set(a[c],a[c+1],a[c+2]),l.localCoordinateAxesAtPoint(this.tmp1,i,this.r,this.s,this.t);for(var d=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],g=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],p=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],f=0,m=a.length;m>f;f+=3)this.tmp1.set(a[f],a[f+1],a[f+2]),this.adjustExtremes(this.r,d,this.s,g,this.t,p,this.tmp1);d[1]-d[0]<g[1]-g[0]&&this.swapAxes(this.r,d,this.s,g),g[1]-g[0]<p[1]-p[0]&&this.swapAxes(this.s,g,this.t,p),d[1]-d[0]<g[1]-g[0]&&this.swapAxes(this.r,d,this.s,g);var E=d[1]-d[0],y=g[1]-g[0],_=p[1]-p[0],v=d[1]+d[0],L=g[1]+g[0],S=p[1]+p[0],T=.5*(this.r[0]*v+this.s[0]*L+this.t[0]*S),b=.5*(this.r[1]*v+this.s[1]*L+this.t[1]*S),w=.5*(this.r[2]*v+this.s[2]*L+this.t[2]*S),M=.5*this.r[0]*E,R=.5*this.r[1]*E,x=.5*this.r[2]*E;return this.center.set(T,b,w),this.topCenter.set(T+M,b+R,w+x),this.bottomCenter.set(T-M,b-R,w-x),this.r.multiply(E),this.s.multiply(y),this.t.multiply(_),this.radius=.5*Math.sqrt(E*E+y*y+_*_),this},c.prototype.translate=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","translate","missingVector"));return this.bottomCenter.add(e),this.topCenter.add(e),this.center.add(e),this},c.prototype.distanceTo=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","distanceTo","missingPoint"));var i=this.center.distanceTo(e)-this.radius;return i>=0?i:-i},c.prototype.effectiveRadius=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","effectiveRadius","missingPlane"));var i=e.normal;return.5*(l.fabs(this.r.dot(i))+l.fabs(this.s.dot(i))+l.fabs(this.t.dot(i)))},c.prototype.intersectsFrustum=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","intersectsFrustum","missingFrustum"));return this.tmp1.copy(this.bottomCenter),this.tmp2.copy(this.topCenter),this.intersectionPoint(e.near)<0?!1:this.intersectionPoint(e.far)<0?!1:this.intersectionPoint(e.left)<0?!1:this.intersectionPoint(e.right)<0?!1:this.intersectionPoint(e.top)<0?!1:this.intersectionPoint(e.bottom)<0?!1:!0},c.prototype.intersectionPoint=function(t){var e=t.normal,i=.5*(Math.abs(this.s.dot(e))+Math.abs(this.t.dot(e)));return this.intersectsAt(t,i,this.tmp1,this.tmp2)},c.prototype.intersectsAt=function(t,e,i,r){var o=t.dot(i),n=-e>=o,s=t.dot(r),a=-e>=s;if(n&&a)return-1;if(n==a)return 0;this.tmp3.copy(i),this.tmp3.subtract(r);var h=(e+o)/t.normal.dot(this.tmp3);return this.tmp3.copy(r),this.tmp3.subtract(i),this.tmp3.multiply(h),this.tmp3.add(i),n?i.copy(this.tmp3):r.copy(this.tmp3),h},c.prototype.adjustExtremes=function(t,e,i,r,o,n,s){var a=s.dot(t);e[0]>a&&(e[0]=a),e[1]<a&&(e[1]=a);var h=s.dot(i);r[0]>h&&(r[0]=h),r[1]<h&&(r[1]=h);var l=s.dot(o);n[0]>l&&(n[0]=l),n[1]<l&&(n[1]=l)},c.prototype.swapAxes=function(t,e,i,r){t.swap(i);var o=e[0];e[0]=r[0],r[0]=o,o=e[1],e[1]=r[1],r[1]=o},c.prototype.render=function(t){var i=t.currentGlContext,r=c.scratchMatrix,o=t.findAndBindProgram(e);try{r.copy(t.navigatorState.modelviewProjection),r.multiply(this.r[0],this.s[0],this.t[0],this.center[0],this.r[1],this.s[1],this.t[1],this.center[1],this.r[2],this.s[2],this.t[2],this.center[2],0,0,0,1),r.multiplyByTranslation(-.5,-.5,-.5),o.loadModelviewProjection(i,r),i.disable(i.CULL_FACE),i.bindBuffer(i.ARRAY_BUFFER,t.unitCubeBuffer()),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.unitCubeElements()),i.enableVertexAttribArray(o.vertexPointLocation),i.vertexAttribPointer(o.vertexPointLocation,3,i.FLOAT,!1,0,0),o.loadColorComponents(i,0,1,0,.6),i.drawElements(i.LINES,24,i.UNSIGNED_SHORT,72),o.loadColorComponents(i,1,1,1,.3),i.drawElements(i.TRIANGLES,36,i.UNSIGNED_SHORT,0)}finally{i.enable(i.CULL_FACE),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}},c}),i("util/Tile",["../error/ArgumentError","../geom/BoundingBox","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWUtil"],function(t,e,i,r,o,n){"use strict";var s=function(e,r,o,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(0>o||0>n)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));this.sector=e,this.level=r,this.row=o,this.column=n,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.texelSize=r.texelSize,this.tileKey=r.levelNumber.toString()+"."+o.toString()+"."+n.toString(),this.extent=null,this.referencePoint=null,this.samplePoints=null,this.sampleElevations=null,this.updateTimestamp=null,this.updateVerticalExaggeration=null,this.updateGlobeStateKey=null};return s.prototype.isEqual=function(t){return t&&t.tileKey?this.tileKey==t.tileKey:!1},s.prototype.size=function(){return 828},s.prototype.distanceTo=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));for(var r,o,n,s=e[0],a=e[1],h=e[2],l=this.samplePoints,u=Number.POSITIVE_INFINITY,c=0,d=l.length;d>c;c+=3)r=s-l[c],o=a-l[c+1],n=h-l[c+2],u=Math.min(u,r*r+o*o+n*n);return Math.sqrt(u)},s.prototype.subdivide=function(e,o){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivide","The specified level is null or undefined."));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivide","The specified tile factory is null or undefined."));var n,s,a,h=this.sector.minLatitude,l=this.sector.maxLatitude,u=this.sector.centroidLatitude(),c=this.sector.minLongitude,d=this.sector.maxLongitude,g=this.sector.centroidLongitude(),p=[];return n=2*this.row,s=2*this.column,a=new r(h,u,c,g),p.push(o.createTile(a,e,n,s)),n=2*this.row,s=2*this.column+1,a=new r(h,u,g,d),p.push(o.createTile(a,e,n,s)),n=2*this.row+1,s=2*this.column,a=new r(u,l,c,g),p.push(o.createTile(a,e,n,s)),n=2*this.row+1,s=2*this.column+1,a=new r(u,l,g,d),p.push(o.createTile(a,e,n,s)),p},s.prototype.subdivideToCache=function(e,r,o){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivideToCache","The specified level is null or undefined."));if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var n=o?o.entryForKey(this.tileKey):null;return n||(n=this.subdivide(e,r),n&&o&&o.putEntry(this.tileKey,n,4*n[0].size())),n},s.prototype.mustSubdivide=function(t,e){var i=t.globe.equatorialRadius*this.texelSize,r=this.distanceTo(t.navigatorState.eyePoint);return i>r*Math.pow(10,-e)},s.prototype.update=function(t){var e=t.globe.elevationTimestamp(),i=t.verticalExaggeration,r=t.globeStateKey;(this.updateTimestamp!=e||this.updateVerticalExaggeration!=i||this.updateGlobeStateKey!=r)&&(this.doUpdate(t),t.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=e,this.updateVerticalExaggeration=i,this.updateGlobeStateKey=r)},s.prototype.doUpdate=function(t){var i=t.globe,r=t.verticalExaggeration,s=i.minAndMaxElevationsForSector(this.sector),a=s?s[0]*r:0,h=s?s[1]*r:0;a==h&&(a=h+10),this.extent||(this.extent=new e),this.extent.setToSector(this.sector,i,a,h),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),n.fillArray(this.sampleElevations,.5*(a+h)),i.computePointsForGrid(this.sector,3,3,this.sampleElevations,o.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new o(0,0,0)),i.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},s.computeRow=function(t,e){var i=Math.floor((e+90)/t);return 90==e&&(i-=1),i},s.computeColumn=function(t,e){var i=Math.floor((e+180)/t);return 180==e&&(i-=1),i},s.computeLastRow=function(t,e){var i=Math.ceil((e+90)/t-1);return t>e+90&&(i=0),i},s.computeLastColumn=function(t,e){var i=Math.ceil((e+180)/t-1);return t>e+180&&(i=0),i},s.computeSector=function(e,o,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","computeSector","missingLevel"));if(0>o||0>n)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","computeSector","The specified row or column is less than zero."));var s=e.tileDelta.latitude,a=e.tileDelta.longitude,h=-90+o*s,l=-180+n*a,u=h+s,c=l+a;return new r(h,u,l,c)},s.createTilesForLevel=function(e,o,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","createTilesForLevel","missingLevel"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","createTilesForLevel","The specified tile factory is null or undefined"));if(!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"Tile","createTilesForLevel","missingResult"));for(var a,h,l,u=e.tileDelta.latitude,c=e.tileDelta.longitude,d=e.sector,g=s.computeRow(u,d.minLatitude),p=s.computeRow(u,d.maxLatitude),f=s.computeColumn(c,d.minLongitude),m=s.computeColumn(c,d.maxLongitude),E=-90+g*u,y=-180+f*c,_=E,v=g;p>=v;v+=1){h=_+u,a=y;for(var L=f;m>=L;L+=1){l=a+c;var S=new r(_,h,a,l),T=o.createTile(S,e,v,L);n.push(T),a=l}_=h}},s}),i("render/TextureTile",["../error/ArgumentError","../util/Logger","../util/Tile"],function(t,e,i){"use strict";var r=function(t,e,r,o){i.call(this,t,e,r,o),this.gpuCacheKey=null};return r.prototype=Object.create(i.prototype),r.prototype.size=function(){return i.prototype.size.call(this)},r.prototype.bind=function(t){var e=t.gpuResourceCache.resourceForKey(this.gpuCacheKey);return e?e.bind(t):!1},r.prototype.applyInternalTransform=function(t,e){},r}),i("render/ImageTile",["../error/ArgumentError","../util/Logger","../render/TextureTile","../util/Tile"],function(t,e,i,r){"use strict";var o=function(r,o,n,s,a){if(!a||a.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ImageTile","constructor","The specified image path is null, undefined or zero length."));i.call(this,r,o,n,s),this.imagePath=a,this.fallbackTile=null,this.gpuCacheKey=a};return o.prototype=Object.create(i.prototype),o.prototype.size=function(){return this.__proto__.__proto__.size.call(this)+this.imagePath.length+8},o.prototype.bind=function(t){var e=this.__proto__.__proto__.bind.call(this,t);return e?!0:this.fallbackTile?this.fallbackTile.bind(t):!1},o.prototype.applyInternalTransform=function(t,e){this.fallbackTile&&!t.gpuResourceCache.resourceForKey(this.imagePath)&&this.applyFallbackTransform(e)},o.prototype.applyFallbackTransform=function(t){var e=this.level.levelNumber-this.fallbackTile.level.levelNumber;if(!(0>=e)){var i=this.fallbackTile.sector.deltaLatitude(),r=this.fallbackTile.sector.deltaLongitude(),o=this.sector.deltaLongitude()/r,n=this.sector.deltaLatitude()/i,s=(this.sector.minLongitude-this.fallbackTile.sector.minLongitude)/r,a=(this.sector.minLatitude-this.fallbackTile.sector.minLatitude)/i;t.multiply(o,0,0,s,0,n,0,a,0,0,1,0,0,0,0,1)}},o}),i("layer/Layer",["../util/Logger"],function(t){"use strict";var e=function(t){this.displayName=t?t:"Layer",this.enabled=!0,this.pickEnabled=!0,this.opacity=1,this.minActiveAltitude=-Number.MAX_VALUE,this.maxActiveAltitude=Number.MAX_VALUE,this.inCurrentFrame=!1};return e.prototype.refresh=function(){},e.prototype.render=function(t){this.inCurrentFrame=!1,this.enabled&&(!t.pickingMode||this.pickEnabled)&&this.withinActiveAltitudes(t)&&this.isLayerInView(t)&&this.doRender(t)},e.prototype.doRender=function(t){},e.prototype.withinActiveAltitudes=function(t){var e=t.eyePosition;return e?e.altitude>=this.minActiveAltitude&&e.altitude<=this.maxActiveAltitude:!1},e.prototype.isLayerInView=function(t){return!0},e}),i("util/Level",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger"],function(t,e,i,r){"use strict";var o=function(i,o,n){if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified tile delta is null or undefined"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified parent level set is null or undefined"));this.levelNumber=i,this.tileDelta=o,this.parent=n,this.texelSize=o.latitude*t.DEGREES_TO_RADIANS/n.tileHeight,this.tileWidth=n.tileWidth,this.tileHeight=n.tileHeight,this.sector=n.sector};return o.prototype.isFirstLevel=function(){return this.parent.firstLevel()==this},o.prototype.isLastLevel=function(){return this.parent.lastLevel()==this},o.prototype.previousLevel=function(){return this.parent.level(this.levelNumber-1)},o.prototype.nextLevel=function(){return this.parent.level(this.levelNumber+1)},o.prototype.compare=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Level","compare","The specified level is null or undefined"));return this.levelNumber<t.levelNumber?-1:this.levelNumber>t.levelNumber?1:0},o}),i("util/LevelSet",["../error/ArgumentError","../util/Level","../geom/Location","../util/Logger"],function(t,e,i,r){"use strict";var o=function(o,n,s,a,h){if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","missingSector"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is null or undefined"));if(n.latitude<=0||n.longitude<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is less than or equal to zero."));if(1>s)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified number of levels is less than one."));if(1>a||1>h)throw new t(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified tile width or tile height is less than one."));this.sector=o,this.levelZeroDelta=n,this.numLevels=s,this.tileWidth=a,this.tileHeight=h,this.levels=[];for(var l=0;s>l;l+=1){var u=Math.pow(2,l),c=n.latitude/u,d=n.longitude/u,g=new i(c,d),p=new e(l,g,this);this.levels[l]=p}};return o.prototype.level=function(t){return 0>t||t>=this.levels.length?null:this.levels[t]},o.prototype.levelForTexelSize=function(t){var e=this.lastLevel();if(e.texelSize>=t)return e;for(var i=0,r=this.levels.length;r>i;i+=1){var o=this.levels[i];if(o.texelSize<=t)return o}return e},o.prototype.firstLevel=function(){return this.levels[0]},o.prototype.lastLevel=function(){return this.levels[this.levels.length-1]},o}),i("cache/MemoryCache",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i,r){if(!i||1>i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","constructor","The specified capacity is undefined, zero or negative"));if(!r||r>=i||0>r)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","constructor","The specified low-water value is undefined, greater than or equal to the capacity, or less than 1"));this._capacity=i,this._lowWater=r,this.usedCapacity=0,this.freeCapacity=i,this.entries={},this.listeners=[]};return Object.defineProperties(i.prototype,{capacity:{get:function(){return this._capacity},set:function(i){if(!i||1>i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","capacity","Specified cache capacity is undefined, 0 or negative."));var r=this._capacity;this._capacity=i,this._capacity<=this.lowWater&&(this._lowWater=.85*this._capacity),this._capacity<r&&this.makeSpace(0)}},lowWater:{get:function(){return this._lowWater},set:function(i){if(!i||i>=this._capacity||0>i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","lowWater","Specified cache low-water value is undefined, negative or not less than the current capacity."));this._lowWater=i}}}),i.prototype.entryForKey=function(t){if(!t)return null;var e=this.entries[t];return e?(e.lastUsed=Date.now(),e.entry):null},i.prototype.putEntry=function(i,r,o){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","putEntry","missingKey."));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","putEntry","missingEntry."));if(1>o)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","putEntry","The specified entry size is less than 1."));var n,s=this.entries[i];s&&this.removeEntry(i),this.usedCapacity+o>this._capacity&&this.makeSpace(o),this.usedCapacity+=o,this.freeCapacity=this._capacity-this.usedCapacity,n={key:i,entry:r,size:o,lastUsed:Date.now()},this.entries[i]=n},i.prototype.clear=function(t){if(t)for(var e in this.entries)this.entries.hasOwnProperty(e)&&this.removeCacheEntry(e);this.entries={},this.freeCapacity=this._capacity,this.usedCapacity=0},i.prototype.removeEntry=function(t){if(t){var e=this.entries[t];e&&this.removeCacheEntry(e)}},i.prototype.removeCacheEntry=function(t){delete this.entries[t.key],this.usedCapacity-=t.size,this.freeCapacity=this._capacity-this.usedCapacity;for(var e=0,i=this.listeners.length;i>e;e++)try{this.listeners[e].entryRemoved(t.key,t.entry)}catch(r){this.listeners[e].removalError(r,t.key,t.entry)}},i.prototype.containsKey=function(t){return t&&this.entries[t]},i.prototype.addCacheListener=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","addCacheListener","missingListener"));if("function"!=typeof i.entryRemoved||"function"!=typeof i.removalError)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","addCacheListener","The specified listener does not implement the required functions."));this.listeners.push(i)},i.prototype.removeCacheListener=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCache","removeCacheListener","missingListener"));var r=this.listeners.indexOf(i);r>-1&&this.listeners.splice(r,1)},i.prototype.makeSpace=function(t){var e=[];this.usedCapacity;for(var i in this.entries)this.entries.hasOwnProperty(i)&&e.push(this.entries[i]);e.sort(function(t,e){return t.lastUsed-e.lastUsed});for(var r=0,o=e.length;o>r&&(this.usedCapacity>this._lowWater||this.freeCapacity<t);r++)this.removeCacheEntry(e[r])},i}),i("layer/TiledImageLayer",["../util/AbsentResourceList","../error/ArgumentError","../render/ImageTile","../layer/Layer","../util/LevelSet","../util/Logger","../cache/MemoryCache","../render/Texture","../util/Tile","../util/WWUtil"],function(t,e,i,r,o,n,s,a,h,l){"use strict";var u=function(i,a,h,l,u,c,d){if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","constructor","missingSector"));if(!a)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified level-zero delta is null or undefined."));if(!l)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified image format is null or undefined."));if(!u)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified cache path is null or undefined."));if(!h||1>h)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified number of levels is less than one."));if(!c||!d||1>c||1>d)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified tile width or height is less than one."));r.call(this,"Tiled Image Layer"),this.retrievalImageFormat=l,this.cachePath=u,this.levels=new o(i,a,h,c,d),this.detailHintOrigin=2.4,this.detailHint=0,this.expiration=null,this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new s(5e5,4e5),this.currentRetrievals=[],this.absentResourceList=new t(3,5e4),this.pickEnabled=!1};return u.prototype=Object.create(r.prototype),u.prototype.refresh=function(){this.expiration=new Date,this.currentTilesInvalid=!0},u.prototype.prePopulate=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","prePopulate","missingWorldWindow"));var i=t.drawContext;this.topLevelTiles&&0!==this.topLevelTiles.length||this.createTopLevelTiles(i);for(var r=0;r<this.topLevelTiles.length;r++){var o=this.topLevelTiles[r];this.isTileTextureInMemory(i,o)||this.retrieveTileImage(i,o)}},u.prototype.isPrePopulated=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"TiledImageLayer","isPrePopulated","missingWorldWindow"));
for(var i=0;i<this.topLevelTiles.length;i++)if(!this.isTileTextureInMemory(t.drawContext,this.topLevelTiles[i]))return!1;return!0},u.prototype.createTile=function(t,e,r,o){var n=this.cachePath+"-layer/"+e.levelNumber+"/"+r+"/"+r+"_"+o+"."+l.suffixForMimeType(this.retrievalImageFormat);return new i(t,e,r,o,n)},u.prototype.doRender=function(t){t.terrain&&(!this.currentTilesInvalid&&this.lasTtMVP&&t.navigatorState.modelviewProjection.equals(this.lasTtMVP)&&t.globeStateKey==this.lastGlobeStateKey||(this.currentTilesInvalid=!1,this.assembleTiles(t)),this.lasTtMVP=t.navigatorState.modelviewProjection,this.lastGlobeStateKey=t.globeStateKey,this.currentTiles.length>0&&(t.surfaceTileRenderer.renderTiles(t,this.currentTiles,this.opacity),t.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0))},u.prototype.isLayerInView=function(t){return t.terrain&&t.terrain.sector&&t.terrain.sector.intersects(this.levels.sector)},u.prototype.createTopLevelTiles=function(t){this.topLevelTiles=[],h.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},u.prototype.assembleTiles=function(t){this.currentTiles=[],this.topLevelTiles&&0!==this.topLevelTiles.length||this.createTopLevelTiles(t);for(var e=0,i=this.topLevelTiles.length;i>e;e++){var r=this.topLevelTiles[e];r.update(t),this.currentAncestorTile=null,this.isTileVisible(t,r)&&this.addTileOrDescendants(t,r)}},u.prototype.addTileOrDescendants=function(t,e){if(this.tileMeetsRenderingCriteria(t,e))return void this.addTile(t,e);var i=null;try{(this.isTileTextureInMemory(t,e)||0===e.level.levelNumber)&&(i=this.currentAncestorTile,this.currentAncestorTile=e);for(var r=this.levels.level(e.level.levelNumber+1),o=e.subdivideToCache(r,this,this.tileCache),n=0,s=o.length;s>n;n++){var a=o[n];a.update(t),this.levels.sector.intersects(a.sector)&&this.isTileVisible(t,a)&&this.addTileOrDescendants(t,a)}}finally{i&&(this.currentAncestorTile=i)}},u.prototype.addTile=function(t,e){e.fallbackTile=null;var i=t.gpuResourceCache.resourceForKey(e.imagePath);return i?(this.currentTiles.push(e),void(this.expiration&&this.isTextureExpired(i)&&this.retrieveTileImage(t,e))):(this.retrieveTileImage(t,e),void(this.currentAncestorTile&&this.isTileTextureInMemory(t,this.currentAncestorTile)&&(e.fallbackTile=this.currentAncestorTile,this.currentTiles.push(e))))},u.prototype.isTileVisible=function(t,e){return t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits)?!1:e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},u.prototype.tileMeetsRenderingCriteria=function(t,e){var i=this.detailHintOrigin+this.detailHint;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=.9),e.level.isLastLevel()||!e.mustSubdivide(t,i)},u.prototype.isTileTextureInMemory=function(t,e){return t.gpuResourceCache.containsResource(e.imagePath)},u.prototype.isTextureExpired=function(t){return this.expiration&&t.creationTime.getTime()<=this.expiration.getTime()},u.prototype.retrieveTileImage=function(t,e){if(this.currentRetrievals.indexOf(e.imagePath)<0){if(this.absentResourceList.isResourceAbsent(e.imagePath))return;var i=this.resourceUrlForTile(e,this.retrievalImageFormat),r=new Image,o=e.imagePath,s=t.gpuResourceCache,a=t.currentGlContext.canvas,h=this;if(!i)return void(this.currentTilesInvalid=!0);r.onload=function(){n.log(n.LEVEL_INFO,"Image retrieval succeeded: "+i);var l=h.createTexture(t,e,r);if(h.removeFromCurrentRetrievals(o),l){s.putResource(o,l,l.size),h.currentTilesInvalid=!0,h.absentResourceList.unmarkResourceAbsent(o);var u=document.createEvent("Event");u.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),a.dispatchEvent(u)}},r.onerror=function(){h.removeFromCurrentRetrievals(o),h.absentResourceList.markResourceAbsent(o),n.log(n.LEVEL_WARNING,"Image retrieval failed: "+i)},this.currentRetrievals.push(o),r.crossOrigin="anonymous",r.src=i}},u.prototype.createTexture=function(t,e,i){return new a(t.currentGlContext,i)},u.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1)},u.prototype.resourceUrlForTile=function(t,e){return this.urlBuilder?this.urlBuilder.urlForTile(t,e):null},u}),i("geom/Vec2",["../util/Logger","../error/ArgumentError","../geom/Vec3"],function(t,e,i){"use strict";var r=function(t,e){this[0]=t,this[1]=e};return r.prototype=new Float64Array(2),r.prototype.set=function(t,e){return this[0]=t,this[1]=e,this},r.prototype.copy=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","copy","missingVector"));return this[0]=i[0],this[1]=i[1],this},r.prototype.equals=function(t){return this[0]===t[0]&&this[1]===t[1]},r.average=function(i,r){if(!i||i.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","average","missingArray"));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","average","missingResult"));var o,n=i.length;r[0]=0,r[1]=0;for(var s=0,a=i.length;a>s;s++)o=i[s],r[0]+=o[0]/n,r[1]+=o[1]/n;return r},r.prototype.add=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","add","missingVector"));return this[0]+=i[0],this[1]+=i[1],this},r.prototype.subtract=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","subtract","missingVector"));return this[0]-=i[0],this[1]-=i[1],this},r.prototype.multiply=function(t){return this[0]*=t,this[1]*=t,this},r.prototype.divide=function(t){return this[0]/=t,this[1]/=t,this},r.prototype.mix=function(i,r){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","mix","missingVector"));var o=1-r,n=r;return this[0]=this[0]*o+i[0]*n,this[1]=this[1]*o+i[1]*n,this},r.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this},r.prototype.dot=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","dot","missingVector"));return this[0]*i[0]+this[1]*i[1]},r.prototype.magnitudeSquared=function(){return this.dot(this)},r.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},r.prototype.normalize=function(){var t=this.magnitude(),e=1/t;return this[0]*=e,this[1]*=e,this},r.prototype.distanceToSquared=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","distanceToSquared","missingVector"));var r=this[0]-i[0],o=this[1]-i[1];return r*r+o*o},r.prototype.distanceTo=function(i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Vec2","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(i))},r.prototype.toVec3=function(){return new i(this[0],this[1],0)},r.prototype.swap=function(t){var e=this[0];return this[0]=t[0],t[0]=e,e=this[1],this[1]=t[1],t[1]=e,this},r.prototype.toString=function(){return"("+this[0]+", "+this[1]+")"},r}),i("layer/MercatorTiledImageLayer",["../util/Color","../geom/Sector","../layer/TiledImageLayer","../geom/Vec2","../util/WWMath"],function(t,e,i,r,o){"use strict";var n=function(t,e,o,n,s,a,h){i.call(this,t,e,o,n,s,a,h),this.detectBlankImages=!1,this.testPixels=[new r(20,20),new r(235,20),new r(20,235),new r(235,235)],this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d")};return n.prototype=Object.create(i.prototype),n.prototype.createTile=function(t,r,n,s){var a,h,l,u,c,d,g=this.mapSizeForLevel(r.levelNumber),p=o.clamp(s*this.imageSize,0,g),f=o.clamp(n*this.imageSize,0,g),m=o.clamp(p+this.imageSize,0,g),E=o.clamp(f+this.imageSize,0,g);return a=p/g-.5,h=.5-E/g,l=90-360*Math.atan(Math.exp(2*-h*Math.PI))/Math.PI,u=360*a,a=m/g-.5,h=.5-f/g,c=90-360*Math.atan(Math.exp(2*-h*Math.PI))/Math.PI,d=360*a,t=new e(l,c,u,d),i.prototype.createTile.call(this,t,r,n,s)},n.prototype.createTexture=function(t,e,r){var n,s,a,h,l,u,c,d,g=t.canvas2D,p=t.ctx2D,f=this.destCanvas,m=this.destContext,E=m.createImageData(r.width,r.height),y=e.sector,_=o.gudermannianInverse(y.minLatitude),v=o.gudermannianInverse(y.maxLatitude);if(g.width=r.width,g.height=r.height,f.width=r.width,f.height=r.height,p.drawImage(r,0,0,r.width,r.height),n=p.getImageData(0,0,r.width,r.height),this.detectBlankImages&&this.isBlankImage(r,n))return this.absentResourceList.markResourceAbsentPermanently(e.imagePath),null;for(var L=0;1>L;L++)for(var S=0;S<r.height;S++){c=1-S/(r.height-1),s=c*y.deltaLatitude()+y.minLatitude,a=o.gudermannianInverse(s),d=1-(a-_)/(v-_),d=o.clamp(d,0,1),h=Math.floor(d*(r.height-1));for(var T=0;T<r.width;T++)l=4*(T+h*r.width),u=4*(T+S*r.width),E.data[u]=n.data[l],E.data[u+1]=n.data[l+1],E.data[u+2]=n.data[l+2],E.data[u+3]=n.data[l+3]}return m.putImageData(E,0,0),i.prototype.createTexture.call(this,t,e,f)},n.prototype.isBlankImage=function(t,e){for(var i,r,o=null,n=0,s=this.testPixels.length;s>n;n++)if(i=this.testPixels[n],r=4*(i[0]+i[1]*t.width),o){if(e.data[r]!=o[0]||e.data[r+1]!=o[1]||e.data[r+2]!=o[2])return!1}else o=[e.data[r],e.data[r+1],e.data[r+2]];return!0},n}),i("layer/BingTiledImageLayer",["../geom/Angle","../geom/Location","../geom/Sector","../layer/MercatorTiledImageLayer"],function(t,e,i,r){"use strict";var o=function(t){this.imageSize=256,r.call(this,new i(-85.05,85.05,-180,180),new e(85.05,180),23,"image/jpeg",t,this.imageSize,this.imageSize),this.displayName=t,this.pickEnabled=!1,this.detailHintOrigin=2.6,this.detectBlankImages=!0,this.creditImage=WorldWind.configuration.baseUrl+"images/powered-by-bing.png"};return o.prototype=Object.create(r.prototype),o.prototype.doRender=function(t){r.prototype.doRender.call(this,t),this.inCurrentFrame&&t.screenCreditController.addImageCredit(this.creditImage)},o.prototype.createTopLevelTiles=function(t){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},o.prototype.mapSizeForLevel=function(t){return 256<<t+1},o}),i("util/BingImageryUrlBuilder",["../error/ArgumentError","../util/Logger","../util/WWUtil"],function(t,e,i){"use strict";var r=function(t,e){var i="AkttWCS8p6qzxvx5RH3qUcCPgwG9nRJ7IwlpFGb14B0rBorB5DvmXr2Y_eCUNIxH";e||(this.bingMapsKey=WorldWind.BingMapsKey,e||(this.bingMapsKey=i),e===i&&(this.bingMapsKey=i,r.showBingMapsKeyWarning())),this.imagerySet=t};return r.showBingMapsKeyWarning=function(){r.keyMessagePrinted||(r.keyMessagePrinted=!0,e.log(e.LEVEL_WARNING,"WARNING: You are using a limited use, non-production Bing Maps key.\nIf you are developing an app or a web page this violates the Bing Terms of Use.\nPlease visit https://www.microsoft.com/maps/choose-your-bing-maps-API.aspx to obtain your own key for your application.\nSpecify that key to World Wind by setting the WorldWind.BingMapsKey property to your key prior to creating any Bing Maps layers.\n"))},r.prototype.requestMetadata=function(){if(!this.metadataRetrievalInProcess){this.metadataRetrievalInProcess=!0;var t="http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+this.imagerySet+"/0,0?zl=1&key="+this.bingMapsKey,e=this;i.jsonp(t,"jsonp",function(t){e.imageUrl=t.resourceSets[0].resources[0].imageUrl;var i=document.createEvent("Event");i.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(i),e.metadataRetrievalInProcess=!1})}},r.prototype.urlForTile=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"BingImageryUrlBuilder","urlForTile","missingTile"));if(!this.imageUrl)return this.requestMetadata(),null;var o,n=this.quadKeyFromLevelRowColumn(i.level.levelNumber,i.row,i.column);return"Aerial"===this.imagerySet?o=this.imageUrl.replace(/a3/,"a"+n):"AerialWithLabels"===this.imagerySet?o=this.imageUrl.replace(/h3/,"h"+n):"Road"===this.imagerySet&&(o=this.imageUrl.replace(/r3/,"r"+n)),o},r.prototype.quadKeyFromLevelRowColumn=function(t,e,i){for(var r,o,n="",s=t+1;s>0;s--)r=0,o=1<<s-1,0!=(i&o)&&(r+=1),0!=(e&o)&&(r+=2),n+=r.toString();return n},r}),i("layer/BingAerialLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(t,e,i,r){"use strict";var o=function(t){i.call(this,"Bing Aerial"),this.urlBuilder=new r("Aerial",t)};return o.prototype=Object.create(i.prototype),o}),i("layer/BingAerialWithLabelsLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(t,e,i,r){"use strict";var o=function(t){i.call(this,"Bing Aerial with Labels"),this.urlBuilder=new r("AerialWithLabels",t)};return o.prototype=Object.create(i.prototype),o}),i("layer/BingRoadsLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(t,e,i,r){"use strict";var o=function(t){i.call(this,"Bing Roads"),this.urlBuilder=new r("Road",t),this.detectBlankImages=!1};return o.prototype=Object.create(i.prototype),o}),i("util/WmsUrlBuilder",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i,r,o,n,s){if(!i||0===i.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS service address is missing."));if(!r||0===r.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS layer names are not specified."));this.serviceAddress=i,this.layerNames=r,this.styleNames=o?o:"",this.transparent=!0,this.wmsVersion=n&&n.length>0?n:"1.3.0",this.isWms130OrGreater=n>="1.3.0",this.crs="EPSG:4326",this.timeString=s};return i.prototype.urlForTile=function(r,o){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var n=r.sector,s=i.fixGetMapString(this.serviceAddress);return s.search(/service=wms/i)<0&&(s+="service=WMS"),s+="&request=GetMap",s=s+"&version="+this.wmsVersion,s=s+"&transparent="+(this.transparent?"TRUE":"FALSE"),s=s+"&layers="+this.layerNames,s=s+"&styles="+this.styleNames,s=s+"&format="+o,s=s+"&width="+r.tileWidth,s=s+"&height="+r.tileHeight,this.timeString&&(s=s+"&time="+this.timeString),this.isWms130OrGreater?(s=s+"&crs="+this.crs,s+="&bbox=","CRS:84"===this.crs?(s=s+n.minLongitude+","+n.minLatitude+",",s=s+n.maxLongitude+","+n.maxLatitude):(s=s+n.minLatitude+","+n.minLongitude+",",s=s+n.maxLatitude+","+n.maxLongitude)):(s=s+"&srs="+this.crs,s+="&bbox=",s=s+n.minLongitude+","+n.minLatitude+",",s=s+n.maxLongitude+","+n.maxLatitude),s=s.replace(" ","%20")},i.fixGetMapString=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","fixGetMapString","The specified service address is null or undefined."));var r=i.indexOf("?");return 0>r?i+="?":r!==i.length-1&&(r=i.search(/&$/),0>r&&(i+="&")),i},i}),i("layer/BingWMSLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(t,e,i,r){"use strict";var o=function(){i.call(this,e.FULL_SPHERE,new t(45,45),16,"image/png","BingWMS",256,256),this.displayName="Bing WMS",this.pickEnabled=!1,this.maxActiveAltitude=1e4,this.urlBuilder=new r(location.protocol+"//worldwind27.arc.nasa.gov/wms/virtualearth","ve","","1.3.0")};return o.prototype=Object.create(i.prototype),o}),i("util/LevelRowColumnUrlBuilder",["../error/ArgumentError","../util/Logger","../util/WWUtil"],function(t,e,i){"use strict";var r=function(t,e){this.serverAddress=t,t&&0!==t.length||(this.serverAddress=i.currentUrlSansFilePart()),this.pathToData=e};return r.prototype.urlForTile=function(r,o){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var n=this.serverAddress;return this.pathToData&&(n=n+"/"+this.pathToData),n=n+"/"+r.level.levelNumber.toString(),n=n+"/"+r.row.toString(),n=n+"/"+r.row.toString()+"_"+r.column.toString(),n=n+"."+i.suffixForMimeType(o),n=n.replace(" ","%20")},r}),i("layer/BMNGRestLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/LevelRowColumnUrlBuilder","../util/WWUtil"],function(t,e,i,r,o,n,s){"use strict";var a=function(t,i,a){var h=s.urlPath(t+"/"+i);o.call(this,r.FULL_SPHERE,new e(45,45),5,"image/jpeg",h,256,256),this.displayName=a,this.pickEnabled=!1,this.urlBuilder=new n(t,i)};return a.prototype=Object.create(o.prototype),a}),i("layer/BlueMarbleLayer",["../layer/BMNGRestLayer","../layer/Layer"],function(t,e){"use strict";var i=function(t,r){e.call(this,t||"Blue Marble"),this.time=r||new Date("2004-01"),this.pickEnabled=!1,this.layers={},this.layerNames=[{month:"BlueMarble-200401",time:i.availableTimes[0]},{month:"BlueMarble-200402",time:i.availableTimes[1]},{month:"BlueMarble-200403",time:i.availableTimes[2]},{month:"BlueMarble-200404",time:i.availableTimes[3]},{month:"BlueMarble-200405",time:i.availableTimes[4]},{month:"BlueMarble-200406",time:i.availableTimes[5]},{month:"BlueMarble-200407",time:i.availableTimes[6]},{month:"BlueMarble-200408",time:i.availableTimes[7]},{month:"BlueMarble-200409",time:i.availableTimes[8]},{month:"BlueMarble-200410",time:i.availableTimes[9]},{month:"BlueMarble-200411",time:i.availableTimes[10]},{month:"BlueMarble-200412",time:i.availableTimes[11]}],this.serverAddress=null,this.pathToData="../standalonedata/Earth/BlueMarble256/"};return i.prototype=Object.create(e.prototype),i.availableTimes=[new Date("2004-01"),new Date("2004-02"),new Date("2004-03"),new Date("2004-04"),new Date("2004-05"),new Date("2004-06"),new Date("2004-07"),new Date("2004-08"),new Date("2004-09"),new Date("2004-10"),new Date("2004-11"),new Date("2004-12")],i.prototype.prePopulate=function(t){if(!t)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"BlueMarbleLayer","prePopulate","missingWorldWindow"));for(var e=0;e<this.layerNames.length;e++){var i=this.layerNames[e].month;this.layers[i]||this.createSubLayer(i),this.layers[i].prePopulate(t)}},i.prototype.isPrePopulated=function(t){for(var e=0;e<this.layerNames.length;e++){var i=this.layers[this.layerNames[e].month];if(!i||!i.isPrePopulated(t))return!1}return!0},i.prototype.doRender=function(t){var e=this.nearestLayer(this.time);e.opacity=this.opacity,e.doRender(t),this.inCurrentFrame=e.inCurrentFrame},i.prototype.nearestLayer=function(t){var e=this.nearestLayerName(t);return this.layers[e]||this.createSubLayer(e),this.layers[e]},i.prototype.createSubLayer=function(e){var i=this.pathToData+e;this.layers[e]=new t(this.serverAddress,i,this.displayName)},i.prototype.nearestLayerName=function(t){var e=t.getTime();if(e<=this.layerNames[0].time.getTime())return this.layerNames[0].month;if(e>=this.layerNames[11].time.getTime())return this.layerNames[11].month;for(var i=0;i<this.layerNames.length-1;i++){var r=this.layerNames[i].time.getTime(),o=this.layerNames[i+1].time.getTime();if(e>=r&&o>=e){var n=e-r,s=o-e;return s>n?this.layerNames[i].month:this.layerNames[i+1].month}}},i}),i("layer/BMNGLandsatLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(t,e,i,r){"use strict";var o=function(){i.call(this,e.FULL_SPHERE,new t(45,45),10,"image/jpeg","BMNGLandsat256",256,256),this.displayName="Blue Marble & Landsat",this.pickEnabled=!1,this.urlBuilder=new r(location.protocol+"//worldwind25.arc.nasa.gov/wms","BlueMarble-200405,esat","","1.3.0")};return o.prototype=Object.create(i.prototype),o}),i("layer/BMNGLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(t,e,i,r){"use strict";var o=function(o){i.call(this,e.FULL_SPHERE,new t(45,45),5,"image/jpeg",o||"BMNG256",256,256),this.displayName="Blue Marble",this.pickEnabled=!1,this.urlBuilder=new r(location.protocol+"//worldwind25.arc.nasa.gov/wms",o||"BlueMarble-200405","","1.3.0")};return o.prototype=Object.create(i.prototype),o}),i("layer/RenderableLayer",["../error/ArgumentError","../layer/Layer","../util/Logger"],function(t,e,i){"use strict";var r=function(t){e.call(this,t),this.renderables=[]};return r.prototype=Object.create(e.prototype),r.prototype.addRenderable=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"RenderableLayer","addRenderable","missingRenderable"));this.renderables.push(e)},r.prototype.addRenderables=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"RenderableLayer","addRenderables","The renderables array is null or undefined."));for(var r=0,o=e.length;o>r;r++)this.addRenderable(e[r])},r.prototype.removeRenderable=function(t){var e=this.renderables.indexOf(t);e>=0&&this.renderables.splice(e,1)},r.prototype.removeAllRenderables=function(){this.renderables=[]},r.prototype.doRender=function(t){for(var e=t.orderedRenderables.length,r=0,o=this.renderables.length;o>r;r++)try{this.renderables[r].render(t)}catch(n){i.logMessage(i.LEVEL_SEVERE,"RenderableLayer","doRender","Error while rendering shape "+this.renderables[r].displayName+".\n"+n.toString())}t.orderedRenderables.length>e&&(this.inCurrentFrame=!0)},r}),i("pick/PickedObject",[],function(){"use strict";var t=function(t,e,i,r,o){this.color=t,this.userObject=e,this.position=i,this.parentLayer=r,this.isTerrain=o,this.isOnTop=!1};return t}),i("error/UnsupportedOperationError",["../error/AbstractError"],function(t){"use strict";var e=function(e){t.call(this,"UnsupportedOperationError",e);var i;try{throw new Error}catch(r){i=r.stack}this.stack=i};return e.prototype=Object.create(t.prototype),e}),i("render/SurfaceTile",["../error/ArgumentError","../util/Logger","../geom/Matrix","../geom/Sector","../error/UnsupportedOperationError"],function(t,e,i,r,o){"use strict";var n=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceTile","constructor","missingSector"));this.sector=i};return n.prototype.bind=function(t){throw new o(e.logMessage(e.LEVEL_SEVERE,"SurfaceTile","bind","abstractInvocation"))},n.prototype.applyInternalTransform=function(t,i){throw new o(e.logMessage(e.LEVEL_SEVERE,"SurfaceTile","applyInternalTransform","abstractInvocation"))},n}),i("shapes/SurfaceImage",["../error/ArgumentError","../util/Logger","../pick/PickedObject","../render/SurfaceTile"],function(t,e,i,r){"use strict";var o=function(i,o){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceImage","constructor","missingSector"));if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceImage","constructor","missingImage"));r.call(this,i),this.enabled=!0,this._imageSource=o,this.opacity=1,this.displayName="Surface Image",this.imageSourceWasUpdated=!0};return o.prototype=Object.create(r.prototype),Object.defineProperties(o.prototype,{imageSource:{get:function(){return this._imageSource},set:function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceImage","imageSource","missingImage"));this._imageSource=i,this.imageSourceWasUpdated=!0}}}),o.prototype.bind=function(t){var e=t.gpuResourceCache.resourceForKey(this._imageSource);return e&&!this.imageSourceWasUpdated?e.bind(t):(e=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this._imageSource),this.imageSourceWasUpdated=!1,e?e.bind(t):void 0)},o.prototype.applyInternalTransform=function(t,e){},o.prototype.render=function(t){if(this.enabled&&this.sector.overlaps(t.terrain.sector)){if(t.pickingMode&&(this.pickColor=t.uniquePickColor()),t.surfaceTileRenderer.renderTiles(t,[this],this.opacity*t.currentLayer.opacity),t.pickingMode){var e=new i(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);t.resolvePick(e)}t.currentLayer.inCurrentFrame=!0}},o}),i("layer/BMNGOneImageLayer",["../layer/RenderableLayer","../geom/Sector","../shapes/SurfaceImage","../util/WWUtil"],function(t,e,i,r){"use strict";var o=function(){t.call(this,"Blue Marble Image");var o=new i(e.FULL_SPHERE,r.currentUrlSansFilePart()+"/../images/BMNG_world.topo.bathy.200405.3.2048x1024.jpg");this.addRenderable(o),this.pickEnabled=!1,this.minActiveAltitude=3e6};return o.prototype=Object.create(t.prototype),o}),i("gesture/Touch",[],function(){"use strict";var t=function(t,e,i){this.identifier=t,this._clientX=e,this._clientY=i,this._clientStartX=e,this._clientStartY=i};return Object.defineProperties(t.prototype,{clientX:{get:function(){return this._clientX},set:function(t){this._clientX=t}},clientY:{get:function(){return this._clientY},set:function(t){this._clientY=t}},translationX:{get:function(){return this._clientX-this._clientStartX},set:function(t){this._clientStartX=this._clientX-t}},translationY:{get:function(){return this._clientY-this._clientStartY},set:function(t){this._clientStartY=this._clientY-t}}}),t}),i("gesture/GestureRecognizer",["../error/ArgumentError","../util/Logger","../gesture/Touch"],function(t,e,i){"use strict";var r=function(i,o){function n(t){s.handleEvent(t)}if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","constructor","missingTarget"));this.target=i,this.enabled=!0,this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._translationWeight=.4,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0,this._gestureCallbacks=[],this._canRecognizeWith=[],this._requiresFailureOf=[],this._requiredToFailBy=[],o&&this._gestureCallbacks.push(o),r.allRecognizers.push(this);var s=this;window.PointerEvent?(i.addEventListener("pointerdown",n,!1),window.addEventListener("pointermove",n,!1),window.addEventListener("pointercancel",n,!1),window.addEventListener("pointerup",n,!1)):(i.addEventListener("mousedown",n,!1),window.addEventListener("mousemove",n,!1),window.addEventListener("mouseup",n,!1),i.addEventListener("touchstart",n,!1),i.addEventListener("touchmove",n,!1),i.addEventListener("touchend",n,!1),i.addEventListener("touchcancel",n,!1))};return r.allRecognizers=[],Object.defineProperties(r.prototype,{state:{get:function(){return this._state},set:function(t){this.transitionToState(t)}},clientX:{get:function(){return this._clientX},set:function(t){this._clientX=t}},clientY:{get:function(){return this._clientY},set:function(t){this._clientY=t}},translationX:{get:function(){return this._translationX},set:function(t){this._translationX=t,this._clientStartX=this._clientX,this._touchCentroidShiftX=0}},translationY:{get:function(){return this._translationY},set:function(t){this._translationY=t,this._clientStartY=this._clientY,this._touchCentroidShiftY=0}},mouseButtonMask:{get:function(){return this._mouseButtonMask}},touchCount:{get:function(){return this._touches.length}},gestureCallbacks:{get:function(){return this._gestureCallbacks}}}),r.prototype.touch=function(i){if(0>i||i>=this._touches.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","touch","indexOutOfRange"));return this._touches[i]},r.prototype.recognizeSimultaneouslyWith=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","recognizeSimultaneouslyWith","The specified gesture recognizer is null or undefined."));var r=this._canRecognizeWith.indexOf(i);-1==r&&(this._canRecognizeWith.push(i),i._canRecognizeWith.push(this))},r.prototype.canRecognizeSimultaneouslyWith=function(t){var e=this._canRecognizeWith.indexOf(t);return-1!=e},r.prototype.requireRecognizerToFail=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","requireRecognizerToFail","The specified gesture recognizer is null or undefined"));var r=this._requiresFailureOf.indexOf(i);-1==r&&(this._requiresFailureOf.push(i),i._requiredToFailBy.push(this))},r.prototype.requiresRecognizerToFail=function(t){var e=this._requiresFailureOf.indexOf(t);return-1!=e},r.prototype.requiredToFailByRecognizer=function(t){var e=this._requiredToFailBy.indexOf(t);return-1!=e},r.prototype.reset=function(){this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0},r.prototype.prepareToRecognize=function(){},r.prototype.mouseDown=function(t){},r.prototype.mouseMove=function(t){},r.prototype.mouseUp=function(t){},r.prototype.touchStart=function(t){},r.prototype.touchMove=function(t){},r.prototype.touchCancel=function(t){},r.prototype.touchEnd=function(t){},r.prototype.transitionToState=function(t){this._nextState=null,t==WorldWind.FAILED?(this._state=t,this.updateRecognizersWaitingForFailure(),this.resetIfEventsEnded()):t==WorldWind.RECOGNIZED?(this.tryToRecognize(t),this._state==t&&(this.prepareToRecognize(),this.callGestureCallbacks(),this.resetIfEventsEnded())):t==WorldWind.BEGAN?(this.tryToRecognize(t),this._state==t&&(this.prepareToRecognize(),this.callGestureCallbacks())):t==WorldWind.CHANGED?(this._state=t,this.callGestureCallbacks()):t==WorldWind.CANCELLED?(this._state=t,this.callGestureCallbacks(),this.resetIfEventsEnded()):t==WorldWind.ENDED&&(this._state=t,this.callGestureCallbacks(),this.resetIfEventsEnded())},r.prototype.updateRecognizersWaitingForFailure=function(){for(var t=0,e=this._requiredToFailBy.length;e>t;t++){var i=this._requiredToFailBy[t];null!=i._nextState&&i.transitionToState(i._nextState)}},r.prototype.tryToRecognize=function(t){if(r.allRecognizers.some(this.canBePreventedByRecognizer,this))return void this.transitionToState(WorldWind.FAILED);if(r.allRecognizers.some(this.isWaitingForRecognizerToFail,this))return void(this._nextState=t);for(var e=r.allRecognizers.filter(this.canPreventRecognizer,this),i=0,o=e.length;o>i;i++)e[i].transitionToState(WorldWind.FAILED);this._state=t},r.prototype.canPreventRecognizer=function(t){return this!=t&&this.target==t.target&&t.state==WorldWind.POSSIBLE&&(this.requiredToFailByRecognizer(t)||!this.canRecognizeSimultaneouslyWith(t))},r.prototype.canBePreventedByRecognizer=function(t){return this!=t&&this.target==t.target&&t.state==WorldWind.RECOGNIZED&&(this.requiresRecognizerToFail(t)||!this.canRecognizeSimultaneouslyWith(t))},r.prototype.isWaitingForRecognizerToFail=function(t){return this!=t&&this.target==t.target&&t.state==WorldWind.POSSIBLE&&this.requiresRecognizerToFail(t)},r.prototype.callGestureCallbacks=function(){for(var t=0,e=this._gestureCallbacks.length;e>t;t++)this._gestureCallbacks[t](this)},r.prototype.handleEvent=function(t){if(this.enabled&&(!t.defaultPrevented||this.state!=WorldWind.POSSIBLE)){var i,r;try{if("mousedown"==t.type)this.handleMouseDown(t);else if("mousemove"==t.type)this.handleMouseMove(t);else if("mouseup"==t.type)this.handleMouseUp(t);else if("touchstart"==t.type)for(i=0,r=t.changedTouches.length;r>i;i++)this.handleTouchStart(t.changedTouches.item(i));else if("touchmove"==t.type)for(i=0,r=t.changedTouches.length;r>i;i++)this.handleTouchMove(t.changedTouches.item(i));else if("touchcancel"==t.type)for(i=0,r=t.changedTouches.length;r>i;i++)this.handleTouchCancel(t.changedTouches.item(i));else if("touchend"==t.type)for(i=0,r=t.changedTouches.length;r>i;i++)this.handleTouchEnd(t.changedTouches.item(i));else"pointerdown"==t.type&&"mouse"==t.pointerType?this.handleMouseDown(t):"pointermove"==t.type&&"mouse"==t.pointerType?this.handleMouseMove(t):"pointercancel"==t.type&&"mouse"==t.pointerType||("pointerup"==t.type&&"mouse"==t.pointerType?this.handleMouseUp(t):"pointerdown"==t.type&&"touch"==t.pointerType?this.handleTouchStart(t):"pointermove"==t.type&&"touch"==t.pointerType?this.handleTouchMove(t):"pointercancel"==t.type&&"touch"==t.pointerType?this.handleTouchCancel(t):"pointerup"==t.type&&"touch"==t.pointerType?this.handleTouchEnd(t):e.logMessage(e.LEVEL_INFO,"GestureRecognizer","handleEvent","Unrecognized event type: "+t.type))}catch(o){e.logMessage(e.LEVEL_SEVERE,"GestureRecognizer","handleEvent","Error handling event.\n"+o.toString())}}},r.prototype.handleMouseDown=function(t){if(!("mousedown"==t.type&&this._touches.length>0)){var e=1<<t.button;e&0!=this._mouseButtonMask||(0==this._mouseButtonMask&&(this._clientX=t.clientX,this._clientY=t.clientY,this._clientStartX=t.clientX,this._clientStartY=t.clientY,this._translationX=0,this._translationY=0),this._mouseButtonMask|=e,this.mouseDown(t))}},r.prototype.handleMouseMove=function(t){if(0!=this._mouseButtonMask&&(this._clientX!=t.clientX||this._clientY!=t._clientY)){
var e=t.clientX-this._clientStartX,i=t.clientY-this._clientStartY,r=this._translationWeight;this._clientX=t.clientX,this._clientY=t.clientY,this._translationX=this._translationX*(1-r)+e*r,this._translationY=this._translationY*(1-r)+i*r,this.mouseMove(t)}},r.prototype.handleMouseUp=function(t){var e=1<<t.button;e&0==this._mouseButtonMask||(this._mouseButtonMask&=~e,this.mouseUp(t),0==this._mouseButtonMask&&this.resetIfEventsEnded())},r.prototype.handleTouchStart=function(t){var e=new i(t.identifier||t.pointerId,t.clientX,t.clientY);this._touches.push(e),1==this._touches.length?(this._clientX=t.clientX,this._clientY=t.clientY,this._clientStartX=t.clientX,this._clientStartY=t.clientY,this._translationX=0,this._translationY=0,this._touchCentroidShiftX=0,this._touchCentroidShiftY=0):this.touchesAddedOrRemoved(),this.touchStart(e)},r.prototype.handleTouchMove=function(t){var e=this.indexOfTouchWithId(t.identifier||t.pointerId);if(-1!=e){var i=this._touches[e];if(i.clientX!=t.clientX||i.clientY!=t.clientY){i.clientX=t.clientX,i.clientY=t.clientY;var r=this.touchCentroid(),o=r.clientX-this._clientStartX+this._touchCentroidShiftX,n=r.clientY-this._clientStartY+this._touchCentroidShiftY,s=this._translationWeight;this._clientX=r.clientX,this._clientY=r.clientY,this._translationX=this._translationX*(1-s)+o*s,this._translationY=this._translationY*(1-s)+n*s,this.touchMove(i)}}},r.prototype.handleTouchCancel=function(t){var e=this.indexOfTouchWithId(t.identifier||t.pointerId);if(-1!=e){var i=this._touches[e];this._touches.splice(e,1),this.touchesAddedOrRemoved(),this.touchCancel(i),this.resetIfEventsEnded()}},r.prototype.handleTouchEnd=function(t){var e=this.indexOfTouchWithId(t.identifier||t.pointerId);if(-1!=e){var i=this._touches[e];this._touches.splice(e,1),this.touchesAddedOrRemoved(),this.touchEnd(i),this.resetIfEventsEnded()}},r.prototype.resetIfEventsEnded=function(){this._state!=WorldWind.POSSIBLE&&0==this._mouseButtonMask&&0==this._touches.length&&this.reset()},r.prototype.touchesAddedOrRemoved=function(){this._touchCentroidShiftX+=this._clientX,this._touchCentroidShiftY+=this._clientY;var t=this.touchCentroid();this._clientX=t.clientX,this._clientY=t.clientY,this._touchCentroidShiftX-=this._clientX,this._touchCentroidShiftY-=this._clientY},r.prototype.touchCentroid=function(){for(var t=0,e=0,i=0,r=this._touches.length;r>i;i++){var o=this._touches[i];t+=o.clientX/r,e+=o.clientY/r}return{clientX:t,clientY:e}},r.prototype.indexOfTouchWithId=function(t){for(var e=0,i=this._touches.length;i>e;e++)if(this._touches[e].identifier==t)return e;return-1},r}),i("gesture/ClickRecognizer",["../gesture/GestureRecognizer"],function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.numberOfClicks=1,this.button=0,this.maxMouseMovement=5,this.maxClickDuration=500,this.maxClickInterval=400,this.clicks=[],this.timeout=null};return e.prototype=Object.create(t.prototype),e.prototype.reset=function(){t.prototype.reset.call(this),this.clicks=[],this.cancelFailAfterDelay()},e.prototype.mouseDown=function(t){if(this.state==WorldWind.POSSIBLE)if(this.button!=t.button)this.state=WorldWind.FAILED;else{var e={clientX:this.clientX,clientY:this.clientY};this.clicks.push(e),this.failAfterDelay(this.maxClickDuration)}},e.prototype.mouseMove=function(t){if(this.state==WorldWind.POSSIBLE){var e=this.translationX,i=this.translationY,r=Math.sqrt(e*e+i*i);r>this.maxMouseMovement&&(this.state=WorldWind.FAILED)}},e.prototype.mouseUp=function(t){if(this.state==WorldWind.POSSIBLE&&0==this.mouseButtonMask){var e=this.clicks.length;e==this.numberOfClicks?(this.clientX=this.clicks[0].clientX,this.clientY=this.clicks[0].clientY,this.state=WorldWind.RECOGNIZED):this.failAfterDelay(this.maxClickInterval)}},e.prototype.touchStart=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.failAfterDelay=function(t){var e=this;e.timeout&&window.clearTimeout(e.timeout),e.timeout=window.setTimeout(function(){e.timeout=null,e.state==WorldWind.POSSIBLE&&(e.state=WorldWind.FAILED)},t)},e.prototype.cancelFailAfterDelay=function(){var t=this;t.timeout&&(window.clearTimeout(t.timeout),t.timeout=null)},e}),i("util/Offset",["../geom/Vec2"],function(t){"use strict";var e=function(t,e,i,r){this.x=e,this.y=r,this.xUnits=t,this.yUnits=i};return e.prototype.clone=function(){return new e(this.xUnits,this.x,this.yUnits,this.y)},e.prototype.offsetForSize=function(e,i){var r,o;return r=this.xUnits==WorldWind.OFFSET_FRACTION?e*this.x:this.xUnits==WorldWind.OFFSET_INSET_PIXELS?e-this.x:this.x,o=this.yUnits==WorldWind.OFFSET_FRACTION?i*this.y:this.yUnits==WorldWind.OFFSET_INSET_PIXELS?i-this.y:this.y,new t(r,o)},e.prototype.toString=function(){return this.xUnits+" "+this.x+" "+this.yUnits+" "+this.y},e}),i("util/ImageSource",["../error/ArgumentError","../util/Color","../util/Logger"],function(t,e,i){"use strict";var r=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"ImageSource","constructor","missingImage"));this.image=e,this.key="ImageSource "+ ++r.keyPool};return r.keyPool=0,r}),i("render/Renderable",["../util/Logger","../error/UnsupportedOperationError"],function(t,e){"use strict";var i=function(){this.displayName="Renderable",this.enabled=!0,this.pickDelegate=null};return i.prototype.render=function(i){throw new e(t.logMessage(t.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},i}),i("shapes/ScreenImage",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/ImageSource","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(e,r){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"ScreenImage","constructor","missingOffset"));if(!r)throw new t(o.logMessage(o.LEVEL_SEVERE,"ScreenImage","constructor","missingImage"));h.call(this),this.screenOffset=e,this._imageSource=r,this.imageColor=i.WHITE,this.imageOffset=new s(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this.imageScale=1,this.imageRotation=0,this.imageTilt=0,this.enabled=!0,this.opacity=1,this.pickDelegate=null,this.activeTexture=null,this.imageTransform=n.fromIdentity(),this.texCoordMatrix=n.fromIdentity(),this.imageBounds=null,this.layer=null};return c.matrix=n.fromIdentity(),c.prototype=Object.create(h.prototype),Object.defineProperties(c.prototype,{imageSource:{get:function(){return this._imageSource},set:function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"ScreenImage","imageSource","missingImage"));this._imageSource=e,this.imageSourceWasUpdated=!0}}}),c.prototype.render=function(t){if(this.enabled&&t.accumulateOrderedRenderables){var e=null;this.lastFrameTime!==t.timestamp&&(e=this.makeOrderedRenderable(t)),e&&e.isVisible(t)&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e))}},c.prototype.renderOrdered=function(t){if(this.drawOrderedScreenImage(t),t.pickingMode){var e=new a(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);t.resolvePick(e)}},c.prototype.makeOrderedRenderable=function(t){var e,i,r,o,n,s,a;return this.activeTexture=this.getActiveTexture(t),this.activeTexture&&!this.imageSourceWasUpdated||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this._imageSource),this.activeTexture)?(this.eyeDistance=0,e=this.activeTexture.imageWidth,i=this.activeTexture.imageHeight,r=this.imageScale,s=this.imageOffset.offsetForSize(e,i),o=t.navigatorState.viewport.width,n=t.navigatorState.viewport.height,a=this.screenOffset.offsetForSize(o,n),this.imageTransform.setTranslation(a[0]-s[0]*r,a[1]-s[1]*r,0),this.imageTransform.setScale(e*r,i*r,1),this.imageBounds=u.boundingRectForUnitQuad(this.imageTransform),this):null},c.prototype.getActiveTexture=function(t){return t.gpuResourceCache.resourceForKey(this._imageSource)},c.prototype.isVisible=function(t){return t.pickingMode?t.pickRectangle&&this.imageBounds.intersects(t.pickRectangle):this.imageBounds.intersects(t.navigatorState.viewport)},c.prototype.drawOrderedScreenImage=function(t){this.beginDrawing(t);try{this.doDrawOrderedScreenImage(t)}finally{this.endDrawing(t)}},c.prototype.beginDrawing=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),i.loadModulateColor(r,t.pickingMode)},c.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.enable(e.DEPTH_TEST)},c.prototype.doDrawOrderedScreenImage=function(t){var e=t.currentGlContext,i=t.currentProgram;e.bindBuffer(e.ARRAY_BUFFER,t.unitQuadBuffer3()),e.vertexAttribPointer(i.vertexPointLocation,3,e.FLOAT,!1,0,0),c.matrix.copy(t.screenProjection),c.matrix.multiplyMatrix(this.imageTransform),c.matrix.multiplyByTranslation(.5,.5,.5),c.matrix.multiplyByRotation(1,0,0,this.imageTilt),c.matrix.multiplyByRotation(0,0,1,this.imageRotation),c.matrix.multiplyByTranslation(-.5,-.5,0),i.loadModelviewProjection(e,c.matrix),i.loadTextureEnabled(e,!0),t.pickingMode?(this.pickColor=t.uniquePickColor(),i.loadColor(e,this.pickColor)):(i.loadColor(e,this.imageColor),i.loadOpacity(e,this.opacity*this.layer.opacity)),this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),i.loadTextureMatrix(e,this.texCoordMatrix),this.activeTexture.bind(t)&&e.drawArrays(e.TRIANGLE_STRIP,0,4)},c}),i("shapes/Compass",["../error/ArgumentError","../util/Logger","../util/Offset","../shapes/ScreenImage"],function(t,e,i,r){"use strict";var o=function(t,e){var o=t?t:new i(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,1),n=e?e:WorldWind.configuration.baseUrl+"images/notched-compass.png";r.call(this,o,n),t||(this.imageOffset=new i(WorldWind.OFFSET_FRACTION,1.1,WorldWind.OFFSET_FRACTION,1.1)),this.size=.15};return o.prototype=Object.create(r.prototype),o.prototype.render=function(t){this.imageRotation=t.navigatorState.heading,this.imageTilt=t.navigatorState.tilt;var e=this.getActiveTexture(t);e&&(this.imageScale=.15*t.currentGlContext.drawingBufferWidth/e.imageWidth),r.prototype.render.call(this,t)},o}),i("layer/CompassLayer",["../shapes/Compass","../layer/RenderableLayer"],function(t,e){"use strict";var i=function(){e.call(this,"Compass"),this._compass=new t(null,null),this.addRenderable(this._compass)};return i.prototype=Object.create(e.prototype),Object.defineProperties(i.prototype,{compass:{get:function(){return this._compass},set:function(e){e&&e instanceof t&&(this.removeAllRenderables(),this.addRenderable(e),this._compass=e)}}}),i}),i("util/Font",["../error/ArgumentError","../util/Color","../util/Logger"],function(t,e,i){"use strict";var r=function(e,r,o,n,s,a){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Font","constructor","missingSize"));if(0>=e)throw new t(i.logMessage(i.LEVEL_SEVERE,"Font","constructor","invalidSize"));this._size=e,this.style=r||"normal",this.variant=o||"normal",this.weight=n||"normal",this.family=s||"sans-serif",this.horizontalAlignment=a||"center"};return Object.defineProperties(r.prototype,{size:{get:function(){return this._size},set:function(t){this._fontString=null,this._size=t}},style:{get:function(){return this._style},set:function(t){this._fontString=null,this._style=t}},variant:{get:function(){return this._variant},set:function(t){this._fontString=null,this._variant=t}},weight:{get:function(){return this._weight},set:function(t){this._fontString=null,this._weight=t}},family:{get:function(){return this._family},set:function(t){this._fontString=null,this._family=t}},horizontalAlignment:{get:function(){return this._horizontalAlignment},set:function(t){this._toString=null,this._horizontalAlignment=t}},fontString:{get:function(){return this._fontString||(this._fontString=this._style+" "+this.variant+" "+this._weight+" "+this._size.toString()+"px "+this._family),this._fontString}}}),r.prototype.toString=function(){return this._toString&&this._fontString||(this._toString=this.fontString+" "+this.horizontalAlignment),this._toString},r}),i("shapes/TextAttributes",["../util/Color","../util/Font","../util/Offset"],function(t,e,i){"use strict";var r=function(r){this._color=r?r._color:new t(1,1,1,1),this._font=r?r._font:new e(14),this._offset=r?r._offset:new i(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,0),this._scale=r?r._scale:1,this._depthTest=r?r._depthTest:!1,this.stateKeyInvalid=!0};return r.prototype.computeStateKey=function(){return"c "+this._color.toHexString(!0)+" f "+this._font.toString()+" o "+this._offset.toString()+" s "+this._scale+" dt "+this._depthTest},Object.defineProperties(r.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},color:{get:function(){return this._color},set:function(t){this._color=t,this.stateKeyInvalid=!0}},font:{get:function(){return this._font},set:function(t){this._font=t,this.stateKeyInvalid=!0}},offset:{get:function(){return this._offset},set:function(t){this._offset=t,this.stateKeyInvalid=!0}},scale:{get:function(){return this._scale},set:function(t){this._scale=t,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this.stateKeyInvalid=!0}}}),r}),i("shapes/Text",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../pick/PickedObject","../render/Renderable","../shapes/TextAttributes","../error/UnsupportedOperationError","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u,c,d){"use strict";var g=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Text","constructor","missingText"));a.call(this),this.attributes=new h(null),this.highlightAttributes=null,this.highlighted=!1,this.enabled=!0,this.text=e,this.altitudeMode=WorldWind.ABSOLUTE,this.pickDelegate=null,this.alwaysOnTop=!1,this.targetVisibility=1,this.currentVisibility=1,this.declutterGroup=0,this.markerImageSource=WorldWind.configuration.baseUrl+"images/white-dot.png",this.markerImageScale=.1,this.activeAttributes=null,this.activeTexture=null,this.imageTransform=n.fromIdentity(),this.texCoordMatrix=n.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-.003,this.screenPoint=new c(0,0,0)};return g.matrix=n.fromIdentity(),g.glPickPoint=new c(0,0,0),g.prototype=Object.create(a.prototype),g.prototype.copy=function(t){return this.text=t.text,this.attributes=t.attributes,this.highlightAttributes=t.highlightAttributes,this.highlighted=t.highlighted,this.enabled=t.enabled,this.altitudeMode=t.altitudeMode,this.pickDelegate=t.pickDelegate,this.alwaysOnTop=t.alwaysOnTop,this.depthOffset=t.depthOffset,this.declutterGroup=t.declutterGroup,this.targetVisibility=t.targetVisibility,this.currentVisibility=t.currentVisibility,this},Object.defineProperties(g.prototype,{screenBounds:{get:function(){return this.imageBounds}}}),g.prototype.render=function(t){if(this.enabled&&this.text&&0!==this.text.length&&t.accumulateOrderedRenderables){var e;if(this.lastFrameTime!=t.timestamp)e=this.makeOrderedRenderable(t);else{var i=this.clone();e=i.makeOrderedRenderable(t)}e&&e.isVisible(t)&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e))}},g.prototype.renderOrdered=function(t){if((0!==this.currentVisibility||0!==this.targetVisibility||this.markerImageSource)&&(this.drawOrderedText(t),t.pickingMode)){var e=new s(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);t.resolvePick(e)}},g.prototype.makeOrderedRenderable=function(t){var e,i,r,o;if(this.determineActiveAttributes(t),!this.activeAttributes)return null;if(!this.computeScreenPointAndEyeDistance(t))return null;var n=this.activeAttributes.font,s=this.text+n.toString();return this.activeTexture=t.gpuResourceCache.resourceForKey(s),this.activeTexture||(this.activeTexture=t.textSupport.createTexture(t,this.text,n,!0),t.gpuResourceCache.putResource(s,this.activeTexture,this.activeTexture.size)),e=this.activeTexture.imageWidth,i=this.activeTexture.imageHeight,r=this.activeAttributes.scale,o=this.activeAttributes.offset.offsetForSize(e,i),this.imageTransform.setTranslation(this.screenPoint[0]-o[0]*r,this.screenPoint[1]-o[1]*r,this.screenPoint[2]),this.imageTransform.setScale(e*r,i*r,1),this.imageBounds=d.boundingRectForUnitQuad(this.imageTransform),this},g.prototype.computeScreenPointAndEyeDistance=function(t){throw new l(o.logMessage(o.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},g.prototype.determineActiveAttributes=function(t){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes},g.prototype.isVisible=function(t){return t.pickingMode?t.pickRectangle&&this.imageBounds.intersects(t.pickRectangle):this.imageBounds.intersects(t.navigatorState.viewport)},g.prototype.drawOrderedText=function(t){this.beginDrawing(t);try{this.doDrawOrderedText(t),!t.pickingMode}finally{this.endDrawing(t)}},g.prototype.drawBatchOrderedText=function(t){for(var e;(e=t.peekOrderedRenderable())&&e instanceof g;){t.popOrderedRenderable();try{e.doDrawOrderedText(t)}catch(i){o.logMessage(o.LEVEL_WARNING,"Text","drawBatchOrderedText","Error occurred while rendering text using batching: "+i.message)}}},g.prototype.beginDrawing=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer3()),r.vertexAttribPointer(i.vertexPointLocation,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),t.pickingMode&&i.loadTextureEnabled(r,!1),i.loadModulateColor(r,!1),r.depthMask(!1),g.currentTexture=null},g.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.depthMask(!0),g.currentTexture=null},g.prototype.doDrawOrderedText=function(t){var e,i=t.currentGlContext,r=t.currentProgram;if(t.pickingMode&&(this.pickColor=t.uniquePickColor()),!t.pickingMode&&this.currentVisibility!=this.targetVisibility){var o=(t.timestamp-t.previousRedrawTimestamp)/t.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+o):this.currentVisibility=Math.max(0,this.currentVisibility-o),t.redrawRequested=!0}if(this.currentVisibility>0&&(g.matrix.copy(t.screenProjection),g.matrix.multiplyMatrix(this.imageTransform),r.loadModelviewProjection(i,g.matrix),t.pickingMode?(r.loadColor(i,this.pickColor),r.loadTextureEnabled(i,!1)):(r.loadColor(i,this.activeAttributes.color),r.loadOpacity(i,this.layer.opacity*this.currentVisibility),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),r.loadTextureMatrix(i,this.texCoordMatrix),this.activeTexture&&this.activeTexture!=g.currentTexture&&(e=this.activeTexture.bind(t),r.loadTextureEnabled(i,e),g.currentTexture=this.activeTexture)),this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!1),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!0)),this.currentVisibility<1&&this.markerImageSource){var s=t.gpuResourceCache.resourceForKey(this.markerImageSource);if(!s)return void t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.markerImageSource);var a=this.markerImageScale,h=n.fromIdentity();if(h.setTranslation(this.screenPoint[0]-a*s.imageWidth/2,this.screenPoint[1]-a*s.imageWidth/2,this.screenPoint[2]),h.setScale(s.imageWidth*a,s.imageHeight*a,1),g.matrix.copy(t.screenProjection),g.matrix.multiplyMatrix(h),r.loadModelviewProjection(i,g.matrix),t.pickingMode)r.loadColor(i,this.pickColor),r.loadTextureEnabled(i,!1);else{r.loadColor(i,this.activeAttributes.color),r.loadOpacity(i,this.layer.opacity*(1-this.currentVisibility));var l=n.fromIdentity();l.multiplyByTextureTransform(s),r.loadTextureMatrix(i,l),s!=g.currentTexture&&(e=s.bind(t),r.loadTextureEnabled(i,e),g.currentTexture=s)}this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!1),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||i.disable(i.DEPTH_TEST,!0)}},g}),i("shapes/ScreenText",["../error/ArgumentError","../util/Logger","../util/Offset","../shapes/Text"],function(t,e,i,r){"use strict";var o=function(i,o){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Text","constructor","missingOffset"));r.call(this,o),this.screenOffset=i,this.altitudeMode=null};return o.prototype=Object.create(r.prototype),o.prototype.render=function(t){this.lastFrameTime!=t.timestamp&&r.prototype.render.call(this,t)},o.prototype.computeScreenPointAndEyeDistance=function(t){var e=t.currentGlContext,i=this.screenOffset.offsetForSize(e.drawingBufferWidth,e.drawingBufferHeight);return this.screenPoint[0]=i[0],this.screenPoint[1]=i[1],this.screenPoint[2]=0,this.eyeDistance=0,!0},o}),i("layer/CoordinatesDisplayLayer",["../error/ArgumentError","../util/Color","../util/Font","../layer/Layer","../util/Logger","../util/Offset","../geom/Position","../shapes/ScreenImage","../shapes/ScreenText","../shapes/TextAttributes","../geom/Vec2"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(i){function s(t){g.handleUIEvent(t)}function u(t,e){g.handleRedraw(e)}if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"ViewControlsLayer","constructor","missingWorldWindow"));r.call(this,"Coordinates"),this.wwd=i,this.pickEnabled=!1,this.eventType=null,this.clientX=null,this.clientY=null,this.terrainPosition=null,this.latText=new h(new n(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.latText.attributes=new l(null),this.latText.attributes.color=e.YELLOW,this.lonText=new h(new n(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.lonText.attributes=new l(null),this.lonText.attributes.color=e.YELLOW,this.elevText=new h(new n(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.elevText.attributes=new l(null),this.elevText.attributes.color=e.YELLOW,this.eyeText=new h(new n(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.eyeText.attributes=new l(null),this.eyeText.attributes.color=e.YELLOW;var c=new n(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),d=WorldWind.configuration.baseUrl+"images/crosshair.png";this.crosshairImage=new a(c,d);var g=this;window.PointerEvent?(i.addEventListener("pointerdown",s),i.addEventListener("pointermove",s),i.addEventListener("pointerleave",s)):(i.addEventListener("mousedown",s),i.addEventListener("mousemove",s),i.addEventListener("mouseleave",s),i.addEventListener("touchstart",s),i.addEventListener("touchmove",s)),this.wwd.redrawCallbacks.push(u)};return c.prototype=Object.create(r.prototype),c.prototype.doRender=function(t){var e,i,r,o,s,a=this.terrainPosition,h=t.eyePosition,l=t.currentGlContext.canvas.clientWidth;l>650?(e=l/2-50,i=5,r=WorldWind.OFFSET_PIXELS,o=0):l>400?(e=60,i=5,r=WorldWind.OFFSET_INSET_PIXELS,o=1):(e=60,i=5,r=WorldWind.OFFSET_INSET_PIXELS,o=1,s=!0),this.latText.text=a?this.formatLatitude(a.latitude):null,this.latText.screenOffset=new n(WorldWind.OFFSET_PIXELS,e,r,i),this.latText.attributes.offset=new n(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,o),this.latText.render(t),e+=70,this.lonText.text=a?this.formatLongitude(a.longitude):null,this.lonText.screenOffset=new n(WorldWind.OFFSET_PIXELS,e,r,i),this.lonText.attributes.offset=new n(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,o),this.lonText.render(t),t.globe.is2D()||(e+=70,this.elevText.text=a?this.formatAltitude(a.altitude,"m"):null,this.elevText.screenOffset=new n(WorldWind.OFFSET_PIXELS,e,r,i),this.elevText.attributes.offset=new n(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,o),this.elevText.render(t)),s||(e+=40,this.eyeText.text="Eye  "+this.formatAltitude(h.altitude,h.altitude<1e3?"m":"km"),this.eyeText.screenOffset=new n(WorldWind.OFFSET_PIXELS,e,r,i),this.eyeText.attributes.offset=new n(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,o),this.eyeText.render(t)),"touch"==this.eventType&&this.crosshairImage.render(t),this.inCurrentFrame=!0},c.prototype.handleUIEvent=function(t){-1!=t.type.indexOf("pointer")?this.eventType=t.pointerType:-1!=t.type.indexOf("mouse")?this.eventType="mouse":-1!=t.type.indexOf("touch")&&(this.eventType="touch"),-1!=t.type.indexOf("leave")?(this.clientX=null,this.clientY=null):(this.clientX=t.clientX,this.clientY=t.clientY),this.wwd.redraw()},c.prototype.handleRedraw=function(t){if(t==WorldWind.BEFORE_REDRAW){var e,i;("mouse"==this.eventType||"pen"==this.eventType)&&this.clientX&&this.clientY?(e=this.wwd.canvasCoordinates(this.clientX,this.clientY),e[0]>=0&&e[0]<this.wwd.canvas.width&&e[1]>=0&&e[1]<this.wwd.canvas.height&&(i=this.wwd.pickTerrain(e).terrainObject())):"touch"==this.eventType&&(e=new u(this.wwd.canvas.width/2,this.wwd.canvas.height/2),i=this.wwd.pickTerrain(e).terrainObject()),this.terrainPosition=i?i.position:null}},c.prototype.formatLatitude=function(t){var e=0>t?"°S":"°N";return Math.abs(t).toFixed(2)+e},c.prototype.formatLongitude=function(t){var e=0>t?"°W":"°E";return Math.abs(t).toFixed(2)+e},c.prototype.formatAltitude=function(t,e){return"km"===e&&(t/=1e3),t.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" "+e},c}),i("layer/DigitalGlobeTiledImageLayer",["../geom/Angle","../error/ArgumentError","../util/Color","../geom/Location","../util/Logger","../geom/Sector","../layer/MercatorTiledImageLayer"],function(t,e,i,r,o,n,s){"use strict";var a=function(t,i,a){if(!i)throw new e(o.logMessage(o.LEVEL_SEVERE,"DigitalGlobeTiledImageLayer","constructor","The map ID is null or undefined."));if(!a)throw new e(o.logMessage(o.LEVEL_SEVERE,"DigitalGlobeTiledImageLayer","constructor","The access token is null or undefined."));this.imageSize=256,t=t||"Digital Globe",s.call(this,new n(-85.05,85.05,-180,180),new r(85.05,180),19,"image/jpeg",t,this.imageSize,this.imageSize),this.mapId=i,this.accessToken=a,this.displayName=t,this.pickEnabled=!1,this.detailHintOrigin=2.9,this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"),this.requestMetadata();var h=this;this.urlBuilder={urlForTile:function(t,e){return h.metadataRetrievalInProcess?null:h.urlTemplate.replace("{z}",t.level.levelNumber+1).replace("{x}",t.column).replace("{y}",t.row)}}};return a.prototype=Object.create(s.prototype),a.prototype.requestMetadata=function(){if(!this.metadataRetrievalInProcess){this.metadataRetrievalInProcess=!0;var t="https://api.mapbox.com/v4/"+this.mapId+".json?secure&access_token="+this.accessToken,e=new XMLHttpRequest,i=this;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=JSON.parse(e.responseText);i.urlTemplate=t.tiles[0];var r=document.createEvent("Event");r.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(r),i.metadataRetrievalInProcess=!1}},e.open("GET",t,!0),e.send()}},a.prototype.doRender=function(t){s.prototype.doRender.call(this,t),this.inCurrentFrame&&t.screenCreditController.addStringCredit("© Digital Globe",i.DARK_GRAY)},a.prototype.createTopLevelTiles=function(t){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},a.prototype.mapSizeForLevel=function(t){return 256<<t+1},a}),i("gesture/DragRecognizer",["../gesture/GestureRecognizer"],function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.button=0,this.interpretDistance=5};return e.prototype=Object.create(t.prototype),e.prototype.mouseMove=function(t){this.state==WorldWind.POSSIBLE?this.shouldInterpret()&&(this.shouldRecognize()?(this.translationX=0,this.translationY=0,this.state=WorldWind.BEGAN):this.state=WorldWind.FAILED):(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.CHANGED)},e.prototype.mouseUp=function(t){0==this.mouseButtonMask&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.ENDED))},e.prototype.touchStart=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.shouldInterpret=function(){var t=this.translationX,e=this.translationY,i=Math.sqrt(t*t+e*e);return i>this.interpretDistance},e.prototype.shouldRecognize=function(){var t=1<<this.button;return t==this.mouseButtonMask},e}),i("util/FrameStatistics",[],function(){"use strict";var t=function(){this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=0,this.frameTimeExtremes=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this.frameTime=0,this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,this.frameTimeAverage=0,this.frameRateAverage=0,this.frameTimeMin=0,this.frameTimeMax=0};return t.prototype.beginFrame=function(){this.frameTime=Date.now(),this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,++this.frameCount},t.prototype.endFrame=function(){var t=Date.now();this.frameTime=t-this.frameTime,this.frameTimeCumulative+=this.frameTime,this.frameTimeExtremes[0]=Math.min(this.frameTimeExtremes[0],this.frameTime),this.frameTimeExtremes[1]=Math.max(this.frameTimeExtremes[1],this.frameTime),t-this.frameTimeBase>2e3&&(this.frameTimeAverage=this.frameTimeCumulative/this.frameCount,this.frameRateAverage=1e3*this.frameCount/(t-this.frameTimeBase),this.frameTimeMin=this.frameTimeExtremes[0],this.frameTimeMax=this.frameTimeExtremes[1],this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=t,this.frameTimeExtremes=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY])},t.prototype.incrementRenderedTileCount=function(t){this.renderedTileCount+=t},t.prototype.setTerrainTileCount=function(t){this.terrainTileCount=t},t.prototype.incrementImageTileCount=function(t){this.imageTileCount=t},t.prototype.incrementTileUpdateCount=function(t){this.tileUpdateCount+=t},t.prototype.incrementTextureLoadCount=function(t){this.textureLoadCount+=t},t.prototype.incrementVboLoadCount=function(t){this.vboLoadCount+=t},t}),i("render/FramebufferTexture",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(t,e){"use strict";var i=function(i,r,o,n){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"FramebufferTexture","constructor","missingGlContext"));if(0>r||0>o)throw new t(e.logMessage(e.LEVEL_SEVERE,"FramebufferTexture","constructor","The framebuffer width or height is less than zero."));this.width=r,this.height=o,this.depth=n,this.size=r*o*4+(n?r*o*2:0),this.framebufferId=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.framebufferId),this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,r,o,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0),
this.depthBuffer=null,n&&(this.depthBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,r,o),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.depthBuffer));var s=i.checkFramebufferStatus(i.FRAMEBUFFER);s!=i.FRAMEBUFFER_COMPLETE&&(e.logMessage(e.LEVEL_WARNING,"FramebufferTexture","constructor","Error creating framebuffer: "+s),this.framebufferId=null,this.texture=null,this.depthBuffer=null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindTexture(i.TEXTURE_2D,null)};return i.prototype.bind=function(t){return this.texture&&t.currentGlContext.bindTexture(gl.TEXTURE_2D,this.texture),!!this.texture},i}),i("render/FramebufferTile",["../error/ArgumentError","../render/FramebufferTexture","../util/Logger","../geom/Matrix","../geom/Rectangle","../render/TextureTile"],function(t,e,i,r,o,n){"use strict";var s=function(e,o,s,a,h){if(!h||h.length<1)throw new t(i.logMessage(i.LEVEL_SEVERE,"FramebufferTile","constructor","The specified cache name is null, undefined or zero length."));n.call(this,e,o,s,a),this.gpuCacheKey=h,this.textureTransform=r.fromIdentity().setToUnitYFlip(),this.mustClear=!0};return s.prototype=Object.create(n.prototype),s.prototype.clearFramebuffer=function(t){this.mustClear=!0},s.prototype.bindFramebuffer=function(t){var e=t.gpuResourceCache.resourceForKey(this.gpuCacheKey);return e||(e=this.createFramebuffer(t)),t.bindFramebuffer(e),this.mustClear&&(this.doClearFramebuffer(t),this.mustClear=!1),!0},s.prototype.createFramebuffer=function(t){var i=new e(t.currentGlContext,this.tileWidth,this.tileHeight,!1);return t.gpuResourceCache.putResource(this.gpuCacheKey,i,i.size),i},s.prototype.doClearFramebuffer=function(t){var e=t.currentGlContext;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},s.prototype.applyInternalTransform=function(t,e){e.multiplyMatrix(this.textureTransform)},s}),i("render/FramebufferTileController",["../error/ArgumentError","../render/FramebufferTile","../util/LevelSet","../geom/Location","../util/Logger","../cache/MemoryCache","../geom/Sector","../util/Tile"],function(t,e,i,r,o,n,s,a){"use strict";var h=function(){this.tileWidth=256,this.tileHeight=256,this.detailHint=0,this.levels=new i(s.FULL_SPHERE,new r(45,45),16,this.tileWidth,this.tileHeight),this.topLevelTiles=[],this.currentTiles=[],this.currentTimestamp=null,this.currentGlobeStateKey=null,this.tileCache=new n(5e5,4e5),this.key="FramebufferTileController "+ ++h.keyPool,this.detailHintOrigin=2.4};return h.keyPool=0,h.prototype.selectTiles=function(e,i){if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"FramebufferTileController","selectTiles","missingSector"));this.assembleTiles(e);for(var r=[],n=0,s=this.currentTiles.length;s>n;n++){var a=this.currentTiles[n];a.sector.overlaps(i)&&(a.selected=!0,r.push(a))}return r},h.prototype.render=function(t){if(0!=this.currentTiles.length){for(var e=[],i=0,r=this.currentTiles.length;r>i;i++){var o=this.currentTiles[i];o.selected&&e.push(o)}t.surfaceTileRenderer.renderTiles(t,e,1);var n=t.currentGlContext,s=t.currentFramebuffer;try{for(n.clearColor(0,0,0,0),i=0,r=e.length;r>i;i++)o=e[i],o.selected=!1,o.bindFramebuffer(t),n.clear(n.COLOR_BUFFER_BIT)}finally{t.bindFramebuffer(s)}}},h.prototype.assembleTiles=function(t){var e=t.timestamp,i=t.globeStateKey;(this.currentTimestamp!=e||this.currentGlobeStateKey!=i)&&(this.doAssembleTiles(t),this.currentTimestamp=e,this.currentGlobeStateKey=i)},h.prototype.doAssembleTiles=function(t){if(this.currentTiles=[],t.terrain){0==this.topLevelTiles.length&&this.createTopLevelTiles();for(var e=0,i=this.topLevelTiles.length;i>e;e++){var r=this.topLevelTiles[e];r.update(t),this.isTileVisible(t,r)&&this.addTileOrDescendants(t,r)}}},h.prototype.createTile=function(t,i,r,o){var n=this.key+" "+i.levelNumber+"."+r+"."+o;return new e(t,i,r,o,n)},h.prototype.createTopLevelTiles=function(){a.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},h.prototype.addTileOrDescendants=function(t,e){if(this.tileMeetsRenderingCriteria(t,e))return void this.addTile(e);for(var i=e.subdivideToCache(e.level.nextLevel(),this,this.tileCache),r=0,o=i.length;o>r;r++){var n=i[r];n.update(t),this.isTileVisible(t,n)&&this.addTileOrDescendants(t,n)}},h.prototype.addTile=function(t){this.currentTiles.push(t)},h.prototype.isTileVisible=function(t,e){return t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits)?!1:t.pickingMode?e.extent.intersectsFrustum(t.pickFrustum):e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},h.prototype.tileMeetsRenderingCriteria=function(t,e){var i=this.detailHintOrigin+this.detailHint;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=.9),e.level.isLastLevel()||!e.mustSubdivide(t,i)},h}),i("globe/ElevationImage",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(t,e,i){"use strict";var r=function(i,r,o,n){if(!i||i.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","constructor","The specified image path is null, undefined or zero length."));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","constructor","missingSector"));this.sector=r,this.imagePath=i,this.imageWidth=o,this.imageHeight=n,this.size=this.imageWidth*this.imageHeight};return r.prototype.pixel=function(t,e){return 0>t||t>=this.imageWidth?0:0>e||e>=this.imageHeight?0:(e=this.imageHeight-e-1,this.imageData[t+e*this.imageWidth])},r.prototype.elevationAtLocation=function(t,e){var r=this.sector.maxLatitude,o=this.sector.minLongitude,n=this.sector.deltaLatitude(),s=this.sector.deltaLongitude(),a=(this.imageWidth-1)*(e-o)/s,h=(this.imageHeight-1)*(r-t)/n,l=Math.floor(i.clamp(a,0,this.imageWidth-1)),u=Math.floor(i.clamp(l+1,0,this.imageWidth-1)),c=Math.floor(i.clamp(h,0,this.imageHeight-1)),d=Math.floor(i.clamp(c+1,0,this.imageHeight-1)),g=this.imageData,p=g[l+c*this.imageWidth],f=g[u+c*this.imageWidth],m=g[l+d*this.imageWidth],E=g[u+d*this.imageWidth],y=a-l,_=h-c;return(1-y)*(1-_)*p+y*(1-_)*f+(1-y)*_*m+y*_*E},r.prototype.elevationsForGrid=function(r,o,n,s){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingSector"));if(1>o||1>n)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","elevationsForSector","The specified number of sample points is less than 1."));if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingResult"));var a,h,l,u,c=this.sector.minLatitude,d=this.sector.maxLatitude,g=this.sector.minLongitude,p=this.sector.maxLongitude,f=d-c,m=p-g,E=r.minLatitude,y=r.maxLatitude,_=r.minLongitude,v=r.maxLongitude,L=(y-E)/(o>1?o-1:1),S=(v-_)/(n>1?n-1:1),T=0,b=this.imageData;for(u=0,a=E;o>u;u+=1,a+=L)if(u===o-1&&(a=y),a>=c&&d>=a){var w=(this.imageHeight-1)*(d-a)/f,M=Math.floor(i.clamp(w,0,this.imageHeight-1)),R=Math.floor(i.clamp(M+1,0,this.imageHeight-1)),x=w-M;for(l=0,h=_;n>l;l+=1,h+=S){if(l===n-1&&(h=v),h>=g&&p>=h){var C=(this.imageWidth-1)*(h-g)/m,A=Math.floor(i.clamp(C,0,this.imageWidth-1)),P=Math.floor(i.clamp(A+1,0,this.imageWidth-1)),I=C-A,N=b[A+M*this.imageWidth],O=b[P+M*this.imageWidth],V=b[A+R*this.imageWidth],D=b[P+R*this.imageWidth];s[T]=(1-I)*(1-x)*N+I*(1-x)*O+(1-I)*x*V+I*x*D}T++}}else T+=n},r.prototype.minAndMaxElevationsForSector=function(t){var e=[];if(t)if(t.contains(this.sector))e[0]>this.minElevation&&(e[0]=this.minElevation),e[1]<this.maxElevation&&(e[1]=this.maxElevation);else{var r=this.sector.maxLatitude,o=this.sector.minLongitude,n=this.sector.deltaLatitude(),s=this.sector.deltaLongitude(),a=t.minLatitude,h=t.maxLatitude,l=t.minLongitude,u=t.maxLongitude,c=Math.floor((this.imageHeight-1)*(r-h)/n),d=Math.ceil((this.imageHeight-1)*(r-a)/n),g=Math.floor((this.imageWidth-1)*(l-o)/s),p=Math.ceil((this.imageWidth-1)*(u-o)/s);c=i.clamp(c,0,this.imageHeight-1),d=i.clamp(d,0,this.imageHeight-1),g=i.clamp(g,0,this.imageWidth-1),p=i.clamp(p,0,this.imageWidth-1);for(var f=this.imageData,m=Number.MAX_VALUE,E=-m,y=c;d>=y;y++)for(var _=g;p>=_;_++){var v=f[Math.floor(_+y*this.imageWidth)];m>v&&(m=v),v>E&&(E=v)}e[0]>m&&(e[0]=m),e[1]<E&&(e[1]=E)}else e[0]=this.minElevation,e[1]=this.maxElevation;return e},r.prototype.findMinAndMaxElevation=function(){if(this.imageData&&this.imageData.length>0){this.minElevation=Number.MAX_VALUE,this.maxElevation=-this.minElevation;for(var t=this.imageData,e=this.imageWidth*this.imageHeight,i=0;e>i;i++){var r=t[i];this.minElevation>r&&(this.minElevation=r),this.maxElevation<r&&(this.maxElevation=r)}}else this.minElevation=0,this.maxElevation=0},r}),i("globe/ElevationTile",["../error/ArgumentError","../util/Logger","../util/Tile"],function(t,e,i){"use strict";var r=function(r,o,n,s,a,h){if(!a||a.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationTile","constructor","The specified image path is null, undefined or zero length."));if(!h)throw new t(e.logMessage(e.LEVEL_SEVERE,"ElevationTile","constructor","The specified cache is null or undefined."));i.call(this,r,o,n,s),this.imagePath=a,this.memoryCache=h};return r.prototype=Object.create(i.prototype),r.prototype.size=function(){return i.prototype.size.call(this)+this.imagePath.length+8},r.prototype.image=function(){return this.memoryCache.entryForKey(this.imagePath)},r}),i("globe/ElevationModel",["../util/AbsentResourceList","../geom/Angle","../error/ArgumentError","../globe/ElevationImage","../globe/ElevationTile","../util/LevelSet","../util/Logger","../cache/MemoryCache","../geom/Sector","../util/Tile","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(e,r,o,l,u,d,g){if(!e)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","missingSector"));if(!r)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified level-zero delta is null or undefined."));if(!l)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified image format is null or undefined."));if(!u)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified cache path is null or undefined."));if(!o||1>o)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of levels is not greater than zero."));if(!d||!g||1>d||1>g)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified tile width or height is not greater than zero."));this.coverageSector=e,this.retrievalImageFormat=l,this.cachePath=u,this.displayName="Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0,this.pixelIsPoint=!0,this.levels=new n(this.coverageSector,r,o,d,g),this.currentTiles=[],this.currentSector=new h(0,0,0,0),this.tileCache=new a(1e6,8e5),this.imageCache=new a(1e7,8e6),this.currentRetrievals=[],this.absentResourceList=new t(3,5e3),this.id=++c.idPool,this.stateKey="elevationModel "+this.id.toString()+" "};return c.idPool=0,c.prototype.minAndMaxElevationsForSector=function(t){if(!t)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","minAndMaxElevationsForSector","missingSector"));var r=this.levels.levelForTexelSize(t.deltaLatitude()*e.DEGREES_TO_RADIANS/64);if(this.assembleTiles(r,t,!1),0==this.currentTiles.length)return null;for(var o,n,a,h=Number.MAX_VALUE,l=-h,u=[],c=0,d=this.currentTiles.length;d>c;c++){if(o=this.currentTiles[c].image(),!o)return u[0]=this.minElevation,u[1]=this.maxElevation,u;n=o.minElevation,h>n&&(h=n),a=o.maxElevation,a>l&&(l=a)}return u[0]=h,u[1]=l,u},c.prototype.elevationAtLocation=function(t,e){return this.coverageSector.containsLocation(t,e)?this.pointElevationForLocation(t,e):0},c.prototype.elevationsForGrid=function(t,e,r,o,n){if(!t)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingSector"));if(!n)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingResult"));if(!e||!r||1>e||1>r)throw new i(s.logMessage(s.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of latitudinal or longitudinal positions is less than one."));var a=this.levels.levelForTexelSize(o);return this.pixelIsPoint?this.pointElevationsForGrid(t,e,r,a,n):this.areaElevationsForGrid(t,e,r,a,n)},c.prototype.pointElevationForLocation=function(t,e){for(var i,r=this.levels.lastLevel(),o=r.tileDelta.latitude,n=r.tileDelta.longitude,s=l.computeRow(o,t),a=l.computeColumn(n,e),h=null,u=r.levelNumber;u>=0;u--){if(i=this.tileCache.entryForKey(u+"."+s+"."+a),i&&(h=i.image()))return h.elevationAtLocation(t,e);s=Math.floor(s/2),a=Math.floor(a/2)}return 0},c.prototype.pointElevationsForGrid=function(t,e,i,r,o){var n,s=0;if(this.assembleTiles(r,t,!0),0===this.currentTiles.length)return 0;this.currentTiles.sort(function(t,e){return t.level.levelNumber-e.level.levelNumber});for(var a=0,h=this.currentTiles.length;h>a;a++){var l=this.currentTiles[a],u=l.image();u?(u.elevationsForGrid(t,e,i,o),n=l.level.texelSize,n>s&&(s=n)):s=Number.MAX_VALUE}return s},c.prototype.areaElevationsForGrid=function(t,e,i,r,o){var n,s,a,h,l,u,c=t.minLatitude,d=t.maxLatitude,g=t.minLongitude,p=t.maxLongitude,f=t.deltaLatitude()/(e>1?e-1:1),m=t.deltaLongitude()/(i>1?i-1:1),E=0;for(l=0,n=c;e>l;l+=1,n+=f)for(l===e-1&&(n=d),u=0,s=g;i>u;u+=1,s+=m)u===i-1&&(s=p),this.coverageSector.containsLocation(n,s)&&(a=(s+180)/360,h=(n+90)/180,this.areaElevationForCoord(a,h,r.levelNumber,o,E)),E++;return r.texelSize},c.prototype.areaElevationForCoord=function(t,e,i,r,o){for(var n,s,a,h,l,c,d,g,p,f,m,E,y,_,v=new Float64Array(4),L=i;L>=0;L--)if(n=this.levels.level(L),s=Math.round(360*n.tileWidth/n.tileDelta.longitude),a=Math.round(180*n.tileHeight/n.tileDelta.latitude),h=1/(2*a),l=1-h,c=s*u.fract(t),d=a*u.clamp(e,h,l),g=u.mod(Math.floor(c-.5),s),p=u.mod(g+1,s),f=Math.floor(d-.5),m=f+1,E=u.fract(c-.5),y=u.fract(d-.5),_=L==i||0==L,this.lookupPixels(g,p,f,m,n,_,v))return void(r[o]=(1-E)*(1-y)*v[0]+E*(1-y)*v[1]+(1-E)*y*v[2]+E*y*v[3])},c.prototype.lookupPixels=function(t,e,i,r,o,n,s){var a,h,l,u,c=o.levelNumber,d=o.tileWidth,g=o.tileHeight,p=Math.floor(i/g),f=Math.floor(r/g),m=Math.floor(t/d),E=Math.floor(e/d);return p==f&&p==this.cachedRow&&m==E&&m==this.cachedCol?a=h=l=u=this.cachedImage:p==f&&m==E?(a=this.lookupImage(c,p,m,n),h=l=u=a,this.cachedRow=p,this.cachedCol=m,this.cachedImage=a):(a=this.lookupImage(c,p,m,n),h=this.lookupImage(c,p,E,n),l=this.lookupImage(c,f,m,n),u=this.lookupImage(c,f,E,n)),a&&h&&l&&u?(s[0]=a.pixel(t%d,i%g),s[1]=h.pixel(e%d,i%g),s[2]=l.pixel(t%d,r%g),s[3]=u.pixel(e%d,r%g),!0):!1},c.prototype.lookupImage=function(t,e,i,r){var o=this.tileForLevel(t,e,i),n=o.image();return null==n&&r&&this.retrieveTileImage(o),n},c.prototype.createTile=function(t,e,i,r){var n=this.cachePath+"/"+e.levelNumber+"/"+i+"/"+i+"_"+r+".bil";return new o(t,e,i,r,n,this.imageCache)},c.prototype.assembleTiles=function(t,e,i){if(this.currentTiles=[],this.currentSector.copy(e),this.currentSector.intersection(this.coverageSector),!this.currentSector.isEmpty())for(var r=t.tileDelta.latitude,o=t.tileDelta.longitude,n=l.computeRow(r,this.currentSector.minLatitude),s=l.computeLastRow(r,this.currentSector.maxLatitude),a=l.computeColumn(o,this.currentSector.minLongitude),h=l.computeLastColumn(o,this.currentSector.maxLongitude),u=n;s>=u;u++)for(var c=a;h>=c;c++)this.addTileOrAncestor(t,u,c,i)},c.prototype.addTileOrAncestor=function(t,e,i,r){var o=this.tileForLevel(t.levelNumber,e,i);this.isTileImageInMemory(o)?this.addToCurrentTiles(o):(r&&this.retrieveTileImage(o),t.isFirstLevel()?this.currentTiles.push(o):this.addAncestor(t,e,i,r))},c.prototype.addAncestor=function(t,e,i,r){for(var o=null,n=Math.floor(e/2),s=Math.floor(i/2),a=t.levelNumber-1;a>=0;a--){if(o=this.tileForLevel(a,n,s),this.isTileImageInMemory(o))return void this.addToCurrentTiles(o);n=Math.floor(n/2),s=Math.floor(s/2)}this.addToCurrentTiles(o),r&&this.retrieveTileImage(o)},c.prototype.addToCurrentTiles=function(t){this.currentTiles.push(t)},c.prototype.tileForLevel=function(t,e,i){var r=t+"."+e+"."+i,o=this.tileCache.entryForKey(r);if(o)return o;var n=this.levels.level(t),s=l.computeSector(n,e,i);return o=this.createTile(s,n,e,i),this.tileCache.putEntry(r,o,o.size()),o},c.prototype.isTileImageInMemory=function(t){return this.imageCache.containsKey(t.imagePath)},c.prototype.resourceUrlForTile=function(t){return this.urlBuilder.urlForTile(t,this.retrievalImageFormat)},c.prototype.retrieveTileImage=function(t){if(this.currentRetrievals.indexOf(t.imagePath)<0){var e=this.resourceUrlForTile(t,this.retrievalImageFormat),i=new XMLHttpRequest,r=this;if(!e)return;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){if(4===i.readyState){r.removeFromCurrentRetrievals(t.imagePath);var o=i.getResponseHeader("content-type");if(200===i.status)if(o===r.retrievalImageFormat||"text/plain"===o||"application/octet-stream"===o){s.log(s.LEVEL_INFO,"Elevations retrieval succeeded: "+e),r.loadElevationImage(t,i),r.absentResourceList.unmarkResourceAbsent(t.imagePath);var n=document.createEvent("Event");n.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(n)}else"text/xml"===o?(r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed ("+i.statusText+"): "+e+".\n "+String.fromCharCode.apply(null,new Uint8Array(i.response)))):(r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed: "+e+". Unexpected content type "+o));else r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed ("+i.statusText+"): "+e)}},i.onerror=function(){r.removeFromCurrentRetrievals(t.imagePath),r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval failed: "+e)},i.ontimeout=function(){r.removeFromCurrentRetrievals(t.imagePath),r.absentResourceList.markResourceAbsent(t.imagePath),s.log(s.LEVEL_WARNING,"Elevations retrieval timed out: "+e)},i.send(null),this.currentRetrievals.push(t.imagePath)}},c.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1)},c.prototype.loadElevationImage=function(t,e){var i=new r(t.imagePath,t.sector,t.tileWidth,t.tileHeight);"application/bil16"==this.retrievalImageFormat?(i.imageData=new Int16Array(e.response),i.size=2*i.imageData.length):"application/bil32"==this.retrievalImageFormat&&(i.imageData=new Float32Array(e.response),i.size=4*i.imageData.length),i.imageData&&(i.findMinAndMaxElevation(),this.imageCache.putEntry(t.imagePath,i,i.size),this.timestamp=Date.now())},c}),i("navigate/NavigatorState",["../error/ArgumentError","../geom/Frustum","../geom/Line","../util/Logger","../geom/Matrix","../geom/Rectangle","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h){"use strict";var l=function(t,i,r,n,s){this.modelview=t,this.projection=i,this.modelviewProjection=o.fromIdentity(),this.modelviewProjection.setToMultiply(i,t),this.viewport=r,this.heading=n,this.tilt=s,this.eyePoint=this.modelview.extractEyePoint(new a(0,0,0)),this.frustumInModelCoordinates=null;var l=o.fromIdentity();l.setToTransposeOfMatrix(this.modelview),this.frustumInModelCoordinates=e.fromProjectionMatrix(this.projection),this.frustumInModelCoordinates.transformByMatrix(l),this.frustumInModelCoordinates.normalize(),this.modelviewInv=o.fromIdentity(),this.modelviewInv.invertOrthonormalMatrix(this.modelview),this.projectionInv=o.fromIdentity(),this.projectionInv.invertMatrix(this.projection),this.modelviewProjectionInv=o.fromIdentity(),this.modelviewProjectionInv.invertMatrix(this.modelviewProjection),this.modelviewNormalTransform=o.fromIdentity().setToTransposeOfMatrix(this.modelviewInv.upper3By3());var u=new a(-1,-1,-1),c=new a(1,1,-1),d=new a(-1,-1,1),g=new a(1,1,1);u.multiplyByMatrix(this.projectionInv),c.multiplyByMatrix(this.projectionInv),d.multiplyByMatrix(this.projectionInv),g.multiplyByMatrix(this.projectionInv);var p=h.fabs(c[0]-u[0]),f=h.fabs(g[0]-d[0]),m=-u[2],E=-d[2],y=(f-p)/(E-m),_=p-y*m;this.pixelSizeScale=y/r.width,this.pixelSizeOffset=_/r.height};return l.prototype.project=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingResult"));var o=e[0],n=e[1],s=e[2],a=this.modelviewProjection,h=a[0]*o+a[1]*n+a[2]*s+a[3],l=a[4]*o+a[5]*n+a[6]*s+a[7],u=a[8]*o+a[9]*n+a[10]*s+a[11],c=a[12]*o+a[13]*n+a[14]*s+a[15],d=this.viewport;return 0==c?!1:(h/=c,l/=c,u/=c,-1>u||u>1?!1:(h=.5*h+.5,l=.5*l+.5,u=.5*u+.5,h=h*d.width+d.x,l=l*d.height+d.y,i[0]=h,i[1]=l,i[2]=u,!0))},l.prototype.projectWithDepth=function(e,i,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingPoint"));if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingResult"));var n=e[0],s=e[1],a=e[2],l=this.modelview,u=l[0]*n+l[1]*s+l[2]*a+l[3],c=l[4]*n+l[5]*s+l[6]*a+l[7],d=l[8]*n+l[9]*s+l[10]*a+l[11],g=l[12]*n+l[13]*s+l[14]*a+l[15],p=this.projection,f=p[0]*u+p[1]*c+p[2]*d+p[3]*g,m=p[4]*u+p[5]*c+p[6]*d+p[7]*g,E=p[8]*u+p[9]*c+p[10]*d+p[11]*g,y=p[12]*u+p[13]*c+p[14]*d+p[15]*g,_=this.viewport;return 0===y?!1:(f/=y,m/=y,E/=y,-1>E||E>1?!1:(E=p[8]*u+p[9]*c+p[10]*d*(1+i)+p[11]*g,E/=y,E=h.clamp(E,-1,1),f=.5*f+.5,m=.5*m+.5,E=.5*E+.5,f=f*_.width+_.x,m=m*_.height+_.y,o[0]=f,o[1]=m,o[2]=E,!0))},l.prototype.unProject=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingResult"));var o=e[0],n=e[1],s=e[2],a=this.viewport;if(o=(o-a.x)/a.width,n=(n-a.y)/a.height,o=2*o-1,n=2*n-1,s=2*s-1,-1>s||s>1)return!1;var h=this.modelviewProjectionInv,l=h[0]*o+h[1]*n+h[2]*s+h[3],u=h[4]*o+h[5]*n+h[6]*s+h[7],c=h[8]*o+h[9]*n+h[10]*s+h[11],d=h[12]*o+h[13]*n+h[14]*s+h[15];return 0===d?!1:(i[0]=l/d,i[1]=u/d,i[2]=c/d,!0)},l.prototype.convertPointToWindow=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingResult"));return i[0]=e[0],i[1]=this.viewport.height-e[1],i},l.prototype.convertPointToViewport=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingPoint"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingResult"));return i[0]=e[0],i[1]=this.viewport.height-e[1],i},l.prototype.rayFromScreenPoint=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","rayFromScreenPoint","missingPoint"));var o=this.convertPointToViewport(e,new a(0,0,0)),n=new a(0,0,0),s=new a(0,0,0);if(!this.unProject(o,n))return null;if(o[2]=1,!this.unProject(o,s))return null;var h=new a(this.eyePoint[0],this.eyePoint[1],this.eyePoint[2]),l=new a(s[0],s[1],s[2]);return l.subtract(n),l.normalize(),new i(h,l)},l.prototype.pixelSizeAtDistance=function(t){return this.pixelSizeScale*t+this.pixelSizeOffset},l}),i("globe/Terrain",["../error/ArgumentError","../util/Logger","../geom/Vec3"],function(t,e,i){"use strict";var r=function(t,e,i,r){this.globe=t,this.verticalExaggeration=r,this.sector=i.sector,this.tessellator=e,this.surfaceGeometry=i.tileArray,this.stateKey=t.stateKey+" ve "+r.toString()};return r.scratchPoint=new i(0,0,0),r.prototype.surfacePoint=function(i,o,n,s){if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","surfacePoint","missingResult"));for(var a=0,h=this.surfaceGeometry.length;h>a;a++)if(this.surfaceGeometry[a].sector.containsLocation(i,o)){if(this.surfaceGeometry[a].surfacePoint(i,o,s),n){var l=this.globe.surfaceNormalAtPoint(s[0],s[1],s[2],r.scratchPoint);s[0]+=l[0]*n,s[1]+=l[1]*n,s[2]+=l[2]*n}return s}var u=n+this.globe.elevationAtLocation(i,o)*this.verticalExaggeration;return this.globe.computePointFromPosition(i,o,u,s),s},r.prototype.surfacePointForMode=function(i,r,o,n,s){if(!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","surfacePointForMode","missingResult"));if(n||(n=WorldWind.ABSOLUTE),n===WorldWind.CLAMP_TO_GROUND)return this.surfacePoint(i,r,0,s);if(n===WorldWind.RELATIVE_TO_GROUND)return this.surfacePoint(i,r,o,s);var a=o*this.verticalExaggeration;return this.globe.computePointFromPosition(i,r,a,s),s},r.prototype.beginRendering=function(t){this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRendering(t)},r.prototype.endRendering=function(t){this.globe&&this.globe.tessellator&&this.globe.tessellator.endRendering(t)},r.prototype.beginRenderingTile=function(i,r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","beginRenderingTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRenderingTile(i,r)},r.prototype.endRenderingTile=function(t,e){},r.prototype.renderTile=function(i,r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Terrain","renderTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.renderTile(i,r)},r.prototype.pick=function(t){this.globe&&this.globe.tessellator&&this.globe.tessellator.pick(t,this.surfaceGeometry,this)},r}),i("globe/TerrainTile",["../error/ArgumentError","../util/Logger","../geom/Matrix","../util/Tile"],function(t,e,i,r){"use strict";var o=function(t,e,o,n){r.call(this,t,e,o,n),this.transformationMatrix=i.fromIdentity(),this.points=null,this.pointsStateKey=null,this.pointsVboStateKey=null,this.neighborMap={},this.neighborMap[WorldWind.NORTH]=null,this.neighborMap[WorldWind.SOUTH]=null,this.neighborMap[WorldWind.EAST]=null,this.neighborMap[WorldWind.WEST]=null,this._stateKey=null,this._elevationTimestamp=null,this.scratchArray=[]};return o.prototype=Object.create(r.prototype),Object.defineProperties(o.prototype,{stateKey:{get:function(){return this._stateKey||(this._stateKey=this.computeStateKey()),this._stateKey}}}),o.prototype.neighborLevel=function(t){return this.neighborMap[t]},o.prototype.setNeighborLevel=function(t,e){this.neighborMap[t]=e,this._stateKey=null},o.prototype.surfacePoint=function(i,r,o){if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"TerrainTile","surfacePoint","missingResult"));var n,s,a,h,l,u,c,d,g,p,f=this.sector,m=f.minLatitude,E=f.maxLatitude,y=f.minLongitude,_=f.maxLongitude,v=this.tileWidth,L=this.tileHeight;n=(r-y)/(_-y)*v,s=(i-m)/(E-m)*L,a=v>n?Math.floor(n):v-1,h=L>s?Math.floor(s):L-1,l=v+1,u=this.points,c=this.scratchArray,d=3*(a+h*l);for(var S=0;6>S;S++)c[S]=u[d+S];d=3*(a+(h+1)*l);for(var T=6;12>T;T++)c[T]=u[d+(T-6)];return g=v>n?n-Math.floor(n):1,p=L>s?s-Math.floor(s):1,g>p?(o[0]=c[0]+g*(c[3]-c[0])+p*(c[6]-c[0]),o[1]=c[1]+g*(c[4]-c[1])+p*(c[7]-c[1]),o[2]=c[2]+g*(c[5]-c[2])+p*(c[8]-c[2])):(o[0]=c[9]+(1-g)*(c[6]-c[9])+(1-p)*(c[3]-c[9]),o[1]=c[10]+(1-g)*(c[7]-c[10])+(1-p)*(c[4]-c[10]),o[2]=c[11]+(1-g)*(c[8]-c[11])+(1-p)*(c[5]-c[11])),o[0]+=this.referencePoint[0],o[1]+=this.referencePoint[1],o[2]+=this.referencePoint[2],o},o.prototype.update=function(t){r.prototype.update.call(this,t);var e=t.globe.elevationTimestamp();this._elevationTimestamp!=e&&(this._elevationTimestamp=e,this._stateKey=null)},o.prototype.computeStateKey=function(){var t=[];return t.push(this._elevationTimestamp),t.push(this.neighborMap[WorldWind.NORTH]?this.neighborMap[WorldWind.NORTH].compare(this.level):0),t.push(this.neighborMap[WorldWind.SOUTH]?this.neighborMap[WorldWind.SOUTH].compare(this.level):0),t.push(this.neighborMap[WorldWind.EAST]?this.neighborMap[WorldWind.EAST].compare(this.level):0),t.push(this.neighborMap[WorldWind.WEST]?this.neighborMap[WorldWind.WEST].compare(this.level):0),t.join(".")},o}),i("globe/TerrainTileList",["../error/ArgumentError","../util/Logger","../geom/Sector"],function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"TerrainTileList","TerrainTileList","missingTessellator"));this.tessellator=i,this.sector=null,this.tileArray=[]};return Object.defineProperties(r.prototype,{length:{get:function(){return this.tileArray.length}}}),r.prototype.addTile=function(r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"TerrainTileList","addTile","missingTile"));-1==this.tileArray.indexOf(r)&&(this.tileArray.push(r),this.sector?this.sector.union(r.sector):(this.sector=new i(0,0,0,0),this.sector.copy(r.sector)))},r.prototype.removeAllTiles=function(){this.tileArray=[],this.sector=null},r}),i("globe/Tessellator",["../error/ArgumentError","../shaders/BasicProgram","../globe/Globe","../shaders/GpuProgram","../util/Level","../util/LevelSet","../geom/Location","../util/Logger","../geom/Matrix","../cache/MemoryCache","../navigate/NavigatorState","../error/NotYetImplementedError","../pick/PickedObject","../geom/Position","../geom/Rectangle","../geom/Sector","../globe/Terrain","../globe/TerrainTile","../globe/TerrainTileList","../util/Tile","../util/WWMath","../util/WWUtil"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L){"use strict";var S=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=32,this.tileHeight=32,this.detailHintOrigin=1.1,this.detailHint=0,this.levels=new n(f.FULL_SPHERE,new s(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.topLevelTiles={},this.currentTiles=new y(this),this.tileCache=new l(5e6,4e6),this.elevationTimestamp=void 0,this.lastModelViewProjection=void 0,this.vertexPointLocation=-1,this.vertexTexCoordLocation=-1,this.texCoords=null,this.texCoordVboCacheKey="global_tex_coords",this.indices=null,this.numIndices=null,this.indicesVboCacheKey="global_indices",this.indicesNorth=null,this.numIndicesNorth=null,this.indicesNorthVboCacheKey="global_north_indices",this.indicesSouth=null,this.numIndicesSouth=null,this.indicesSouthVboCacheKey="global_south_indices",this.indicesWest=null,this.numIndicesWest=null,this.indicesWestVboCacheKey="global_west_indices",this.indicesEast=null,this.numIndicesEast=null,this.indicesEastVboCacheKey="global_east_indices",this.indicesLoresNorth=null,this.numIndicesLoresNorth=null,this.indicesLoresNorthVboCacheKey="global_lores_north_indices",this.indicesLoresSouth=null,this.numIndicesLoresSouth=null,this.indicesLoresSouthVboCacheKey="global_lores_south_indices",this.indicesLoresWest=null,this.numIndicesLoresWest=null,this.indicesLoresWestVboCacheKey="global_lores_west_indices",this.indicesLoresEast=null,this.numIndicesLoresEast=null,this.indicesLoresEastVboCacheKey="global_lores_east_indices",this.outlineIndices=null,this.outlineIndicesVboCacheKey="global_outline_indices",this.wireframeIndices=null,this.wireframeIndicesVboCacheKey="global_wireframe_indices",this.scratchMatrix=h.fromIdentity(),this.scratchElevations=null,this.scratchPrevElevations=null,this.corners={},this.tiles=[]};return S.prototype.tessellate=function(e){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","tessellate","missingDC"));var i=e.globe.elevationTimestamp();if(this.lastGlobeStateKey===e.globeStateKey&&this.lastVerticalExaggeration===e.verticalExaggeration&&this.elevationTimestamp===i&&this.lastModelViewProjection&&e.navigatorState.modelviewProjection.equals(this.lastModelViewProjection))return this.lastTerrain;var r=e.navigatorState;this.lastModelViewProjection=r.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.elevationTimestamp=i,this.lastVerticalExaggeration=e.verticalExaggeration,this.currentTiles.removeAllTiles(),this.topLevelTiles[e.globeStateKey]&&0!=this.topLevelTiles[e.globeStateKey].length||this.createTopLevelTiles(e),this.corners={},this.tiles=[];for(var o=0,n=this.topLevelTiles[e.globeStateKey].length;n>o;o+=1){var s=this.topLevelTiles[e.globeStateKey][o];s.update(e),this.isTileVisible(e,s)&&this.addTileOrDescendants(e,s)}return this.refineNeighbors(e),this.finishTessellating(e),this.lastTerrain=0===this.currentTiles.length?null:new m(e.globe,this,this.currentTiles,e.verticalExaggeration),this.lastTerrain},S.prototype.createTile=function(e,i,r,o){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tile","constructor","missingSector"));
if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(0>r||0>o)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));return new E(e,i,r,o)},S.prototype.beginRendering=function(t){var e=t.currentProgram;if(!e)return void a.logMessage(a.LEVEL_INFO,"Tessellator","beginRendering","Current Program is empty");this.buildSharedGeometry(),this.cacheSharedGeometryVBOs(t);var i=t.currentGlContext,r=t.gpuResourceCache;if(this.vertexPointLocation=e.attributeLocation(i,"vertexPoint"),this.vertexTexCoordLocation=e.attributeLocation(i,"vertexTexCoord"),i.enableVertexAttribArray(this.vertexPointLocation),this.vertexTexCoordLocation>=0){var o=r.resourceForKey(this.texCoordVboCacheKey);i.bindBuffer(i.ARRAY_BUFFER,o),i.vertexAttribPointer(this.vertexTexCoordLocation,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.vertexTexCoordLocation)}},S.prototype.endRendering=function(t){var e=t.currentGlContext;e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.vertexPointLocation>=0&&e.disableVertexAttribArray(this.vertexPointLocation),this.vertexTexCoordLocation>=0&&e.disableVertexAttribArray(this.vertexTexCoordLocation)},S.prototype.beginRenderingTile=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","beginRenderingTile","missingTile"));var r=e.currentGlContext,o=e.gpuResourceCache;this.scratchMatrix.setToMultiply(e.navigatorState.modelviewProjection,i.transformationMatrix),e.currentProgram.loadModelviewProjection(r,this.scratchMatrix);var n=e.globeStateKey+i.tileKey,s=o.resourceForKey(n);s?i.pointsVboStateKey!=i.pointsStateKey?(r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferSubData(r.ARRAY_BUFFER,0,i.points),i.pointsVboStateKey=i.pointsStateKey):e.currentGlContext.bindBuffer(r.ARRAY_BUFFER,s):(s=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,i.points,r.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),o.putResource(n,s,4*i.points.length),i.pointsVboStateKey=i.pointsStateKey),r.vertexAttribPointer(this.vertexPointLocation,3,r.FLOAT,!1,0,0)},S.prototype.endRenderingTile=function(t,e){},S.prototype.renderTile=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","renderTile","missingTile"));var r=e.currentGlContext,o=e.gpuResourceCache,n=r.TRIANGLE_STRIP,s=o.resourceForKey(this.indicesVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.drawElements(n,this.numIndices,r.UNSIGNED_SHORT,0);var h,l=i.level;if(h=i.neighborLevel(WorldWind.NORTH),h&&h.compare(l)<0){var u=o.resourceForKey(this.indicesLoresNorthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,u),r.drawElements(n,this.numIndicesLoresNorth,r.UNSIGNED_SHORT,0)}else{var c=o.resourceForKey(this.indicesNorthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,c),r.drawElements(n,this.numIndicesNorth,r.UNSIGNED_SHORT,0)}if(h=i.neighborLevel(WorldWind.SOUTH),h&&h.compare(l)<0){var d=o.resourceForKey(this.indicesLoresSouthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,d),r.drawElements(n,this.numIndicesLoresSouth,r.UNSIGNED_SHORT,0)}else{var g=o.resourceForKey(this.indicesSouthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,g),r.drawElements(n,this.numIndicesSouth,r.UNSIGNED_SHORT,0)}if(h=i.neighborLevel(WorldWind.WEST),h&&h.compare(l)<0){var p=o.resourceForKey(this.indicesLoresWestVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p),r.drawElements(n,this.numIndicesLoresWest,r.UNSIGNED_SHORT,0)}else{var f=o.resourceForKey(this.indicesWestVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f),r.drawElements(n,this.numIndicesWest,r.UNSIGNED_SHORT,0)}if(h=i.neighborLevel(WorldWind.EAST),h&&h.compare(l)<0){var m=o.resourceForKey(this.indicesLoresEastVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,m),r.drawElements(n,this.numIndicesLoresEast,r.UNSIGNED_SHORT,0)}else{var E=o.resourceForKey(this.indicesEastVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,E),r.drawElements(n,this.numIndicesEast,r.UNSIGNED_SHORT,0)}},S.prototype.renderWireframeTile=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","renderWireframeTile","missingTile"));var r=e.currentGlContext,o=e.gpuResourceCache;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation);var n=o.resourceForKey(this.wireframeIndicesVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n),r.drawElements(r.LINES,this.wireframeIndices.length,r.UNSIGNED_SHORT,0)},S.prototype.renderTileOutline=function(e,i){if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","renderTileOutline","missingTile"));var r=e.currentGlContext,o=e.gpuResourceCache;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation);var n=o.resourceForKey(this.outlineIndicesVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n),r.drawElements(r.LINE_LOOP,this.outlineIndices.length,r.UNSIGNED_SHORT,0)},S.prototype.pick=function(e,i,r){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","pick","missingDc"));if(!i)throw new t(a.logMessage(a.LEVEL_SEVERE,"Tessellator","pick","missingList"));for(var o=null,n=r||this,s=new g(0,0,0),h=[],l=0,u=i.length;u>l;l++){var c=i[l];c.extent.intersectsFrustum(e.pickFrustum)&&h.push(c)}if(e.pickTerrainOnly||(o=e.uniquePickColor(),this.drawPickTiles(e,h,o)),!e.regionPicking){var p=e.navigatorState.rayFromScreenPoint(e.pickPoint),f=this.computeNearestIntersection(p,h);f&&(e.globe.computePositionFromPoint(f[0],f[1],f[2],s),s.altitude=e.globe.elevationAtLocation(s.latitude,s.longitude),e.addPickedObject(new d(o,n,s,null,!0)))}},S.prototype.drawPickTiles=function(t,i,r){var o=t.currentGlContext;try{t.findAndBindProgram(e),t.currentProgram.loadColor(o,r),this.beginRendering(t);for(var n=0,s=i.length;s>n;n++){var a=i[n];this.beginRenderingTile(t,a),this.renderTile(t,a),this.endRenderingTile(t,a)}}finally{this.endRendering(t)}},S.prototype.computeNearestIntersection=function(t,e){for(var i=[],r=0,o=e.length;o>r;r++)this.computeIntersections(t,e[r],i);if(0==i.length)return null;var n,s=Number.POSITIVE_INFINITY;for(r=0,o=i.length;o>r;r++){var a=t.origin.distanceToSquared(i[r]);s>a&&(s=a,n=r)}return i[n]},S.prototype.computeIntersections=function(t,e,i){var r,o,n=e.level,s=e.points,a=i.length;t.origin.subtract(e.referencePoint),this.buildSharedGeometry(e),o=this.indices,v.computeTriStripIntersections(t,s,o,i),r=e.neighborLevel(WorldWind.SOUTH),o=r&&r.compare(n)<0?this.indicesLoresSouth:this.indicesSouth,v.computeTriStripIntersections(t,s,o,i),r=e.neighborLevel(WorldWind.WEST),o=r&&r.compare(n)<0?this.indicesLoresWest:this.indicesWest,v.computeTriStripIntersections(t,s,o,i),r=e.neighborLevel(WorldWind.EAST),o=r&&r.compare(n)<0?this.indicesLoresEast:this.indicesEast,v.computeTriStripIntersections(t,s,o,i),r=e.neighborLevel(WorldWind.NORTH),o=r&&r.compare(n)<0?this.indicesLoresNorth:this.indicesNorth,v.computeTriStripIntersections(t,s,o,i),t.origin.add(e.referencePoint);for(var h=a,l=i.length;l>h;h++)i[h].add(e.referencePoint)},S.prototype.createTopLevelTiles=function(t){this.topLevelTiles[t.globeStateKey]=[],_.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles[t.globeStateKey])},S.prototype.addTileOrDescendants=function(t,e){return this.tileMeetsRenderCriteria(t,e)?void this.addTile(t,e):void this.addTileDescendants(t,e)},S.prototype.addTileDescendants=function(t,e){for(var i=e.level.nextLevel(),r=e.subdivideToCache(i,this,this.tileCache),o=0;o<r.length;o+=1){var n=r[o];n.update(t),this.levels.sector.intersects(n.sector)&&this.isTileVisible(t,n)&&this.addTileOrDescendants(t,n)}},S.prototype.addTile=function(t,e){var i=this.tiles.length;this.tiles.push(e);var r,o=e.sector,n=[o.maxLatitude,o.maxLongitude].toString(),s=[o.minLatitude,o.maxLongitude].toString(),a=[o.maxLatitude,o.minLongitude].toString(),h=[o.minLatitude,o.minLongitude].toString();r=this.corners[h],r?r.sw=i:this.corners[h]={sw:i},r=this.corners[a],r?r.nw=i:this.corners[a]={nw:i},r=this.corners[s],r?r.se=i:this.corners[s]={se:i},r=this.corners[n],r?r.ne=i:this.corners[n]={ne:i}},S.prototype.refineNeighbors=function(t){for(var e={},i=0,r=this.tiles.length;r>i;i+=1){var o,n,i,r,s=this.tiles[i],a=s.level.levelNumber,h=s.sector,l=[h.maxLatitude,h.maxLongitude].toString(),u=[h.minLatitude,h.maxLongitude].toString(),c=[h.maxLatitude,h.minLongitude].toString(),d=[h.minLatitude,h.minLongitude].toString();o=this.corners[l],o.hasOwnProperty("se")&&(n=o.se,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o.hasOwnProperty("nw")&&(n=o.nw,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o=this.corners[u],o.hasOwnProperty("ne")&&(n=o.ne,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o.hasOwnProperty("sw")&&(n=o.sw,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o=this.corners[c],o.hasOwnProperty("ne")&&(n=o.ne,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o.hasOwnProperty("sw")&&(n=o.sw,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o=this.corners[d],o.hasOwnProperty("se")&&(n=o.se,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0))),o.hasOwnProperty("nw")&&(n=o.nw,this.tiles[n].level.levelNumber<a-1&&(e[n]||(e[n]=!0)))}var g=[],p=[];for(i=0,r=this.tiles.length;r>i;i+=1)s=this.tiles[i],e[i]?g.push(s):p.push(s);if(g.length>0){for(this.tiles=[],this.corners={},i=0,r=p.length;r>i;i+=1)s=p[i],this.addTile(t,s);for(i=0,r=g.length;r>i;i+=1){var s=g[i];this.addTileDescendants(t,s)}this.refineNeighbors(t)}},S.prototype.finishTessellating=function(t){for(var e=0,i=this.tiles.length;i>e;e+=1){var r=this.tiles[e];this.setNeighbors(r),this.regenerateTileGeometryIfNeeded(t,r),this.currentTiles.addTile(r)}},S.prototype.setNeighbors=function(t){var e=t.sector,i=[e.maxLatitude,e.maxLongitude].toString(),r=[e.minLatitude,e.maxLongitude].toString(),o=[e.maxLatitude,e.minLongitude].toString(),n=[e.minLatitude,e.minLongitude].toString(),s=this.corners[i],a=this.corners[r],h=this.corners[o],l=this.corners[n],u=-1,c=-1,d=-1,g=-1;s.hasOwnProperty("se")?u=s.se:h.hasOwnProperty("sw")&&(u=h.sw),a.hasOwnProperty("ne")?c=a.ne:l.hasOwnProperty("nw")&&(c=l.nw),s.hasOwnProperty("nw")?d=s.nw:a.hasOwnProperty("sw")&&(d=a.sw),h.hasOwnProperty("ne")?g=h.ne:l.hasOwnProperty("se")&&(g=l.se),t.setNeighborLevel(WorldWind.NORTH,u>=0?this.tiles[u].level:null),t.setNeighborLevel(WorldWind.SOUTH,c>=0?this.tiles[c].level:null),t.setNeighborLevel(WorldWind.EAST,d>=0?this.tiles[d].level:null),t.setNeighborLevel(WorldWind.WEST,g>=0?this.tiles[g].level:null)},S.prototype.isTileVisible=function(t,e){return t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits)?!1:e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},S.prototype.tileMeetsRenderCriteria=function(t,e){var i=this.detailHintOrigin+this.detailHint;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=.5),e.level.isLastLevel()||!e.mustSubdivide(t,i)},S.prototype.regenerateTileGeometryIfNeeded=function(t,e){var i=t.globeStateKey+e.stateKey+t.verticalExaggeration;e.points&&e.pointsStateKey==i||(this.regenerateTileGeometry(t,e),e.pointsStateKey=i)},S.prototype.regenerateTileGeometry=function(t,e){var i=e.tileHeight+1,r=e.tileWidth+1,o=e.referencePoint,n=this.scratchElevations;n||(n=new Float64Array(i*r),this.scratchElevations=n),e.points||(e.points=new Float32Array(i*r*3)),L.fillArray(n,0),t.globe.elevationsForGrid(e.sector,i,r,e.texelSize,n),this.mustAlignNeighborElevations(t,e)&&this.alignNeighborElevations(t,e,n),L.multiplyArray(n,t.verticalExaggeration),t.globe.computePointsForGrid(e.sector,i,r,n,o,e.points),e.transformationMatrix.setTranslation(o[0],o[1],o[2])},S.prototype.mustAlignNeighborElevations=function(t,e){var i=e.level,r=e.neighborLevel(WorldWind.NORTH),o=e.neighborLevel(WorldWind.SOUTH),n=e.neighborLevel(WorldWind.EAST),s=e.neighborLevel(WorldWind.WEST);return r&&r.compare(i)<0||o&&o.compare(i)<0||n&&n.compare(i)<0||s&&s.compare(i)<0},S.prototype.alignNeighborElevations=function(t,e,i){var r,o,n,s,a=e.tileHeight+1,h=e.tileWidth+1,l=e.level,u=Math.floor(a/2)+1,c=Math.floor(h/2)+1,d=l.previousLevel(),g=this.scratchPrevElevations;if(g||(g=new Float64Array(u*c),this.scratchPrevElevations=g),L.fillArray(g,0),t.globe.elevationsForGrid(e.sector,u,c,d.texelSize,g),r=e.neighborLevel(WorldWind.NORTH),r&&r.compare(l)<0)for(n=(a-1)*h,s=(u-1)*c,o=0;c>o;o++,n+=2,s+=1)i[n]=g[s],c-1>o&&(i[n+1]=.5*(g[s]+g[s+1]));if(r=e.neighborLevel(WorldWind.SOUTH),r&&r.compare(l)<0)for(n=0,s=0,o=0;c>o;o++,n+=2,s+=1)i[n]=g[s],c-1>o&&(i[n+1]=.5*(g[s]+g[s+1]));if(r=e.neighborLevel(WorldWind.EAST),r&&r.compare(l)<0)for(n=h-1,s=c-1,o=0;u>o;o++,n+=2*h,s+=c)i[n]=g[s],u-1>o&&(i[n+h]=.5*(g[s]+g[s+c]));if(r=e.neighborLevel(WorldWind.WEST),r&&r.compare(l)<0)for(n=0,s=0,o=0;u>o;o++,n+=2*h,s+=c)i[n]=g[s],u-1>o&&(i[n+h]=.5*(g[s]+g[s+c]))},S.prototype.buildSharedGeometry=function(){var t=this.levels.tileWidth,e=this.levels.tileHeight;this.texCoords||this.buildTexCoords(t,e),this.indices||this.buildIndices(t,e),this.wireframeIndices||this.buildWireframeIndices(t,e),this.outlineIndices||this.buildOutlineIndices(t,e)},S.prototype.buildTexCoords=function(t,e){for(var i=t+1,r=e+1,o=1/t,n=1/e,s=new Float32Array(i*r*2),a=0,h=0,l=0;r>h;h++,l+=n){h==r-1&&(l=1);for(var u=0,c=0;i>u;u++,c+=o)u==i-1&&(c=1),s[a++]=c,s[a++]=l}this.texCoords=s},S.prototype.buildIndices=function(t,e){for(var i,r=e+1,o=t+1,n=2*(r-3)*(o-2)+2*(r-3),s=new Int16Array(n),a=0,h=1;o-2>h;h+=1){for(var l=1;r-1>l;l+=1)i=h+l*o,s[a++]=i,s[a++]=i+1;s[a++]=i+1,i=h+1+1*o,s[a++]=i}for(this.indices=s,this.numIndices=n,n=2*o-2,s=new Int16Array(n),a=0,l=r-1,h=o-1,i=h+l*o,s[a++]=i,h=o-2;h>0;h-=1)i=h+l*o,s[a++]=i,s[a++]=i-o;for(h=0,i=h+l*o,s[a++]=i,this.indicesNorth=s,this.numIndicesNorth=n,n=2*o-2,s=new Int16Array(n),a=0,l=0,h=0,i=h+l*o,s[a++]=i,h=1;o-1>h;h+=1)i=h+l*o,s[a++]=i,s[a++]=i+o;for(h=o-1,i=h+l*o,s[a++]=i,this.indicesSouth=s,this.numIndicesSouth=n,n=2*r-2,s=new Int16Array(n),a=0,h=0,l=r-1,i=h+l*o,s[a++]=i,l=r-2;l>0;l-=1)i=h+l*o,s[a++]=i,s[a++]=i+1;for(l=0,i=h+l*o,s[a++]=i,this.indicesWest=s,this.numIndicesWest=n,n=2*r-2,s=new Int16Array(n),a=0,h=o-1,l=0,i=h+l*o,s[a++]=i,l=1;r-1>l;l+=1)i=h+l*o,s[a++]=i,s[a++]=i-1;for(l=r-1,i=h+l*o,s[a++]=i,this.indicesEast=s,this.numIndicesEast=n,n=2*o-2,s=new Int16Array(n),a=0,l=r-1,h=o-1,i=h+l*o,s[a++]=i,h=o-2;h>0;h-=1)i=(h+1&-2)+l*o,s[a++]=i,i=h+(l-1)*o,s[a++]=i;for(h=0,i=h+l*o,s[a++]=i,this.indicesLoresNorth=s,this.numIndicesLoresNorth=n,n=2*o-2,s=new Int16Array(n),a=0,l=0,h=0,i=h+l*o,s[a++]=i,h=1;o-1>h;h+=1)i=(-2&h)+l*o,s[a++]=i,i=h+(l+1)*o,s[a++]=i;for(h=o-1,i=h+l*o,s[a++]=i,this.indicesLoresSouth=s,this.numIndicesLoresSouth=n,n=2*r-2,s=new Int16Array(n),a=0,h=0,l=r-1,i=h+l*o,s[a++]=i,l=r-2;l>0;l-=1)i=h+(l+1&-2)*o,s[a++]=i,i=h+1+l*o,s[a++]=i;for(l=0,i=h+l*o,s[a++]=i,this.indicesLoresWest=s,this.numIndicesLoresWest=n,n=2*r-2,s=new Int16Array(n),a=0,h=o-1,l=0,i=h+l*o,s[a++]=i,l=1;r-1>l;l+=1)i=h+(-2&l)*o,s[a++]=i,i=h-1+l*o,s[a++]=i;l=r-1,i=h+l*o,s[a++]=i,this.indicesLoresEast=s,this.numIndicesLoresEast=n},S.prototype.buildWireframeIndices=function(t,e){var i,r,o,n=e+1,s=t+1,a=2*t*n+2*e*s,h=new Int16Array(a),l=s,u=0;for(r=0;n>r;r+=1)for(i=0;t>i;i+=1)o=i+r*l,h[u]=o,h[u+1]=o+1,u+=2;for(i=0;s>i;i+=1)for(r=0;e>r;r+=1)o=i+r*l,h[u]=o,h[u+1]=o+l,u+=2;this.wireframeIndices=h},S.prototype.buildOutlineIndices=function(t,e){var i,r,o,n=e+1,s=t+1,a=2*(n-2)+2*s+1,h=new Int16Array(a),l=0;for(r=0,i=0;s>i;i+=1)o=i+r*s,h[l]=o,l+=1;for(i=s-1,r=1;n>r;r+=1)o=i+r*s,h[l]=o,l+=1;for(r=n-1,i=s-1;i>=0;i-=1)o=i+r*s,h[l]=o,l+=1;for(i=0,r=n-1;r>=0;r-=1)o=i+r*s,h[l]=o,l+=1;this.outlineIndices=h},S.prototype.cacheSharedGeometryVBOs=function(t){var e=t.currentGlContext,i=t.gpuResourceCache,r=i.resourceForKey(this.texCoordVboCacheKey);r||(r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,this.texCoords,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.texCoordVboCacheKey,r,4*this.texCoords.length/2));var o=i.resourceForKey(this.indicesVboCacheKey);o||(o=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesVboCacheKey,o,2*this.indices.length));var n=i.resourceForKey(this.indicesNorthVboCacheKey);n||(n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesNorth,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesNorthVboCacheKey,n,2*this.indicesNorth.length));var s=i.resourceForKey(this.indicesSouthVboCacheKey);s||(s=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesSouth,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesSouthVboCacheKey,s,2*this.indicesSouth.length));var a=i.resourceForKey(this.indicesWestVboCacheKey);a||(a=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesWest,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesWestVboCacheKey,a,2*this.indicesWest.length));var h=i.resourceForKey(this.indicesEastVboCacheKey);h||(h=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesEast,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesEastVboCacheKey,h,2*this.indicesEast.length));var l=i.resourceForKey(this.indicesLoresNorthVboCacheKey);l||(l=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesLoresNorth,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesLoresNorthVboCacheKey,l,2*this.indicesLoresNorth.length));var u=i.resourceForKey(this.indicesLoresSouthVboCacheKey);u||(u=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesLoresSouth,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesLoresSouthVboCacheKey,u,2*this.indicesLoresSouth.length));var c=i.resourceForKey(this.indicesLoresWestVboCacheKey);c||(c=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesLoresWest,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesLoresWestVboCacheKey,c,2*this.indicesLoresWest.length));var d=i.resourceForKey(this.indicesLoresEastVboCacheKey);d||(d=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indicesLoresEast,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.indicesLoresEastVboCacheKey,d,2*this.indicesLoresEast.length));var g=i.resourceForKey(this.outlineIndicesVboCacheKey);g||(g=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,g),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.outlineIndices,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.outlineIndicesVboCacheKey,g,2*this.outlineIndices.length));var p=i.resourceForKey(this.wireframeIndicesVboCacheKey);p||(p=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,p),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.wireframeIndices,e.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(this.wireframeIndicesVboCacheKey,p,2*this.wireframeIndices.length))},S}),i("globe/Globe",["../geom/Angle","../error/ArgumentError","../globe/ElevationModel","../geom/Line","../geom/Location","../util/Logger","../geom/Position","../geom/Sector","../globe/Tessellator","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","constructor","Elevation model is null or undefined."));this.elevationModel=t,this.equatorialRadius=6378137,this.polarRadius=6356752.3,this.eccentricitySquared=.00669437999013,this.tessellator=new h,this.scratchPosition=new s(0,0,0),this.scratchPoint=new l(0,0,0),this.id=++c.idPool,this._stateKey="globe "+this.id.toString()+" "};return c.idPool=0,Object.defineProperties(c.prototype,{stateKey:{get:function(){return this._stateKey+this.elevationModel.stateKey}}}),c.prototype.is2D=function(){return!1},c.prototype.computePointFromPosition=function(i,r,o,s){if(!s)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePointFromPosition","missingResult"));var a=Math.cos(i*t.DEGREES_TO_RADIANS),h=Math.sin(i*t.DEGREES_TO_RADIANS),l=Math.cos(r*t.DEGREES_TO_RADIANS),u=Math.sin(r*t.DEGREES_TO_RADIANS),c=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*h*h);return s[0]=(c+o)*a*u,s[1]=(c*(1-this.eccentricitySquared)+o)*h,s[2]=(c+o)*a*l,s},c.prototype.computePointFromLocation=function(t,i,r){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePointFromLocation","missingResult"));return this.computePointFromPosition(t,i,0,r)},c.prototype.computePointsForGrid=function(i,r,o,s,a,h){if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePointsFromPositions","missingSector"));if(1>r||1>o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePointsFromPositions","Number of latitude or longitude locations is less than one."));var u=r*o;if(!s||s.length<u)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePointsFromPositions","Elevations array is null, undefined or insufficient length."));if(!h||h.length<u)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePointsFromPositions","Result array is null, undefined or insufficient length."));var c,d,g,p,f,m,E,y,_=i.minLatitude*t.DEGREES_TO_RADIANS,v=i.maxLatitude*t.DEGREES_TO_RADIANS,L=i.minLongitude*t.DEGREES_TO_RADIANS,S=i.maxLongitude*t.DEGREES_TO_RADIANS,T=(v-_)/(r>1?r-1:1),b=(S-L)/(o>1?o-1:1),w=a?a:new l(0,0,0),M=0,R=0,x=new Float64Array(o),C=new Float64Array(o);for(d=0,p=L;o>d;d++,p+=b)d===o-1&&(p=S),x[d]=Math.cos(p),C[d]=Math.sin(p);for(c=0,g=_;r>c;c++,g+=T)for(c===r-1&&(g=v),E=Math.cos(g),y=Math.sin(g),f=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*y*y),d=0;o>d;d++)m=s[M++],h[R++]=(f+m)*E*C[d]-w[0],h[R++]=(f*(1-this.eccentricitySquared)+m)*y-w[1],h[R++]=(f+m)*E*x[d]-w[2];return h},c.prototype.computePositionFromPoint=function(i,r,o,s){if(!s)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","computePositionFromPoint","missingResult"));var a,h,l,c,d,g,p,f,m,E,y,_,v,L,S,T=o,b=i,w=r,M=T*T+b*b,R=Math.sqrt(M),x=this.equatorialRadius,C=1/(x*x),A=this.eccentricitySquared,P=A*A,I=M*C,N=w*w*(1-A)*C,O=(I+N-P)/6,V=8*O*O*O+P*I*N;return V>0||0!=N?(V>0?(c=Math.sqrt(V),d=Math.sqrt(P*I*N),V>10*A?(g=u.cbrt((c+d)*(c+d)),l=O+.5*g+2*O*O/g):l=O+.5*u.cbrt((c+d)*(c+d))+.5*u.cbrt((c-d)*(c-d))):(c=Math.sqrt(-V),d=Math.sqrt(-8*O*O*O),g=Math.sqrt(P*I*N),p=2*Math.atan2(g,c+d)/3,l=-4*O*Math.sin(p)*Math.cos(Math.PI/6+p)),f=Math.sqrt(l*l+P*N),m=A*(l+f-N)/(2*f),E=(l+f)/(Math.sqrt(m*m+l+f)+m),y=E*R/(E+A),_=Math.sqrt(y*y+w*w),a=(E+A-1)*_/E,h=2*Math.atan2(w,_+y)):(c=Math.sqrt(1-A),d=Math.sqrt(A-I),v=Math.sqrt(A),a=-x*c*d/v,h=d/(v*d+c*Math.sqrt(I))),S=Math.sqrt(2),L=R+T>(S-1)*b?2*Math.atan2(b,R+T):(S+1)*T>R+b?.5*-Math.PI+2*Math.atan2(T,R-b):.5*Math.PI-2*Math.atan2(T,R+b),s.latitude=t.RADIANS_TO_DEGREES*h,s.longitude=t.RADIANS_TO_DEGREES*L,s.altitude=a,s},c.prototype.radiusAt=function(e,i){var r=Math.sin(e*t.DEGREES_TO_RADIANS),o=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*r*r);return o*Math.sqrt(1+(this.eccentricitySquared*this.eccentricitySquared-2*this.eccentricitySquared)*r*r)},c.prototype.surfaceNormalAtLocation=function(i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","surfaceNormalAtLocation","missingResult"));var s=Math.cos(i*t.DEGREES_TO_RADIANS),a=Math.cos(r*t.DEGREES_TO_RADIANS),h=Math.sin(i*t.DEGREES_TO_RADIANS),l=Math.sin(r*t.DEGREES_TO_RADIANS),u=this.equatorialRadius*this.equatorialRadius,c=this.polarRadius*this.polarRadius;return o[0]=s*l/u,o[1]=(1-this.eccentricitySquared)*h/c,o[2]=s*a/u,o.normalize()},c.prototype.surfaceNormalAtPoint=function(t,i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","surfaceNormalAtPoint","missingResult"));var s=this.equatorialRadius*this.equatorialRadius,a=this.polarRadius*this.polarRadius;return o[0]=t/s,o[1]=i/a,o[2]=r/s,o.normalize()},c.prototype.northTangentAtLocation=function(i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","northTangentAtLocation","missingResult"));var s=Math.cos(i*t.DEGREES_TO_RADIANS),a=Math.cos(r*t.DEGREES_TO_RADIANS),h=Math.sin(i*t.DEGREES_TO_RADIANS),l=Math.sin(r*t.DEGREES_TO_RADIANS);return o[0]=-h*l,o[1]=s,o[2]=-h*a,o.normalize()},c.prototype.northTangentAtPoint=function(t,i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","northTangentAtPoint","missingResult"));return this.computePositionFromPoint(t,i,r,this.scratchPosition),this.northTangentAtLocation(this.scratchPosition.latitude,this.scratchPosition.longitude,o)},c.prototype.intersectsFrustum=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","intersectsFrustum","missingFrustum"));return t.far.distance<=this.equatorialRadius?!1:t.left.distance<=this.equatorialRadius?!1:t.right.distance<=this.equatorialRadius?!1:t.top.distance<=this.equatorialRadius?!1:t.bottom.distance<=this.equatorialRadius?!1:t.near.distance<=this.equatorialRadius?!1:!0},c.prototype.intersectsLine=function(t,i){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","intersectWithRay","missingLine"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","intersectsLine","missingResult"));return u.computeEllipsoidalGlobeIntersection(t,this.equatorialRadius,this.polarRadius,i)},c.prototype.elevationTimestamp=function(){return this.elevationModel.timestamp},c.prototype.minElevation=function(){return this.elevationModel.minElevation},c.prototype.maxElevation=function(){return this.elevationModel.maxElevation},c.prototype.minAndMaxElevationsForSector=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","minAndMaxElevationsForSector","missingSector"));return this.elevationModel.minAndMaxElevationsForSector(t)},c.prototype.elevationAtLocation=function(t,e){return this.elevationModel.elevationAtLocation(t,e)},c.prototype.elevationsForGrid=function(t,i,r,o,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","elevationsForSector","missingSector"));if(0>=i||0>=r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","elevationsForSector","numLat or numLon is less than 1"));if(!s||s.length<i*r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","elevationsForSector","missingArray"));return this.elevationModel.elevationsForGrid(t,i,r,o,s)},c}),i("cache/GpuResourceCache",["../util/AbsentResourceList","../error/ArgumentError","../util/ImageSource","../util/Logger","../cache/MemoryCache","../render/Texture"],function(t,e,i,r,o,n){"use strict";var s=function(i,n){if(!i||1>i)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache capacity is undefined, 0 or negative."));if(!n||0>n||n>=i)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache low-water value is undefined, negative or not less than the capacity."));this.entries=new o(i,n),this.cacheKeyPool=0,this.currentRetrievals={},this.absentResourceList=new t(3,6e4)};return Object.defineProperties(s.prototype,{capacity:{get:function(){return this.entries.capacity}},lowWater:{get:function(){return this.entries.lowWater}},usedCapacity:{get:function(){return this.entries.usedCapacity}},freeCapacity:{get:function(){return this.entries.freeCapacity}}}),s.prototype.generateCacheKey=function(){return"GpuResourceCache "+ ++this.cacheKeyPool},s.prototype.putResource=function(t,o,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingKey."));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingResource."));if(!n||1>n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","The specified resource size is undefined or less than 1."));var s={resource:o};this.entries.putEntry(t instanceof i?t.key:t,s,n)},s.prototype.resourceForKey=function(t){var e=t instanceof i?this.entries.entryForKey(t.key):this.entries.entryForKey(t);return e?e.resource:null},s.prototype.containsResource=function(t){return this.entries.containsKey(t instanceof i?t.key:t)},s.prototype.removeResource=function(t){this.entries.removeEntry(t instanceof i?t.key:t)},s.prototype.clear=function(){this.entries.clear(!1)},s.prototype.retrieveTexture=function(t,e){if(!e)return null;if(e instanceof i){var o=new n(t,e.image);return this.putResource(e.key,o,o.size),o}if(this.currentRetrievals[e]||this.absentResourceList.isResourceAbsent(e))return null;var s=this,a=new Image;return a.onload=function(){r.log(r.LEVEL_INFO,"Image retrieval succeeded: "+e);var i=new n(t,a);s.putResource(e,i,i.size),delete s.currentRetrievals[e],s.absentResourceList.unmarkResourceAbsent(e);var o=document.createEvent("Event");o.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(o)},a.onerror=function(){delete s.currentRetrievals[e],s.absentResourceList.markResourceAbsent(e),r.log(r.LEVEL_WARNING,"Image retrieval failed: "+e)},this.currentRetrievals[e]=e,a.crossOrigin="anonymous",a.src=e,null},s}),i("pick/PickedObjectList",[],function(){"use strict";var t=function(){this.objects=[]};return t.prototype.hasNonTerrainObjects=function(){return this.objects.length>1||1===this.objects.length&&null==this.terrainObject()},t.prototype.terrainObject=function(){for(var t=0,e=this.objects.length;e>t;t++)if(this.objects[t].isTerrain)return this.objects[t];return null},t.prototype.add=function(t){if(t)if(t.isTerrain){for(var e=this.objects.length,i=0,r=this.objects.length;r>i;i++)if(this.objects[i].isTerrain){e=i;break}this.objects[e]=t}else this.objects.push(t)},t.prototype.clear=function(){this.objects=[]},t.prototype.topPickedObject=function(){var t=this.objects.length;if(t>1)for(var e=0;t>e;e++)if(this.objects[[e].isOnTop])return this.objects[e];return t>0?this.objects[0]:null},t}),i("render/ScreenCreditController",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(){this.imageUrls=[],this.stringCredits=[],this.imageCreditSize=64,this.margin=5,this.opacity=.5,this.creditFont=new r(14)};return c.scratchMatrix=n.fromIdentity(),c.imageTransform=n.fromIdentity(),c.texCoordMatrix=n.fromIdentity(),c.prototype.clear=function(){this.imageUrls=[],this.stringCredits=[]},c.prototype.addImageCredit=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"ScreenCreditController","addImageCredit","missingUrl"));-1===this.imageUrls.indexOf(e)&&this.imageUrls.push(e)},c.prototype.addStringCredit=function(e,r){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingText"));if(!r)throw new t(o.logMessage(o.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingColor"));-1===this.stringCredits.indexOf(e)&&this.stringCredits.push({text:e,color:r||i.WHITE})},c.prototype.drawCredits=function(t){if((0!==this.imageUrls.length||0!==this.stringCredits.length)&&!t.pickingMode&&t.timestamp!=this.lastFrameTimestamp){this.lastFrameTimestamp=t.timestamp,this.beginDrawingCredits(t);for(var e,i=t.navigatorState.viewport.width-(this.margin+this.imageCreditSize),r=0,o=0;o<this.imageUrls.length;o++)e=this.drawImageCredit(t,this.imageUrls[o],i,this.margin),e>0&&(i-=this.margin+this.imageCreditSize,r=u.max(e,r));for(var n=r+this.margin,s=0;s<this.stringCredits.length;s++)this.drawStringCredit(t,this.stringCredits[s],n),n+=this.margin+15;this.endDrawingCredits(t)}},c.prototype.beginDrawingCredits=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer3()),r.vertexAttribPointer(i.vertexPointLocation,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),
i.loadTextureUnit(r,r.TEXTURE0),i.loadModulateColor(r,!1)},c.prototype.endDrawingCredits=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.enable(e.DEPTH_TEST)},c.prototype.drawImageCredit=function(t,e,r,o){var n,s,a,h,l,u;return(h=t.gpuResourceCache.resourceForKey(e))?(n=h.imageWidth,s=h.imageHeight,a=n<=this.imageCreditSize&&this.imageHeight<=this.imageCreditSize?1:n>=s?this.imageCreditSize/n:this.imageCreditSize/s,c.imageTransform.setTranslation(r,o,0),c.imageTransform.setScale(a*n,a*s,1),l=t.currentGlContext,u=t.currentProgram,c.scratchMatrix.copy(t.screenProjection),c.scratchMatrix.multiplyMatrix(c.imageTransform),u.loadModelviewProjection(l,c.scratchMatrix),u.loadTextureEnabled(l,!0),u.loadColor(l,i.WHITE),u.loadOpacity(l,this.opacity),c.texCoordMatrix.setToIdentity(),c.texCoordMatrix.multiplyByTextureTransform(h),u.loadTextureMatrix(l,c.texCoordMatrix),h.bind(t)&&l.drawArrays(l.TRIANGLE_STRIP,0,4),s):(t.gpuResourceCache.retrieveTexture(t.currentGlContext,e),0)},c.prototype.drawStringCredit=function(t,e,i){var r,o,n,s,a,h,l;return s=e.text+this.creditFont.toString(),n=t.gpuResourceCache.resourceForKey(s),n||(n=t.textSupport.createTexture(t,e.text,this.creditFont,!1),t.gpuResourceCache.putResource(s,n,n.size)),r=n.imageWidth,o=n.imageHeight,l=t.navigatorState.viewport.width-(r+this.margin),c.imageTransform.setTranslation(l,i,0),c.imageTransform.setScale(r,o,1),a=t.currentGlContext,h=t.currentProgram,c.scratchMatrix.copy(t.screenProjection),c.scratchMatrix.multiplyMatrix(c.imageTransform),h.loadModelviewProjection(a,c.scratchMatrix),h.loadTextureEnabled(a,!0),h.loadColor(a,e.color),h.loadOpacity(a,this.opacity),c.texCoordMatrix.setToIdentity(),c.texCoordMatrix.multiplyByTextureTransform(n),h.loadTextureMatrix(a,c.texCoordMatrix),n.bind(t)&&a.drawArrays(a.TRIANGLE_STRIP,0,4),!0},c}),i("shapes/ShapeAttributes",["../util/Color","../util/ImageSource"],function(t,e){"use strict";var i=function(e){this._drawInterior=e?e._drawInterior:!0,this._drawOutline=e?e._drawOutline:!0,this._enableLighting=e?e._enableLighting:!1,this._interiorColor=e?e._interiorColor:t.WHITE,this._outlineColor=e?e._outlineColor:t.RED,this._outlineWidth=e?e._outlineWidth:1,this._outlineStippleFactor=e?e._outlineStippleFactor:0,this._outlineStipplePattern=e?e._outlineStipplePattern:61680,this._imageSource=e?e._imageSource:null,this._depthTest=e?e._depthTest:!0,this._drawVerticals=e?e._drawVerticals:!1,this._applyLighting=e?e._applyLighting:!1,this.stateKeyInvalid=!0};return i.prototype.computeStateKey=function(){return"di "+this._drawInterior+" do "+this._drawOutline+" el "+this._enableLighting+" ic "+this._interiorColor.toHexString(!0)+" oc "+this._outlineColor.toHexString(!0)+" ow "+this._outlineWidth+" osf "+this._outlineStippleFactor+" osp "+this._outlineStipplePattern+" is "+(this._imageSource?this.imageSource instanceof e?this.imageSource.key:this.imageSource:"null")+" dt "+this._depthTest+" dv "+this._drawVerticals+" li "+this._applyLighting},Object.defineProperties(i.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},drawInterior:{get:function(){return this._drawInterior},set:function(t){this._drawInterior=t,this.stateKeyInvalid=!0}},drawOutline:{get:function(){return this._drawOutline},set:function(t){this._drawOutline=t,this.stateKeyInvalid=!0}},enableLighting:{get:function(){return this._enableLighting},set:function(t){this._enableLighting=t,this.stateKeyInvalid=!0}},interiorColor:{get:function(){return this._interiorColor},set:function(t){this._interiorColor=t,this.stateKeyInvalid=!0}},outlineColor:{get:function(){return this._outlineColor},set:function(t){this._outlineColor=t,this.stateKeyInvalid=!0}},outlineWidth:{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth=t,this.stateKeyInvalid=!0}},outlineStipplePattern:{get:function(){return this._outlineStipplePattern},set:function(t){this._outlineStipplePattern=t,this.stateKeyInvalid=!0}},outlineStippleFactor:{get:function(){return this._outlineStippleFactor},set:function(t){this._outlineStippleFactor=t,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(t){this._imageSource=t,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this.stateKeyInvalid=!0}},drawVerticals:{get:function(){return this._drawVerticals},set:function(t){this._drawVerticals=t,this.stateKeyInvalid=!0}},applyLighting:{get:function(){return this._applyLighting},set:function(t){this._applyLighting=t,this.stateKeyInvalid=!0}}}),i}),i("shapes/SurfaceShape",["../error/AbstractError","../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../error/NotYetImplementedError","../pick/PickedObject","../render/Renderable","../geom/Sector","../shapes/ShapeAttributes","../error/UnsupportedOperationError","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u,c){"use strict";var d=function(t){a.call(this),this._displayName="Surface Shape",this._attributes=t?t:new l(null),this._highlightAttributes=null,this._highlighted=!1,this._enabled=!0,this._pathType=WorldWind.GREAT_CIRCLE,this._maximumNumEdgeIntervals=d.DEFAULT_NUM_EDGE_INTERVALS,this._polarThrottle=d.DEFAULT_POLAR_THROTTLE,this._sector=null,this.pickDelegate=null,this._sectors=[],this._locations=null,this._boundaries=null,this._interiorGeometry=null,this._outlineGeometry=null,this._isInteriorInhibited=!1,this.stateKeyInvalid=!0,this._attributesStateKey=null,this.isPrepared=!1,this.layer=null,this.pickColor=null};return d.prototype=Object.create(a.prototype),Object.defineProperties(d.prototype,{stateKey:{get:function(){if(this._attributesStateKey){var t=null;this._highlighted?this._highlightAttributes&&(t=this._highlightAttributes.stateKey):this._attributes&&(t=this._attributes.stateKey),t!=this._attributesStateKey&&(this._attributesStateKey=t,this.stateKeyInvalid=!0)}else this._highlighted?this._highlightAttributes&&(this._attributesStateKey=this._highlightAttributes.stateKey):this._attributes&&(this._attributesStateKey=this._attributes.stateKey),this._attributesStateKey&&(this.stateKeyInvalid=!0);return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey()),this._stateKey}},displayName:{get:function(){return this._displayName},set:function(t){this.stateKeyInvalid=!0,this._displayName=t}},attributes:{get:function(){return this._attributes},set:function(t){this.stateKeyInvalid=!0,this._attributes=t,this._attributesStateKey=t.stateKey}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(t){this.stateKeyInvalid=!0,this._highlightAttributes=t}},highlighted:{get:function(){return this._highlighted},set:function(t){this.stateKeyInvalid=!0,this._highlighted=t}},enabled:{get:function(){return this._enabled},set:function(t){this.stateKeyInvalid=!0,this._enabled=t}},pathType:{get:function(){return this._pathType},set:function(t){this.stateKeyInvalid=!0,this._pathType=t}},maximumNumEdgeIntervals:{get:function(){return this._maximumNumEdgeIntervals},set:function(t){this.stateKeyInvalid=!0,this._maximumNumEdgeIntervals=t}},polarThrottle:{get:function(){return this._polarThrottle},set:function(t){this.stateKeyInvalid=!0,this._polarThrottle=t}},sector:{get:function(){return this._sector}}}),d.staticStateKey=function(t){return t.stateKeyInvalid=!1,t.highlighted&&t._highlightAttributes?t._attributesStateKey=t._highlightAttributes.stateKey:t._attributes?t._attributesStateKey=t._attributes.stateKey:t._attributesStateKey=null,"dn "+t.displayName+" at "+(t._attributesStateKey?t._attributesStateKey:"null")+" hi "+t.highlighted+" en "+t.enabled+" pt "+t.pathType+" ne "+t.maximumNumEdgeIntervals+" po "+t.polarThrottle+" se ["+t.sector.minLatitude+","+t.sector.maxLatitude+","+t.sector.minLongitude+","+t.sector.maxLongitude+"]"},d.prototype.computeStateKey=function(){return d.staticStateKey(this)},d.prototype.area=function(t,e){throw new n(o.logMessage(o.LEVEL_SEVERE,"SurfaceShape","area","notYetImplemented"))},d.prototype.computeBoundaries=function(e){throw new t(o.logMessage(o.LEVEL_SEVERE,"SurfaceShape","computeBoundaries","abstractInvocation"))},d.prototype.render=function(t){this.layer=t.currentLayer,this.prepareBoundaries(t),t.surfaceShapeTileBuilder.insertSurfaceShape(this)},d.prototype.interpolateLocations=function(t){var e,i,r,o=t[0],n=o,s=!0,a=!0,h=0,l=!0;for(this._locations=[o],i=1,r=t.length;r>i;i+=1)e=n,a=s,n=t[i],s=n.latitude==o.latitude&&n.longitude==o.longitude,l=!0,(s||a)&&(h+=1,h>2&&(l=!1)),l&&this.interpolateEdge(e,n,this._locations),this._locations.push(n),e=n;this._isInteriorInhibited||(e.latitude!=o.latitude||e.longitude!=o.longitude)&&(this.interpolateEdge(e,o,this._locations),this._locations.push(o))},d.prototype.interpolateEdge=function(t,e,i){var o,n,s=r.greatCircleDistance(t,e),a=Math.round(this._maximumNumEdgeIntervals*s/Math.PI);if(a>0){o=1/a,n=t;for(var h=this.throttledStep(o,n);1>h;h+=this.throttledStep(o,n))n=new r(0,0),r.interpolateAlongPath(this._pathType,h,t,e,n),i.push(n)}},d.prototype.throttledStep=function(t,i){var r=Math.cos(i.latitude*e.DEGREES_TO_RADIANS);r*=r;var o=this._polarThrottle/(1+this._polarThrottle);return t*(1-o+o*r)},d.prototype.prepareBoundaries=function(t){this.isPrepared||(this._boundaries||this.computeBoundaries(t),this._locations||this.interpolateLocations(this._boundaries),this.prepareGeometry(t),this.prepareSectors(),this.isPrepared=!0)},d.prototype.computeSectors=function(t){return this._sectors&&this._sectors.length>0?this._sectors:(this.prepareBoundaries(t),this._sectors)},d.prototype.prepareSectors=function(){var t=this._boundaries;if(t){this._sector=new h(-90,90,-180,180),this._sector.setToBoundingSector(t);var e=this.containsPole(t);if(e!=r.poles.NONE?(e==r.poles.NORTH?this._sector=new h(this._sector.minLatitude,90,-180,180):this._sector=new h(-90,this._sector.maxLatitude,-180,180),this._sectors=[this._sector]):r.locationsCrossDateLine(t)?this._sectors=h.splitBoundingSectors(t):this._sector.isEmpty()||(this._sectors=[this._sector]),this._sectors&&this._pathType===WorldWind.GREAT_CIRCLE)for(var i=0,o=this._sectors.length;o>i;i+=1){var n=this._sectors[i],s=r.greatCircleArcExtremeLocations(t),a=Math.min(n.minLatitude,s[0].latitude),l=Math.max(n.maxLatitude,s[1].latitude);this._sectors[i]=new h(a,l,n.minLongitude,n.maxLongitude)}}},d.prototype.prepareGeometry=function(t){var e;this._interiorGeometry=[],this._outlineGeometry=[];var i=this._locations,o=this.containsPole(i);if(o!=r.poles.NONE){var n=this.cutAlongDateLine(i,o,t.globe);this._interiorGeometry.push(n),e=this.repeatAroundDateline(i),this._outlineGeometry.push(e[0]),e.length>1&&this._outlineGeometry.push(e[1])}else r.locationsCrossDateLine(i)?(e=this.repeatAroundDateline(i),this._interiorGeometry.push(e[0]),this._interiorGeometry.push(e[1]),this._outlineGeometry.push(e[0]),this._outlineGeometry.push(e[1])):(this._interiorGeometry.push(i),this._outlineGeometry.push(i))},d.prototype.containsPole=function(t){for(var e=!1,i=90,o=-90,n=t[0],s=1,a=t.length;a>s;s+=1){var h=t[s];r.locationsCrossDateLine([n,h])&&(e=!e),i=Math.min(i,h.latitude),o=Math.max(o,h.latitude),n=h}var l=t[0];return r.locationsCrossDateLine([l,n])&&(e=!e),e?i>0?r.poles.NORTH:0>o?r.poles.SOUTH:Math.abs(o)>=Math.abs(i)?r.poles.NORTH:r.poles.SOUTH:r.poles.NONE},d.prototype.cutAlongDateLine=function(t,e,i){if(e==r.poles.NONE)return t;for(var o=[],n=e==r.poles.NORTH?90:-90,s=t[t.length-1],a=0,h=t.length;h>a;a+=1){var l=t[a];if(o.push(s),r.locationsCrossDateLine([s,l])){var u=r.intersectionWithMeridian(s,l,180,i),d=c.signum(s.longitude),g=u,p=180*d,f=-p;o.push(new r(g,p)),o.push(new r(n,p)),o.push(new r(n,f)),o.push(new r(g,f))}s=l}return o.push(s),o},d.prototype.repeatAroundDateline=function(t){var e=0,i=!1,o=[],n=t[0];o.push(n);for(var s=1,a=t.length;a>s;s+=1){var h=t[s];r.locationsCrossDateLine([n,h])&&(0==e&&(e=n.longitude<0?-360:360),i=!i),i?o.push(new r(h.latitude,h.longitude+e)):o.push(h),n=h}var l=[o];if(0!=e){var u=o;for(o=[],s=0,a=u.length;a>s;s+=1){var c=u[s];o.push(new r(c.latitude,c.longitude-e))}l.push(o)}return l},d.prototype.resetPickColor=function(){this.pickColor=null},d.prototype.renderToTexture=function(t,e,i,r,o,n){var a,h,l,u,c=[],d=t.pickingMode,g=this._highlighted?this._highlightAttributes||this._attributes:this._attributes;if(d&&!this.pickColor&&(this.pickColor=t.uniquePickColor()),!this._isInteriorInhibited&&g.drawInterior)for(e.fillStyle=d?this.pickColor.toHexString(!1):g.interiorColor.toHexString(!1),a=0,h=this._interiorGeometry.length;h>a;a+=1)if(l=0,u=2*this._outlineGeometry[a].length,c.splice(0,c.length),this.transformPath(this._interiorGeometry[a],i,r,o,n,c)){for(e.beginPath(),e.moveTo(c[l++],c[l++]);u>l;)e.lineTo(c[l++],c[l++]);e.closePath(),e.fill()}if(g.drawOutline&&g.outlineWidth>0){e.lineWidth=4*g.outlineWidth,e.strokeStyle=d?this.pickColor.toHexString(!1):g.outlineColor.toHexString(!1);this._attributes.outlineStipplePattern,this._attributes.outlineStippleFactor;for(a=0,h=this._outlineGeometry.length;h>a;a+=1)if(c.splice(0,c.length),this.transformPath(this._outlineGeometry[a],i,r,o,n,c)){var p=c[0],f=c[1],m=p,E=f,y=p,_=f,v=!0,L=!0,S=0;for(l=2,u=c.length;u>l;)m=y,E=_,v=L,y=c[l++],_=c[l++],L=y==p&&_==f,(v||L)&&(S+=1,S>2)||(e.beginPath(),e.moveTo(m,E),e.lineTo(y,_),e.stroke())}}if(d){var T=new s(this.pickColor.clone(),this._pickDelegate?this._pickDelegate:this,null,this.layer,!1);t.resolvePick(T)}},d.prototype.transformPath=function(t,e,i,r,o,n){var s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L,S,T,b,w,M=4;for(T=0,S=t[0],u=S.longitude*e+r,c=S.latitude*i+o,L=!0,p=m=s=h=u,f=E=a=l=c,n[T++]=h,n[T++]=l,b=1,w=t.length;w>b;b+=1)S=t[b],d=h,g=l,h=S.longitude*e+r,l=S.latitude*i+o,L=h==u&&l==c,y=h-s,_=l-a,v=y*y+_*_,(L||v>=M)&&(p=Math.min(p,h),m=Math.max(m,h),f=Math.min(f,l),E=Math.max(E,l),(n[T-2]!=d||n[T-1]!=g)&&(n[T++]=d,n[T++]=g),n[T++]=h,n[T++]=l,s=h,a=l);return m-p>=2||E-f>=2},d.DEFAULT_NUM_EDGE_INTERVALS=128,d.DEFAULT_POLAR_THROTTLE=10,d}),i("shapes/SurfaceShapeTile",["../geom/Angle","../error/ArgumentError","../util/Level","../util/Logger","../geom/Sector","../render/Texture","../render/TextureTile"],function(t,e,i,r,o,n,s){"use strict";var a=function(t,e,i,r){s.call(this,t,e,i,r),this.surfaceShapes=[],this.sector=t,this.cacheKey=null,this.pickSequence=0,this.surfaceShapeStateKeys=[],this.prevSurfaceShapes=[],this.createCtx2D()};return a.prototype=Object.create(s.prototype),a.prototype.clearShapes=function(){var t=this.prevSurfaceShapes;this.prevSurfaceShapes=this.surfaceShapes,this.surfaceShapes=t,this.surfaceShapes.splice(0,this.surfaceShapes.length)},a.prototype.hasShapes=function(){return this.surfaceShapes.length>0},a.prototype.getShapes=function(){return this.surfaceShapes},a.prototype.setShapes=function(t){this.surfaceShapes=t},a.prototype.getSector=function(){return this.sector},a.prototype.addSurfaceShape=function(t){this.surfaceShapes.push(t),this.surfaceShapeStateKeys.push(t.stateKey)},a.prototype.addAllSurfaceShapes=function(t){for(var e=0,i=t.length;i>e;e+=1){var r=t[e];this.addAllSurfaceShapes(r)}},a.prototype.needsUpdate=function(t){var e,i,r,o;if(this.prevSurfaceShapes.length!=this.surfaceShapes.length)return!0;for(e=0,i=this.prevSurfaceShapes;i>e;e+=1)if(r=this.prevSurfaceShapes[e],this.surfaceShapes.indexOf(r)<0)return!0;for(e=0,i=this.surfaceShapes;i>e;e+=1)if(r=this.surfaceShapes[e],this.prevSurfaceShapes.indexOf(r)<0)return!0;for(e=0,i=this.surfaceShapes.length;i>e;e+=1)if(r=this.surfaceShapes[e],o=this.surfaceShapeStateKeys[e],o!=r.stateKey)return!0;return this.hasTexture(t)?!1:!0},a.prototype.hasTexture=function(t){if(t.pickingMode)return!1;var e=t.gpuResourceCache;this.gpuCacheKey||(this.gpuCacheKey=this.getCacheKey());var i=e.resourceForKey(this.gpuCacheKey);return!!i},a.prototype.updateTexture=function(t){var e=t.currentGlContext,i=a.canvas;i.width=this.tileWidth,i.height=this.tileHeight;for(var r=a.ctx2D,o=this.tileWidth/this.sector.deltaLongitude(),s=-this.tileHeight/this.sector.deltaLatitude(),h=-this.sector.minLongitude*o,l=-this.sector.maxLatitude*s,u=0,c=this.surfaceShapes.length;c>u;u+=1){var d=this.surfaceShapes[u];this.surfaceShapeStateKeys[u]=d.stateKey,d.renderToTexture(t,r,o,s,h,l)}var g=new n(e,i),p=t.gpuResourceCache;return this.gpuCacheKey=this.getCacheKey(),p.putResource(this.gpuCacheKey,g,g.size),g},a.prototype.getCacheKey=function(){return this.cacheKey||(this.cacheKey="SurfaceShapeTile:"+this.tileKey+","+this.pickSequence.toString()),this.cacheKey},a.prototype.createCtx2D=function(){a.ctx2D||(a.canvas=document.createElement("canvas"),a.ctx2D=a.canvas.getContext("2d"))},a.canvas=null,a.ctx2D=null,a}),i("shapes/SurfaceShapeTileBuilder",["../error/ArgumentError","../render/DrawContext","../globe/Globe","../shaders/GpuProgram","../util/Level","../util/LevelSet","../geom/Location","../util/Logger","../geom/Matrix","../cache/MemoryCache","../navigate/NavigatorState","../error/NotYetImplementedError","../pick/PickedObject","../geom/Rectangle","../geom/Sector","../shapes/SurfaceShape","../shapes/SurfaceShapeTile","../globe/Terrain","../globe/TerrainTile","../globe/TerrainTileList","../render/TextureTile","../util/Tile"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L){"use strict";var S=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=256,this.tileHeight=256,this.levels=new n(p.FULL_SPHERE,new s(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.surfaceShapes=[],this.surfaceShapeTiles=[],this.topLevelTiles=[],this.sector=new p(-90,90,-180,180),this.SPLIT_SCALE=2.9,this.tileCache=new l(5e5,4e5)};return S.prototype.clear=function(){this.surfaceShapeTiles.splice(0,this.surfaceShapeTiles.length),this.surfaceShapes.splice(0,this.surfaceShapes.length)},S.prototype.insertSurfaceShape=function(t){this.surfaceShapes.push(t)},S.prototype.doRender=function(t){if(t.pickingMode){for(var e=0,i=this.surfaceShapes.length;i>e;e+=1)this.surfaceShapes[e].resetPickColor();S.pickSequence+=1;var r=this.surfaceShapeTiles,o=this.topLevelTiles;this.surfaceShapeTiles=[],this.topLevelTiles=[],this.buildTiles(t),t.deepPicking?this.doDeepPickingRender(t):t.surfaceTileRenderer.renderTiles(t,this.surfaceShapeTiles,1),this.surfaceShapeTiles=r,this.topLevelTiles=o}else this.buildTiles(t),t.surfaceTileRenderer.renderTiles(t,this.surfaceShapeTiles,1)},S.prototype.doDeepPickingRender=function(t){var e,i,r,o,n,s,a,h,l,u=[];for(n=0,s=t.objectsAtPickPoint.objects.length;s>n;n+=1)a=t.objectsAtPickPoint.objects[n],a.userObject instanceof f&&(h=a.userObject,u.indexOf(h)<0&&(u.push(h),t.objectsAtPickPoint.objects.splice(n,1),n-=1,s-=1));if(!(u.length<=0)){var c=[];for(r=0,o=u.length;o>r;r+=1){for(h=u[r],e=0,i=this.surfaceShapeTiles.length;i>e;e+=1)l=this.surfaceShapeTiles[e],l.setShapes([h]),l.updateTexture(t);t.surfaceTileRenderer.renderTiles(t,this.surfaceShapeTiles,1);var g=t.readPickColor(t.pickPoint);g&&h.pickColor.equals(g)&&(a=new d(h.pickColor.clone(),h._pickDelegate?h._pickDelegate:h,null,h.layer,!1),c.push(a))}for(n=0,s=t.objectsAtPickPoint.objects.length;s>n;n+=1)a=t.objectsAtPickPoint.objects[n],a.userObject instanceof f&&(t.objectsAtPickPoint.objects.splice(n,1),n-=1,s-=1);for(n=0,s=c.length;s>n;n+=1)a=c[n],t.objectsAtPickPoint.objects.push(a)}},S.prototype.buildTiles=function(e){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"SurfaceShapeTileBuilder","buildTiles","missingDc"));if(this.surfaceShapes&&!(this.surfaceShapes.length<1)){this.assembleTiles(e),this.surfaceShapes.splice(0,this.surfaceShapes.length);for(var i=0,r=this.surfaceShapeTiles.length;r>i;i+=1){var o=this.surfaceShapeTiles[i];o.clearShapes()}}},S.prototype.assembleTiles=function(t){var e,i,r,o,n,s,a;this.topLevelTiles.length<1&&this.createTopLevelTiles();var h={};for(i=0,r=this.surfaceShapes.length;r>i;i+=1){var l=this.surfaceShapes[i],u=l.computeSectors(t);if(u)for(s=0,a=u.length;a>s;s+=1){var c=u[s];for(o=0,n=this.topLevelTiles.length;n>o;o+=1)if(e=this.topLevelTiles[o],e.sector.intersects(c)){var d=e.tileKey;h[d]=e,e.addSurfaceShape(l)}}}for(var g in h)h.hasOwnProperty(g)&&(e=h[g],this.addTileOrDescendants(t,this.levels,null,e))},S.prototype.addTileOrDescendants=function(t,e,i,r){if(!this.intersectsFrustum(t,r))return void r.clearShapes();if(null!=i&&this.addIntersectingShapes(t,i,r),r.hasShapes()){if(this.meetsRenderCriteria(t,e,r))return void this.addTile(t,r);for(var o=e.level(r.level.levelNumber+1),n=t.pickingMode?r.subdivide(o,this):r.subdivideToCache(o,this,this.tileCache),s=0,a=n.length;a>s;s+=1){var h=n[s];this.addTileOrDescendants(t,e,r,h)}r.clearShapes()}},S.prototype.addIntersectingShapes=function(t,e,i){if(e.hasShapes()&&i.sector.intersects(e.sector))if(i.getSector().contains(e.sector))i.addAllSurfaceShapes(e.getShapes());else for(var r=e.getShapes(),o=0,n=r.length;n>o;o+=1){var s=r[o],a=s.computeSectors(t);if(a)for(var h=0,l=a.length;l>h;h+=1){var u=a[h];if(i.getSector().intersects(u)){i.addSurfaceShape(s);break}}}},S.prototype.addTile=function(t,e){t.pickingMode&&(e.pickSequence=S.pickSequence),e.needsUpdate(t)&&e.updateTexture(t),this.surfaceShapeTiles.push(e)},S.prototype.createTile=function(t,e,i,r){return new m(t,e,i,r)},S.prototype.createTopLevelTiles=function(){L.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},S.prototype.intersectsFrustum=function(t,e){return t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits)?!1:(e.update(t),e.extent.intersectsFrustum(t.pickingMode?t.pickFrustum:t.navigatorState.frustumInModelCoordinates))},S.prototype.meetsRenderCriteria=function(t,e,i){return i.level.levelNumber==e.lastLevel().levelNumber||!i.mustSubdivide(t,this.SPLIT_SCALE)},S.pickSequence=0,S}),i("shaders/SurfaceTileRendererProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(t,e,i,r){"use strict";var o=function(t){var e="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nuniform mat4 mvpMatrix;\nuniform mat4 texSamplerMatrix;\nuniform mat4 texMaskMatrix;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nvoid main() {\ngl_Position = mvpMatrix * vertexPoint;\ntexSamplerCoord = (texSamplerMatrix * vertexTexCoord).st;\ntexMaskCoord = (texMaskMatrix * vertexTexCoord).st;\n}",r="precision mediump float;\nuniform sampler2D texSampler;\nuniform float opacity;\nuniform vec4 color;\nuniform bool modulateColor;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nbool isOutsideTextureImage(const vec2 coord) {\n    return coord.x < 0.0 || coord.x > 1.0 || coord.y < 0.0 || coord.y > 1.0;\n}\nvoid main(void) {\nif (isOutsideTextureImage(texMaskCoord)) {\n    discard;\n} else if (modulateColor) {\n    gl_FragColor = color * floor(texture2D(texSampler, texSamplerCoord).a + 0.5);\n} else {\n    gl_FragColor = texture2D(texSampler, texSamplerCoord) * opacity;\n}\n}";i.call(this,t,e,r),this.vertexPointLocation=this.attributeLocation(t,"vertexPoint"),this.vertexTexCoordLocation=this.attributeLocation(t,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(t,"mvpMatrix"),this.colorLocation=this.uniformLocation(t,"color"),this.modulateColorLocation=this.uniformLocation(t,"modulateColor"),this.texSamplerMatrixLocation=this.uniformLocation(t,"texSamplerMatrix"),this.texMaskMatrixLocation=this.uniformLocation(t,"texMaskMatrix"),this.texSamplerLocation=this.uniformLocation(t,"texSampler"),this.opacityLocation=this.uniformLocation(t,"opacity"),this.vertexPointLocation=-1};return o.key="WorldWindGpuSurfaceTileRenderingProgram",o.prototype=Object.create(i.prototype),o.prototype.loadModelviewProjection=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(e,i,this.mvpMatrixLocation)},o.prototype.loadTexSamplerMatrix=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexSamplerMatrix","missingMatrix"));this.loadUniformMatrix(e,i,this.texSamplerMatrixLocation)},o.prototype.loadTexMaskMatrix=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexMaskMatrix","missingMatrix"));this.loadUniformMatrix(e,i,this.texMaskMatrixLocation)},o.prototype.loadTexSampler=function(t,e){t.uniform1i(this.texSamplerLocation,e-WebGLRenderingContext.TEXTURE0)},o.prototype.loadOpacity=function(t,e){t.uniform1f(this.opacityLocation,e)},o.prototype.loadColor=function(e,i){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadColor","missingColor"));this.loadUniformColor(e,i,this.colorLocation)},o.prototype.loadModulateColor=function(t,e){t.uniform1i(this.modulateColorLocation,e?1:0)},o}),i("render/SurfaceTileRenderer",["../error/ArgumentError","../util/Logger","../geom/Matrix","../shapes/SurfaceShapeTile","../shaders/SurfaceTileRendererProgram"],function(t,e,i,r,o){"use strict";var n=function(){this.texMaskMatrix=i.fromIdentity(),this.texSamplerMatrix=i.fromIdentity(),this.isSurfaceShapeTileRendering=!1};return n.prototype.renderTiles=function(i,o,n){if(!o)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceTileRenderer","renderTiles","Specified surface tiles array is null or undefined."));if(!(o.length<1)){var s,a,h,l,u=i.terrain,c=i.currentGlContext,d=0;if(u){this.isSurfaceShapeTileRendering=o[0]instanceof r,n*=i.surfaceOpacity,s=this.beginRendering(i,n),u.beginRendering(i);try{for(var g=0,p=u.surfaceGeometry.length;p>g;g++){a=u.surfaceGeometry[g],h=a.sector,u.beginRenderingTile(i,a);try{for(var f=0,m=o.length;m>f;f++)l=o[f],l.sector.overlaps(h)&&l.bind(i)&&(i.pickingMode&&l.pickColor&&s.loadColor(c,l.pickColor),this.applyTileState(i,a,l),u.renderTile(i,a),++d)}catch(E){console.log(E)}finally{u.endRenderingTile(i,a)}}}catch(E){console.log(E)}finally{u.endRendering(i),this.endRendering(i),i.frameStatistics.incrementRenderedTileCount(d)}}}},n.prototype.beginRendering=function(t,e){var i=t.currentGlContext,r=t.findAndBindProgram(o);return r.loadTexSampler(i,i.TEXTURE0),t.pickingMode&&!this.isSurfaceShapeTileRendering?r.loadModulateColor(i,!0):(r.loadModulateColor(i,!1),r.loadOpacity(i,e)),r},n.prototype.endRendering=function(t){var e=t.currentGlContext;e.bindTexture(e.TEXTURE_2D,null)},n.prototype.applyTileState=function(t,e,i){var r=t.currentGlContext,o=t.currentProgram,n=e.sector,s=n.deltaLatitude(),a=n.deltaLongitude(),h=i.sector,l=h.deltaLatitude(),u=h.deltaLongitude(),c=l>0?l:1,d=u>0?u:1,g=a/d,p=s/c,f=-(h.minLongitude-n.minLongitude)/d,m=-(h.minLatitude-n.minLatitude)/c;this.texMaskMatrix.set(g,0,0,f,0,p,0,m,0,0,1,0,0,0,0,1),this.texSamplerMatrix.setToUnitYFlip(),i.applyInternalTransform(t,this.texSamplerMatrix),this.texSamplerMatrix.multiplyMatrix(this.texMaskMatrix),o.loadTexSamplerMatrix(r,this.texSamplerMatrix),o.loadTexMaskMatrix(r,this.texMaskMatrix)},n}),i("render/TextSupport",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Logger","../geom/Matrix","../render/Texture","../geom/Vec2"],function(t,e,i,r,o,n,s){"use strict";var a=function(){this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.lineSpacing=.15,this.strokeStyle="rgba(0, 0, 0, 0.5)",this.strokeWidth=4};return a.prototype.textSize=function(t,e,i){if(0===t.length)return new s(0,0);this.ctx2D.font=e.fontString;for(var r=t.split("\n"),o=r.length*(e.size*(1+this.lineSpacing)),n=0,a=0;a<r.length;a++)n=Math.max(n,this.ctx2D.measureText(r[a]).width);return i&&(n+=this.strokeWidth,o+=this.strokeWidth),new s(n,o)},a.prototype.createTexture=function(t,e,r,o){var s=t.currentGlContext,a=this.ctx2D,h=this.canvas2D,l=this.textSize(e,r,o),u=e.split("\n"),c=o?this.strokeWidth/2:0,d=t.pixelScale;h.width=Math.ceil(l[0])*d,h.height=Math.ceil(l[1])*d,a.scale(d,d),a.font=r.fontString,a.textBaseline="top",a.textAlign=r.horizontalAlignment,a.fillStyle=i.WHITE.toHexString(!1),a.strokeStyle=this.strokeStyle,a.lineWidth=this.strokeWidth,a.lineCap="round",a.lineJoin="round","left"===r.horizontalAlignment?a.translate(c,0):"right"===r.horizontalAlignment?a.translate(l[0]-c,0):a.translate(l[0]/2,0);for(var g=0;g<u.length;g++)o&&a.strokeText(u[g],0,0),a.fillText(u[g],0,0),a.translate(0,r.size*(1+this.lineSpacing)+c);return new n(s,h)},a}),i("render/DrawContext",["../error/ArgumentError","../util/Color","../util/FrameStatistics","../render/FramebufferTexture","../render/FramebufferTileController","../geom/Frustum","../globe/Globe","../shaders/GpuProgram","../cache/GpuResourceCache","../layer/Layer","../util/Logger","../geom/Matrix","../navigate/NavigatorState","../pick/PickedObjectList","../geom/Plane","../geom/Position","../geom/Rectangle","../render/ScreenCreditController","../geom/Sector","../shapes/SurfaceShape","../shapes/SurfaceShapeTileBuilder","../render/SurfaceTileRenderer","../render/TextSupport","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L,S,T,b,w){"use strict";var M=function(i){if(!i)throw new t(u.logMessage(u.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));this.currentGlContext=i,this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.clearColor=e.TRANSPARENT,this.gpuResourceCache=new h(WorldWind.configuration.gpuCacheSize,.8*WorldWind.configuration.gpuCacheSize),this.surfaceTileRenderer=new L,this.surfaceShapeTileBuilder=new v,this.surfaceShapeTileController=new o,this.screenCreditController=new E,this.textSupport=new S,this.currentFramebuffer=null,this.currentProgram=null,this.surfaceRenderables=[],this.orderedRenderingMode=!1,this.orderedRenderables=[],this.orderedRenderablesCounter=0,this.timestamp=Date.now(),this.previousRedrawTimestamp=this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.eyePosition=new f(0,0,0),this.screenProjection=c.fromIdentity(),this.terrain=null,this.verticalExaggeration=1,this.fadeTime=500,this.surfaceOpacity=1,this.frameStatistics=null,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFramebuffer=null,this.pickFrustum=null,this.pickColor=new e(0,0,0,1),this.objectsAtPickPoint=new g,this.pixelScale=1};return M.unitCubeKey="DrawContextUnitCubeKey",M.unitCubeElementsKey="DrawContextUnitCubeElementsKey",M.unitQuadKey="DrawContextUnitQuadKey",M.unitQuadKey3="DrawContextUnitQuadKey3",M.prototype.reset=function(){this.screenCreditController.clear(),this.surfaceRenderables=[],this.orderedRenderingMode=!1,this.orderedRenderables=[],this.orderedRenderablesCounter=0;var t=this.timestamp;this.timestamp=Date.now(),this.timestamp===t&&++this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.terrain=null,this.verticalExaggeration=1,this.frameStatistics=null,this.accumulateOrderedRenderables=!0,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFrustum=null,this.pickColor=new e(0,0,0,1),this.objectsAtPickPoint.clear()},M.prototype.update=function(){var t=this.currentGlContext,e=this.navigatorState.eyePoint;this.globeStateKey=this.globe.stateKey,this.globe.computePositionFromPoint(e[0],e[1],e[2],this.eyePosition),this.screenProjection.setToScreenProjection(t.drawingBufferWidth,t.drawingBufferHeight)},M.prototype.contextLost=function(){this.gpuResourceCache.clear(),this.pickFramebuffer=null,this.currentFramebuffer=null,this.currentProgram=null},M.prototype.contextRestored=function(){this.gpuResourceCache.clear()},M.prototype.bindFramebuffer=function(t){this.currentFramebuffer!=t&&(this.currentGlContext.bindFramebuffer(this.currentGlContext.FRAMEBUFFER,t?t.framebufferId:null),
this.currentFramebuffer=t)},M.prototype.bindProgram=function(t){this.currentProgram!=t&&(this.currentGlContext.useProgram(t?t.programId:null),this.currentProgram=t)},M.prototype.findAndBindProgram=function(e){if(!e)throw new t(u.logMessage(u.LEVEL_SEVERE,"DrawContext","findAndBindProgram","The specified program constructor is null or undefined."));var i=this.gpuResourceCache.resourceForKey(e.key);if(i)this.bindProgram(i);else try{i=new e(this.currentGlContext),this.bindProgram(i),this.gpuResourceCache.putResource(e.key,i,i.size)}catch(r){u.log(u.LEVEL_SEVERE,"Error attempting to create GPU program.")}return i},M.prototype.addSurfaceRenderable=function(t){t&&this.surfaceRenderables.push(t)},M.prototype.peekSurfaceRenderable=function(){return this.surfaceRenderables.length>0?this.surfaceRenderables[this.surfaceRenderables.length-1]:null},M.prototype.popSurfaceRenderable=function(){return this.surfaceRenderables.length>0?this.surfaceRenderables.pop():null},M.prototype.reverseSurfaceRenderables=function(){this.surfaceRenderables.reverse()},M.prototype.addOrderedRenderable=function(t){if(t){var e={orderedRenderable:t,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:t.eyeDistance,globeStateKey:this.globeStateKey};this.globe.continuous&&(e.globeOffset=this.globe.offset),this.orderedRenderables.push(e)}},M.prototype.addOrderedRenderableToBack=function(t){if(t){var e={orderedRenderable:t,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:Number.MAX_VALUE,globeStateKey:this.globeStateKey};this.globe.continuous&&(e.globeOffset=this.globe.offset),this.orderedRenderables.push(e)}},M.prototype.peekOrderedRenderable=function(){return this.orderedRenderables.length>0?this.orderedRenderables[this.orderedRenderables.length-1].orderedRenderable:null},M.prototype.popOrderedRenderable=function(){if(this.orderedRenderables.length>0){var t=this.orderedRenderables.pop();return this.globeStateKey=t.globeStateKey,this.globe.continuous&&(this.globe.offset=t.globeOffset),t.orderedRenderable}return null},M.prototype.sortOrderedRenderables=function(){this.orderedRenderables.sort(function(t,e){var i=t.eyeDistance,r=e.eyeDistance;if(r>i)return-1;if(i>r)return 1;var o=t.insertionOrder,n=e.insertionOrder;return o>n?-1:n>o?1:0})},M.prototype.readPickColor=function(t){var i=this.navigatorState.convertPointToViewport(t,new T(0,0)),r=new Uint8Array(4);return this.currentGlContext.readPixels(i[0],i[1],1,1,this.currentGlContext.RGBA,this.currentGlContext.UNSIGNED_BYTE,r),this.clearColor.equalsBytes(r)?null:e.colorFromByteArray(r)},M.prototype.readPickColors=function(t){var i,r=this.currentGlContext,o=new Uint8Array(t.width*t.height*4),n={},s=new e(0,0,0,0),a=r.getParameter(r.PACK_ALIGNMENT);r.pixelStorei(r.PACK_ALIGNMENT,1),this.currentGlContext.readPixels(t.x,t.y,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,o),r.pixelStorei(r.PACK_ALIGNMENT,a);for(var h=0,l=t.width*t.height;l>h;h++){var u=4*h;i=e.colorFromBytes(o[u],o[u+1],o[u+2],o[u+3]),i.equals(this.clearColor)||i.equals(s)||(n[i.toByteString()]=i)}return n},M.prototype.resolvePick=function(t){if(t.userObject instanceof _||!this.deepPicking||this.regionPicking)this.addPickedObject(t);else{var e=this.readPickColor(this.pickPoint);if(!e)return null;t.color.equals(e)&&this.addPickedObject(t)}},M.prototype.addPickedObject=function(t){t&&this.objectsAtPickPoint.add(t)},M.prototype.uniquePickColor=function(){var t=this.pickColor.nextColor().clone();return t.equals(this.clearColor)?t.nextColor():t},M.prototype.makePickFramebuffer=function(){var t=this.currentGlContext,e=t.drawingBufferWidth,i=t.drawingBufferHeight;return this.pickFramebuffer&&this.pickFramebuffer.width==e&&this.pickFramebuffer.height==i||(this.pickFramebuffer=new r(t,e,i,!0)),this.pickFramebuffer},M.prototype.makePickFrustum=function(){if(!this.pickPoint&&!this.pickRectangle)return!1;var t,e,i,r,o,s,a,h,l,u,c,d,g,f,E,y,_,v,L,S,M,R,x=new b(0,0,0),C=2,A=new b(0,0,0),P=this.pickRectangle,I=this.navigatorState.viewport;P||(R=this.navigatorState.convertPointToViewport(this.pickPoint,new T(0,0)),P=new m(R[0]-C,R[1]-C,2*C,2*C));var N=P.x,O=P.x+P.width,V=P.y,D=P.y+P.height;return 0>O||0>D||N>I.x+I.width||V>I.y+I.height?!1:(P.x=w.clamp(N,I.x,I.x+I.width),P.y=w.clamp(V,I.y,I.y+I.height),P.width=w.clamp(O,I.x,I.x+I.width)-P.x,P.height=w.clamp(D,I.y,I.y+I.height)-P.y,this.pickRectangle=P,A[0]=P.x,A[1]=P.y,A[2]=0,this.navigatorState.unProject(A,t=new b(0,0,0)),A[0]=P.x,A[1]=P.y,A[2]=1,this.navigatorState.unProject(A,e=new b(0,0,0)),A[0]=P.x+P.width,A[1]=P.y,A[2]=0,this.navigatorState.unProject(A,i=new b(0,0,0)),A[0]=P.x+P.width,A[1]=P.y,A[2]=1,this.navigatorState.unProject(A,r=new b(0,0,0)),A[0]=P.x,A[1]=P.y+P.height,A[2]=0,this.navigatorState.unProject(A,o=new b(0,0,0)),A[0]=P.x,A[1]=P.y+P.height,A[2]=1,this.navigatorState.unProject(A,s=new b(0,0,0)),A[0]=P.x+P.width,A[1]=P.y+P.height,A[2]=0,this.navigatorState.unProject(A,a=new b(0,0,0)),A[0]=P.x+P.width,A[1]=P.y+P.height,A[2]=1,this.navigatorState.unProject(A,h=new b(0,0,0)),M=new b(s[0]-t[0],s[1]-t[1],s[2]-t[2]),x.set(o[0]-e[0],o[1]-e[1],o[2]-e[2]),l=M.cross(x),E=new p(l[0],l[1],l[2],-l.dot(t)),E.normalize(),M=new b(a[0]-r[0],a[1]-r[1],a[2]-r[2]),x.set(h[0]-i[0],h[1]-i[1],h[2]-i[2]),u=M.cross(x),y=new p(u[0],u[1],u[2],-u.dot(i)),y.normalize(),M=new b(s[0]-a[0],s[1]-a[1],s[2]-a[2]),x.set(h[0]-o[0],h[1]-o[1],h[2]-o[2]),c=M.cross(x),_=new p(c[0],c[1],c[2],-c.dot(o)),_.normalize(),M=new b(r[0]-t[0],r[1]-t[1],r[2]-t[2]),x.set(e[0]-i[0],e[1]-i[1],e[2]-i[2]),d=M.cross(x),v=new p(d[0],d[1],d[2],-d.dot(i)),v.normalize(),M=new b(o[0]-i[0],o[1]-i[1],o[2]-i[2]),x.set(a[0]-t[0],a[1]-t[1],a[2]-t[2]),g=M.cross(x),L=new p(g[0],g[1],g[2],-g.dot(t)),L.normalize(),M=new b(h[0]-e[0],h[1]-e[1],h[2]-e[2]),x.set(s[0]-r[0],s[1]-r[1],s[2]-r[2]),f=M.cross(x),S=new p(f[0],f[1],f[2],-f.dot(e)),S.normalize(),this.pickFrustum=new n(E,y,v,_,L,S),!0)},M.prototype.isSmall=function(t,e){if(!t)return!1;var i=this.navigatorState.eyePoint.distanceTo(t.center),r=this.navigatorState.pixelSizeAtDistance(i);return 2*t.radius<e*r},M.prototype.unitCubeBuffer=function(){var t=this.gpuResourceCache.resourceForKey(M.unitCubeKey);if(!t){var e=this.currentGlContext,i=new Float32Array(24),r=0;i[r++]=0,i[r++]=1,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=0,i[r++]=1,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=0,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=1,i[r++]=1,i[r++]=1,i[r++]=0,i[r]=1,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(M.unitCubeKey,t,4*i.length)}return t},M.prototype.unitCubeElements=function(){var t=this.gpuResourceCache.resourceForKey(M.unitCubeElementsKey);if(!t){var e=this.currentGlContext,i=new Int16Array(60),r=0;i[r++]=1,i[r++]=0,i[r++]=3,i[r++]=3,i[r++]=0,i[r++]=2,i[r++]=4,i[r++]=5,i[r++]=6,i[r++]=6,i[r++]=5,i[r++]=7,i[r++]=5,i[r++]=1,i[r++]=7,i[r++]=7,i[r++]=1,i[r++]=3,i[r++]=6,i[r++]=2,i[r++]=4,i[r++]=4,i[r++]=2,i[r++]=0,i[r++]=4,i[r++]=0,i[r++]=5,i[r++]=5,i[r++]=0,i[r++]=1,i[r++]=7,i[r++]=3,i[r++]=6,i[r++]=6,i[r++]=3,i[r++]=2,i[r++]=0,i[r++]=1,i[r++]=1,i[r++]=3,i[r++]=3,i[r++]=2,i[r++]=2,i[r++]=0,i[r++]=4,i[r++]=5,i[r++]=5,i[r++]=7,i[r++]=7,i[r++]=6,i[r++]=6,i[r++]=4,i[r++]=0,i[r++]=4,i[r++]=5,i[r++]=1,i[r++]=2,i[r++]=6,i[r++]=7,i[r]=3,t=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(M.unitCubeElementsKey,t,2*i.length)}return t},M.prototype.unitQuadBuffer=function(){var t=this.gpuResourceCache.resourceForKey(M.unitQuadKey);if(!t){var e=this.currentGlContext,i=new Float32Array(8);i[0]=0,i[1]=1,i[2]=0,i[3]=0,i[4]=1,i[5]=1,i[6]=1,i[7]=0,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(M.unitQuadKey,t,4*i.length)}return t},M.prototype.unitQuadBuffer3=function(){var t=this.gpuResourceCache.resourceForKey(M.unitQuadKey3);if(!t){var e=this.currentGlContext,i=new Float32Array(12);i[0]=0,i[1]=1,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=1,i[7]=1,i[8]=0,i[9]=1,i[10]=0,i[11]=0,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(M.unitQuadKey3,t,4*i.length)}return t},M.prototype.surfacePointForMode=function(e,i,r,o,n){if(!n)throw new t(u.logMessage(u.LEVEL_SEVERE,"DrawContext","surfacePointForMode","missingResult"));if(this.terrain)this.terrain.surfacePointForMode(e,i,r,o,n);else{var s=r+this.globe.elevationAtLocation(e,i)*this.verticalExaggeration;this.globe.computePointFromPosition(e,i,s,n)}return n},M}),i("globe/EarthElevationModel",["../geom/Location","../geom/Sector","../globe/ElevationModel","../util/WmsUrlBuilder"],function(t,e,i,r){"use strict";var o=function(){i.call(this,e.FULL_SPHERE,new t(45,45),12,"application/bil16","EarthElevations256",256,256),this.displayName="Earth Elevation Model",this.minElevation=-11e3,this.maxElevation=8850,this.pixelIsPoint=!1,this.urlBuilder=new r("http://worldwind26.arc.nasa.gov/elev","GEBCO,aster_v2,USGS-NED","","1.3.0")};return o.prototype=Object.create(i.prototype),o}),i("globe/EarthRestElevationModel",["../geom/Location","../geom/Sector","../globe/ElevationModel","../util/LevelRowColumnUrlBuilder"],function(t,e,i,r){"use strict";var o=function(o,n,s){i.call(this,e.FULL_SPHERE,new t(60,60),5,"application/bil16","EarthElevations",512,512),this.displayName=s,this.minElevation=-11e3,this.maxElevation=8850,this.urlBuilder=new r(o,n)};return o.prototype=Object.create(i.prototype),o}),i("layer/FrameStatisticsLayer",["../error/ArgumentError","../util/Color","../util/Font","../layer/Layer","../util/Logger","../util/Offset","../shapes/ScreenText","../shapes/TextAttributes"],function(t,e,i,r,o,n,s,a){"use strict";var h=function(h){function l(t,e){c.handleRedraw(t,e)}if(!h)throw new t(o.logMessage(o.LEVEL_SEVERE,"FrameStatisticsLayer","constructor","missingWorldWindow"));r.call(this,"Frame Statistics"),this.pickEnabled=!1;var u=new a(null);u.color=e.GREEN,u.font=new i(12),u.offset=new n(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,1),this.frameTime=new s(new n(WorldWind.OFFSET_PIXELS,5,WorldWind.OFFSET_INSET_PIXELS,5)," "),this.frameTime.attributes=u,this.frameRate=new s(new n(WorldWind.OFFSET_PIXELS,5,WorldWind.OFFSET_INSET_PIXELS,25)," "),this.frameRate.attributes=u;var c=this;h.redrawCallbacks.push(l)};return h.prototype=Object.create(r.prototype),h.prototype.doRender=function(t){this.frameRate.render(t),this.frameTime.render(t),this.inCurrentFrame=!0},h.prototype.handleRedraw=function(t,e){if(e==WorldWind.BEFORE_REDRAW){var i=t.frameStatistics;this.frameTime.text="Frame time  "+i.frameTimeAverage.toFixed(0)+" ms  ("+i.frameTimeMin.toFixed(0)+" - "+i.frameTimeMax.toFixed(0)+")",this.frameRate.text="Frame rate  "+i.frameRateAverage.toFixed(0)+" fps"}},h}),i("shapes/AbstractShape",["../error/ArgumentError","../util/Logger","../geom/Matrix","../cache/MemoryCache","../render/Renderable","../shapes/ShapeAttributes","../error/UnsupportedOperationError","../geom/Vec3"],function(t,e,i,r,o,n,s,a){"use strict";var h=function(t){o.call(this),this._attributes=t?t:new n(null),this._highlightAttributes=null,this.highlighted=!1,this._altitudeMode=WorldWind.ABSOLUTE,this.referencePosition=null,this.shapeDataCache=new r(3,2),this.currentData=null,this.activeAttributes=null,this.expirationInterval=2e3,this.useSurfaceShapeFor2D=!1,this.scratchMatrix=i.fromIdentity()};return h.prototype=Object.create(o.prototype),Object.defineProperties(h.prototype,{attributes:{get:function(){return this._attributes},set:function(t){this._attributes=t,this.surfaceShape&&(this.surfaceShape.attributes=this._attributes)}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(t){this._highlightAttributes=t,this.surfaceShape&&(this.surfaceShape.highlightAttributes=this._highlightAttributes)}},altitudeMode:{get:function(){return this._altitudeMode},set:function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"AbstractShape","altitudeMode","missingAltitudeMode"));this._altitudeMode=i,this.reset()}}}),h.prototype.reset=function(){this.shapeDataCache.clear(!1),this.surfaceShape=null},h.prototype.updateSurfaceShape=function(){this.surfaceShape.displayName=this.displayName,this.surfaceShape.highlighted=this.highlighted,this.surfaceShape.enabled=this.enabled,this.surfaceShape.pathType=this.pathType,this.surfaceShape.pickDelegate=this.pickDelegate?this.pickDelegate:this},h.prototype.createSurfaceShape=function(){return null},h.prototype.render=function(t){if(this.enabled&&t.accumulateOrderedRenderables){if(t.globe.is2D()&&this.useSurfaceShapeFor2D&&(this.surfaceShape||(this.surfaceShape=this.createSurfaceShape(),this.surfaceShape&&(this.surfaceShape.attributes=this._attributes,this.surfaceShape.highlightAttributes=this._highlightAttributes)),this.surfaceShape))return this.updateSurfaceShape(),void this.surfaceShape.render(t);if((t.terrain||this.altitudeMode==WorldWind.ABSOLUTE)&&(this.establishCurrentData(t),(!t.globe.projectionLimits||this.isWithinProjectionLimits(t))&&(!this.currentData.extent||this.intersectsFrustum(t))&&(this.determineActiveAttributes(t),this.activeAttributes))){var e=this.makeOrderedRenderable(t);if(e){if(!this.intersectsFrustum(t))return;if(t.isSmall(this.currentData.extent,1))return;e.layer=t.currentLayer,t.addOrderedRenderable(e)}}}},h.prototype.renderOrdered=function(t){this.currentData=this.shapeDataCache.entryForKey(t.globeStateKey),this.beginDrawing(t);try{this.doRenderOrdered(t)}finally{this.endDrawing(t)}},h.prototype.makeOrderedRenderable=function(t){var e=this.doMakeOrderedRenderable(t);return this.currentData.verticalExaggeration=t.verticalExaggeration,e},h.prototype.doMakeOrderedRenderable=function(t){throw new s(e.logMessage(e.LEVEL_SEVERE,"AbstractShape","makeOrderedRenderable","abstractInvocation"))},h.prototype.doRenderOrdered=function(t){throw new s(e.logMessage(e.LEVEL_SEVERE,"AbstractShape","doRenderOrdered","abstractInvocation"))},h.prototype.beginDrawing=function(t){},h.prototype.endDrawing=function(t){},h.prototype.intersectsFrustum=function(t){return this.currentData&&this.currentData.extent?t.pickingMode?this.currentData.extent.intersectsFrustum(t.pickFrustum):this.currentData.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates):!0},h.prototype.establishCurrentData=function(t){this.currentData=this.shapeDataCache.entryForKey(t.globeStateKey),this.currentData||(this.currentData=this.createShapeDataObject(),this.resetExpiration(this.currentData),this.shapeDataCache.putEntry(t.globeStateKey,this.currentData,1)),this.currentData.isExpired=!this.isShapeDataCurrent(t,this.currentData)},h.prototype.createShapeDataObject=function(){return{transformationMatrix:i.fromIdentity(),referencePoint:new a(0,0,0)}},h.prototype.resetExpiration=function(t){t.expiryTime=Date.now()+this.expirationInterval+1e3*Math.random()},h.prototype.isShapeDataCurrent=function(t,e){return e.verticalExaggeration===t.verticalExaggeration&&e.expiryTime>Date.now()},h.prototype.determineActiveAttributes=function(t){this.highlighted&&this._highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this._attributes},h.prototype.isWithinProjectionLimits=function(t){return!0},h.prototype.applyMvpMatrix=function(t){this.scratchMatrix.copy(t.navigatorState.modelviewProjection),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),t.currentProgram.loadModelviewProjection(t.currentGlContext,this.scratchMatrix)},h.prototype.applyMvpMatrixForOutline=function(t){this.scratchMatrix.copy(t.navigatorState.projection),this.scratchMatrix.offsetProjectionDepth(-.001),this.scratchMatrix.multiplyMatrix(t.navigatorState.modelview),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),t.currentProgram.loadModelviewProjection(t.currentGlContext,this.scratchMatrix)},h}),i("shapes/AbstractMesh",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Line","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f){"use strict";var m=function(e){t.call(this,e),this.pickTransparentImagePixels=!0,this._altitudeScale=1};return m.prototype=Object.create(t.prototype),Object.defineProperties(m.prototype,{altitudeScale:{get:function(){return this._altitudeScale},set:function(t){this._altitudeScale=t,this.reset()}}}),m.prototype.mustGenerateGeometry=function(t){return this.currentData.meshPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior?!0:this.activeAttributes.applyLighting&&!this.currentData.normals?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},m.prototype.doMakeOrderedRenderable=function(t){if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(t))return this;var e=this.currentData,i=e.referencePoint;return t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude*this._altitudeScale,this._altitudeMode,i),e.transformationMatrix.setToTranslation(i[0],i[1],i[2]),e.meshPoints=this.computeMeshPoints(t,e),e.refreshVertexBuffer=!0,this.activeAttributes.imageSource&&!this.texCoords&&(this.texCoords=this.computeTexCoords(),this.texCoords&&(e.refreshTexCoordBuffer=!0)),this.meshIndices||(this.meshIndices=this.computeMeshIndices(),e.refreshMeshIndices=!0),this.meshOutlineIndices||(this.meshOutlineIndices=this.computeOutlineIndices(),this.meshOutlineIndices&&(e.refreshOutlineIndices=!0)),this.activeAttributes.applyLighting&&this.computeNormals(e),e.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(e),e.extent||(e.extent=new r),e.extent.setToPoints(e.meshPoints),e.extent.translate(e.referencePoint),this},m.prototype.computeMeshPoints=function(t,e){throw new UnsupportedOperationError(h.logMessage(h.LEVEL_SEVERE,"AbstractMesh","computeMeshPoints","abstractInvocation"))},m.prototype.computeTexCoords=function(){return null},m.prototype.computeMeshIndices=function(t){throw new UnsupportedOperationError(h.logMessage(h.LEVEL_SEVERE,"AbstractMesh","computeMeshIndices","abstractInvocation"))},m.prototype.computeOutlineIndices=function(t){},m.prototype.computeNormals=function(t){for(var e,i=new Float32Array(t.meshPoints.length),r=this.meshIndices,o=t.meshPoints,n=[],s=[new p(0,0,0),new p(0,0,0),new p(0,0,0)],a=0;a<r.length;a+=3){for(var h=0;3>h;h++)e=r[a+h],s[h].set(o[3*e],o[3*e+1],o[3*e+2]);var l=p.computeTriangleNormal(s[0],s[1],s[2]);for(h=0;3>h;h++)e=r[a+h],n[e]||(n[e]=[]),n[e].push(l)}for(l=new p(0,0,0),a=0;a<n.length;a++)n[a]?(p.average(n[a],l),l.normalize(),i[3*a]=l[0],i[3*a+1]=l[1],i[3*a+2]=l[2]):(i[3*a]=0,i[3*a+1]=0,i[3*a+2]=0);t.normals=i,t.refreshNormalsBuffer=!0},m.prototype.doRenderOrdered=function(t){var e,i,r,o,n,s=t.currentGlContext,a=t.currentProgram,h=this.currentData,l=this.texCoords&&!!this.activeAttributes.imageSource;if(t.pickingMode&&(o=t.uniquePickColor()),h.pointsVboCacheKey||(h.pointsVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(h.pointsVboCacheKey),e||(e=s.createBuffer(),t.gpuResourceCache.putResource(h.pointsVboCacheKey,e,4*h.meshPoints.length),h.refreshVertexBuffer=!0),s.bindBuffer(s.ARRAY_BUFFER,e),h.refreshVertexBuffer&&(s.bufferData(s.ARRAY_BUFFER,h.meshPoints,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),h.refreshVertexBuffer=!1),s.vertexAttribPointer(a.vertexPointLocation,3,s.FLOAT,!1,0,0),a.loadTextureEnabled(s,!1),this.activeAttributes.drawInterior){var c=!t.pickingMode&&h.normals&&this.activeAttributes.applyLighting;this.applyMvpMatrix(t),h.meshIndicesVboCacheKey||(h.meshIndicesVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(h.meshIndicesVboCacheKey),e||(e=s.createBuffer(),t.gpuResourceCache.putResource(h.meshIndicesVboCacheKey,e,2*this.meshIndices.length),h.refreshMeshIndices=!0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),h.refreshMeshIndices&&(s.bufferData(s.ELEMENT_ARRAY_BUFFER,this.meshIndices,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),h.refreshMeshIndices=!1),r=this.activeAttributes.interiorColor,i=r.alpha*t.currentLayer.opacity,s.depthMask(i>=1||t.pickingMode),a.loadColor(s,t.pickingMode?o:r),a.loadOpacity(s,t.pickingMode?i>0?1:0:i),!l||t.pickingMode&&this.pickTransparentImagePixels||(this.activeTexture=t.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource),this.activeTexture||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.activeAttributes.imageSource)),n=this.activeTexture&&this.activeTexture.bind(t),n&&(h.texCoordsVboCacheKey||(h.texCoordsVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(h.texCoordsVboCacheKey),e||(e=s.createBuffer(),t.gpuResourceCache.putResource(h.texCoordsVboCacheKey,e,4*this.texCoords.length),h.refreshTexCoordBuffer=!0),s.bindBuffer(s.ARRAY_BUFFER,e),h.refreshTexCoordBuffer&&(s.bufferData(s.ARRAY_BUFFER,this.texCoords,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),h.refreshTexCoordBuffer=!1),a.loadTextureEnabled(s,!0),s.enableVertexAttribArray(a.vertexTexCoordLocation),s.vertexAttribPointer(a.vertexTexCoordLocation,2,s.FLOAT,!1,0,0),a.loadTextureUnit(s,s.TEXTURE0),a.loadModulateColor(s,t.pickingMode))),c&&(a.loadApplyLighting(s,!0),h.normalsVboCacheKey||(h.normalsVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(h.normalsVboCacheKey),e||(e=s.createBuffer(),t.gpuResourceCache.putResource(h.normalsVboCacheKey,e,4*h.normals.length),h.refreshNormalsBuffer=!0),s.bindBuffer(s.ARRAY_BUFFER,e),h.refreshNormalsBuffer&&(s.bufferData(s.ARRAY_BUFFER,h.normals,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),h.refreshNormalsBuffer=!1),s.enableVertexAttribArray(a.normalVectorLocation),s.vertexAttribPointer(a.normalVectorLocation,3,s.FLOAT,!1,0,0)),s.drawElements(s.TRIANGLES,this.meshIndices.length,s.UNSIGNED_SHORT,0),l&&s.disableVertexAttribArray(a.vertexTexCoordLocation),c&&(a.loadApplyLighting(s,!1),s.disableVertexAttribArray(a.normalVectorLocation))}if(this.activeAttributes.drawOutline&&this.meshOutlineIndices&&(a.loadTextureEnabled(s,!1),s.disableVertexAttribArray(a.vertexTexCoordLocation),this.applyMvpMatrixForOutline(t),r=this.activeAttributes.outlineColor,i=r.alpha*t.currentLayer.opacity,s.depthMask(i>=1||t.pickingMode),a.loadColor(s,t.pickingMode?o:r),a.loadOpacity(s,t.pickingMode?1:i),s.lineWidth(this.activeAttributes.outlineWidth),h.outlineIndicesVboCacheKey||(h.outlineIndicesVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(h.outlineIndicesVboCacheKey),e||(e=s.createBuffer(),t.gpuResourceCache.putResource(h.outlineIndicesVboCacheKey,e,2*this.meshOutlineIndices.length),h.refreshOutlineIndices=!0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),h.refreshOutlineIndices&&(s.bufferData(s.ELEMENT_ARRAY_BUFFER,this.meshOutlineIndices,s.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),h.refreshOutlineIndices=!1),s.drawElements(s.LINE_STRIP,this.meshOutlineIndices.length,s.UNSIGNED_SHORT,0)),t.pickingMode){var d=this.computePickPosition(t),g=new u(o,this.pickDelegate?this.pickDelegate:this,d,t.currentLayer,!1);t.resolvePick(g)}},m.prototype.computePickPosition=function(t){var e=this.currentData,i=t.navigatorState.rayFromScreenPoint(t.pickPoint),r=new p(i.origin[0],i.origin[1],i.origin[2]).subtract(e.referencePoint),o=new s(r,i.direction),n=[];if(f.computeIndexedTrianglesIntersection(o,e.meshPoints,this.meshIndices,n)){var a=n[0];if(n.length>1)for(var h=a.distanceToSquared(t.navigatorState.eyePoint),l=1;l<n.length;l++){var u=n[l].distanceToSquared(t.navigatorState.eyePoint);h>u&&(h=u,a=n[l])}var d=new c(0,0,0);return t.globe.computePositionFromPoint(a[0]+e.referencePoint[0],a[1]+e.referencePoint[1],a[2]+e.referencePoint[2],d),d.altitude/=this._altitudeScale,d}return null},m.prototype.beginDrawing=function(t){var e=t.currentGlContext;if(this.activeAttributes.drawInterior){e.disable(e.CULL_FACE),t.findAndBindProgram(i);var r=!t.pickMode&&this.currentData.normals&&this.activeAttributes.applyLighting;r&&t.currentProgram.loadModelviewInverse(e,t.navigatorState.modelviewNormalTransform)}e.enableVertexAttribArray(t.currentProgram.vertexPointLocation)},m.prototype.endDrawing=function(t){var e=t.currentGlContext;e.disableVertexAttribArray(t.currentProgram.vertexPointLocation),e.depthMask(!0),e.lineWidth(1),e.enable(e.CULL_FACE)},m}),i("shapes/SurfacePolygon",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(t,e,i,r){"use strict";var o=function(i,o){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfacePolygon","constructor","The specified boundary array is null or undefined."));r.call(this,o);var n=null;if(i.length>0&&i[0].latitude)n=i.slice(0),n.push(i[0]),this._boundariesSpecifiedSimply=!0;else if(i.length>1){var s=null;n=[];for(var a=0;a<i.length;a++){for(var h=i[a][0],l=0;l<i[a].length;l++)n.push(i[a][l]);n.push(h),s?n.push(s):s=n[n.length-1]}}else 1===i.length&&(n=i[0].slice(0),n.push(i[0][0]));this._boundaries=n};return o.prototype=Object.create(r.prototype),Object.defineProperties(o.prototype,{}),o.staticStateKey=function(t){var e=r.staticStateKey(t);return e},o.prototype.computeStateKey=function(){return o.staticStateKey(this)},o}),i("shapes/GeographicMesh",["../shapes/AbstractMesh","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p){"use strict";var f=function(i,r){if(!i)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","constructor","missingPositions"));if(i.length<2||i[0].length<2)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","constructor","Number of positions is insufficient."));if(i.length*i[0].length>65536)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","constructor","Too many positions. Must be fewer than 65536. Try using multiple meshes."));for(var o=i[0].length,n=1;n<i.length;n++)if(i[n].length!==o)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","constructor","Array lengths are inconsistent."));var s=i.length,h=i[0].length;t.call(this,r),this.pickTransparentImagePixels=!0,this._positions=i,this._altitudeScale=1,this.numRows=s,this.numColumns=h,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._positions)};return f.prototype=Object.create(t.prototype),Object.defineProperties(f.prototype,{positions:{get:function(){return this._positions},set:function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","positions","missingPositions"));if(t.length<2||t[0].length<2)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","positions","Number of positions is insufficient."));for(var i=t[0].length,r=1;r<t.length;r++)if(t[r].length!==i)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","positions","Array lengths are inconsistent."));this.numRows=t.length,this.numColumns=t[0].length,this._positions=t,this.referencePosition=this.determineReferencePosition(this._positions),this.reset(),this.meshIndices=null,this.outlineIndices=null}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(t){if(t&&t.length!=this.numRows)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","textureCoordinates","Number of texture coordinate rows is inconsistent with the currently specified positions."));for(var i=0;i<this.numRows;i++)if(t[i].length!==this.numColumns)throw new e(a.logMessage(a.LEVEL_SEVERE,"GeographicMesh","textureCoordinates","Texture coordinate row lengths are inconsistent with the currently specified positions."));this._textureCoordinates=t,this.reset(),this.texCoords=null}}}),f.makeGridIndices=function(t,e){for(var i=[],r=0,o=0;t-1>o;o++)for(var n=0;e-1>n;n++){var s=o*e+n;i[r++]=s,i[r++]=s+1,i[r++]=s+e,i[r++]=s+1,i[r++]=s+1+e,i[r++]=s+e}return i},f.prototype.determineReferencePosition=function(t){return t[0][0]},f.prototype.createSurfaceShape=function(){for(var t=[],e=0;e<this.numColumns;e++)t.push(this._positions[0][e]);for(var i=1;i<this.numRows;i++)t.push(this._positions[i][this.numColumns-1]);for(e=this.numColumns-2;e>=0;e--)t.push(this._positions[this.numRows-1][e]);for(i=this.numRows-2;i>0;i--)t.push(this._positions[i][0]);return new d(t,null)},f.prototype.computeMeshPoints=function(t,e){for(var i,r,o=Number.MAX_VALUE,n=t.navigatorState.eyePoint,s=new Float32Array(this.numRows*this.numColumns*3),a=new p(0,0,0),h=0,l=0;l<this._positions.length;l++)for(var u=0,c=this._positions[l].length;c>u;u++)i=this._positions[l][u],t.surfacePointForMode(i.latitude,i.longitude,i.altitude*this._altitudeScale,this.altitudeMode,a),r=a.distanceToSquared(n),o>r&&(o=r),a.subtract(this.currentData.referencePoint),s[h++]=a[0],s[h++]=a[1],s[h++]=a[2];return e.eyeDistance=Math.sqrt(o),s},f.prototype.computeTexCoords=function(){return this._textureCoordinates?this.computeExplicitTexCoords():this.computeImplicitTexCoords()},f.prototype.computeExplicitTexCoords=function(){for(var t=new Float32Array(2*this.numRows*this.numColumns),e=0,i=0;i<this._textureCoordinates.length;i++)for(var r=0,o=this._textureCoordinates[i].length;o>r;r++){var n=this._textureCoordinates[i][r];t[e++]=n[0],t[e++]=n[1]}return t},f.prototype.computeImplicitTexCoords=function(){for(var t=new Float32Array(2*this.numRows*this.numColumns),e=1/(this.numRows-1),i=1/(this.numColumns-1),r=0,o=0;o<this._positions.length;o++)for(var n=o===this.numRows-1?1:o*e,s=0,a=this._positions[o].length;a>s;s++)t[r++]=s===this.numColumns-1?1:s*i,t[r++]=n;return t},f.prototype.computeMeshIndices=function(){for(var t=new Uint16Array((this.numRows-1)*(this.numColumns-1)*6),e=0,i=0;i<this.numRows-1;i++)for(var r=0;r<this.numColumns-1;r++){var o=i*this.numColumns+r;t[e++]=o,t[e++]=o+1,t[e++]=o+this.numColumns,t[e++]=o+1,t[e++]=o+1+this.numColumns,t[e++]=o+this.numColumns}return t},f.prototype.computeOutlineIndices=function(){for(var t=new Uint16Array(2*this.numRows+2*this.numColumns),e=0,i=0;i<this.numColumns;i++)t[e++]=i;for(var r=1;r<this.numRows;r++)t[e++]=(r+1)*this.numColumns-1;for(i=this.numRows*this.numColumns-2;i>=(this.numRows-1)*this.numColumns;i--)t[e++]=i;for(r=this.numRows-2;r>=0;r--)t[e++]=r*this.numColumns;return t},f}),i("projections/GeographicProjection",["../error/ArgumentError","../util/Logger","../geom/Sector","../error/UnsupportedOperationError"],function(t,e,i,r){"use strict";var o=function(t,e,i){this.displayName=t||"Geographic Projection",this.continuous=e,this.projectionLimits=i};return o.prototype.geographicToCartesian=function(t,i,o,n,s,a){throw new r(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","geographicToCartesian","abstractInvocation"))},o.prototype.geographicToCartesianGrid=function(t,i,o,n,s,a,h,l){throw new r(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","geographicToCartesianGrid","abstractInvocation"))},o.prototype.cartesianToGeographic=function(t,i,o,n,s,a){throw new r(e.logMessage(e.LEVEL_SEVERE,"GeographicProjection","cartesianToGeographic","abstractInvocation"))},o.prototype.northTangentAtLocation=function(i,r,o,n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtLocation","missingResult"));return n[0]=0,n[1]=1,n[2]=0,n},o.prototype.northTangentAtPoint=function(i,r,o,n,s,a){
if(!a)throw new t(e.logMessage(e.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtPoint","missingResult"));return a[0]=0,a[1]=1,a[2]=0,a},o}),i("shapes/GeographicText",["../error/ArgumentError","../util/Logger","../shapes/Text","../geom/Vec3"],function(t,e,i,r){"use strict";var o=function(r,o){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Text","constructor","missingPosition"));i.call(this,o),this.position=r,this.declutterGroup=1};return o.placePoint=new r(0,0,0),o.prototype=Object.create(i.prototype),o.prototype.clone=function(){var t=new o(this.position,this.text);return t.copy(this),t.pickDelegate=this.pickDelegate?this.pickDelegate:this,t},o.prototype.render=function(t){(!t.globe.projectionLimits||t.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))&&i.prototype.render.call(this,t)},o.prototype.computeScreenPointAndEyeDistance=function(t){return t.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,o.placePoint),t.navigatorState.frustumInModelCoordinates.containsPoint(o.placePoint)?(this.eyeDistance=this.alwaysOnTop?0:t.navigatorState.eyePoint.distanceTo(o.placePoint),t.navigatorState.projectWithDepth(o.placePoint,this.depthOffset,this.screenPoint)?!0:!1):!1},o}),i("formats/geojson/GeoJSONConstants",[],function(){"use strict";var t=function(){};return t.FIELD_TYPE="type",t.FIELD_CRS="crs",t.FIELD_NAME="name",t.FIELD_BBOX="bbox",t.FIELD_COORDINATES="coordinates",t.FIELD_GEOMETRIES="geometries",t.FIELD_GEOMETRY="geometry",t.FIELD_PROPERTIES="properties",t.FIELD_FEATURES="features",t.FIELD_ID="id",t.TYPE_POINT="Point",t.TYPE_MULTI_POINT="MultiPoint",t.TYPE_LINE_STRING="LineString",t.TYPE_MULTI_LINE_STRING="MultiLineString",t.TYPE_POLYGON="Polygon",t.TYPE_MULTI_POLYGON="MultiPolygon",t.TYPE_GEOMETRY_COLLECTION="GeometryCollection",t.TYPE_FEATURE="Feature",t.TYPE_FEATURE_COLLECTION="FeatureCollection",t.FIELD_CRS_NAME="name",t.FIELD_CRS_LINK="link",t.WGS84_CRS="urn:ogc:def:crs:OGC:1.3:CRS84",t.EPSG4326_CRS="EPSG:4326",t}),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof i&&i.amd)i("util/proj4-src",t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.proj4=t()}}(function(){return function t(i,r,o){function n(a,h){if(!r[a]){if(!i[a]){var l="function"==typeof e&&e;if(!h&&l)return l(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=r[a]={exports:{}};i[a][0].call(u.exports,function(t){var e=i[a][1][t];return n(e?e:t)},u,u.exports,t,i,r,o)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<o.length;a++)n(o[a]);return n}({1:[function(t,e,i){function r(t,e,i){if(!(this instanceof r))return new r(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&"undefined"==typeof e){var o=t.split(",");this.x=parseFloat(o[0],10),this.y=parseFloat(o[1],10),this.z=parseFloat(o[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var o=t("mgrs");r.fromMGRS=function(t){return new r(o.toPoint(t))},r.prototype.toMGRS=function(t){return o.forward([this.x,this.y],t)},e.exports=r},{mgrs:66}],2:[function(t,e,i){function r(t,e){if(!(this instanceof r))return new r(t);e=e||function(t){if(t)throw t};var i=o(t);if("object"!=typeof i)return void e(t);var s=a(i),h=r.projections.get(s.projName);h?(n(this,s),n(this,h),this.init(),e(null,this)):e(t)}var o=t("./parseCode"),n=t("./extend"),s=t("./projections"),a=t("./deriveConstants");r.projections=s,r.projections.start(),e.exports=r},{"./deriveConstants":32,"./extend":33,"./parseCode":36,"./projections":38}],3:[function(t,e,i){e.exports=function(t,e,i){var r,o,n,s=i.x,a=i.y,h=i.z||0;for(n=0;3>n;n++)if(!e||2!==n||void 0!==i.z)switch(0===n?(r=s,o="x"):1===n?(r=a,o="y"):(r=h,o="z"),t.axis[n]){case"e":i[o]=r;break;case"w":i[o]=-r;break;case"n":i[o]=r;break;case"s":i[o]=-r;break;case"u":void 0!==i[o]&&(i.z=r);break;case"d":void 0!==i[o]&&(i.z=-r);break;default:return null}return i}},{}],4:[function(t,e,i){var r=Math.PI/2,o=t("./sign");e.exports=function(t){return Math.abs(t)<r?t:t-o(t)*Math.PI}},{"./sign":21}],5:[function(t,e,i){var r=2*Math.PI,o=3.14159265359,n=t("./sign");e.exports=function(t){return Math.abs(t)<=o?t:t-n(t)*r}},{"./sign":21}],6:[function(t,e,i){e.exports=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}},{}],7:[function(t,e,i){e.exports=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))}},{}],8:[function(t,e,i){e.exports=function(t){return.375*t*(1+.25*t*(1+.46875*t))}},{}],9:[function(t,e,i){e.exports=function(t){return.05859375*t*t*(1+.75*t)}},{}],10:[function(t,e,i){e.exports=function(t){return t*t*t*(35/3072)}},{}],11:[function(t,e,i){e.exports=function(t,e,i){var r=e*i;return t/Math.sqrt(1-r*r)}},{}],12:[function(t,e,i){e.exports=function(t,e,i,r,o){var n,s;n=t/e;for(var a=0;15>a;a++)if(s=(t-(e*n-i*Math.sin(2*n)+r*Math.sin(4*n)-o*Math.sin(6*n)))/(e-2*i*Math.cos(2*n)+4*r*Math.cos(4*n)-6*o*Math.cos(6*n)),n+=s,Math.abs(s)<=1e-10)return n;return NaN}},{}],13:[function(t,e,i){var r=Math.PI/2;e.exports=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return 0>e?-1*r:r;for(var o,n,s,a,h=Math.asin(.5*e),l=0;30>l;l++)if(n=Math.sin(h),s=Math.cos(h),a=t*n,o=Math.pow(1-a*a,2)/(2*s)*(e/(1-t*t)-n/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),h+=o,Math.abs(o)<=1e-10)return h;return NaN}},{}],14:[function(t,e,i){e.exports=function(t,e,i,r,o){return t*o-e*Math.sin(2*o)+i*Math.sin(4*o)-r*Math.sin(6*o)}},{}],15:[function(t,e,i){e.exports=function(t,e,i){var r=t*e;return i/Math.sqrt(1-r*r)}},{}],16:[function(t,e,i){var r=Math.PI/2;e.exports=function(t,e){for(var i,o,n=.5*t,s=r-2*Math.atan(e),a=0;15>=a;a++)if(i=t*Math.sin(s),o=r-2*Math.atan(e*Math.pow((1-i)/(1+i),n))-s,s+=o,Math.abs(o)<=1e-10)return s;return-9999}},{}],17:[function(t,e,i){var r=1,o=.25,n=.046875,s=.01953125,a=.01068115234375,h=.75,l=.46875,u=.013020833333333334,c=.007120768229166667,d=.3645833333333333,g=.005696614583333333,p=.3076171875;e.exports=function(t){var e=[];e[0]=r-t*(o+t*(n+t*(s+t*a))),e[1]=t*(h-t*(n+t*(s+t*a)));var i=t*t;return e[2]=i*(l-t*(u+t*c)),i*=t,e[3]=i*(d-t*g),e[4]=i*t*p,e}},{}],18:[function(t,e,i){var r=t("./pj_mlfn"),o=1e-10,n=20;e.exports=function(t,e,i){for(var s=1/(1-e),a=t,h=n;h;--h){var l=Math.sin(a),u=1-e*l*l;if(u=(r(a,l,Math.cos(a),i)-t)*(u*Math.sqrt(u))*s,a-=u,Math.abs(u)<o)return a}return a}},{"./pj_mlfn":19}],19:[function(t,e,i){e.exports=function(t,e,i,r){return i*=e,e*=e,r[0]*t-i*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}},{}],20:[function(t,e,i){e.exports=function(t,e){var i;return t>1e-7?(i=t*e,(1-t*t)*(e/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*e}},{}],21:[function(t,e,i){e.exports=function(t){return 0>t?-1:1}},{}],22:[function(t,e,i){e.exports=function(t,e){return Math.pow((1-t)/(1+t),e)}},{}],23:[function(t,e,i){e.exports=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}},{}],24:[function(t,e,i){var r=Math.PI/2;e.exports=function(t,e,i){var o=t*i,n=.5*t;return o=Math.pow((1-o)/(1+o),n),Math.tan(.5*(r-e))/o}},{}],25:[function(t,e,i){i.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},i.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},i.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},i.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},i.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},i.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},i.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},i.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},i.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},i.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},i.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},i.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},i.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},i.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},i.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},i.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],26:[function(t,e,i){i.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},i.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},i.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},i.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},i.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},i.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},i.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},i.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},i.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},i.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},i.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},i.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},i.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},i.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},i.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},i.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},i.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},i.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},i.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},i.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},i.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},i.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},i.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},i.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},i.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},i.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},i.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},i.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},i.hough={a:6378270,rf:297,ellipseName:"Hough"},i.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},i.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},i.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},i.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},i.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},i.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},i.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},i.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},i.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},i.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},i.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},i.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},i.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},i.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],27:[function(t,e,i){i.greenwich=0,i.lisbon=-9.131906111111,i.paris=2.337229166667,i.bogota=-74.080916666667,i.madrid=-3.687938888889,i.rome=12.452333333333,i.bern=7.439583333333,i.jakarta=106.807719444444,i.ferro=-17.666666666667,i.brussels=4.367975,i.stockholm=18.058277777778,i.athens=23.7163375,i.oslo=10.722916666667},{}],28:[function(t,e,i){function r(t,e,i){var r;return Array.isArray(i)?(r=a(t,e,i),3===i.length?[r.x,r.y,r.z]:[r.x,r.y]):a(t,e,i)}function o(t){return t instanceof s?t:t.oProj?t.oProj:s(t)}function n(t,e,i){t=o(t);var n,s=!1;return"undefined"==typeof e?(e=t,t=h,s=!0):("undefined"!=typeof e.x||Array.isArray(e))&&(i=e,e=t,t=h,s=!0),e=o(e),i?r(t,e,i):(n={forward:function(i){return r(t,e,i)},inverse:function(i){return r(e,t,i)}},s&&(n.oProj=e),n)}var s=t("./Proj"),a=t("./transform"),h=s("WGS84");e.exports=n},{"./Proj":2,"./transform":64}],29:[function(t,e,i){var r=Math.PI/2,o=1,n=2,s=3,a=4,h=5,l=484813681109536e-20,u=1.0026,c=.3826834323650898,d=function(t){if(!(this instanceof d))return new d(t);if(this.datum_type=a,t){if(t.datumCode&&"none"===t.datumCode&&(this.datum_type=h),t.datum_params){for(var e=0;e<t.datum_params.length;e++)t.datum_params[e]=parseFloat(t.datum_params[e]);(0!==t.datum_params[0]||0!==t.datum_params[1]||0!==t.datum_params[2])&&(this.datum_type=o),t.datum_params.length>3&&(0!==t.datum_params[3]||0!==t.datum_params[4]||0!==t.datum_params[5]||0!==t.datum_params[6])&&(this.datum_type=n,t.datum_params[3]*=l,t.datum_params[4]*=l,t.datum_params[5]*=l,t.datum_params[6]=t.datum_params[6]/1e6+1)}this.datum_type=t.grids?s:this.datum_type,this.a=t.a,this.b=t.b,this.es=t.es,this.ep2=t.ep2,this.datum_params=t.datum_params,this.datum_type===s&&(this.grids=t.grids)}};d.prototype={compare_datums:function(t){return this.datum_type!==t.datum_type?!1:this.a!==t.a||Math.abs(this.es-t.es)>5e-11?!1:this.datum_type===o?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]:this.datum_type===n?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]&&this.datum_params[3]===t.datum_params[3]&&this.datum_params[4]===t.datum_params[4]&&this.datum_params[5]===t.datum_params[5]&&this.datum_params[6]===t.datum_params[6]:this.datum_type===s||t.datum_type===s?this.nadgrids===t.nadgrids:!0},geodetic_to_geocentric:function(t){var e,i,o,n,s,a,h,l=t.x,u=t.y,c=t.z?t.z:0,d=0;if(-r>u&&u>-1.001*r)u=-r;else if(u>r&&1.001*r>u)u=r;else if(-r>u||u>r)return null;return l>Math.PI&&(l-=2*Math.PI),s=Math.sin(u),h=Math.cos(u),a=s*s,n=this.a/Math.sqrt(1-this.es*a),e=(n+c)*h*Math.cos(l),i=(n+c)*h*Math.sin(l),o=(n*(1-this.es)+c)*s,t.x=e,t.y=i,t.z=o,d},geocentric_to_geodetic:function(t){var e,i,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_=1e-12,v=_*_,L=30,S=t.x,T=t.y,b=t.z?t.z:0;if(p=!1,e=Math.sqrt(S*S+T*T),i=Math.sqrt(S*S+T*T+b*b),e/this.a<_){if(p=!0,m=0,i/this.a<_)return E=r,void(y=-this.b)}else m=Math.atan2(T,S);o=b/i,n=e/i,s=1/Math.sqrt(1-this.es*(2-this.es)*n*n),l=n*(1-this.es)*s,u=o*s,f=0;do f++,h=this.a/Math.sqrt(1-this.es*u*u),y=e*l+b*u-h*(1-this.es*u*u),a=this.es*h/(h+y),s=1/Math.sqrt(1-a*(2-a)*n*n),c=n*(1-a)*s,d=o*s,g=d*l-c*u,l=c,u=d;while(g*g>v&&L>f);return E=Math.atan(d/Math.abs(c)),t.x=m,t.y=E,t.z=y,t},geocentric_to_geodetic_noniter:function(t){var e,i,o,n,s,a,h,l,d,g,p,f,m,E,y,_,v,L=t.x,S=t.y,T=t.z?t.z:0;if(L=parseFloat(L),S=parseFloat(S),T=parseFloat(T),v=!1,0!==L)e=Math.atan2(S,L);else if(S>0)e=r;else if(0>S)e=-r;else if(v=!0,e=0,T>0)i=r;else{if(!(0>T))return i=r,void(o=-this.b);i=-r}return s=L*L+S*S,n=Math.sqrt(s),a=T*u,l=Math.sqrt(a*a+s),g=a/l,f=n/l,p=g*g*g,h=T+this.b*this.ep2*p,_=n-this.a*this.es*f*f*f,d=Math.sqrt(h*h+_*_),m=h/d,E=_/d,y=this.a/Math.sqrt(1-this.es*m*m),o=E>=c?n/E-y:-c>=E?n/-E-y:T/m+y*(this.es-1),v===!1&&(i=Math.atan(m/E)),t.x=e,t.y=i,t.z=o,t},geocentric_to_wgs84:function(t){if(this.datum_type===o)t.x+=this.datum_params[0],t.y+=this.datum_params[1],t.z+=this.datum_params[2];else if(this.datum_type===n){var e=this.datum_params[0],i=this.datum_params[1],r=this.datum_params[2],s=this.datum_params[3],a=this.datum_params[4],h=this.datum_params[5],l=this.datum_params[6],u=l*(t.x-h*t.y+a*t.z)+e,c=l*(h*t.x+t.y-s*t.z)+i,d=l*(-a*t.x+s*t.y+t.z)+r;t.x=u,t.y=c,t.z=d}},geocentric_from_wgs84:function(t){if(this.datum_type===o)t.x-=this.datum_params[0],t.y-=this.datum_params[1],t.z-=this.datum_params[2];else if(this.datum_type===n){var e=this.datum_params[0],i=this.datum_params[1],r=this.datum_params[2],s=this.datum_params[3],a=this.datum_params[4],h=this.datum_params[5],l=this.datum_params[6],u=(t.x-e)/l,c=(t.y-i)/l,d=(t.z-r)/l;t.x=u+h*c-a*d,t.y=-h*u+c+s*d,t.z=a*u-s*c+d}}},e.exports=d},{}],30:[function(t,e,i){var r=1,o=2,n=3,s=5,a=6378137,h=.006694379990141316;e.exports=function(t,e,i){function l(t){return t===r||t===o}var u,c,d;if(t.compare_datums(e))return i;if(t.datum_type===s||e.datum_type===s)return i;var g=t.a,p=t.es,f=e.a,m=e.es,E=t.datum_type;if(E===n)if(0===this.apply_gridshift(t,0,i))t.a=a,t.es=h;else{if(!t.datum_params)return t.a=g,t.es=t.es,i;for(u=1,c=0,d=t.datum_params.length;d>c;c++)u*=t.datum_params[c];if(0===u)return t.a=g,t.es=t.es,i;E=t.datum_params.length>3?o:r}return e.datum_type===n&&(e.a=a,e.es=h),(t.es!==e.es||t.a!==e.a||l(E)||l(e.datum_type))&&(t.geodetic_to_geocentric(i),l(t.datum_type)&&t.geocentric_to_wgs84(i),l(e.datum_type)&&e.geocentric_from_wgs84(i),e.geocentric_to_geodetic(i)),e.datum_type===n&&this.apply_gridshift(e,1,i),t.a=g,t.es=p,e.a=f,e.es=m,i}},{}],31:[function(t,e,i){function r(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?r[t]=n(arguments[1]):r[t]=s(arguments[1]):r[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?r.apply(e,t):r(t)});if("string"==typeof t){if(t in r)return r[t]}else"EPSG"in t?r["EPSG:"+t.EPSG]=t:"ESRI"in t?r["ESRI:"+t.ESRI]=t:"IAU2000"in t?r["IAU2000:"+t.IAU2000]=t:console.log(t);return}}var o=t("./global"),n=t("./projString"),s=t("./wkt");o(r),e.exports=r},{"./global":34,"./projString":37,"./wkt":65}],32:[function(t,e,i){var r=t("./constants/Datum"),o=t("./constants/Ellipsoid"),n=t("./extend"),s=t("./datum"),a=1e-10,h=.16666666666666666,l=.04722222222222222,u=.022156084656084655;e.exports=function(t){if(t.datumCode&&"none"!==t.datumCode){var e=r[t.datumCode];e&&(t.datum_params=e.towgs84?e.towgs84.split(","):null,t.ellps=e.ellipse,t.datumName=e.datumName?e.datumName:t.datumCode)}if(!t.a){var i=o[t.ellps]?o[t.ellps]:o.WGS84;n(t,i)}return t.rf&&!t.b&&(t.b=(1-1/t.rf)*t.a),(0===t.rf||Math.abs(t.a-t.b)<a)&&(t.sphere=!0,t.b=t.a),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=(t.a2-t.b2)/t.a2,t.e=Math.sqrt(t.es),t.R_A&&(t.a*=1-t.es*(h+t.es*(l+t.es*u)),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=0),t.ep2=(t.a2-t.b2)/t.b2,t.k0||(t.k0=1),t.axis||(t.axis="enu"),t.datum||(t.datum=s(t)),t}},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":29,"./extend":33}],33:[function(t,e,i){e.exports=function(t,e){t=t||{};var i,r;if(!e)return t;for(r in e)i=e[r],void 0!==i&&(t[r]=i);return t}},{}],34:[function(t,e,i){e.exports=function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}},{}],35:[function(t,e,i){var r=t("./core");r.defaultDatum="WGS84",r.Proj=t("./Proj"),r.WGS84=new r.Proj("WGS84"),r.Point=t("./Point"),r.toPoint=t("./common/toPoint"),r.defs=t("./defs"),r.transform=t("./transform"),r.mgrs=t("mgrs"),r.version=t("../package.json").version,t("./includedProjections")(r),e.exports=r},{"../package.json":67,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":28,"./defs":31,"./includedProjections":"gWUPNW","./transform":64,mgrs:66}],36:[function(t,e,i){function r(t){return"string"==typeof t}function o(t){return t in h}function n(t){var e=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];return e.reduce(function(e,i){return e+1+t.indexOf(i)},0)}function s(t){return"+"===t[0]}function a(t){return r(t)?o(t)?h[t]:n(t)?l(t):s(t)?u(t):void 0:t}var h=t("./defs"),l=t("./wkt"),u=t("./projString");e.exports=a},{"./defs":31,"./projString":37,"./wkt":65}],37:[function(t,e,i){var r=.017453292519943295,o=t("./constants/PrimeMeridian");e.exports=function(t){var e={},i={};t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).forEach(function(t){var e=t.split("=");e.push(!0),i[e[0].toLowerCase()]=e[1]});var n,s,a,h={proj:"projName",datum:"datumCode",rf:function(t){e.rf=parseFloat(t)},lat_0:function(t){e.lat0=t*r},lat_1:function(t){e.lat1=t*r},lat_2:function(t){e.lat2=t*r},lat_ts:function(t){e.lat_ts=t*r},lon_0:function(t){e.long0=t*r},lon_1:function(t){e.long1=t*r},lon_2:function(t){e.long2=t*r},alpha:function(t){e.alpha=parseFloat(t)*r},lonc:function(t){e.longc=t*r},x_0:function(t){e.x0=parseFloat(t)},y_0:function(t){e.y0=parseFloat(t)},k_0:function(t){e.k0=parseFloat(t)},k:function(t){e.k0=parseFloat(t)},a:function(t){e.a=parseFloat(t)},b:function(t){e.b=parseFloat(t)},r_a:function(){e.R_A=!0},zone:function(t){e.zone=parseInt(t,10)},south:function(){e.utmSouth=!0},towgs84:function(t){e.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){e.to_meter=parseFloat(t)},from_greenwich:function(t){e.from_greenwich=t*r},pm:function(t){e.from_greenwich=(o[t]?o[t]:parseFloat(t))*r},nadgrids:function(t){"@null"===t?e.datumCode="none":e.nadgrids=t},axis:function(t){var i="ewnsud";3===t.length&&-1!==i.indexOf(t.substr(0,1))&&-1!==i.indexOf(t.substr(1,1))&&-1!==i.indexOf(t.substr(2,1))&&(e.axis=t)}};for(n in i)s=i[n],n in h?(a=h[n],"function"==typeof a?a(s):e[a]=s):e[n]=s;return"string"==typeof e.datumCode&&"WGS84"!==e.datumCode&&(e.datumCode=e.datumCode.toLowerCase()),e}},{"./constants/PrimeMeridian":27}],38:[function(t,e,i){function r(t,e){var i=s.length;return t.names?(s[i]=t,t.names.forEach(function(t){n[t.toLowerCase()]=i}),this):(console.log(e),!0)}var o=[t("./projections/merc"),t("./projections/longlat")],n={},s=[];i.add=r,i.get=function(t){if(!t)return!1;var e=t.toLowerCase();return"undefined"!=typeof n[e]&&s[n[e]]?s[n[e]]:void 0},i.start=function(){o.forEach(r)}},{"./projections/longlat":50,"./projections/merc":51}],39:[function(t,e,i){var r=1e-10,o=t("../common/msfnz"),n=t("../common/qsfnz"),s=t("../common/adjust_lon"),a=t("../common/asinz");i.init=function(){Math.abs(this.lat1+this.lat2)<r||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=o(this.e3,this.sin_po,this.cos_po),this.qs1=n(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=o(this.e3,this.sin_po,this.cos_po),this.qs2=n(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=n(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>r?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},i.forward=function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var r=n(this.e3,this.sin_phi,this.cos_phi),o=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*s(e-this.long0),h=o*Math.sin(a)+this.x0,l=this.rh-o*Math.cos(a)+this.y0;return t.x=h,t.y=l,t},i.inverse=function(t){var e,i,r,o,n,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),o=0,0!==e&&(o=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,i)),n=s(o/this.ns0+this.long0),t.x=n,t.y=a,t},i.phi1z=function(t,e){var i,o,n,s,h,l=a(.5*e);if(r>t)return l;for(var u=t*t,c=1;25>=c;c++)if(i=Math.sin(l),o=Math.cos(l),n=t*i,s=1-n*n,h=.5*s*s/o*(e/(1-u)-i/s+.5/t*Math.log((1-n)/(1+n))),l+=h,Math.abs(h)<=1e-7)return l;return null},i.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],40:[function(t,e,i){var r=t("../common/adjust_lon"),o=Math.PI/2,n=1e-10,s=t("../common/mlfn"),a=t("../common/e0fn"),h=t("../common/e1fn"),l=t("../common/e2fn"),u=t("../common/e3fn"),c=t("../common/gN"),d=t("../common/asinz"),g=t("../common/imlfn");i.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},i.forward=function(t){var e,i,d,g,p,f,m,E,y,_,v,L,S,T,b,w,M,R,x,C,A,P,I,N=t.x,O=t.y,V=Math.sin(t.y),D=Math.cos(t.y),F=r(N-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=n?(t.x=this.x0+this.a*(o-O)*Math.sin(F),t.y=this.y0-this.a*(o-O)*Math.cos(F),t):Math.abs(this.sin_p12+1)<=n?(t.x=this.x0+this.a*(o+O)*Math.sin(F),t.y=this.y0+this.a*(o+O)*Math.cos(F),t):(R=this.sin_p12*V+this.cos_p12*D*Math.cos(F),w=Math.acos(R),M=w/Math.sin(w),t.x=this.x0+this.a*M*D*Math.sin(F),t.y=this.y0+this.a*M*(this.cos_p12*V-this.sin_p12*D*Math.cos(F)),t):(e=a(this.es),i=h(this.es),d=l(this.es),g=u(this.es),Math.abs(this.sin_p12-1)<=n?(p=this.a*s(e,i,d,g,o),f=this.a*s(e,i,d,g,O),t.x=this.x0+(p-f)*Math.sin(F),t.y=this.y0-(p-f)*Math.cos(F),t):Math.abs(this.sin_p12+1)<=n?(p=this.a*s(e,i,d,g,o),f=this.a*s(e,i,d,g,O),t.x=this.x0+(p+f)*Math.sin(F),t.y=this.y0+(p+f)*Math.cos(F),t):(m=V/D,E=c(this.a,this.e,this.sin_p12),y=c(this.a,this.e,V),_=Math.atan((1-this.es)*m+this.es*E*this.sin_p12/(y*D)),v=Math.atan2(Math.sin(F),this.cos_p12*Math.tan(_)-this.sin_p12*Math.cos(F)),x=0===v?Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.abs(Math.abs(v)-Math.PI)<=n?-Math.asin(this.cos_p12*Math.sin(_)-this.sin_p12*Math.cos(_)):Math.asin(Math.sin(F)*Math.cos(_)/Math.sin(v)),L=this.e*this.sin_p12/Math.sqrt(1-this.es),S=this.e*this.cos_p12*Math.cos(v)/Math.sqrt(1-this.es),T=L*S,b=S*S,C=x*x,A=C*x,P=A*x,I=P*x,w=E*x*(1-C*b*(1-b)/6+A/8*T*(1-2*b)+P/120*(b*(4-7*b)-3*L*L*(1-7*b))-I/48*T),t.x=this.x0+w*Math.sin(v),t.y=this.y0+w*Math.cos(v),t))},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,p,f,m,E,y,_,v,L,S,T,b,w,M,R,x,C,A,P,I,N,O;if(this.sphere){if(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*o*this.a)return;return i=e/this.a,p=Math.sin(i),f=Math.cos(i),m=this.long0,Math.abs(e)<=n?E=this.lat0:(E=d(f*this.sin_p12+t.y*p*this.cos_p12/e),y=Math.abs(this.lat0)-o,m=r(Math.abs(y)<=n?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*p,e*this.cos_p12*f-t.y*this.sin_p12*p))),t.x=m,t.y=E,t}return _=a(this.es),v=h(this.es),L=l(this.es),S=u(this.es),Math.abs(this.sin_p12-1)<=n?(T=this.a*s(_,v,L,S,o),e=Math.sqrt(t.x*t.x+t.y*t.y),b=T-e,E=g(b/this.a,_,v,L,S),m=r(this.long0+Math.atan2(t.x,-1*t.y)),t.x=m,t.y=E,t):Math.abs(this.sin_p12+1)<=n?(T=this.a*s(_,v,L,S,o),e=Math.sqrt(t.x*t.x+t.y*t.y),b=e-T,E=g(b/this.a,_,v,L,S),m=r(this.long0+Math.atan2(t.x,t.y)),t.x=m,t.y=E,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),R=Math.atan2(t.x,t.y),w=c(this.a,this.e,this.sin_p12),x=Math.cos(R),C=this.e*this.cos_p12*x,A=-C*C/(1-this.es),P=3*this.es*(1-A)*this.sin_p12*this.cos_p12*x/(1-this.es),I=e/w,N=I-A*(1+A)*Math.pow(I,3)/6-P*(1+3*A)*Math.pow(I,4)/24,O=1-A*N*N/2-I*N*N*N/6,M=Math.asin(this.sin_p12*Math.cos(N)+this.cos_p12*Math.sin(N)*x),m=r(this.long0+Math.asin(Math.sin(R)*Math.sin(N)/Math.cos(M))),E=Math.atan((1-this.es*O*this.sin_p12/Math.sin(M))*Math.tan(M)/(1-this.es)),t.x=m,t.y=E,t)},i.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],41:[function(t,e,i){var r=t("../common/mlfn"),o=t("../common/e0fn"),n=t("../common/e1fn"),s=t("../common/e2fn"),a=t("../common/e3fn"),h=t("../common/gN"),l=t("../common/adjust_lon"),u=t("../common/adjust_lat"),c=t("../common/imlfn"),d=Math.PI/2,g=1e-10;i.init=function(){this.sphere||(this.e0=o(this.es),this.e1=n(this.es),this.e2=s(this.es),this.e3=a(this.es),this.ml0=this.a*r(this.e0,this.e1,this.e2,this.e3,this.lat0))},i.forward=function(t){var e,i,o=t.x,n=t.y;if(o=l(o-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(n)*Math.sin(o)),i=this.a*(Math.atan2(Math.tan(n),Math.cos(o))-this.lat0);else{var s=Math.sin(n),a=Math.cos(n),u=h(this.a,this.e,s),c=Math.tan(n)*Math.tan(n),d=o*Math.cos(n),g=d*d,p=this.es*a*a/(1-this.es),f=this.a*r(this.e0,this.e1,this.e2,this.e3,n);e=u*d*(1-g*c*(1/6-(8-c+8*p)*g/120)),i=f-this.ml0+u*s/a*g*(.5+(5-c+6*p)*g/24)}return t.x=e+this.x0,t.y=i+this.y0,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,r=t.x/this.a,o=t.y/this.a;if(this.sphere){var n=o+this.lat0;e=Math.asin(Math.sin(n)*Math.cos(r)),i=Math.atan2(Math.tan(r),Math.cos(n))}else{var s=this.ml0/this.a+o,a=c(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-d)<=g)return t.x=this.long0,t.y=d,0>o&&(t.y*=-1),t;var p=h(this.a,this.e,Math.sin(a)),f=p*p*p/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(a),2),E=r*this.a/p,y=E*E;e=a-p*Math.tan(a)/f*E*E*(.5-(1+3*m)*E*E/24),i=E*(1-y*(m/3+(1+3*m)*m*y/15))/Math.cos(a)}return t.x=l(i+this.long0),t.y=u(e),t},i.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(t,e,i){var r=t("../common/adjust_lon"),o=t("../common/qsfnz"),n=t("../common/msfnz"),s=t("../common/iqsfnz");i.init=function(){this.sphere||(this.k0=n(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},i.forward=function(t){var e,i,n=t.x,s=t.y,a=r(n-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var h=o(this.e,Math.sin(s));e=this.x0+this.a*this.k0*a,i=this.y0+this.a*h*.5/this.k0}return t.x=e,t.y=i,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i;return this.sphere?(e=r(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=s(this.e,2*t.y*this.k0/this.a),e=r(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},i.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],43:[function(t,e,i){var r=t("../common/adjust_lon"),o=t("../common/adjust_lat");i.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},i.forward=function(t){var e=t.x,i=t.y,n=r(e-this.long0),s=o(i-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*s,t},i.inverse=function(t){var e=t.x,i=t.y;return t.x=r(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=o(this.lat0+(i-this.y0)/this.a),t},i.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],44:[function(t,e,i){var r=t("../common/e0fn"),o=t("../common/e1fn"),n=t("../common/e2fn"),s=t("../common/e3fn"),a=t("../common/msfnz"),h=t("../common/mlfn"),l=t("../common/adjust_lon"),u=t("../common/adjust_lat"),c=t("../common/imlfn"),d=1e-10;i.init=function(){Math.abs(this.lat1+this.lat2)<d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=o(this.es),this.e2=n(this.es),this.e3=s(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=a(this.e,this.sinphi,this.cosphi),this.ml1=h(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=a(this.e,this.sinphi,this.cosphi),this.ml2=h(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=h(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},i.forward=function(t){var e,i=t.x,r=t.y;if(this.sphere)e=this.a*(this.g-r);else{var o=h(this.e0,this.e1,this.e2,this.e3,r);
e=this.a*(this.g-o)}var n=this.ns*l(i-this.long0),s=this.x0+e*Math.sin(n),a=this.y0+this.rh-e*Math.cos(n);return t.x=s,t.y=a,t},i.inverse=function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,i,r,o;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;if(0!==i&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere)return o=l(this.long0+n/this.ns),r=u(this.g-i/this.a),t.x=o,t.y=r,t;var s=this.g-i/this.a;return r=c(s,this.e0,this.e1,this.e2,this.e3),o=l(this.long0+n/this.ns),t.x=o,t.y=r,t},i.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],45:[function(t,e,i){var r=Math.PI/4,o=t("../common/srat"),n=Math.PI/2,s=20;i.init=function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+r)/(Math.pow(Math.tan(.5*this.lat0+r),this.C)*o(this.e*t,this.ratexp))},i.forward=function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+r),this.C)*o(this.e*Math.sin(i),this.ratexp))-n,t.x=this.C*e,t},i.inverse=function(t){for(var e=1e-14,i=t.x/this.C,a=t.y,h=Math.pow(Math.tan(.5*a+r)/this.K,1/this.C),l=s;l>0&&(a=2*Math.atan(h*o(this.e*Math.sin(t.y),-.5*this.e))-n,!(Math.abs(a-t.y)<e));--l)t.y=a;return l?(t.x=i,t.y=a,t):null},i.names=["gauss"]},{"../common/srat":22}],46:[function(t,e,i){var r=t("../common/adjust_lon"),o=1e-10,n=t("../common/asinz");i.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},i.forward=function(t){var e,i,n,s,a,h,l,u,c=t.x,d=t.y;return n=r(c-this.long0),e=Math.sin(d),i=Math.cos(d),s=Math.cos(n),h=this.sin_p14*e+this.cos_p14*i*s,a=1,h>0||Math.abs(h)<=o?(l=this.x0+this.a*a*i*Math.sin(n)/h,u=this.y0+this.a*a*(this.cos_p14*e-this.sin_p14*i*s)/h):(l=this.x0+this.infinity_dist*i*Math.sin(n),u=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*s)),t.x=l,t.y=u,t},i.inverse=function(t){var e,i,o,s,a,h;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),i=Math.sin(s),o=Math.cos(s),h=n(o*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.atan2(t.x*i,e*this.cos_p14*o-t.y*this.sin_p14*i),a=r(this.long0+a)):(h=this.phic0,a=0),t.x=a,t.y=h,t},i.names=["gnom"]},{"../common/adjust_lon":5,"../common/asinz":6}],47:[function(t,e,i){var r=t("../common/adjust_lon");i.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},i.forward=function(t){var e,i,o,n,s,a,h,l=t.x,u=t.y,c=r(l-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),o=-c*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(o)),s=Math.asin(Math.cos(i)*Math.sin(o)/Math.cos(n)),a=this.n*s,h=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),t.y=h*Math.cos(a)/1,t.x=h*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},i.inverse=function(t){var e,i,r,o,n,s,a,h,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),s=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.atan2(t.y,t.x),o=n/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(o)),i=Math.asin(Math.cos(r)*Math.sin(o)/Math.cos(e)),t.x=this.long0-i/this.alfa,a=e,h=0;var u=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(h=1),a=t.y,u+=1;while(0===h&&15>u);return u>=15?null:t},i.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],48:[function(t,e,i){var r=Math.PI/2,o=Math.PI/4,n=1e-10,s=t("../common/qsfnz"),a=t("../common/adjust_lon");i.S_POLE=1,i.N_POLE=2,i.EQUIT=3,i.OBLIQ=4,i.init=function(){var t=Math.abs(this.lat0);if(Math.abs(t-r)<n?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<n?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=s(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=s(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},i.forward=function(t){var e,i,h,l,u,c,d,g,p,f,m=t.x,E=t.y;if(m=a(m-this.long0),this.sphere){if(u=Math.sin(E),f=Math.cos(E),h=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i=this.mode===this.EQUIT?1+f*h:1+this.sinph0*u+this.cosph0*f*h,n>=i)return null;i=Math.sqrt(2/i),e=i*f*Math.sin(m),i*=this.mode===this.EQUIT?u:this.cosph0*u-this.sinph0*f*h}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(h=-h),Math.abs(E+this.phi0)<n)return null;i=o-.5*E,i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)),e=i*Math.sin(m),i*=h}}else{switch(d=0,g=0,p=0,h=Math.cos(m),l=Math.sin(m),u=Math.sin(E),c=s(this.e,u),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=c/this.qp,g=Math.sqrt(1-d*d)),this.mode){case this.OBLIQ:p=1+this.sinb1*d+this.cosb1*g*h;break;case this.EQUIT:p=1+g*h;break;case this.N_POLE:p=r+E,c=this.qp-c;break;case this.S_POLE:p=E-r,c=this.qp+c}if(Math.abs(p)<n)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),i=this.mode===this.OBLIQ?this.ymf*p*(this.cosb1*d-this.sinb1*g*h):(p=Math.sqrt(2/(1+g*h)))*d*this.ymf,e=this.xmf*p*g*l;break;case this.N_POLE:case this.S_POLE:c>=0?(e=(p=Math.sqrt(c))*l,i=h*(this.mode===this.S_POLE?p:-p)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,o,s,h,l,u,c=t.x/this.a,d=t.y/this.a;if(this.sphere){var g,p=0,f=0;if(g=Math.sqrt(c*c+d*d),i=.5*g,i>1)return null;switch(i=2*Math.asin(i),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(i),p=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(g)<=n?0:Math.asin(d*f/g),c*=f,d=p*g;break;case this.OBLIQ:i=Math.abs(g)<=n?this.phi0:Math.asin(p*this.sinph0+d*f*this.cosph0/g),c*=f*this.cosph0,d=(p-Math.sin(i)*this.sinph0)*g;break;case this.N_POLE:d=-d,i=r-i;break;case this.S_POLE:i-=r}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,d):0}else{if(u=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,d*=this.dd,l=Math.sqrt(c*c+d*d),n>l)return t.x=0,t.y=this.phi0,t;s=2*Math.asin(.5*l/this.rq),o=Math.cos(s),c*=s=Math.sin(s),this.mode===this.OBLIQ?(u=o*this.sinb1+d*s*this.cosb1/l,h=this.qp*u,d=l*this.cosb1*o-d*this.sinb1*s):(u=d*s/l,h=this.qp*u,d=l*o)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),h=c*c+d*d,!h)return t.x=0,t.y=this.phi0,t;u=1-h/this.qp,this.mode===this.S_POLE&&(u=-u)}e=Math.atan2(c,d),i=this.authlat(Math.asin(u),this.apa)}return t.x=a(this.long0+e),t.y=i,t},i.P00=.3333333333333333,i.P01=.17222222222222222,i.P02=.10257936507936508,i.P10=.06388888888888888,i.P11=.0664021164021164,i.P20=.016415012942191543,i.authset=function(t){var e,i=[];return i[0]=t*this.P00,e=t*t,i[0]+=e*this.P01,i[1]=e*this.P10,e*=t,i[0]+=e*this.P02,i[1]+=e*this.P11,i[2]=e*this.P20,i},i.authlat=function(t,e){var i=t+t;return t+e[0]*Math.sin(i)+e[1]*Math.sin(i+i)+e[2]*Math.sin(i+i+i)},i.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":20}],49:[function(t,e,i){var r=1e-10,o=t("../common/msfnz"),n=t("../common/tsfnz"),s=Math.PI/2,a=t("../common/sign"),h=t("../common/adjust_lon"),l=t("../common/phi2z");i.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<r)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),s=o(this.e,e,i),a=n(this.e,this.lat1,e),h=Math.sin(this.lat2),l=Math.cos(this.lat2),u=o(this.e,h,l),c=n(this.e,this.lat2,h),d=n(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>r?this.ns=Math.log(s/u)/Math.log(a/c):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=s/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(d,this.ns),this.title||(this.title="Lambert Conformal Conic")}},i.forward=function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=r&&(i=a(i)*(s-2*r));var o,l,u=Math.abs(Math.abs(i)-s);if(u>r)o=n(this.e,i,Math.sin(i)),l=this.a*this.f0*Math.pow(o,this.ns);else{if(u=i*this.ns,0>=u)return null;l=0}var c=this.ns*h(e-this.long0);return t.x=this.k0*(l*Math.sin(c))+this.x0,t.y=this.k0*(this.rh-l*Math.cos(c))+this.y0,t},i.inverse=function(t){var e,i,r,o,n,a=(t.x-this.x0)/this.k0,u=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+u*u),i=1):(e=-Math.sqrt(a*a+u*u),i=-1);var c=0;if(0!==e&&(c=Math.atan2(i*a,i*u)),0!==e||this.ns>0){if(i=1/this.ns,r=Math.pow(e/(this.a*this.f0),i),o=l(this.e,r),-9999===o)return null}else o=-s;return n=h(c/this.ns+this.long0),t.x=n,t.y=o,t},i.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],50:[function(t,e,i){function r(t){return t}i.init=function(){},i.forward=r,i.inverse=r,i.names=["longlat","identity"]},{}],51:[function(t,e,i){var r=t("../common/msfnz"),o=Math.PI/2,n=1e-10,s=57.29577951308232,a=t("../common/adjust_lon"),h=Math.PI/4,l=t("../common/tsfnz"),u=t("../common/phi2z");i.init=function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},i.forward=function(t){var e=t.x,i=t.y;if(i*s>90&&-90>i*s&&e*s>180&&-180>e*s)return null;var r,u;if(Math.abs(Math.abs(i)-o)<=n)return null;if(this.sphere)r=this.x0+this.a*this.k0*a(e-this.long0),u=this.y0+this.a*this.k0*Math.log(Math.tan(h+.5*i));else{var c=Math.sin(i),d=l(this.e,i,c);r=this.x0+this.a*this.k0*a(e-this.long0),u=this.y0-this.a*this.k0*Math.log(d)}return t.x=r,t.y=u,t},i.inverse=function(t){var e,i,r=t.x-this.x0,n=t.y-this.y0;if(this.sphere)i=o-2*Math.atan(Math.exp(-n/(this.a*this.k0)));else{var s=Math.exp(-n/(this.a*this.k0));if(i=u(this.e,s),-9999===i)return null}return e=a(this.long0+r/(this.a*this.k0)),t.x=e,t.y=i,t},i.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],52:[function(t,e,i){var r=t("../common/adjust_lon");i.init=function(){},i.forward=function(t){var e=t.x,i=t.y,o=r(e-this.long0),n=this.x0+this.a*o,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=n,t.y=s,t},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e=r(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},i.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],53:[function(t,e,i){var r=t("../common/adjust_lon"),o=1e-10;i.init=function(){},i.forward=function(t){for(var e=t.x,i=t.y,n=r(e-this.long0),s=i,a=Math.PI*Math.sin(i),h=0;!0;h++){var l=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=l,Math.abs(l)<o)break}s/=2,Math.PI/2-Math.abs(i)<o&&(n=0);var u=.900316316158*this.a*n*Math.cos(s)+this.x0,c=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=u,t.y=c,t},i.inverse=function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var o=r(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));o<-Math.PI&&(o=-Math.PI),o>Math.PI&&(o=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var n=Math.asin(i);return t.x=o,t.y=n,t},i.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],54:[function(t,e,i){var r=484813681109536e-20;i.iterations=1,i.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},i.forward=function(t){var e,i=t.x,o=t.y,n=o-this.lat0,s=i-this.long0,a=n/r*1e-5,h=s,l=1,u=0;for(e=1;10>=e;e++)l*=a,u+=this.A[e]*l;var c,d,g=u,p=h,f=1,m=0,E=0,y=0;for(e=1;6>=e;e++)c=f*g-m*p,d=m*g+f*p,f=c,m=d,E=E+this.B_re[e]*f-this.B_im[e]*m,y=y+this.B_im[e]*f+this.B_re[e]*m;return t.x=y*this.a+this.x0,t.y=E*this.a+this.y0,t},i.inverse=function(t){var e,i,o,n=t.x,s=t.y,a=n-this.x0,h=s-this.y0,l=h/this.a,u=a/this.a,c=1,d=0,g=0,p=0;for(e=1;6>=e;e++)i=c*l-d*u,o=d*l+c*u,c=i,d=o,g=g+this.C_re[e]*c-this.C_im[e]*d,p=p+this.C_im[e]*c+this.C_re[e]*d;for(var f=0;f<this.iterations;f++){var m,E,y=g,_=p,v=l,L=u;for(e=2;6>=e;e++)m=y*g-_*p,E=_*g+y*p,y=m,_=E,v+=(e-1)*(this.B_re[e]*y-this.B_im[e]*_),L+=(e-1)*(this.B_im[e]*y+this.B_re[e]*_);y=1,_=0;var S=this.B_re[1],T=this.B_im[1];for(e=2;6>=e;e++)m=y*g-_*p,E=_*g+y*p,y=m,_=E,S+=e*(this.B_re[e]*y-this.B_im[e]*_),T+=e*(this.B_im[e]*y+this.B_re[e]*_);var b=S*S+T*T;g=(v*S+L*T)/b,p=(L*S-v*T)/b}var w=g,M=p,R=1,x=0;for(e=1;9>=e;e++)R*=w,x+=this.D[e]*R;var C=this.lat0+x*r*1e5,A=this.long0+M;return t.x=A,t.y=C,t},i.names=["New_Zealand_Map_Grid","nzmg"]},{}],55:[function(t,e,i){var r=t("../common/tsfnz"),o=t("../common/adjust_lon"),n=t("../common/phi2z"),s=Math.PI/2,a=Math.PI/4,h=1e-10;i.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var n=r(this.e,this.lat0,t),s=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));1>s*s&&(s=1);var a,h;if(isNaN(this.longc)){var l=r(this.e,this.lat1,Math.sin(this.lat1)),u=r(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(n,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(n,this.bl);var c=Math.pow(l,this.bl),d=Math.pow(u,this.bl);a=this.el/c,h=.5*(a-1/a);var g=(this.el*this.el-d*c)/(this.el*this.el+d*c),p=(d-c)/(d+c),f=o(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(g*Math.tan(.5*this.bl*f)/p)/this.bl,this.long0=o(this.long0);var m=o(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/h),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else a=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=a*Math.pow(n,this.bl),h=.5*(a-1/a),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(h*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))},i.forward=function(t){var e,i,n,l=t.x,u=t.y,c=o(l-this.long0);if(Math.abs(Math.abs(u)-s)<=h)n=u>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(a+n*this.gamma0*.5)),e=-1*n*s*this.al/this.bl;else{var d=r(this.e,u,Math.sin(u)),g=this.el/Math.pow(d,this.bl),p=.5*(g-1/g),f=.5*(g+1/g),m=Math.sin(this.bl*c),E=(p*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/f;i=Math.abs(Math.abs(E)-1)<=h?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-E)/(1+E))/this.bl,e=Math.abs(Math.cos(this.bl*c))<=h?this.al*this.bl*c:this.al*Math.atan2(p*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*c))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},i.inverse=function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var r=Math.exp(-1*this.bl*i/this.al),a=.5*(r-1/r),l=.5*(r+1/r),u=Math.sin(this.bl*e/this.al),c=(u*Math.cos(this.gamma0)+a*Math.sin(this.gamma0))/l,d=Math.pow(this.el/Math.sqrt((1+c)/(1-c)),1/this.bl);return Math.abs(c-1)<h?(t.x=this.long0,t.y=s):Math.abs(c+1)<h?(t.x=this.long0,t.y=-1*s):(t.y=n(this.e,d),t.x=o(this.long0-Math.atan2(a*Math.cos(this.gamma0)-u*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},i.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],56:[function(t,e,i){var r=t("../common/e0fn"),o=t("../common/e1fn"),n=t("../common/e2fn"),s=t("../common/e3fn"),a=t("../common/adjust_lon"),h=t("../common/adjust_lat"),l=t("../common/mlfn"),u=1e-10,c=t("../common/gN"),d=20;i.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=o(this.es),this.e2=n(this.es),this.e3=s(this.es),this.ml0=this.a*l(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(t){var e,i,r,o=t.x,n=t.y,s=a(o-this.long0);if(r=s*Math.sin(n),this.sphere)Math.abs(n)<=u?(e=this.a*s,i=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(n),i=this.a*(h(n-this.lat0)+(1-Math.cos(r))/Math.tan(n)));else if(Math.abs(n)<=u)e=this.a*s,i=-1*this.ml0;else{var d=c(this.a,this.e,Math.sin(n))/Math.tan(n);e=d*Math.sin(r),i=this.a*l(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+d*(1-Math.cos(r))}return t.x=e+this.x0,t.y=i+this.y0,t},i.inverse=function(t){var e,i,r,o,n,s,h,c,g;if(r=t.x-this.x0,o=t.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=u)e=a(r/this.a+this.long0),i=0;else{s=this.lat0+o/this.a,h=r*r/this.a/this.a+s*s,c=s;var p;for(n=d;n;--n)if(p=Math.tan(c),g=-1*(s*(c*p+1)-c-.5*(c*c+h)*p)/((c-s)/p-1),c+=g,Math.abs(g)<=u){i=c;break}e=a(this.long0+Math.asin(r*Math.tan(c)/this.a)/Math.sin(i))}else if(Math.abs(o+this.ml0)<=u)i=0,e=a(this.long0+r/this.a);else{s=(this.ml0+o)/this.a,h=r*r/this.a/this.a+s*s,c=s;var f,m,E,y,_;for(n=d;n;--n)if(_=this.e*Math.sin(c),f=Math.sqrt(1-_*_)*Math.tan(c),m=this.a*l(this.e0,this.e1,this.e2,this.e3,c),E=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),y=m/this.a,g=(s*(f*y+1)-y-.5*f*(y*y+h))/(this.es*Math.sin(2*c)*(y*y+h-2*s*y)/(4*f)+(s-y)*(f*E-2/Math.sin(2*c))-E),c-=g,Math.abs(g)<=u){i=c;break}f=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=a(this.long0+Math.asin(r*f/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},i.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],57:[function(t,e,i){var r=t("../common/adjust_lon"),o=t("../common/adjust_lat"),n=t("../common/pj_enfn"),s=20,a=t("../common/pj_mlfn"),h=t("../common/pj_inv_mlfn"),l=Math.PI/2,u=1e-10,c=t("../common/asinz");i.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=n(this.es)},i.forward=function(t){var e,i,o=t.x,n=t.y;if(o=r(o-this.long0),this.sphere){if(this.m)for(var h=this.n*Math.sin(n),l=s;l;--l){var c=(this.m*n+Math.sin(n)-h)/(this.m+Math.cos(n));if(n-=c,Math.abs(c)<u)break}else n=1!==this.n?Math.asin(this.n*Math.sin(n)):n;e=this.a*this.C_x*o*(this.m+Math.cos(n)),i=this.a*this.C_y*n}else{var d=Math.sin(n),g=Math.cos(n);i=this.a*a(n,d,g,this.en),e=this.a*o*g/Math.sqrt(1-this.es*d*d)}return t.x=e,t.y=i,t},i.inverse=function(t){var e,i,n,s;return t.x-=this.x0,n=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,n/=this.C_x*(this.m+Math.cos(e)),this.m?e=c((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=c(Math.sin(e)/this.n)),n=r(n+this.long0),e=o(e)):(e=h(t.y/this.a,this.es,this.en),s=Math.abs(e),l>s?(s=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),n=r(i)):l>s-u&&(n=this.long0)),t.x=n,t.y=e,t},i.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],58:[function(t,e,i){i.init=function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,r=this.rf,o=1/r,n=2*o-Math.pow(o,2),s=this.e=Math.sqrt(n);this.R=this.k0*i*Math.sqrt(1-n)/(1-n*Math.pow(e,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+s*e)/(1-s*e));this.K=a-this.alpha*h+this.alpha*s/2*l},i.forward=function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=-this.alpha*(e+i)+this.K,o=2*(Math.atan(Math.exp(r))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(n))),a=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*s+this.x0,t},i.inverse=function(t){for(var e=t.x-this.x0,i=t.y-this.y0,r=e/this.R,o=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(r)),s=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(o))),a=this.lambda0+s/this.alpha,h=0,l=n,u=-1e3,c=0;Math.abs(l-u)>1e-7;){if(++c>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=a,t.y=l,t},i.names=["somerc"]},{}],59:[function(t,e,i){var r=Math.PI/2,o=1e-10,n=t("../common/sign"),s=t("../common/msfnz"),a=t("../common/tsfnz"),h=t("../common/phi2z"),l=t("../common/adjust_lon");i.ssfn_=function(t,e,i){return e*=i,Math.tan(.5*(r+t))*Math.pow((1-e)/(1+e),.5*i)},i.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o&&(this.k0=.5*(1+n(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=o&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o&&(this.k0=.5*this.cons*s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/a(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=s(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-r,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},i.forward=function(t){var e,i,n,s,h,u,c=t.x,d=t.y,g=Math.sin(d),p=Math.cos(d),f=l(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=o&&Math.abs(d+this.lat0)<=o?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*g+this.coslat0*p*Math.cos(f)),t.x=this.a*e*p*Math.sin(f)+this.x0,t.y=this.a*e*(this.coslat0*g-this.sinlat0*p*Math.cos(f))+this.y0,t):(i=2*Math.atan(this.ssfn_(d,g,this.e))-r,s=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=o?(h=a(this.e,d*this.con,this.con*g),u=2*this.a*this.k0*h/this.cons,t.x=this.x0+u*Math.sin(c-this.long0),t.y=this.y0-this.con*u*Math.cos(c-this.long0),t):(Math.abs(this.sinlat0)<o?(e=2*this.a*this.k0/(1+s*Math.cos(f)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*s*Math.cos(f))),t.y=e*(this.cosX0*n-this.sinX0*s*Math.cos(f))+this.y0),t.x=e*s*Math.sin(f)+this.x0,t))},i.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,s,a,u=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var c=2*Math.atan(u/(.5*this.a*this.k0));return e=this.long0,i=this.lat0,o>=u?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(c)*this.sinlat0+t.y*Math.sin(c)*this.coslat0/u),e=l(Math.abs(this.coslat0)<o?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(c),u*this.coslat0*Math.cos(c)-t.y*this.sinlat0*Math.sin(c))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=o){if(o>=u)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,n=u*this.cons/(2*this.a*this.k0),i=this.con*h(this.e,n),e=this.con*l(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(u*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,o>=u?a=this.X0:(a=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/u),e=l(this.long0+Math.atan2(t.x*Math.sin(s),u*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),i=-1*h(this.e,Math.tan(.5*(r+a)));return t.x=e,t.y=i,t},i.names=["stere"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],60:[function(t,e,i){var r=t("./gauss"),o=t("../common/adjust_lon");i.init=function(){r.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},i.forward=function(t){var e,i,n,s;return t.x=o(t.x-this.long0),r.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),n=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*n),t.x=s*i*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*i*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},i.inverse=function(t){var e,i,n,s,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var h=2*Math.atan2(a,this.R2);e=Math.sin(h),i=Math.cos(h),s=Math.asin(i*this.sinc0+t.y*e*this.cosc0/a),n=Math.atan2(t.x*e,a*this.cosc0*i-t.y*this.sinc0*e)}else s=this.phic0,n=0;return t.x=n,t.y=s,r.inverse.apply(this,[t]),t.x=o(t.x+this.long0),t},i.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":45}],61:[function(t,e,i){var r=t("../common/e0fn"),o=t("../common/e1fn"),n=t("../common/e2fn"),s=t("../common/e3fn"),a=t("../common/mlfn"),h=t("../common/adjust_lon"),l=Math.PI/2,u=1e-10,c=t("../common/sign"),d=t("../common/asinz");i.init=function(){this.e0=r(this.es),this.e1=o(this.es),this.e2=n(this.es),this.e3=s(this.es),this.ml0=this.a*a(this.e0,this.e1,this.e2,this.e3,this.lat0)},i.forward=function(t){var e,i,r,o=t.x,n=t.y,s=h(o-this.long0),l=Math.sin(n),u=Math.cos(n);if(this.sphere){var c=u*Math.sin(s);if(Math.abs(Math.abs(c)-1)<1e-10)return 93;i=.5*this.a*this.k0*Math.log((1+c)/(1-c)),e=Math.acos(u*Math.cos(s)/Math.sqrt(1-c*c)),0>n&&(e=-e),r=this.a*this.k0*(e-this.lat0)}else{var d=u*s,g=Math.pow(d,2),p=this.ep2*Math.pow(u,2),f=Math.tan(n),m=Math.pow(f,2);e=1-this.es*Math.pow(l,2);var E=this.a/Math.sqrt(e),y=this.a*a(this.e0,this.e1,this.e2,this.e3,n);i=this.k0*E*d*(1+g/6*(1-m+p+g/20*(5-18*m+Math.pow(m,2)+72*p-58*this.ep2)))+this.x0,r=this.k0*(y-this.ml0+E*f*(g*(.5+g/24*(5-m+9*p+4*Math.pow(p,2)+g/30*(61-58*m+Math.pow(m,2)+600*p-330*this.ep2)))))+this.y0}return t.x=i,t.y=r,t},i.inverse=function(t){var e,i,r,o,n,s,a=6;if(this.sphere){var g=Math.exp(t.x/(this.a*this.k0)),p=.5*(g-1/g),f=this.lat0+t.y/(this.a*this.k0),m=Math.cos(f);e=Math.sqrt((1-m*m)/(1+p*p)),n=d(e),0>f&&(n=-n),s=0===p&&0===m?this.long0:h(Math.atan2(p,m)+this.long0)}else{var E=t.x-this.x0,y=t.y-this.y0;for(e=(this.ml0+y/this.k0)/this.a,i=e,o=0;!0&&(r=(e+this.e1*Math.sin(2*i)-this.e2*Math.sin(4*i)+this.e3*Math.sin(6*i))/this.e0-i,i+=r,!(Math.abs(r)<=u));o++)if(o>=a)return 95;if(Math.abs(i)<l){var _=Math.sin(i),v=Math.cos(i),L=Math.tan(i),S=this.ep2*Math.pow(v,2),T=Math.pow(S,2),b=Math.pow(L,2),w=Math.pow(b,2);e=1-this.es*Math.pow(_,2);var M=this.a/Math.sqrt(e),R=M*(1-this.es)/e,x=E/(M*this.k0),C=Math.pow(x,2);n=i-M*L*C/R*(.5-C/24*(5+3*b+10*S-4*T-9*this.ep2-C/30*(61+90*b+298*S+45*w-252*this.ep2-3*T))),s=h(this.long0+x*(1-C/6*(1+2*b+S-C/20*(5-2*S+28*b-3*T+8*this.ep2+24*w)))/v)}else n=l*c(y),s=this.long0}return t.x=s,t.y=n,t},i.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],62:[function(t,e,i){var r=.017453292519943295,o=t("./tmerc");i.dependsOn="tmerc",i.init=function(){this.zone&&(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*r,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,o.init.apply(this),this.forward=o.forward,this.inverse=o.inverse)},i.names=["Universal Transverse Mercator System","utm"]},{"./tmerc":61}],63:[function(t,e,i){var r=t("../common/adjust_lon"),o=Math.PI/2,n=1e-10,s=t("../common/asinz");i.init=function(){this.R=this.a},i.forward=function(t){var e,i,a=t.x,h=t.y,l=r(a-this.long0);Math.abs(h)<=n&&(e=this.x0+this.R*l,i=this.y0);var u=s(2*Math.abs(h/Math.PI));(Math.abs(l)<=n||Math.abs(Math.abs(h)-o)<=n)&&(e=this.x0,i=h>=0?this.y0+Math.PI*this.R*Math.tan(.5*u):this.y0+Math.PI*this.R*-Math.tan(.5*u));var c=.5*Math.abs(Math.PI/l-l/Math.PI),d=c*c,g=Math.sin(u),p=Math.cos(u),f=p/(g+p-1),m=f*f,E=f*(2/g-1),y=E*E,_=Math.PI*this.R*(c*(f-y)+Math.sqrt(d*(f-y)*(f-y)-(y+d)*(m-y)))/(y+d);0>l&&(_=-_),e=this.x0+_;var v=d+f;return _=Math.PI*this.R*(E*v-c*Math.sqrt((y+d)*(d+1)-v*v))/(y+d),i=h>=0?this.y0+_:this.y0-_,t.x=e,t.y=i,t},i.inverse=function(t){var e,i,o,s,a,h,l,u,c,d,g,p,f;return t.x-=this.x0,t.y-=this.y0,g=Math.PI*this.R,o=t.x/g,s=t.y/g,a=o*o+s*s,h=-Math.abs(s)*(1+a),l=h-2*s*s+o*o,u=-2*h+1+2*s*s+a*a,f=s*s/u+(2*l*l*l/u/u/u-9*h*l/u/u)/27,c=(h-l*l/3/u)/u,d=2*Math.sqrt(-c/3),g=3*f/c/d,Math.abs(g)>1&&(g=g>=0?1:-1),p=Math.acos(g)/3,i=t.y>=0?(-d*Math.cos(p+Math.PI/3)-l/3/u)*Math.PI:-(-d*Math.cos(p+Math.PI/3)-l/3/u)*Math.PI,e=Math.abs(o)<n?this.long0:r(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(o*o-s*s)+a*a))/2/o),t.x=e,t.y=i,t},i.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":6}],64:[function(t,e,i){var r=.017453292519943295,o=57.29577951308232,n=1,s=2,a=t("./datum_transform"),h=t("./adjust_axis"),l=t("./Proj"),u=t("./common/toPoint");e.exports=function c(t,e,i){function d(t,e){return(t.datum.datum_type===n||t.datum.datum_type===s)&&"WGS84"!==e.datumCode}var g;return Array.isArray(i)&&(i=u(i)),t.datum&&e.datum&&(d(t,e)||d(e,t))&&(g=new l("WGS84"),
c(t,g,i),t=g),"enu"!==t.axis&&h(t,!1,i),"longlat"===t.projName?(i.x*=r,i.y*=r):(t.to_meter&&(i.x*=t.to_meter,i.y*=t.to_meter),t.inverse(i)),t.from_greenwich&&(i.x+=t.from_greenwich),i=a(t.datum,e.datum,i),e.from_greenwich&&(i.x-=e.from_greenwich),"longlat"===e.projName?(i.x*=o,i.y*=o):(e.forward(i),e.to_meter&&(i.x/=e.to_meter,i.y/=e.to_meter)),"enu"!==e.axis&&h(e,!0,i),i}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":30}],65:[function(t,e,i){function r(t,e,i){t[e]=i.map(function(t){var e={};return o(t,e),e}).reduce(function(t,e){return l(t,e)},{})}function o(t,e){var i;return Array.isArray(t)?(i=t.shift(),"PARAMETER"===i&&(i=t.shift()),1===t.length?Array.isArray(t[0])?(e[i]={},o(t[0],e[i])):e[i]=t[0]:t.length?"TOWGS84"===i?e[i]=t:(e[i]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(i)>-1?(e[i]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(e[i].auth=t[2])):"SPHEROID"===i?(e[i]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(e[i].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(i)>-1?(t[0]=["name",t[0]],r(e,i,t)):t.every(function(t){return Array.isArray(t)})?r(e,i,t):o(t,e[i])):e[i]=!0,void 0):void(e[t]=!0)}function n(t,e){var i=e[0],r=e[1];!(i in t)&&r in t&&(t[i]=t[r],3===e.length&&(t[i]=e[2](t[i])))}function s(t){return t*h}function a(t){function e(e){var i=t.to_meter||1;return parseFloat(e,10)*i}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&(t.to_meter=parseFloat(t.UNIT.convert,10))),t.GEOGCS&&(t.GEOGCS.DATUM?t.datumCode=t.GEOGCS.DATUM.name.toLowerCase():t.datumCode=t.GEOGCS.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),("new_zealand_geodetic_datum_1949"===t.datumCode||"new_zealand_1949"===t.datumCode)&&(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),t.GEOGCS.DATUM&&t.GEOGCS.DATUM.SPHEROID&&(t.ellps=t.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=t.GEOGCS.DATUM.SPHEROID.a,t.rf=parseFloat(t.GEOGCS.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);var i=function(e){return n(t,e)},r=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",s],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",s],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",s],["lat0","latitude_of_origin",s],["lat0","standard_parallel_1",s],["lat1","standard_parallel_1",s],["lat2","standard_parallel_2",s],["alpha","azimuth",s],["srsCode","name"]];r.forEach(i),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.PROJECTION&&"Lambert_Azimuthal_Equal_Area"!==t.PROJECTION||(t.long0=t.longc)}var h=.017453292519943295,l=t("./extend");e.exports=function(t,e){var i=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),r=i.shift(),n=i.shift();i.unshift(["name",n]),i.unshift(["type",r]),i.unshift("output");var s={};return o(i,s),a(s.output),l(e,s.output)}},{"./extend":33}],66:[function(t,e,i){function r(t){return t*(Math.PI/180)}function o(t){return 180*(t/Math.PI)}function n(t){var e,i,o,n,s,h,l,u,c,d=t.lat,g=t.lon,p=6378137,f=.00669438,m=.9996,E=r(d),y=r(g);c=Math.floor((g+180)/6)+1,180===g&&(c=60),d>=56&&64>d&&g>=3&&12>g&&(c=32),d>=72&&84>d&&(g>=0&&9>g?c=31:g>=9&&21>g?c=33:g>=21&&33>g?c=35:g>=33&&42>g&&(c=37)),e=6*(c-1)-180+3,u=r(e),i=f/(1-f),o=p/Math.sqrt(1-f*Math.sin(E)*Math.sin(E)),n=Math.tan(E)*Math.tan(E),s=i*Math.cos(E)*Math.cos(E),h=Math.cos(E)*(y-u),l=p*((1-f/4-3*f*f/64-5*f*f*f/256)*E-(3*f/8+3*f*f/32+45*f*f*f/1024)*Math.sin(2*E)+(15*f*f/256+45*f*f*f/1024)*Math.sin(4*E)-35*f*f*f/3072*Math.sin(6*E));var _=m*o*(h+(1-n+s)*h*h*h/6+(5-18*n+n*n+72*s-58*i)*h*h*h*h*h/120)+5e5,v=m*(l+o*Math.tan(E)*(h*h/2+(5-n+9*s+4*s*s)*h*h*h*h/24+(61-58*n+n*n+600*s-330*i)*h*h*h*h*h*h/720));return 0>d&&(v+=1e7),{northing:Math.round(v),easting:Math.round(_),zoneNumber:c,zoneLetter:a(d)}}function s(t){var e=t.northing,i=t.easting,r=t.zoneLetter,n=t.zoneNumber;if(0>n||n>60)return null;var a,h,l,u,c,d,g,p,f,m,E=.9996,y=6378137,_=.00669438,v=(1-Math.sqrt(1-_))/(1+Math.sqrt(1-_)),L=i-5e5,S=e;"N">r&&(S-=1e7),p=6*(n-1)-180+3,a=_/(1-_),g=S/E,f=g/(y*(1-_/4-3*_*_/64-5*_*_*_/256)),m=f+(3*v/2-27*v*v*v/32)*Math.sin(2*f)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*f)+151*v*v*v/96*Math.sin(6*f),h=y/Math.sqrt(1-_*Math.sin(m)*Math.sin(m)),l=Math.tan(m)*Math.tan(m),u=a*Math.cos(m)*Math.cos(m),c=y*(1-_)/Math.pow(1-_*Math.sin(m)*Math.sin(m),1.5),d=L/(h*E);var T=m-h*Math.tan(m)/c*(d*d/2-(5+3*l+10*u-4*u*u-9*a)*d*d*d*d/24+(61+90*l+298*u+45*l*l-252*a-3*u*u)*d*d*d*d*d*d/720);T=o(T);var b=(d-(1+2*l+u)*d*d*d/6+(5-2*u+28*l-3*u*u+8*a+24*l*l)*d*d*d*d*d/120)/Math.cos(m);b=p+o(b);var w;if(t.accuracy){var M=s({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});w={top:M.lat,right:M.lon,bottom:T,left:b}}else w={lat:T,lon:b};return w}function a(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function h(t,e){var i=""+t.easting,r=""+t.northing;return t.zoneNumber+t.zoneLetter+l(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+r.substr(r.length-5,e)}function l(t,e,i){var r=u(i),o=Math.floor(t/1e5),n=Math.floor(e/1e5)%20;return c(o,n,r)}function u(t){var e=t%m;return 0===e&&(e=m),e}function c(t,e,i){var r=i-1,o=E.charCodeAt(r),n=y.charCodeAt(r),s=o+t-1,a=n+e,h=!1;s>T&&(s=s-T+_-1,h=!0),(s===v||v>o&&s>v||(s>v||v>o)&&h)&&s++,(s===L||L>o&&s>L||(s>L||L>o)&&h)&&(s++,s===v&&s++),s>T&&(s=s-T+_-1),a>S?(a=a-S+_-1,h=!0):h=!1,(a===v||v>n&&a>v||(a>v||v>n)&&h)&&a++,(a===L||L>n&&a>L||(a>L||L>n)&&h)&&(a++,a===v&&a++),a>S&&(a=a-S+_-1);var l=String.fromCharCode(s)+String.fromCharCode(a);return l}function d(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,r=null,o="",n=0;!/[A-Z]/.test(e=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;o+=e,n++}var s=parseInt(o,10);if(0===n||n+3>i)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(n++);if("A">=a||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+t;r=t.substring(n,n+=2);for(var h=u(s),l=g(r.charAt(0),h),c=p(r.charAt(1),h);c<f(a);)c+=2e6;var d=i-n;if(d%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var m,E,y,_,v,L=d/2,S=0,T=0;return L>0&&(m=1e5/Math.pow(10,L),E=t.substring(n,n+L),S=parseFloat(E)*m,y=t.substring(n+L),T=parseFloat(y)*m),_=S+l,v=T+c,{easting:_,northing:v,zoneLetter:a,zoneNumber:s,accuracy:m}}function g(t,e){for(var i=E.charCodeAt(e-1),r=1e5,o=!1;i!==t.charCodeAt(0);){if(i++,i===v&&i++,i===L&&i++,i>T){if(o)throw"Bad character: "+t;i=_,o=!0}r+=1e5}return r}function p(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=y.charCodeAt(e-1),r=0,o=!1;i!==t.charCodeAt(0);){if(i++,i===v&&i++,i===L&&i++,i>S){if(o)throw"Bad character: "+t;i=_,o=!0}r+=1e5}return r}function f(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}var m=6,E="AJSAJS",y="AFAFAF",_=65,v=73,L=79,S=86,T=90;i.forward=function(t,e){return e=e||5,h(n({lat:t[1],lon:t[0]}),e)},i.inverse=function(t){var e=s(d(t.toUpperCase()));return[e.left,e.bottom,e.right,e.top]},i.toPoint=function(t){var e=i.inverse(t);return[(e[2]+e[0])/2,(e[3]+e[1])/2]}},{}],67:[function(t,e,i){e.exports={name:"proj4",version:"2.3.3",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"0.0.0"}}},{}],"./includedProjections":[function(t,e,i){e.exports=t("gWUPNW")},{}],gWUPNW:[function(t,e,i){var r=[t("./lib/projections/tmerc"),t("./lib/projections/utm"),t("./lib/projections/sterea"),t("./lib/projections/stere"),t("./lib/projections/somerc"),t("./lib/projections/omerc"),t("./lib/projections/lcc"),t("./lib/projections/krovak"),t("./lib/projections/cass"),t("./lib/projections/laea"),t("./lib/projections/aea"),t("./lib/projections/gnom"),t("./lib/projections/cea"),t("./lib/projections/eqc"),t("./lib/projections/poly"),t("./lib/projections/nzmg"),t("./lib/projections/mill"),t("./lib/projections/sinu"),t("./lib/projections/moll"),t("./lib/projections/eqdc"),t("./lib/projections/vandg"),t("./lib/projections/aeqd")];e.exports=function(t){r.forEach(function(e){t.Proj.projections.add(e)})}},{"./lib/projections/aea":39,"./lib/projections/aeqd":40,"./lib/projections/cass":41,"./lib/projections/cea":42,"./lib/projections/eqc":43,"./lib/projections/eqdc":44,"./lib/projections/gnom":46,"./lib/projections/krovak":47,"./lib/projections/laea":48,"./lib/projections/lcc":49,"./lib/projections/mill":52,"./lib/projections/moll":53,"./lib/projections/nzmg":54,"./lib/projections/omerc":55,"./lib/projections/poly":56,"./lib/projections/sinu":57,"./lib/projections/somerc":58,"./lib/projections/stere":59,"./lib/projections/sterea":60,"./lib/projections/tmerc":61,"./lib/projections/utm":62,"./lib/projections/vandg":63}]},{},[35])(35)}),i("formats/geojson/GeoJSONCRS",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger","../../util/proj4-src"],function(t,e,i,r){"use strict";var o=function(e,r){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONCRS","constructor","missingType"));if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONCRS","constructor","missingProperties"));this._type=e,this._properties=r,this._projectionString=null};return Object.defineProperties(o.prototype,{type:{get:function(){return this._type}},properties:{get:function(){return this._properties}},projectionString:{get:function(){return this._projectionString}}}),o.prototype.isDefault=function(){return!this.isNamed()||this._projectionString!==e.EPSG4326_CRS&&this._projectionString!==e.WGS84_CRS?!1:!0},o.prototype.isNamed=function(){return this._type===e.FIELD_CRS_NAME},o.prototype.isLinked=function(){return this._type===e.FIELD_CRS_LINK},o.prototype.isCRSSupported=function(){try{r(this._projectionString,e.EPSG4326_CRS)}catch(t){return i.log(i.LEVEL_WARNING,"Unknown GeoJSON coordinate reference system ("+t+"): "+this._properties.name),!1}return!0},o.prototype.getLinkedCRSString=function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="text",r.onreadystatechange=function(){4===r.readyState&&(200===r.status?(this._projectionString=r.response,e()):i.log(i.LEVEL_WARNING,"GeoJSON Linked CRS retrieval failed ("+r.statusText+"): "+t))}.bind(this),r.onerror=function(){i.log(i.LEVEL_WARNING,"GeoJSON Linked CRS retrieval failed: "+t)},r.ontimeout=function(){i.log(i.LEVEL_WARNING,"GeoJSON Linked CRS retrieval timed out: "+t)},r.send(null)},o.prototype.setCRSString=function(t){this.isNamed()?(this._projectionString=this._properties.name,t()):this.isLinked()&&this.getLinkedCRSString(this._properties.href,t)},o}),i("formats/geojson/GeoJSONFeature",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n,s){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONFeature","constructor","missingGeometry"));if(!r[e.FIELD_TYPE])throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONFeature","constructor","missingFeatureGeometryType"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONFeature","constructor","missingProperties"));this._geometry=r,this._properties=o,this._id=n,this._bbox=s};return Object.defineProperties(r.prototype,{geometry:{get:function(){return this._geometry}},properties:{get:function(){return this._properties}},id:{get:function(){return this._id}},bbox:{get:function(){return this._bbox}}}),r}),i("formats/geojson/GeoJSONFeatureCollection",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger"],function(t,e,i){"use strict";var r=function(e,r){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONFeatureCollection","constructor","missingFeatures"));if("[object Array]"!==Object.prototype.toString.call(e))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONFeatureCollection","constructor","invalidFeatures"));this._features=e,this._bbox=r};return Object.defineProperties(r.prototype,{features:{get:function(){return this._features}},bbox:{get:function(){return this._bbox}}}),r}),i("formats/geojson/GeoJSONGeometry",["./GeoJSONConstants"],function(t){"use strict";var e=function(t,e,i){if(!t)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"GeoJSONGeometry","constructor","missingCoordinates"));if(!e)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"GeoJSONGeometry","constructor","missingType"));this._coordinates=t,this._type=e,this._bbox=i?i:null};return Object.defineProperties(e.prototype,{coordinates:{get:function(){return this._coordinates}},type:{get:function(){return this._type}},bbox:{get:function(){return this._bbox}}}),e.prototype.isPointType=function(){return this.type===t.TYPE_POINT},e.prototype.isMultiPointType=function(){return this.type===t.TYPE_MULTI_POINT},e.prototype.isLineStringType=function(){return this.type===t.TYPE_LINE_STRING},e.prototype.isMultiLineStringType=function(){return this.type===t.TYPE_MULTI_LINE_STRING},e.prototype.isPolygonType=function(){return this.type===t.TYPE_POLYGON},e.prototype.isMultiPolygonType=function(){return this.type===t.TYPE_MULTI_POLYGON},e}),i("formats/geojson/GeoJSONGeometryCollection",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger"],function(t,e,i){"use strict";var r=function(e,r){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryCollection","constructor","missingGeometries"));if("[object Array]"!==Object.prototype.toString.call(e))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryCollection","constructor","invalidGeometries"));this._geometries=e,this._bbox=r};return Object.defineProperties(r.prototype,{geometries:{get:function(){return this._geometries}},bbox:{get:function(){return this._bbox}}}),r}),i("formats/geojson/GeoJSONGeometryLineString",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","missingCoordinates"));if(r.length<2||r[0].length<2)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","invalidNumberOfCoordinates"));if("[object Array]"!==Object.prototype.toString.call(r[0])||"[object Number]"!==Object.prototype.toString.call(r[0][0]))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","invalidCoordinatesType"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","missingType"));e.call(this,r,o,n)};return r.prototype=Object.create(e.prototype),r}),i("formats/geojson/GeoJSONGeometryMultiLineString",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiLineString","constructor","missingCoordinates"));if(r[0].length<2||r[0][0].length<2)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiLineString","constructor","invalidNumberOfCoordinates"));if("[object Array]"!==Object.prototype.toString.call(r[0])||"[object Array]"!==Object.prototype.toString.call(r[0][0])||"[object Number]"!==Object.prototype.toString.call(r[0][0][0]))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiLineString","constructor","invalidCoordinatesType"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","missingType"));e.call(this,r,o,n)};return r.prototype=Object.create(e.prototype),r}),i("formats/geojson/GeoJSONGeometryMultiPoint",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiPoint","constructor","missingCoordinates"));if(r[0].length<2)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiPoint","constructor","invalidNumberOfCoordinates"));if("[object Array]"!==Object.prototype.toString.call(r[0])||"[object Number]"!==Object.prototype.toString.call(r[0][0]))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiPoint","constructor","invalidCoordinatesType"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","missingType"));e.call(this,r,o,n)};return r.prototype=Object.create(e.prototype),r}),i("formats/geojson/GeoJSONGeometryMultiPolygon",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryMultiPolygon","constructor","missingCoordinates"));if("[object Array]"!==Object.prototype.toString.call(r[0])||"[object Array]"!==Object.prototype.toString.call(r[0][0])||"[object Array]"!==Object.prototype.toString.call(r[0][0][0])||"[object Number]"!==Object.prototype.toString.call(r[0][0][0][0]))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidCoordinatesType"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","missingType"));e.call(this,r,o,n)};return r.prototype=Object.create(e.prototype),r}),i("formats/geojson/GeoJSONGeometryPoint",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","missingCoordinates"));if(r.length<2)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","invalidNumberOfCoordinates"));if("[object Array]"!==Object.prototype.toString.call(r)||"[object Number]"!==Object.prototype.toString.call(r[0]))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","invalidCoordinatesType"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","missingType"));e.call(this,r,o,n)};return r.prototype=Object.create(e.prototype),r}),i("formats/geojson/GeoJSONGeometryPolygon",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(t,e,i){"use strict";var r=function(r,o,n){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","missingCoordinates"));if(r[0].length<2||r[0][0].length<2)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidNumberOfCoordinates"));if("[object Array]"!==Object.prototype.toString.call(r[0])||"[object Array]"!==Object.prototype.toString.call(r[0][0])||"[object Number]"!==Object.prototype.toString.call(r[0][0][0]))throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidCoordinatesType"));if(r[0][0]!==r[0][r.length-1])throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidLinearRing"));if(!o)throw new t(i.logMessage(i.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","missingType"));e.call(this,r,o,n)};return r.prototype=Object.create(e.prototype),r}),i("shapes/PlacemarkAttributes",["../util/Color","../util/Font","../util/Offset","../shapes/ShapeAttributes","../shapes/TextAttributes"],function(t,e,i,r,o){"use strict";var n=function(e){this._imageColor=e?e._imageColor:new t(1,1,1,1),this._imageOffset=e?e._imageOffset:new i(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this._imageScale=e?e._imageScale:1,this._imageSource=e?e._imageSource:null,this._depthTest=e?e._depthTest:!0,this._labelAttributes=e?e._labelAttributes:new o(null),this._drawLeaderLine=e?e._drawLeaderLine:!1,this._leaderLineAttributes=e?e._leaderLineAttributes:new r(null),this.stateKeyInvalid=!0};return n.prototype.computeStateKey=function(){return"ic "+this._imageColor.toHexString(!0)+" io "+this._imageOffset.toString()+" is "+this._imageScale+" ip "+this._imageSource+" dt "+this._depthTest+" la "+this._labelAttributes.stateKey+" dll "+this._drawLeaderLine+" lla "+this._leaderLineAttributes.stateKey},Object.defineProperties(n.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},imageColor:{get:function(){return this._imageColor},set:function(t){this._imageColor=t,this.stateKeyInvalid=!0}},imageOffset:{get:function(){return this._imageOffset},set:function(t){this._imageOffset=t,this.stateKeyInvalid=!0}},imageScale:{get:function(){return this._imageScale},set:function(t){this._imageScale=t,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(t){this._imageSource=t,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this.stateKeyInvalid=!0}},labelAttributes:{get:function(){return this._labelAttributes},set:function(t){this._labelAttributes=t,this.stateKeyInvalid=!0}},drawLeaderLine:{get:function(){return this._drawLeaderLine},set:function(t){this._drawLeaderLine=t,this.stateKeyInvalid=!0}},leaderLineAttributes:{get:function(){return this._leaderLineAttributes},set:function(t){this._leaderLineAttributes=t,this.stateKeyInvalid=!0}}}),n}),i("shapes/Placemark",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../pick/PickedObject","../shapes/PlacemarkAttributes","../render/Renderable","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u,c){"use strict";var d=function(e,i,r){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Placemark","constructor","missingPosition"));h.call(this),this.attributes=r?r:new a(null),this.highlightAttributes=null,this.highlighted=!1,this.position=e,this.eyeDistanceScaling=i,this.eyeDistanceScalingThreshold=1e6,this.eyeDistanceScalingLabelThreshold=1.5*this.eyeDistanceScalingThreshold,this.label=null,this.altitudeMode=WorldWind.ABSOLUTE,this.alwaysOnTop=!1,this.enableLeaderLinePicking=!1,this.updateImage=!0,this.declutterGroup=2,this.targetVisibility=1,this.currentVisibility=1,this.imageRotation=0,this.imageTilt=0,this.imageRotationReference=WorldWind.RELATIVE_TO_SCREEN,this.imageTiltReference=WorldWind.RELATIVE_TO_SCREEN,this.activeAttributes=null,this.activeTexture=null,this.labelTexture=null,this.placePoint=new u(0,0,0),this.groundPoint=new u(0,0,0),this.imageTransform=n.fromIdentity(),this.labelTransform=n.fromIdentity(),this.texCoordMatrix=n.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-.003};return d.screenPoint=new u(0,0,0),d.matrix=n.fromIdentity(),d.scratchPoint=new u(0,0,0),d.prototype=Object.create(h.prototype),Object.defineProperties(d.prototype,{screenBounds:{get:function(){return this.labelBounds}}}),d.prototype.copy=function(t){return this.position=t.position,this.attributes=t.attributes,this.highlightAttributes=t.highlightAttributes,this.highlighted=t.highlighted,this.enabled=t.enabled,this.label=t.label,this.altitudeMode=t.altitudeMode,this.pickDelegate=t.pickDelegate,this.alwaysOnTop=t.alwaysOnTop,this.depthOffset=t.depthOffset,this.targetVisibility=t.targetVisibility,this.currentVisibility=t.currentVisibility,this.imageRotation=t.imageRotation,this.imageTilt=t.imageTilt,this.imageRotationReference=t.imageRotationReference,this.imageTiltReference=t.imageTiltReference,this},d.prototype.clone=function(){var t=new d(this.position);return t.copy(this),t.pickDelegate=this.pickDelegate?this.pickDelegate:this,t},d.prototype.render=function(t){if(this.enabled&&t.accumulateOrderedRenderables&&(!t.globe.projectionLimits||t.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))){var e;if(this.lastFrameTime!==t.timestamp)e=this.makeOrderedRenderable(t);else{var i=this.clone();e=i.makeOrderedRenderable(t)}e&&e.isVisible(t)&&(e.layer=t.currentLayer,this.lastFrameTime=t.timestamp,t.addOrderedRenderable(e))}},d.prototype.renderOrdered=function(t){if(this.drawOrderedPlacemark(t),t.pickingMode){var e=new s(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);t.pickPoint&&this.mustDrawLabel()&&this.labelBounds.containsPoint(t.navigatorState.convertPointToViewport(t.pickPoint,d.scratchPoint))&&(e.labelPicked=!0),t.resolvePick(e)}},d.prototype.makeOrderedRenderable=function(t){var e,i,r,o;if(this.determineActiveAttributes(t),!this.activeAttributes)return null;if(t.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,this.placePoint),this.eyeDistance=this.alwaysOnTop?0:t.navigatorState.eyePoint.distanceTo(this.placePoint),this.mustDrawLeaderLine(t)&&t.surfacePointForMode(this.position.latitude,this.position.longitude,0,this.altitudeMode,this.groundPoint),!t.navigatorState.projectWithDepth(this.placePoint,this.depthOffset,d.screenPoint))return null;var n=this.eyeDistanceScaling?Math.max(0,Math.min(1,this.eyeDistanceScalingThreshold/this.eyeDistance)):1;if(this.activeTexture?(e=this.activeTexture.originalImageWidth,i=this.activeTexture.originalImageHeight,r=this.activeAttributes.imageScale*n,o=this.activeAttributes.imageOffset.offsetForSize(e,i),this.imageTransform.setTranslation(d.screenPoint[0]-o[0]*r,d.screenPoint[1]-o[1]*r,d.screenPoint[2]),this.imageTransform.setScale(e*r,i*r,1)):(r=this.activeAttributes.imageScale*n,o=this.activeAttributes.imageOffset.offsetForSize(r,r),this.imageTransform.setTranslation(d.screenPoint[0]-o[0],d.screenPoint[1]-o[1],d.screenPoint[2]),this.imageTransform.setScale(r,r,1)),this.imageBounds=c.boundingRectForUnitQuad(this.imageTransform),this.mustDrawLabel()){var s=this.activeAttributes.labelAttributes.font,a=this.label+s.toString();this.labelTexture=t.gpuResourceCache.resourceForKey(a),this.labelTexture||(this.labelTexture=t.textSupport.createTexture(t,this.label,s,!0),t.gpuResourceCache.putResource(a,this.labelTexture,this.labelTexture.size)),e=this.labelTexture.imageWidth,i=this.labelTexture.imageHeight,r=this.activeAttributes.labelAttributes.scale*n,o=this.activeAttributes.labelAttributes.offset.offsetForSize(e,i),this.labelTransform.setTranslation(d.screenPoint[0]-o[0]*r,d.screenPoint[1]-o[1]*r,d.screenPoint[2]),this.labelTransform.setScale(e*r,i*r,1),this.labelBounds=c.boundingRectForUnitQuad(this.labelTransform)}return this},d.prototype.determineActiveAttributes=function(t){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes,this.activeAttributes&&this.activeAttributes.imageSource&&(this.activeTexture=t.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource),(!this.activeTexture||this.updateImage)&&(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.activeAttributes.imageSource),this.updateImage=!1))},d.prototype.isVisible=function(t){return t.pickingMode?t.pickRectangle&&(this.imageBounds.intersects(t.pickRectangle)||this.mustDrawLabel()&&this.labelBounds.intersects(t.pickRectangle)||this.mustDrawLeaderLine(t)&&t.pickFrustum.intersectsSegment(this.groundPoint,this.placePoint)):this.imageBounds.intersects(t.navigatorState.viewport)||this.mustDrawLabel()&&this.labelBounds.intersects(t.navigatorState.viewport)||this.mustDrawLeaderLine(t)&&t.navigatorState.frustumInModelCoordinates.intersectsSegment(this.groundPoint,this.placePoint)},d.prototype.drawOrderedPlacemark=function(t){this.beginDrawing(t);try{this.doDrawOrderedPlacemark(t),t.pickingMode||this.drawBatchOrderedPlacemarks(t)}finally{this.endDrawing(t)}},d.prototype.drawBatchOrderedPlacemarks=function(t){for(var e;(e=t.peekOrderedRenderable())&&e.doDrawOrderedPlacemark;){t.popOrderedRenderable();try{e.doDrawOrderedPlacemark(t)}catch(i){o.logMessage(o.LEVEL_WARNING,"Placemark","drawBatchOrderedPlacemarks","Error occurred while rendering placemark using batching: "+i.message)}}},d.prototype.beginDrawing=function(t){var i,r=t.currentGlContext;t.findAndBindProgram(e),i=t.currentProgram,r.bindBuffer(r.ARRAY_BUFFER,t.unitQuadBuffer()),r.vertexAttribPointer(i.vertexTexCoordLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(i.vertexPointLocation),r.enableVertexAttribArray(i.vertexTexCoordLocation),i.loadTextureUnit(r,r.TEXTURE0),i.loadModulateColor(r,t.pickingMode)},d.prototype.endDrawing=function(t){var e=t.currentGlContext,i=t.currentProgram;e.disableVertexAttribArray(i.vertexPointLocation),e.disableVertexAttribArray(i.vertexTexCoordLocation),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindTexture(e.TEXTURE_2D,null)},d.prototype.doDrawOrderedPlacemark=function(t){var e,i=t.currentGlContext,r=t.currentProgram,o=!0;if(t.pickingMode&&(this.pickColor=t.uniquePickColor()),this.eyeDistanceScaling&&this.eyeDistance>this.eyeDistanceScalingLabelThreshold&&(this.targetVisibility=0),!t.pickingMode&&this.mustDrawLabel()&&this.currentVisibility!=this.targetVisibility){var n=(t.timestamp-t.previousRedrawTimestamp)/t.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+n):this.currentVisibility=Math.max(0,this.currentVisibility-n),t.redrawRequested=!0}if(r.loadOpacity(i,t.pickingMode?1:this.layer.opacity),this.mustDrawLeaderLine(t)){this.leaderLinePoints||(this.leaderLinePoints=new Float32Array(6)),this.leaderLinePoints[0]=this.groundPoint[0],this.leaderLinePoints[1]=this.groundPoint[1],this.leaderLinePoints[2]=this.groundPoint[2],this.leaderLinePoints[3]=this.placePoint[0],this.leaderLinePoints[4]=this.placePoint[1],this.leaderLinePoints[5]=this.placePoint[2],this.leaderLineCacheKey||(this.leaderLineCacheKey=t.gpuResourceCache.generateCacheKey());var s=t.gpuResourceCache.resourceForKey(this.leaderLineCacheKey);s||(s=i.createBuffer(),t.gpuResourceCache.putResource(this.leaderLineCacheKey,s,4*this.leaderLinePoints.length)),
r.loadTextureEnabled(i,!1),r.loadColor(i,t.pickingMode?this.pickColor:this.activeAttributes.leaderLineAttributes.outlineColor),d.matrix.copy(t.navigatorState.modelviewProjection),r.loadModelviewProjection(i,d.matrix),this.activeAttributes.leaderLineAttributes.depthTest||i.disable(i.DEPTH_TEST),i.lineWidth(this.activeAttributes.leaderLineAttributes.outlineWidth),i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,this.leaderLinePoints,i.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.vertexAttribPointer(r.vertexPointLocation,3,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2)}this.activeAttributes.depthTest||(o=!1,i.disable(i.DEPTH_TEST)),i.bindBuffer(i.ARRAY_BUFFER,t.unitQuadBuffer3()),i.vertexAttribPointer(r.vertexPointLocation,3,i.FLOAT,!1,0,0),d.matrix.copy(t.screenProjection),d.matrix.multiplyMatrix(this.imageTransform);var a=this.imageRotationReference===WorldWind.RELATIVE_TO_GLOBE?t.navigatorState.heading-this.imageRotation:-this.imageRotation;d.matrix.multiplyByTranslation(.5,.5,0),d.matrix.multiplyByRotation(0,0,1,a),d.matrix.multiplyByTranslation(-.5,-.5,0);var h=this.imageTiltReference===WorldWind.RELATIVE_TO_GLOBE?t.navigatorState.tilt+this.imageTilt:this.imageTilt;d.matrix.multiplyByRotation(-1,0,0,h),r.loadModelviewProjection(i,d.matrix),r.loadTextureEnabled(i,!0),t.pickingMode?r.loadColor(i,this.pickColor):r.loadColor(i,this.activeAttributes.imageColor),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),r.loadTextureMatrix(i,this.texCoordMatrix),this.activeTexture?(e=this.activeTexture.bind(t),r.loadTextureEnabled(i,e)):r.loadTextureEnabled(i,!1),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.mustDrawLabel()&&this.currentVisibility>0&&(r.loadOpacity(i,t.pickingMode?1:this.layer.opacity*this.currentVisibility),d.matrix.copy(t.screenProjection),d.matrix.multiplyMatrix(this.labelTransform),r.loadModelviewProjection(i,d.matrix),!t.pickingMode&&this.labelTexture?(this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.labelTexture),r.loadTextureMatrix(i,this.texCoordMatrix),r.loadColor(i,this.activeAttributes.labelAttributes.color),e=this.labelTexture.bind(t),r.loadTextureEnabled(i,e)):(r.loadTextureEnabled(i,!1),r.loadColor(i,this.pickColor)),this.activeAttributes.labelAttributes.depthTest?o||(o=!0,i.enable(i.DEPTH_TEST)):(o=!1,i.disable(i.DEPTH_TEST)),i.drawArrays(i.TRIANGLE_STRIP,0,4)),o||i.enable(i.DEPTH_TEST)},d.prototype.mustDrawLabel=function(){return this.label&&this.label.length>0&&this.activeAttributes.labelAttributes},d.prototype.mustDrawLeaderLine=function(t){return this.activeAttributes.drawLeaderLine&&this.activeAttributes.leaderLineAttributes&&(!t.pickingMode||this.enableLeaderLinePicking)},d});var r={};return r.DEBUG=!1,r.assert=function(t,e){if(r.DEBUG&&!t)throw new Error("Assertion failed"+(e?": "+e:""))},r.GLU_TESS_MAX_COORD=1e150,r.TRUE_PROJECT=!1,r.TESS_MAX_CACHE=100,r.GLU_TESS_DEFAULT_TOLERANCE=0,r.windingRule={GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},r.primitiveType={GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},r.errorType={GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},r.gluEnum={GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},r.PQHandle,r.PQKey,r.geom={},r.geom.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},r.geom.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},r.geom.edgeEval=function(t,e,i){var r=e.s-t.s,o=i.s-e.s;return r+o>0?o>r?e.t-t.t+(t.t-i.t)*(r/(r+o)):e.t-i.t+(i.t-t.t)*(o/(r+o)):0},r.geom.edgeSign=function(t,e,i){var r=e.s-t.s,o=i.s-e.s;return r+o>0?(e.t-i.t)*r+(e.t-t.t)*o:0},r.geom.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},r.geom.transEval=function(t,e,i){var r=e.t-t.t,o=i.t-e.t;return r+o>0?o>r?e.s-t.s+(t.s-i.s)*(r/(r+o)):e.s-i.s+(i.s-t.s)*(o/(r+o)):0},r.geom.transSign=function(t,e,i){var r=e.t-t.t,o=i.t-e.t;return r+o>0?(e.s-i.s)*r+(e.s-t.s)*o:0},r.geom.edgeGoesLeft=function(t){return r.geom.vertLeq(t.dst(),t.org)},r.geom.edgeGoesRight=function(t){return r.geom.vertLeq(t.org,t.dst())},r.geom.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},r.geom.vertCCW=function(t,e,i){return t.s*(e.t-i.t)+e.s*(i.t-t.t)+i.s*(t.t-e.t)>=0},r.geom.interpolate_=function(t,e,i,r){return t=0>t?0:t,i=0>i?0:i,i>=t?0===i?(e+r)/2:e+(r-e)*(t/(t+i)):r+(e-r)*(i/(t+i))},r.geom.edgeIntersect=function(t,e,i,o,n){var s,a,h;r.geom.vertLeq(t,e)||(h=t,t=e,e=h),r.geom.vertLeq(i,o)||(h=i,i=o,o=h),r.geom.vertLeq(t,i)||(h=t,t=i,i=h,h=e,e=o,o=h),r.geom.vertLeq(i,e)?r.geom.vertLeq(e,o)?(s=r.geom.edgeEval(t,i,e),a=r.geom.edgeEval(i,e,o),0>s+a&&(s=-s,a=-a),n.s=r.geom.interpolate_(s,i.s,a,e.s)):(s=r.geom.edgeSign(t,i,e),a=-r.geom.edgeSign(t,o,e),0>s+a&&(s=-s,a=-a),n.s=r.geom.interpolate_(s,i.s,a,o.s)):n.s=(i.s+e.s)/2,r.geom.transLeq(t,e)||(h=t,t=e,e=h),r.geom.transLeq(i,o)||(h=i,i=o,o=h),r.geom.transLeq(t,i)||(h=t,t=i,i=h,h=e,e=o,o=h),r.geom.transLeq(i,e)?r.geom.transLeq(e,o)?(s=r.geom.transEval(t,i,e),a=r.geom.transEval(i,e,o),0>s+a&&(s=-s,a=-a),n.t=r.geom.interpolate_(s,i.t,a,e.t)):(s=r.geom.transSign(t,i,e),a=-r.geom.transSign(t,o,e),0>s+a&&(s=-s,a=-a),n.t=r.geom.interpolate_(s,i.t,a,o.t)):n.t=(i.t+e.t)/2},r.mesh={},r.mesh.makeEdge=function(t){var e=r.mesh.makeEdgePair_(t.eHead);return r.mesh.makeVertex_(e,t.vHead),r.mesh.makeVertex_(e.sym,t.vHead),r.mesh.makeFace_(e,t.fHead),e},r.mesh.meshSplice=function(t,e){var i=!1,o=!1;t!==e&&(e.org!==t.org&&(o=!0,r.mesh.killVertex_(e.org,t.org)),e.lFace!==t.lFace&&(i=!0,r.mesh.killFace_(e.lFace,t.lFace)),r.mesh.splice_(e,t),o||(r.mesh.makeVertex_(e,t.org),t.org.anEdge=t),i||(r.mesh.makeFace_(e,t.lFace),t.lFace.anEdge=t))},r.mesh.deleteEdge=function(t){var e=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,r.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?r.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,r.mesh.splice_(t,t.oPrev()),i||r.mesh.makeFace_(t,t.lFace)),e.oNext===e?(r.mesh.killVertex_(e.org,null),r.mesh.killFace_(e.lFace,null)):(t.lFace.anEdge=e.oPrev(),e.org.anEdge=e.oNext,r.mesh.splice_(e,e.oPrev())),r.mesh.killEdge_(t)},r.mesh.addEdgeVertex=function(t){var e=r.mesh.makeEdgePair_(t),i=e.sym;return r.mesh.splice_(e,t.lNext),e.org=t.dst(),r.mesh.makeVertex_(i,e.org),e.lFace=i.lFace=t.lFace,e},r.mesh.splitEdge=function(t){var e=r.mesh.addEdgeVertex(t),i=e.sym;return r.mesh.splice_(t.sym,t.sym.oPrev()),r.mesh.splice_(t.sym,i),t.sym.org=i.org,i.dst().anEdge=i.sym,i.sym.lFace=t.rFace(),i.winding=t.winding,i.sym.winding=t.sym.winding,i},r.mesh.connect=function(t,e){var i=!1,o=r.mesh.makeEdgePair_(t),n=o.sym;return e.lFace!==t.lFace&&(i=!0,r.mesh.killFace_(e.lFace,t.lFace)),r.mesh.splice_(o,t.lNext),r.mesh.splice_(n,e),o.org=t.dst(),n.org=e.org,o.lFace=n.lFace=t.lFace,t.lFace.anEdge=n,i||r.mesh.makeFace_(o,t.lFace),o},r.mesh.zapFace=function(t){var e,i=t.anEdge,o=i.lNext;do if(e=o,o=e.lNext,e.lFace=null,null===e.rFace()){e.oNext===e?r.mesh.killVertex_(e.org,null):(e.org.anEdge=e.oNext,r.mesh.splice_(e,e.oPrev()));var n=e.sym;n.oNext===n?r.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,r.mesh.splice_(n,n.oPrev())),r.mesh.killEdge_(e)}while(e!==i);var s=t.prev,a=t.next;a.prev=s,s.next=a},r.mesh.meshUnion=function(t,e){var i=t.fHead,r=t.vHead,o=t.eHead,n=e.fHead,s=e.vHead,a=e.eHead;return n.next!==n&&(i.prev.next=n.next,n.next.prev=i.prev,n.prev.next=i,i.prev=n.prev),s.next!==s&&(r.prev.next=s.next,s.next.prev=r.prev,s.prev.next=r,r.prev=s.prev),a.next!==a&&(o.sym.next.sym.next=a.next,a.next.sym.next=o.sym.next,a.sym.next.sym.next=o,o.sym.next=a.sym.next),t},r.mesh.deleteMesh=function(t){},r.mesh.makeEdgePair_=function(t){var e=new r.GluHalfEdge,i=new r.GluHalfEdge,o=t.sym.next;return i.next=o,o.sym.next=e,e.next=t,t.sym.next=i,e.sym=i,e.oNext=e,e.lNext=i,i.sym=e,i.oNext=i,i.lNext=e,e},r.mesh.splice_=function(t,e){var i=t.oNext,r=e.oNext;i.sym.lNext=e,r.sym.lNext=t,t.oNext=r,e.oNext=i},r.mesh.makeVertex_=function(t,e){var i=e.prev,o=new r.GluVertex(e,i);i.next=o,e.prev=o,o.anEdge=t;var n=t;do n.org=o,n=n.oNext;while(n!==t)},r.mesh.makeFace_=function(t,e){var i=e.prev,o=new r.GluFace(e,i);i.next=o,e.prev=o,o.anEdge=t,o.inside=e.inside;var n=t;do n.lFace=o,n=n.lNext;while(n!==t)},r.mesh.killEdge_=function(t){var e=t.next,i=t.sym.next;e.sym.next=i,i.sym.next=e},r.mesh.killVertex_=function(t,e){var i=t.anEdge,r=i;do r.org=e,r=r.oNext;while(r!==i);var o=t.prev,n=t.next;n.prev=o,o.next=n},r.mesh.killFace_=function(t,e){var i=t.anEdge,r=i;do r.lFace=e,r=r.lNext;while(r!==i);var o=t.prev,n=t.next;n.prev=o,o.next=n},r.normal={},r.normal.S_UNIT_X_=1,r.normal.S_UNIT_Y_=0,r.normal.projectPolygon=function(t){var e=!1,i=[t.normal[0],t.normal[1],t.normal[2]];0===i[0]&&0===i[1]&&0===i[2]&&(r.normal.computeNormal_(t,i),e=!0);var o=t.sUnit,n=t.tUnit,s=r.normal.longAxis_(i);if(r.TRUE_PROJECT){r.normal.normalize_(i),o[s]=0,o[(s+1)%3]=r.normal.S_UNIT_X_,o[(s+2)%3]=r.normal.S_UNIT_Y_;var a=r.normal.dot_(o,i);o[0]-=a*i[0],o[1]-=a*i[1],o[2]-=a*i[2],r.normal.normalize_(o),n[0]=i[1]*o[2]-i[2]*o[1],n[1]=i[2]*o[0]-i[0]*o[2],n[2]=i[0]*o[1]-i[1]*o[0],r.normal.normalize_(n)}else o[s]=0,o[(s+1)%3]=r.normal.S_UNIT_X_,o[(s+2)%3]=r.normal.S_UNIT_Y_,n[s]=0,n[(s+1)%3]=i[s]>0?-r.normal.S_UNIT_Y_:r.normal.S_UNIT_Y_,n[(s+2)%3]=i[s]>0?r.normal.S_UNIT_X_:-r.normal.S_UNIT_X_;for(var h=t.mesh.vHead,l=h.next;l!==h;l=l.next)l.s=r.normal.dot_(l.coords,o),l.t=r.normal.dot_(l.coords,n);e&&r.normal.checkOrientation_(t)},r.normal.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},r.normal.normalize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},r.normal.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},r.normal.computeNormal_=function(t,e){var i,o=[-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD],n=[2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD],s=[],a=[],h=t.mesh.vHead;for(i=h.next;i!==h;i=i.next)for(var l=0;3>l;++l){var u=i.coords[l];u<n[l]&&(n[l]=u,a[l]=i),u>o[l]&&(o[l]=u,s[l]=i)}var c=0;if(o[1]-n[1]>o[0]-n[0]&&(c=1),o[2]-n[2]>o[c]-n[c]&&(c=2),n[c]>=o[c])return e[0]=0,e[1]=0,void(e[2]=1);var d=0,g=a[c],p=s[c],f=[0,0,0],m=[g.coords[0]-p.coords[0],g.coords[1]-p.coords[1],g.coords[2]-p.coords[2]],E=[0,0,0];for(i=h.next;i!==h;i=i.next){E[0]=i.coords[0]-p.coords[0],E[1]=i.coords[1]-p.coords[1],E[2]=i.coords[2]-p.coords[2],f[0]=m[1]*E[2]-m[2]*E[1],f[1]=m[2]*E[0]-m[0]*E[2],f[2]=m[0]*E[1]-m[1]*E[0];var y=f[0]*f[0]+f[1]*f[1]+f[2]*f[2];y>d&&(d=y,e[0]=f[0],e[1]=f[1],e[2]=f[2])}0>=d&&(e[0]=e[1]=e[2]=0,e[r.normal.longAxis_(m)]=1)},r.normal.checkOrientation_=function(t){for(var e=0,i=t.mesh.fHead,r=i.next;r!==i;r=r.next){var o=r.anEdge;if(!(o.winding<=0))do e+=(o.org.s-o.dst().s)*(o.org.t+o.dst().t),o=o.lNext;while(o!==r.anEdge)}if(0>e){for(var n=t.mesh.vHead,s=n.next;s!==n;s=s.next)s.t=-s.t;t.tUnit[0]=-t.tUnit[0],t.tUnit[1]=-t.tUnit[1],t.tUnit[2]=-t.tUnit[2]}},r.render={},r.render.renderMesh=function(t,e,i){for(var o=!1,n=-1,s=e.fHead.prev;s!==e.fHead;s=s.prev)if(s.inside){o||(t.callBeginOrBeginData(r.primitiveType.GL_TRIANGLES),o=!0);var a=s.anEdge;do{if(i){var h=a.rFace().inside?0:1;n!==h&&(n=h,t.callEdgeFlagOrEdgeFlagData(!!n))}t.callVertexOrVertexData(a.org.data),a=a.lNext}while(a!==s.anEdge)}o&&t.callEndOrEndData()},r.render.renderBoundary=function(t,e){for(var i=e.fHead.next;i!==e.fHead;i=i.next)if(i.inside){t.callBeginOrBeginData(r.primitiveType.GL_LINE_LOOP);var o=i.anEdge;do t.callVertexOrVertexData(o.org.data),o=o.lNext;while(o!==i.anEdge);t.callEndOrEndData()}},r.sweep={},r.sweep.SENTINEL_COORD_=4*r.GLU_TESS_MAX_COORD,r.sweep.TOLERANCE_NONZERO_=!1,r.sweep.computeInterior=function(t){t.fatalError=!1,r.sweep.removeDegenerateEdges_(t),r.sweep.initPriorityQ_(t),r.sweep.initEdgeDict_(t);for(var e;null!==(e=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!r.geom.vertEq(i,e))break;i=t.pq.extractMin(),r.sweep.spliceMergeVertices_(t,e.anEdge,i.anEdge)}r.sweep.sweepEvent_(t,e)}var o=t.dict.getMin().getKey();t.event=o.eUp.org,r.sweep.doneEdgeDict_(t),r.sweep.donePriorityQ_(t),r.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},r.sweep.addWinding_=function(t,e){t.winding+=e.winding,t.sym.winding+=e.sym.winding},r.sweep.edgeLeq_=function(t,e,i){var o=t.event,n=e.eUp,s=i.eUp;if(n.dst()===o)return s.dst()===o?r.geom.vertLeq(n.org,s.org)?r.geom.edgeSign(s.dst(),n.org,s.org)<=0:r.geom.edgeSign(n.dst(),s.org,n.org)>=0:r.geom.edgeSign(s.dst(),o,s.org)<=0;if(s.dst()===o)return r.geom.edgeSign(n.dst(),o,n.org)>=0;var a=r.geom.edgeEval(n.dst(),o,n.org),h=r.geom.edgeEval(s.dst(),o,s.org);return a>=h},r.sweep.deleteRegion_=function(t,e){e.fixUpperEdge,e.eUp.activeRegion=null,t.dict.deleteNode(e.nodeUp),e.nodeUp=null},r.sweep.fixUpperEdge_=function(t,e){r.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=e,e.activeRegion=t},r.sweep.topLeftRegion_=function(t){var e=t.eUp.org;do t=t.regionAbove();while(t.eUp.org===e);if(t.fixUpperEdge){var i=r.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);r.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},r.sweep.topRightRegion_=function(t){var e=t.eUp.dst();do t=t.regionAbove();while(t.eUp.dst()===e);return t},r.sweep.addRegionBelow_=function(t,e,i){var o=new r.ActiveRegion;return o.eUp=i,o.nodeUp=t.dict.insertBefore(e.nodeUp,o),i.activeRegion=o,o},r.sweep.isWindingInside_=function(t,e){switch(t.windingRule){case r.windingRule.GLU_TESS_WINDING_ODD:return 0!==(1&e);case r.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==e;case r.windingRule.GLU_TESS_WINDING_POSITIVE:return e>0;case r.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>e;case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return e>=2||-2>=e}return!1},r.sweep.computeWinding_=function(t,e){e.windingNumber=e.regionAbove().windingNumber+e.eUp.winding,e.inside=r.sweep.isWindingInside_(t,e.windingNumber)},r.sweep.finishRegion_=function(t,e){var i=e.eUp,o=i.lFace;o.inside=e.inside,o.anEdge=i,r.sweep.deleteRegion_(t,e)},r.sweep.finishLeftRegions_=function(t,e,i){for(var o=e,n=e.eUp;o!==i;){o.fixUpperEdge=!1;var s=o.regionBelow(),a=s.eUp;if(a.org!==n.org){if(!s.fixUpperEdge){r.sweep.finishRegion_(t,o);break}a=r.mesh.connect(n.lPrev(),a.sym),r.sweep.fixUpperEdge_(s,a)}n.oNext!==a&&(r.mesh.meshSplice(a.oPrev(),a),r.mesh.meshSplice(n,a)),r.sweep.finishRegion_(t,o),n=s.eUp,o=s}return n},r.sweep.addRightEdges_=function(t,e,i,o,n,s){var a=!0,h=i;do r.sweep.addRegionBelow_(t,e,h.sym),h=h.oNext;while(h!==o);null===n&&(n=e.regionBelow().eUp.rPrev());for(var l,u=e,c=n;l=u.regionBelow(),h=l.eUp.sym,h.org===c.org;)h.oNext!==c&&(r.mesh.meshSplice(h.oPrev(),h),r.mesh.meshSplice(c.oPrev(),h)),l.windingNumber=u.windingNumber-h.winding,l.inside=r.sweep.isWindingInside_(t,l.windingNumber),u.dirty=!0,!a&&r.sweep.checkForRightSplice_(t,u)&&(r.sweep.addWinding_(h,c),r.sweep.deleteRegion_(t,u),r.mesh.deleteEdge(c)),a=!1,u=l,c=h;u.dirty=!0,s&&r.sweep.walkDirtyRegions_(t,u)},r.sweep.callCombine_=function(t,e,i,o,n){var s=[e.coords[0],e.coords[1],e.coords[2]];e.data=null,e.data=t.callCombineOrCombineData(s,i,o),null===e.data&&(n?t.fatalError||(t.callErrorOrErrorData(r.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):e.data=i[0])},r.sweep.spliceMergeVertices_=function(t,e,i){var o=[null,null,null,null],n=[.5,.5,0,0];o[0]=e.org.data,o[1]=i.org.data,r.sweep.callCombine_(t,e.org,o,n,!1),r.mesh.meshSplice(e,i)},r.sweep.vertexWeights_=function(t,e,i,o,n){var s=r.geom.vertL1dist(e,t),a=r.geom.vertL1dist(i,t),h=n,l=n+1;o[h]=.5*a/(s+a),o[l]=.5*s/(s+a),t.coords[0]+=o[h]*e.coords[0]+o[l]*i.coords[0],t.coords[1]+=o[h]*e.coords[1]+o[l]*i.coords[1],t.coords[2]+=o[h]*e.coords[2]+o[l]*i.coords[2]},r.sweep.getIntersectData_=function(t,e,i,o,n,s){var a=[0,0,0,0],h=[i.data,o.data,n.data,s.data];e.coords[0]=e.coords[1]=e.coords[2]=0,r.sweep.vertexWeights_(e,i,o,a,0),r.sweep.vertexWeights_(e,n,s,a,2),r.sweep.callCombine_(t,e,h,a,!0)},r.sweep.checkForRightSplice_=function(t,e){var i=e.regionBelow(),o=e.eUp,n=i.eUp;if(r.geom.vertLeq(o.org,n.org)){if(r.geom.edgeSign(n.dst(),o.org,n.org)>0)return!1;r.geom.vertEq(o.org,n.org)?o.org!==n.org&&(t.pq.remove(o.org.pqHandle),r.sweep.spliceMergeVertices_(t,n.oPrev(),o)):(r.mesh.splitEdge(n.sym),r.mesh.meshSplice(o,n.oPrev()),e.dirty=i.dirty=!0)}else{if(r.geom.edgeSign(o.dst(),n.org,o.org)<0)return!1;e.regionAbove().dirty=e.dirty=!0,r.mesh.splitEdge(o.sym),r.mesh.meshSplice(n.oPrev(),o)}return!0},r.sweep.checkForLeftSplice_=function(t,e){var i,o=e.regionBelow(),n=e.eUp,s=o.eUp;if(r.geom.vertLeq(n.dst(),s.dst())){if(r.geom.edgeSign(n.dst(),s.dst(),n.org)<0)return!1;e.regionAbove().dirty=e.dirty=!0,i=r.mesh.splitEdge(n),r.mesh.meshSplice(s.sym,i),i.lFace.inside=e.inside}else{if(r.geom.edgeSign(s.dst(),n.dst(),s.org)>0)return!1;e.dirty=o.dirty=!0,i=r.mesh.splitEdge(s),r.mesh.meshSplice(n.lNext,s.sym),i.rFace().inside=e.inside}return!0},r.sweep.checkForIntersect_=function(t,e){var i=e.regionBelow(),o=e.eUp,n=i.eUp,s=o.org,a=n.org,h=o.dst(),l=n.dst(),u=new r.GluVertex;if(s===a)return!1;var c=Math.min(s.t,h.t),d=Math.max(a.t,l.t);if(c>d)return!1;if(r.geom.vertLeq(s,a)){if(r.geom.edgeSign(l,s,a)>0)return!1}else if(r.geom.edgeSign(h,a,s)<0)return!1;r.geom.edgeIntersect(h,s,l,a,u),r.geom.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t);var g=r.geom.vertLeq(s,a)?s:a;if(r.geom.vertLeq(g,u)&&(u.s=g.s,u.t=g.t),r.geom.vertEq(u,s)||r.geom.vertEq(u,a))return r.sweep.checkForRightSplice_(t,e),!1;if(!r.geom.vertEq(h,t.event)&&r.geom.edgeSign(h,t.event,u)>=0||!r.geom.vertEq(l,t.event)&&r.geom.edgeSign(l,t.event,u)<=0){if(l===t.event)return r.mesh.splitEdge(o.sym),r.mesh.meshSplice(n.sym,o),e=r.sweep.topLeftRegion_(e),o=e.regionBelow().eUp,r.sweep.finishLeftRegions_(t,e.regionBelow(),i),r.sweep.addRightEdges_(t,e,o.oPrev(),o,o,!0),!0;if(h===t.event){r.mesh.splitEdge(n.sym),r.mesh.meshSplice(o.lNext,n.oPrev()),i=e,e=r.sweep.topRightRegion_(e);var p=e.regionBelow().eUp.rPrev();return i.eUp=n.oPrev(),n=r.sweep.finishLeftRegions_(t,i,null),r.sweep.addRightEdges_(t,e,n.oNext,o.rPrev(),p,!0),!0}return r.geom.edgeSign(h,t.event,u)>=0&&(e.regionAbove().dirty=e.dirty=!0,r.mesh.splitEdge(o.sym),o.org.s=t.event.s,o.org.t=t.event.t),r.geom.edgeSign(l,t.event,u)<=0&&(e.dirty=i.dirty=!0,r.mesh.splitEdge(n.sym),n.org.s=t.event.s,n.org.t=t.event.t),!1}return r.mesh.splitEdge(o.sym),r.mesh.splitEdge(n.sym),r.mesh.meshSplice(n.oPrev(),o),o.org.s=u.s,o.org.t=u.t,o.org.pqHandle=t.pq.insert(o.org),r.sweep.getIntersectData_(t,o.org,s,h,a,l),e.regionAbove().dirty=e.dirty=i.dirty=!0,!1},r.sweep.walkDirtyRegions_=function(t,e){for(var i=e.regionBelow();;){for(;i.dirty;)e=i,i=i.regionBelow();if(!e.dirty&&(i=e,e=e.regionAbove(),null===e||!e.dirty))return;e.dirty=!1;var o=e.eUp,n=i.eUp;if(o.dst()!==n.dst()&&r.sweep.checkForLeftSplice_(t,e)&&(i.fixUpperEdge?(r.sweep.deleteRegion_(t,i),r.mesh.deleteEdge(n),i=e.regionBelow(),n=i.eUp):e.fixUpperEdge&&(r.sweep.deleteRegion_(t,e),r.mesh.deleteEdge(o),e=i.regionAbove(),o=e.eUp)),o.org!==n.org)if(o.dst()===n.dst()||e.fixUpperEdge||i.fixUpperEdge||o.dst()!==t.event&&n.dst()!==t.event)r.sweep.checkForRightSplice_(t,e);else if(r.sweep.checkForIntersect_(t,e))return;o.org===n.org&&o.dst()===n.dst()&&(r.sweep.addWinding_(n,o),r.sweep.deleteRegion_(t,e),r.mesh.deleteEdge(o),e=i.regionAbove())}},r.sweep.connectRightVertex_=function(t,e,i){var o=i.oNext,n=e.regionBelow(),s=e.eUp,a=n.eUp,h=!1;if(s.dst()!==a.dst()&&r.sweep.checkForIntersect_(t,e),r.geom.vertEq(s.org,t.event)&&(r.mesh.meshSplice(o.oPrev(),s),e=r.sweep.topLeftRegion_(e),o=e.regionBelow().eUp,r.sweep.finishLeftRegions_(t,e.regionBelow(),n),h=!0),r.geom.vertEq(a.org,t.event)&&(r.mesh.meshSplice(i,a.oPrev()),i=r.sweep.finishLeftRegions_(t,n,null),h=!0),h)return void r.sweep.addRightEdges_(t,e,i.oNext,o,o,!0);var l;l=r.geom.vertLeq(a.org,s.org)?a.oPrev():s,l=r.mesh.connect(i.lPrev(),l),r.sweep.addRightEdges_(t,e,l,l.oNext,l.oNext,!1),l.sym.activeRegion.fixUpperEdge=!0,r.sweep.walkDirtyRegions_(t,e)},r.sweep.connectLeftDegenerate_=function(t,e,i){var o=e.eUp;if(r.geom.vertEq(o.org,i))return void(r.sweep.TOLERANCE_NONZERO_&&r.sweep.spliceMergeVertices_(t,o,i.anEdge));if(!r.geom.vertEq(o.dst(),i))return r.mesh.splitEdge(o.sym),e.fixUpperEdge&&(r.mesh.deleteEdge(o.oNext),e.fixUpperEdge=!1),r.mesh.meshSplice(i.anEdge,o),void r.sweep.sweepEvent_(t,i);if(r.sweep.TOLERANCE_NONZERO_){e=r.sweep.topRightRegion_(e);var n=e.regionBelow(),s=n.eUp.sym,a=s.oNext,h=a;n.fixUpperEdge&&(r.sweep.deleteRegion_(t,n),r.mesh.deleteEdge(s),s=a.oPrev()),r.mesh.meshSplice(i.anEdge,s),r.geom.edgeGoesLeft(a)||(a=null),r.sweep.addRightEdges_(t,e,s.oNext,h,a,!0)}},r.sweep.connectLeftVertex_=function(t,e){var i=new r.ActiveRegion;i.eUp=e.anEdge.sym;var o=t.dict.search(i).getKey(),n=o.regionBelow(),s=o.eUp,a=n.eUp;if(0===r.geom.edgeSign(s.dst(),e,s.org))return void r.sweep.connectLeftDegenerate_(t,o,e);var h,l=r.geom.vertLeq(a.dst(),s.dst())?o:n;if(o.inside||l.fixUpperEdge){if(l===o)h=r.mesh.connect(e.anEdge.sym,s.lNext);else{var u=r.mesh.connect(a.dNext(),e.anEdge);h=u.sym}l.fixUpperEdge?r.sweep.fixUpperEdge_(l,h):r.sweep.computeWinding_(t,r.sweep.addRegionBelow_(t,o,h)),r.sweep.sweepEvent_(t,e)}else r.sweep.addRightEdges_(t,o,e.anEdge,e.anEdge,null,!0)},r.sweep.sweepEvent_=function(t,e){t.event=e;for(var i=e.anEdge;null===i.activeRegion;)if(i=i.oNext,i===e.anEdge)return void r.sweep.connectLeftVertex_(t,e);var o=r.sweep.topLeftRegion_(i.activeRegion),n=o.regionBelow(),s=n.eUp,a=r.sweep.finishLeftRegions_(t,n,null);a.oNext===s?r.sweep.connectRightVertex_(t,o,a):r.sweep.addRightEdges_(t,o,a.oNext,s,s,!0)},r.sweep.addSentinel_=function(t,e){var i=new r.ActiveRegion,o=r.mesh.makeEdge(t.mesh);o.org.s=r.sweep.SENTINEL_COORD_,o.org.t=e,o.dst().s=-r.sweep.SENTINEL_COORD_,o.dst().t=e,t.event=o.dst(),i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},r.sweep.initEdgeDict_=function(t){t.dict=new r.Dict(t,r.sweep.edgeLeq_),r.sweep.addSentinel_(t,-r.sweep.SENTINEL_COORD_),r.sweep.addSentinel_(t,r.sweep.SENTINEL_COORD_)},r.sweep.doneEdgeDict_=function(t){for(var e;null!==(e=t.dict.getMin().getKey());)!e.sentinel,r.sweep.deleteRegion_(t,e);t.dict=null},r.sweep.removeDegenerateEdges_=function(t){for(var e,i=t.mesh.eHead,o=i.next;o!==i;o=e){e=o.next;var n=o.lNext;r.geom.vertEq(o.org,o.dst())&&o.lNext.lNext!==o&&(r.sweep.spliceMergeVertices_(t,n,o),r.mesh.deleteEdge(o),o=n,n=o.lNext),n.lNext===o&&(n!==o&&((n===e||n===e.sym)&&(e=e.next),r.mesh.deleteEdge(n)),(o===e||o===e.sym)&&(e=e.next),r.mesh.deleteEdge(o))}},r.sweep.initPriorityQ_=function(t){var e=new r.PriorityQ(r.geom.vertLeq);t.pq=e;var i,o=t.mesh.vHead;for(i=o.next;i!==o;i=i.next)i.pqHandle=e.insert(i);e.init()},r.sweep.donePriorityQ_=function(t){t.pq.deleteQ(),t.pq=null},r.sweep.removeDegenerateFaces_=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e){e=i.next;var o=i.anEdge;o.lNext.lNext===o&&(r.sweep.addWinding_(o.oNext,o),r.mesh.deleteEdge(o))}},r.tessmono={},r.tessmono.tessellateMonoRegion_=function(t){for(var e=t.anEdge;r.geom.vertLeq(e.dst(),e.org);e=e.lPrev());for(;r.geom.vertLeq(e.org,e.dst());e=e.lNext);for(var i,o=e.lPrev();e.lNext!==o;)if(r.geom.vertLeq(e.dst(),o.org)){for(;o.lNext!==e&&(r.geom.edgeGoesLeft(o.lNext)||r.geom.edgeSign(o.org,o.dst(),o.lNext.dst())<=0);)i=r.mesh.connect(o.lNext,o),o=i.sym;o=o.lPrev()}else{for(;o.lNext!==e&&(r.geom.edgeGoesRight(e.lPrev())||r.geom.edgeSign(e.dst(),e.org,e.lPrev().org)>=0);)i=r.mesh.connect(e,e.lPrev()),e=i.sym;e=e.lNext}for(;o.lNext.lNext!==e;)i=r.mesh.connect(o.lNext,o),o=i.sym},r.tessmono.tessellateInterior=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e)e=i.next,i.inside&&r.tessmono.tessellateMonoRegion_(i)},r.tessmono.discardExterior=function(t){for(var e,i=t.fHead.next;i!==t.fHead;i=e)e=i.next,i.inside||r.mesh.zapFace(i)},r.tessmono.setWindingNumber=function(t,e,i){for(var o,n=t.eHead.next;n!==t.eHead;n=o)o=n.next,n.rFace().inside!==n.lFace.inside?n.winding=n.lFace.inside?e:-e:i?r.mesh.deleteEdge(n):n.winding=0},r.Dict=function(t,e){this.head_=new r.DictNode,this.frame_=t,this.leq_=e},r.Dict.prototype.deleteDict_=function(){},r.Dict.prototype.insertBefore=function(t,e){do t=t.prev;while(null!==t.key&&!this.leq_(this.frame_,t.key,e));var i=new r.DictNode(e,t.next,t);return t.next.prev=i,t.next=i,i},r.Dict.prototype.insert=function(t){return this.insertBefore(this.head_,t)},r.Dict.prototype.deleteNode=function(t){t.next.prev=t.prev,t.prev.next=t.next},r.Dict.prototype.search=function(t){var e=this.head_;do e=e.next;while(null!==e.key&&!this.leq_(this.frame_,t,e.key));return e},r.Dict.prototype.getMin=function(){return this.head_.next},r.Dict.prototype.getMax=function(){return this.head_.prev},r.DictNode=function(t,e,i){this.key=t||null,this.next=e||this,this.prev=i||this},r.DictNode.prototype.getKey=function(){return this.key},r.DictNode.prototype.getSuccessor=function(){return this.next},r.DictNode.prototype.getPredecessor=function(){return this.prev},r.CachedVertex=function(){this.coords=[0,0,0],this.data=null},r.GluTesselator=function(){this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=r.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=r.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(r.TESS_MAX_CACHE);for(var t=0;t<r.TESS_MAX_CACHE;t++)this.cache[t]=new r.CachedVertex},r.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},r.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(r.GluTesselator.tessState_.T_DORMANT)},r.GluTesselator.prototype.gluTessProperty=function(t,e){switch(t){case r.gluEnum.GLU_TESS_TOLERANCE:if(0>e||e>1)break;return void(this.relTolerance=e);case r.gluEnum.GLU_TESS_WINDING_RULE:var i=e;switch(i){case r.windingRule.GLU_TESS_WINDING_ODD:case r.windingRule.GLU_TESS_WINDING_NONZERO:case r.windingRule.GLU_TESS_WINDING_POSITIVE:case r.windingRule.GLU_TESS_WINDING_NEGATIVE:case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly=!!e);default:return void this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_VALUE)},r.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case r.gluEnum.GLU_TESS_TOLERANCE:return this.relTolerance;case r.gluEnum.GLU_TESS_WINDING_RULE:var e=this.windingRule;return e;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}return!1},r.GluTesselator.prototype.gluTessNormal=function(t,e,i){this.normal[0]=t,this.normal[1]=e,this.normal[2]=i},r.GluTesselator.prototype.gluTessCallback=function(t,e){var i=e?e:null;switch(t){case r.gluEnum.GLU_TESS_BEGIN:return void(this.callBegin_=i);case r.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.callBeginData_=i);case r.gluEnum.GLU_TESS_EDGE_FLAG:return void(this.callEdgeFlag_=i);case r.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.callEdgeFlagData_=i);case r.gluEnum.GLU_TESS_VERTEX:return void(this.callVertex_=i);case r.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.callVertexData_=i);case r.gluEnum.GLU_TESS_END:return void(this.callEnd_=i);case r.gluEnum.GLU_TESS_END_DATA:return void(this.callEndData_=i);case r.gluEnum.GLU_TESS_ERROR:return void(this.callError_=i);case r.gluEnum.GLU_TESS_ERROR_DATA:return void(this.callErrorData_=i);case r.gluEnum.GLU_TESS_COMBINE:return void(this.callCombine_=i);case r.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.callCombineData_=i);case r.gluEnum.GLU_TESS_MESH:return void(this.callMesh_=i);default:return void this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}},r.GluTesselator.prototype.gluTessVertex=function(t,e){var i=!1,o=[0,0,0];this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var n=0;3>n;++n){var s=t[n];s<-r.GLU_TESS_MAX_COORD&&(s=-r.GLU_TESS_MAX_COORD,i=!0),s>r.GLU_TESS_MAX_COORD&&(s=r.GLU_TESS_MAX_COORD,i=!0),o[n]=s}if(i&&this.callErrorOrErrorData(r.errorType.GLU_TESS_COORD_TOO_LARGE),null===this.mesh){if(this.cacheCount<r.TESS_MAX_CACHE)return void this.cacheVertex_(o,e);this.emptyCache_()}this.addVertex_(o,e)},r.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(r.GluTesselator.tessState_.T_DORMANT),this.state=r.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=t},r.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,this.cacheCount>0&&(this.emptyCache=!0)},r.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.state=r.GluTesselator.tessState_.T_IN_POLYGON},r.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_DORMANT,null===this.mesh&&this.emptyCache_(),r.normal.projectPolygon(this),r.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly?r.tessmono.setWindingNumber(t,1,!0):r.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)if(this.boundaryOnly)r.render.renderBoundary(this,this.mesh);else{var e=!(!this.callEdgeFlag_&&!this.callEdgeFlagData_);r.render.renderMesh(this,this.mesh,e)}if(this.callMesh_)return r.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,void(this.polygonData_=null)}r.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},r.GluTesselator.prototype.makeDormant_=function(){this.mesh&&r.mesh.deleteMesh(this.mesh),this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},r.GluTesselator.prototype.requireState_=function(t){this.state!==t&&this.gotoState_(t)},r.GluTesselator.prototype.gotoState_=function(t){for(;this.state!==t;)if(this.state<t)switch(this.state){case r.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case r.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},r.GluTesselator.prototype.addVertex_=function(t,e){var i=this.lastEdge_;null===i?(i=r.mesh.makeEdge(this.mesh),r.mesh.meshSplice(i,i.sym)):(r.mesh.splitEdge(i),i=i.lNext),i.org.data=e,i.org.coords[0]=t[0],
i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},r.GluTesselator.prototype.cacheVertex_=function(t,e){var i=this.cache[this.cacheCount];i.data=e,i.coords[0]=t[0],i.coords[1]=t[1],i.coords[2]=t[2],++this.cacheCount},r.GluTesselator.prototype.emptyCache_=function(){this.mesh=new r.GluMesh;for(var t=0;t<this.cacheCount;t++){var e=this.cache[t];this.addVertex_(e.coords,e.data)}this.cacheCount=0,this.emptyCache=!1},r.GluTesselator.prototype.callBeginOrBeginData=function(t){this.callBeginData_?this.callBeginData_(t,this.polygonData_):this.callBegin_&&this.callBegin_(t)},r.GluTesselator.prototype.callVertexOrVertexData=function(t){this.callVertexData_?this.callVertexData_(t,this.polygonData_):this.callVertex_&&this.callVertex_(t)},r.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(t){this.callEdgeFlagData_?this.callEdgeFlagData_(t,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(t)},r.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},r.GluTesselator.prototype.callCombineOrCombineData=function(t,e,i){var r;return this.callCombineData_?r=this.callCombineData_(t,e,i,this.polygonData_):this.callCombine_&&(r=this.callCombine_(t,e,i)),void 0===r&&(r=null),r},r.GluTesselator.prototype.callErrorOrErrorData=function(t){this.callErrorData_?this.callErrorData_(t,this.polygonData_):this.callError_&&this.callError_(t)},r.GluFace=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.inside=!1},r.GluHalfEdge=function(t){this.next=t||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},r.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},r.GluHalfEdge.prototype.dst=function(){return this.sym.org},r.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},r.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},r.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},r.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},r.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},r.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},r.GluMesh=function(){this.vHead=new r.GluVertex,this.fHead=new r.GluFace,this.eHead=new r.GluHalfEdge,this.eHeadSym=new r.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},r.GluMesh.prototype.checkMesh=function(){if(r.DEBUG){var t,e,i=this.fHead,o=this.vHead,n=this.eHead,s=i;for(s=i;(e=s.next)!==i;s=e){t=e.anEdge;do t=t.lNext;while(t!==e.anEdge)}var a,h=o;for(h=o;(a=h.next)!==o;h=a){t=a.anEdge;do t=t.oNext;while(t!==a.anEdge)}var l=n;for(l=n;(t=l.next)!==n;l=t);}},r.GluVertex=function(t,e){this.next=t||this,this.prev=e||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},r.PQHandleElem=function(){this.key=null,this.node=0},r.PQHandleElem.realloc=function(t,e){var i=new Array(e),o=0;if(null!==t)for(;o<t.length;o++)i[o]=t[o];for(;e>o;o++)i[o]=new r.PQHandleElem;return i},r.PQNode=function(){this.handle=0},r.PQNode.realloc=function(t,e){var i=new Array(e),o=0;if(null!==t)for(;o<t.length;o++)i[o]=t[o];for(;e>o;o++)i[o]=new r.PQNode;return i},r.PriorityQ=function(t){this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(null,r.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=r.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=t,this.heap_=new r.PriorityQHeap(this.leq_)},r.PriorityQ.INIT_SIZE_=32,r.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},r.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var e=function(t,e){return function(i,r){return e(t[i],t[r])?1:-1}}(this.keys_,this.leq_);if(this.order_.sort(e),this.max_=this.size_,this.initialized_=!0,this.heap_.init(),r.DEBUG){var i=0,o=i+this.size_-1;for(t=i;o>t;++t);}},r.PriorityQ.prototype.insert=function(t){if(this.initialized_)return this.heap_.insert(t);var e=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[e]=t,-(e+1)},r.PriorityQ.prototype.PQKeyRealloc_=function(t,e){var i=new Array(e),r=0;if(null!==t)for(;r<t.length;r++)i[r]=t[r];for(;e>r;r++)i[r]=null;return i},r.PriorityQ.prototype.keyLessThan_=function(t,e){var i=this.keys_[t],r=this.keys_[e];return!this.leq_(r,i)},r.PriorityQ.prototype.keyGreaterThan_=function(t,e){var i=this.keys_[t],r=this.keys_[e];return!this.leq_(i,r)},r.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(this.leq_(e,t))return this.heap_.extractMin()}do--this.size_;while(this.size_>0&&null===this.keys_[this.order_[this.size_-1]]);return t},r.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var e=this.heap_.minimum();if(this.leq_(e,t))return e}return t},r.PriorityQ.prototype.isEmpty_=function(){return 0===this.size_&&this.heap_.isEmpty()},r.PriorityQ.prototype.remove=function(t){if(t>=0)return void this.heap_.remove(t);for(t=-(t+1),this.keys_[t]=null;this.size_>0&&null===this.keys_[this.order_[this.size_-1]];)--this.size_},r.PriorityQHeap=function(t){this.nodes_=r.PQNode.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.handles_=r.PQHandleElem.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=r.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=t,this.nodes_[1].handle=1},r.PriorityQHeap.INIT_SIZE_=32,r.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},r.PriorityQHeap.prototype.init=function(){for(var t=this.size_;t>=1;--t)this.floatDown_(t);this.initialized_=!0},r.PriorityQHeap.prototype.insert=function(t){var e=++this.size_;2*e>this.max_&&(this.max_*=2,this.nodes_=r.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=r.PQHandleElem.realloc(this.handles_,this.max_+1));var i;return 0===this.freeList_?i=e:(i=this.freeList_,this.freeList_=this.handles_[i].node),this.nodes_[e].handle=i,this.handles_[i].node=e,this.handles_[i].key=t,this.initialized_&&this.floatUp_(e),i},r.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},r.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},r.PriorityQHeap.prototype.extractMin=function(){var t=this.nodes_,e=this.handles_,i=t[1].handle,r=e[i].key;return this.size_>0&&(t[1].handle=t[this.size_].handle,e[t[1].handle].node=1,e[i].key=null,e[i].node=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),r},r.PriorityQHeap.prototype.remove=function(t){var e=this.nodes_,i=this.handles_,r=i[t].node;e[r].handle=e[this.size_].handle,i[e[r].handle].node=r,r<=--this.size_&&(1>=r||this.leq_(i[e[r>>1].handle].key,i[e[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),i[t].key=null,i[t].node=this.freeList_,this.freeList_=t},r.PriorityQHeap.prototype.floatDown_=function(t){for(var e=this.nodes_,i=this.handles_,r=e[t].handle;;){var o=t<<1;o<this.size_&&this.leq_(i[e[o+1].handle].key,i[e[o].handle].key)&&++o;var n=e[o].handle;if(o>this.size_||this.leq_(i[r].key,i[n].key)){e[t].handle=r,i[r].node=t;break}e[t].handle=n,i[n].node=t,t=o}},r.PriorityQHeap.prototype.floatUp_=function(t){for(var e=this.nodes_,i=this.handles_,r=e[t].handle;;){var o=t>>1,n=e[o].handle;if(0===o||this.leq_(i[n].key,i[r].key)){e[t].handle=r,i[r].node=t;break}e[t].handle=n,i[n].node=t,t=o}},r.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},r.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},r.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},"undefined"!=typeof module&&(module.exports=r),i("util/libtess",function(){}),i("shapes/Polygon",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3","../util/libtess"],function(t,e,i,o,n,s,a,h,l,u,c,d,g,p,f,m){"use strict";var E=function(i,r){if(!i)throw new e(h.logMessage(h.LEVEL_SEVERE,"Polygon","constructor","missingBoundaries"));t.call(this,r),i.length>0&&i[0].latitude&&(i=[i],this._boundariesSpecifiedSimply=!0),this._boundaries=i,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._boundaries),this._extrude=!1,this.scratchPoint=new f(0,0,0)};return E.prototype=Object.create(t.prototype),Object.defineProperties(E.prototype,{boundaries:{get:function(){return this._boundariesSpecifiedSimply?this._boundaries[0]:this._boundaries},set:function(t){if(!t)throw new e(h.logMessage(h.LEVEL_SEVERE,"Polygon","boundaries","missingBoundaries"));t.length>0&&t[0].latitude&&(t=[t],this._boundariesSpecifiedSimply=!0),this._boundaries=t,this.referencePosition=this.determineReferencePosition(this._boundaries),this.reset()}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(t){this._textureCoordinates=t,this.reset()}},extrude:{get:function(){return this._extrude},set:function(t){this._extrude=t,this.reset()}}}),E.prototype.determineReferencePosition=function(t){return t.length>0&&t[0].length>2?t[0][0]:null},E.prototype.mustGenerateGeometry=function(t){return this.currentData.boundaryPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},E.prototype.hasCapTexture=function(){return this.textureCoordinates&&this.capImageSource()},E.prototype.capImageSource=function(){return this.activeAttributes.imageSource?"string"==typeof this.activeAttributes.imageSource||this.activeAttributes.imageSource instanceof s?this.activeAttributes.imageSource:Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource[0]&&("string"==typeof this.activeAttributes.imageSource[0]||this.activeAttributes.imageSource instanceof s)?this.activeAttributes.imageSource[0]:null:null},E.prototype.hasSideTextures=function(){return this.activeAttributes.imageSource&&Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource.length>1},E.prototype.sideImageSource=function(t){if(0===t||2===this.activeAttributes.imageSource.length)return this.activeAttributes.imageSource[1];var e=this.activeAttributes.imageSource.length-1;return t=Math.min(t+1,e),this.activeAttributes.imageSource[t]},E.prototype.createSurfaceShape=function(){return new g(this.boundaries,null)},E.prototype.doMakeOrderedRenderable=function(t){if(!this.referencePosition)return null;if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(t))return this;var e=this.currentData,i=e.referencePoint;t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,i),e.transformationMatrix.setToTranslation(i[0],i[1],i[2]);for(var r=[],n=0;n<this._boundaries.length;n++)r[n]=this._boundaries[n].slice(0),r[n].push(this._boundaries[n][0]);var s=this.computeBoundaryPoints(t,r);if(this.activeAttributes.drawInterior){var a=this.tessellatePolygon(t,s);if(a){e.capTriangles=new Float32Array(a.length);for(var h=0,l=a.length;l>h;h++)e.capTriangles[h]=a[h]}}if(e.boundaryPoints=s,e.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(e),e.refreshBuffers=!0,e.extent||(e.extent=new o),1===s.length)e.extent.setToPoints(s[0]);else{var u=[];for(n=0;n<s.length;n++)for(var c=0;c<s[n].length;c++)u.push(s[n][c]);e.extent.setToPoints(u)}return e.extent.translate(e.referencePoint),this},E.prototype.computeBoundaryPoints=function(t,e){for(var i,r,o,n,s=Number.MAX_VALUE,a=t.navigatorState.eyePoint,h=[],l=this._extrude?6:3,u=new f(0,0,0),c=0;c<e.length;c++){i=(this._extrude?2:1)*e[c].length,h[c]=new Float32Array(3*i);for(var d=0,g=e[c].length;g>d;d++)r=e[c][d],t.surfacePointForMode(r.latitude,r.longitude,r.altitude,this.altitudeMode,u),n=u.distanceToSquared(a),s>n&&(s=n),u.subtract(this.currentData.referencePoint),o=l*d,h[c][o]=u[0],h[c][o+1]=u[1],h[c][o+2]=u[2],this._extrude&&(t.surfacePointForMode(r.latitude,r.longitude,0,WorldWind.CLAMP_TO_GROUND,u),n=u.distanceToSquared(a),s>n&&(s=n),u.subtract(this.currentData.referencePoint),h[c][o+3]=u[0],h[c][o+4]=u[1],h[c][o+5]=u[2])}return this.currentData.eyeDistance=Math.sqrt(s),h},E.prototype.tessellatePolygon=function(t,e){var i,o,n=[],s=0,a=this._extrude?6:3,l=this.hasCapTexture();this.polygonTessellator||(this.polygonTessellator=new r.GluTesselator,this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_VERTEX_DATA,function(t,e){e[e.length]=t[0],e[e.length]=t[1],e[e.length]=t[2],l&&(e[e.length]=t[3],e[e.length]=t[4])}),this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_COMBINE,function(t,e,i){var r=[t[0],t[1],t[2]];if(l)for(var o=3;4>=o;o++){for(var n=0,s=0;4>s;s++)i[s]>0&&(n+=i[s]*e[s][o]);r[o]=n}return r}),this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_ERROR,function(t){s=t,h.logMessage(h.LEVEL_WARNING,"Polygon","tessellatePolygon","Tessellation error "+t+".")})),o=f.computeBufferNormal(e[0],a),o||(o=new f(0,0,0),t.globe.surfaceNormalAtLocation(this.referencePosition.latitude,this.referencePosition.longitude,o)),this.polygonTessellator.gluTessNormal(o[0],o[1],o[2]),this.currentData.capNormal=o,this.polygonTessellator.gluTessBeginPolygon(n);for(var u=0;u<e.length;u++){var c=0;this.polygonTessellator.gluTessBeginContour();for(var d=e[u],g=0;g<d.length;g+=a)i=[d[g],d[g+1],d[g+2]],l&&(c<this.textureCoordinates[u].length?(i[3]=this.textureCoordinates[u][c][0],i[4]=this.textureCoordinates[u][c][1]):(i[3]=this.textureCoordinates[u][0][0],i[4]=this.textureCoordinates[u][1][1]),++c),this.polygonTessellator.gluTessVertex(i,i);this.polygonTessellator.gluTessEndContour()}return this.polygonTessellator.gluTessEndPolygon(),0===s?n:null},E.prototype.mustDrawVerticals=function(t){return this._extrude&&this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},E.prototype.doRenderOrdered=function(t){var e,i=this.currentData;if(t.pickingMode&&(e=t.uniquePickColor()),this.activeAttributes.drawInterior&&i.capTriangles&&i.capTriangles.length>0&&this.drawCap(t,e),this._extrude&&this.activeAttributes.drawInterior&&this.drawSides(t,e),this.activeAttributes.drawOutline&&this.drawOutline(t,e),i.refreshBuffers=!1,t.pickingMode){var r=new u(e,this.pickDelegate?this.pickDelegate:this,null,t.currentLayer,!1);t.resolvePick(r)}},E.prototype.drawCap=function(t,e){var i,r,o,n,s,a,h=t.currentGlContext,l=t.currentProgram,u=this.currentData,c=u.refreshBuffers,d=!!this.hasCapTexture(),g=this.activeAttributes.applyLighting,p=u.capTriangles.length/(d?5:3);l.loadTextureEnabled(h,!1),this.applyMvpMatrix(t),u.capVboCacheKey||(u.capVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(u.capVboCacheKey),i||(i=h.createBuffer(),t.gpuResourceCache.putResource(u.capVboCacheKey,i,4*u.capTriangles.length),c=!0),h.bindBuffer(h.ARRAY_BUFFER,i),c&&(a=g?this.makeCapBufferWithNormals():u.capTriangles,h.bufferData(h.ARRAY_BUFFER,a,h.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),o=this.activeAttributes.interiorColor,r=o.alpha*t.currentLayer.opacity,h.depthMask(r>=1||t.pickingMode),l.loadColor(h,t.pickingMode?e:o),l.loadOpacity(h,t.pickingMode?r>0?1:0:r),n=12+(d?8:0)+(g?12:0),d&&!t.pickingMode&&(this.activeTexture=t.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.capImageSource())),s=this.activeTexture&&this.activeTexture.bind(t),s&&(l.loadTextureEnabled(h,!0),h.enableVertexAttribArray(l.vertexTexCoordLocation),h.vertexAttribPointer(l.vertexTexCoordLocation,2,h.FLOAT,!1,n,12),l.loadTextureUnit(h,h.TEXTURE0),l.loadModulateColor(h,t.pickingMode))),g&&!t.pickingMode&&(l.loadApplyLighting(h,!0),h.enableVertexAttribArray(l.normalVectorLocation),h.vertexAttribPointer(l.normalVectorLocation,3,h.FLOAT,!1,n,n-12)),h.vertexAttribPointer(l.vertexPointLocation,3,h.FLOAT,!1,n,0),h.drawArrays(h.TRIANGLES,0,p)},E.prototype.makeCapBufferWithNormals=function(){for(var t=this.currentData,e=t.capNormal,i=this.hasCapTexture()?5:3,r=i+3,o=t.capTriangles.length/i,n=t.capTriangles,s=new Float32Array(o*r),a=0,h=0;o>h;h++){for(var l=0;i>l;l++)s[a++]=n[h*i+l];s[a++]=e[0],s[a++]=e[1],s[a++]=e[2]}return s},E.prototype.drawSides=function(t,e){var i,r,o,n,s,a,h=t.currentGlContext,l=t.currentProgram,u=this.currentData,c=u.refreshBuffers,d=this.hasSideTextures(),g=this.activeAttributes.applyLighting,p=3+(d?2:0)+(g?3:0),f=4*p;a=0;for(var m=0;m<u.boundaryPoints.length;m++)a+=u.boundaryPoints[m].length/6-1;if(u.sidesVboCacheKey||(u.sidesVboCacheKey=t.gpuResourceCache.generateCacheKey()),i=t.gpuResourceCache.resourceForKey(u.sidesVboCacheKey),!i||c?(s=this.makeSidesBuffer(a),u.numSideVertices=s.length/p,i||(i=h.createBuffer()),t.gpuResourceCache.putResource(u.sidesVboCacheKey,i,4*s.length),h.bindBuffer(h.ARRAY_BUFFER,i),h.bufferData(h.ARRAY_BUFFER,s,h.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)):h.bindBuffer(h.ARRAY_BUFFER,i),o=this.activeAttributes.interiorColor,r=o.alpha*t.currentLayer.opacity,h.depthMask(r>=1||t.pickingMode),l.loadColor(h,t.pickingMode?e:o),l.loadOpacity(h,t.pickingMode?r>0?1:0:r),d&&!t.pickingMode){this.activeTexture=t.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=t.gpuResourceCache.retrieveTexture(t.currentGlContext,this.capImageSource())),g?(l.loadApplyLighting(h,!0),h.enableVertexAttribArray(l.normalVectorLocation)):l.loadApplyLighting(h,!1);for(var E=0;a>E;E++){var y=this.sideImageSource(E),_=t.gpuResourceCache.resourceForKey(y),v=6*E*f;y&&!_&&(_=t.gpuResourceCache.retrieveTexture(t.currentGlContext,y)),n=_&&_.bind(t),n?(l.loadTextureEnabled(h,!0),l.loadTextureUnit(h,h.TEXTURE0),h.enableVertexAttribArray(l.vertexTexCoordLocation),h.vertexAttribPointer(l.vertexTexCoordLocation,2,h.FLOAT,!1,f,v+12)):(l.loadTextureEnabled(h,!1),h.disableVertexAttribArray(l.vertexTexCoordLocation)),g&&h.vertexAttribPointer(l.normalVectorLocation,3,h.FLOAT,!1,f,v+20),h.vertexAttribPointer(l.vertexPointLocation,3,h.FLOAT,!1,f,v),h.drawArrays(h.TRIANGLES,0,6)}}else l.loadTextureEnabled(h,!1),g&&!t.pickingMode?(l.loadApplyLighting(h,!0),h.enableVertexAttribArray(l.normalVectorLocation),h.vertexAttribPointer(l.normalVectorLocation,3,h.FLOAT,!1,f,f-12)):l.loadApplyLighting(h,!1),h.vertexAttribPointer(l.vertexPointLocation,3,h.FLOAT,!1,f,0),h.drawArrays(h.TRIANGLES,0,u.numSideVertices)},E.prototype.makeSidesBuffer=function(t){var e,i,r,o,n,s,a,h,l,u,c,d=this.currentData,g=this.hasSideTextures(),m=this.activeAttributes.applyLighting,E=3+(g?2:0)+(m?3:0);r=2*t*3*E,e=new Float32Array(r),i=0,o=new f(0,0,0),n=new f(0,0,0),s=new f(0,0,0),a=new f(0,0,0),g?(h=new p(0,1),l=new p(0,0),u=new p(1,1),c=new p(1,0)):h=l=u=c=null;for(var y=0;y<d.boundaryPoints.length;y++)for(var _,v=d.boundaryPoints[y],L=0;L<v.length-6;L+=6)o[0]=v[L],o[1]=v[L+1],o[2]=v[L+2],n[0]=v[L+3],n[1]=v[L+4],n[2]=v[L+5],s[0]=v[L+6],s[1]=v[L+7],s[2]=v[L+8],a[0]=v[L+9],a[1]=v[L+10],a[2]=v[L+11],_=m?f.computeTriangleNormal(o,n,s):null,this.addVertexToBuffer(o,h,_,e,i),i+=E,this.addVertexToBuffer(n,l,_,e,i),i+=E,this.addVertexToBuffer(s,u,_,e,i),i+=E,this.addVertexToBuffer(n,l,_,e,i),i+=E,this.addVertexToBuffer(a,c,_,e,i),i+=E,this.addVertexToBuffer(s,u,_,e,i),i+=E;return e},E.prototype.addVertexToBuffer=function(t,e,i,r,o){r[o++]=t[0],r[o++]=t[1],r[o++]=t[2],e&&(r[o++]=e[0],r[o++]=e[1]),i&&(r[o++]=i[0],r[o++]=i[1],r[o]=i[2])},E.prototype.drawOutline=function(t,e){var i,r,o,n,s,a,h=t.currentGlContext,l=t.currentProgram,u=this.currentData,c=u.refreshBuffers;l.loadTextureEnabled(h,!1),l.loadApplyLighting(h,!1),this.hasCapTexture()&&h.disableVertexAttribArray(l.vertexTexCoordLocation),this.activeAttributes.applyLighting&&h.disableVertexAttribArray(l.normalVectorLocation),u.boundaryVboCacheKeys||(this.currentData.boundaryVboCacheKeys=[]),this.applyMvpMatrixForOutline(t),l.loadTextureEnabled(h,!1),h.disableVertexAttribArray(l.vertexTexCoordLocation);for(var d=0;d<u.boundaryPoints.length;d++)i=u.boundaryPoints[d].length/3,u.boundaryVboCacheKeys[d]||(u.boundaryVboCacheKeys[d]=t.gpuResourceCache.generateCacheKey()),r=t.gpuResourceCache.resourceForKey(u.boundaryVboCacheKeys[d]),r||(r=h.createBuffer(),t.gpuResourceCache.putResource(u.boundaryVboCacheKeys[d],r,12*i),c=!0),h.bindBuffer(h.ARRAY_BUFFER,r),c&&(h.bufferData(h.ARRAY_BUFFER,u.boundaryPoints[d],h.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),n=this.activeAttributes.outlineColor,o=n.alpha*t.currentLayer.opacity,h.depthMask(o>=1||t.pickingMode),l.loadColor(h,t.pickingMode?e:n),l.loadOpacity(h,t.pickingMode?1:o),h.lineWidth(this.activeAttributes.outlineWidth),this._extrude?(s=24,a=i/2):(s=12,a=i),h.vertexAttribPointer(l.vertexPointLocation,3,h.FLOAT,!1,s,0),h.drawArrays(h.LINE_STRIP,0,a),this.mustDrawVerticals(t)&&(h.vertexAttribPointer(l.vertexPointLocation,3,h.FLOAT,!1,0,0),h.drawArrays(h.LINES,0,i-2))},E.prototype.beginDrawing=function(t){var e=t.currentGlContext;this.activeAttributes.drawInterior&&e.disable(e.CULL_FACE),t.findAndBindProgram(i),e.enableVertexAttribArray(t.currentProgram.vertexPointLocation);var r=!t.pickMode&&this.activeAttributes.applyLighting;r&&t.currentProgram.loadModelviewInverse(e,t.navigatorState.modelviewNormalTransform)},E.prototype.endDrawing=function(t){var e=t.currentGlContext;e.disableVertexAttribArray(t.currentProgram.vertexPointLocation),e.disableVertexAttribArray(t.currentProgram.normalVectorLocation),e.depthMask(!0),e.lineWidth(1),e.enable(e.CULL_FACE)},E}),i("shapes/SurfacePolyline",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(t,e,i,r){"use strict";var o=function(i,o){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfacePolyline","constructor","The specified locations array is null or undefined."));r.call(this,o),this._boundaries=i,this._isInteriorInhibited=!0};return o.prototype=Object.create(r.prototype),o.staticStateKey=function(t){var e=r.staticStateKey(t);return e},o.prototype.computeStateKey=function(){return o.staticStateKey(this)},o}),i("formats/geojson/GeoJSONParser",["../../error/ArgumentError","../../util/Color","./GeoJSONConstants","./GeoJSONCRS","./GeoJSONFeature","./GeoJSONFeatureCollection","./GeoJSONGeometry","./GeoJSONGeometryCollection","./GeoJSONGeometryLineString","./GeoJSONGeometryMultiLineString","./GeoJSONGeometryMultiPoint","./GeoJSONGeometryMultiPolygon","./GeoJSONGeometryPoint","./GeoJSONGeometryPolygon","../../geom/Location","../../util/Logger","../../shapes/Placemark","../../shapes/PlacemarkAttributes","../../shapes/Polygon","../../geom/Position","../../util/proj4-src","../../layer/RenderableLayer","../../shapes/ShapeAttributes","../../shapes/SurfacePolygon","../../shapes/SurfacePolyline"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L,S,T,b){"use strict";var w=function(e){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","constructor","missingUrl"));this._url=e,this._geoJSONObject=null,this._geoJSONType=null,this._crs=null,this._layer=null,this._shapeConfigurationCallback=this.defaultShapeConfigurationCallback,this.defaultPlacemarkAttributes=new E(null),this.defaultShapeAttributes=new S(null),this.setProj4jsAliases()};return Object.defineProperties(w.prototype,{url:{get:function(){return this._url}},geoJSONObject:{get:function(){return this._geoJSONObject}},geoJSONType:{get:function(){return this._geoJSONType}},crs:{get:function(){return this._crs}},layer:{get:function(){return this._layer}},shapeConfigurationCallback:{get:function(){return this._shapeConfigurationCallback}}}),w.prototype.load=function(t,e){t&&(this._shapeConfigurationCallback=t),this._layer=e||new L,this.requestUrl(this.url)},w.prototype.defaultShapeConfigurationCallback=function(t,e){var i={},r=e.name||e.Name||e.NAME;return r&&(i.name=r),t.isPointType()||t.isMultiPointType()?i.attributes=this.defaultPlacemarkAttributes:t.isLineStringType()||t.isMultiLineStringType()?i.attributes=this.defaultShapeAttributes:(t.isPolygonType()||t.isMultiPolygonType())&&(i.attributes=this.defaultShapeAttributes),i},w.prototype.requestUrl=function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="text",e.onreadystatechange=function(){4===e.readyState&&(200===e.status?this.parse(e.response):f.log(f.LEVEL_WARNING,"GeoJSON retrieval failed ("+e.statusText+"): "+t))}.bind(this),e.onerror=function(){f.log(f.LEVEL_WARNING,"GeoJSON retrieval failed: "+t)},e.ontimeout=function(){f.log(f.LEVEL_WARNING,"GeoJSON retrieval timed out: "+t)},e.send(null)},w.prototype.parse=function(e){try{this._geoJSONObject=JSON.parse(e)}catch(r){console.log(r)}finally{if(this.geoJSONObject){if("[object Array]"===Object.prototype.toString.call(this.geoJSONObject))throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","parse","invalidGeoJSONObjectLength"));if(!this.geoJSONObject.hasOwnProperty(i.FIELD_TYPE))throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","parse","missingGeoJSONType"));this.setGeoJSONType(),this.setGeoJSONCRS()}}},w.prototype.setGeoJSONCRS=function(){if(this.geoJSONObject[i.FIELD_CRS]){this._crs=new r(this.geoJSONObject[i.FIELD_CRS][i.FIELD_TYPE],this.geoJSONObject[i.FIELD_CRS][i.FIELD_PROPERTIES]);var t=function(){this.addRenderablesForGeoJSON(this.layer)}.bind(this);this.crs.setCRSString(t)}else this.addRenderablesForGeoJSON(this.layer)},w.prototype.addRenderablesForGeoJSON=function(e){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeoJSON","missingLayer"));switch(this.geoJSONType){case i.TYPE_FEATURE:var r=new o(this.geoJSONObject[i.FIELD_GEOMETRY],this.geoJSONObject[i.FIELD_PROPERTIES],this.geoJSONObject[i.FIELD_ID],this.geoJSONObject[i.FIELD_BBOX]);this.addRenderablesForFeature(e,r);break;case i.TYPE_FEATURE_COLLECTION:var s=new n(this.geoJSONObject[i.FIELD_FEATURES],this.geoJSONObject[i.FIELD_BBOX]);this.addRenderablesForFeatureCollection(e,s);break;case i.TYPE_GEOMETRY_COLLECTION:var h=new a(this.geoJSONObject[i.FIELD_GEOMETRIES],this.geoJSONObject[i.FIELD_BBOX]);this.addRenderablesForGeometryCollection(e,h,null);break;default:this.addRenderablesForGeometry(e,this.geoJSONObject,null)}},w.prototype.addRenderablesForGeometry=function(e,r,o){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometry","missingLayer"));if(!r)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometry","missingGeometry"));switch(r[i.FIELD_TYPE]){case i.TYPE_POINT:var n=new d(r[i.FIELD_COORDINATES],r[i.FIELD_TYPE],r[i.FIELD_BBOX]);this.addRenderablesForPoint(e,n,o?o:null);break;case i.TYPE_MULTI_POINT:var s=new u(r[i.FIELD_COORDINATES],r[i.FIELD_TYPE],r[i.FIELD_BBOX]);this.addRenderablesForMultiPoint(e,s,o?o:null);break;case i.TYPE_LINE_STRING:var a=new h(r[i.FIELD_COORDINATES],r[i.FIELD_TYPE],r[i.FIELD_BBOX]);this.addRenderablesForLineString(e,a,o?o:null);break;case i.TYPE_MULTI_LINE_STRING:var p=new l(r[i.FIELD_COORDINATES],r[i.FIELD_TYPE],r[i.FIELD_BBOX]);this.addRenderablesForMultiLineString(e,p,o?o:null);break;case i.TYPE_POLYGON:var m=new g(r[i.FIELD_COORDINATES],r[i.FIELD_TYPE],r[i.FIELD_BBOX]);this.addRenderablesForPolygon(e,m,o?o:null);break;case i.TYPE_MULTI_POLYGON:var E=new c(r[i.FIELD_COORDINATES],r[i.FIELD_TYPE],r[i.FIELD_BBOX]);this.addRenderablesForMultiPolygon(e,E,o?o:null)}},w.prototype.addRenderablesForPoint=function(e,i,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForPoint","missingLayer"));if(!i)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForPoint","missingGeometry"));var o=this.shapeConfigurationCallback(i,r);if(!this.crs||this.crs.isCRSSupported()){var n=i.coordinates[0],s=i.coordinates[1],a=i.coordinates[2]?i.coordinates[2]:0,h=this.getReprojectedIfRequired(s,n,this.crs),l=new _(h[1],h[0],a),u=new m(l,!1,o&&o.attributes?o.attributes:null);u.altitudeMode=WorldWind.RELATIVE_TO_GROUND,o&&o.name&&(u.label=o.name),e.addRenderable(u)}},w.prototype.addRenderablesForMultiPoint=function(e,i,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPoint","missingLayer"));if(!i)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPoint","missingGeometry"));var o=this.shapeConfigurationCallback(i,r);if(!this.crs||this.crs.isCRSSupported())for(var n=0,s=i.coordinates.length;s>n;n+=1){var a=i.coordinates[n][0],h=i.coordinates[n][1],l=i.coordinates[n][2]?i.coordinates[n][2]:0,u=this.getReprojectedIfRequired(h,a,this.crs),c=new _(u[1],u[0],l),d=new m(c,!1,o&&o.attributes?o.attributes:null);d.altitudeMode=WorldWind.RELATIVE_TO_GROUND,o&&o.name&&(d.label=o.name),e.addRenderable(d)}},w.prototype.addRenderablesForLineString=function(e,i,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForLineString","missingLayer"));if(!i)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForLineString","missingGeometry"));var o=this.shapeConfigurationCallback(i,r);if(!this.crs||this.crs.isCRSSupported()){for(var n=[],s=0,a=i.coordinates;s<a.length;s++){var h=a[s][0],l=a[s][1],u=this.getReprojectedIfRequired(l,h,this.crs),c=new p(u[1],u[0]);n.push(c)}var d;d=new b(n,o&&o.attributes?o.attributes:null),e.addRenderable(d)}},w.prototype.addRenderablesForMultiLineString=function(e,i,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiLineString","missingLayer"));if(!i)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiLineString","missingGeometry"));var o=this.shapeConfigurationCallback(i,r);if(!this.crs||this.crs.isCRSSupported())for(var n=0,s=i.coordinates;n<s.length;n++){for(var a=[],h=0,l=s[n];h<l.length;h++){var u=l[h][0],c=l[h][1],d=this.getReprojectedIfRequired(c,u,this.crs),g=new p(d[1],d[0]);a.push(g)}var m;m=new b(a,o&&o.attributes?o.attributes:null),e.addRenderable(m)}},w.prototype.addRenderablesForPolygon=function(e,i,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingLayer"));if(!i)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingGeometry"));var o=this.shapeConfigurationCallback(i,r);if(!this.crs||this.crs.isCRSSupported())for(var n=0,s=i.coordinates;n<s.length;n++){for(var a=[],h=0,l=s[n];h<l.length;h++){var u=l[h][0],c=l[h][1],d=this.getReprojectedIfRequired(c,u,this.crs),g=new p(d[1],d[0]);a.push(g)}var m;m=new T(a,o&&o.attributes?o.attributes:null),e.addRenderable(m)}},w.prototype.addRenderablesForMultiPolygon=function(e,i,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingLayer"));if(!i)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingGeometry"));var o=this.shapeConfigurationCallback(i,r);if(!this.crs||this.crs.isCRSSupported())for(var n=0,s=i.coordinates;n<s.length;n++){for(var a=[],h=0;h<s[n].length;h++){for(var l=[],u=0,c=s[n][h];u<c.length;u++){var d=c[u][0],g=c[u][1],m=this.getReprojectedIfRequired(g,d,this.crs),E=new p(m[1],m[0]);l.push(E)}a.push(l)}var y;y=new T(a,o&&o.attributes?o.attributes:null),e.addRenderable(y)}},w.prototype.addRenderablesForGeometryCollection=function(e,r,o){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometryCollection","missingLayer"));if(!r)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometryCollection","missingGeometryCollection"));for(var n=0,s=r.geometries;n<s.length;n++)s[n].hasOwnProperty(i.FIELD_TYPE)&&this.addRenderablesForGeometry(e,s[n],o)},w.prototype.addRenderablesForFeature=function(e,r){
if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeature","missingLayer"));if(!r)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeature","missingFeature"));if(r.geometry.type===i.TYPE_GEOMETRY_COLLECTION){var o=new a(r.geometry.geometries,r.bbox);this.addRenderablesForGeometryCollection(e,o,r.properties)}else this.addRenderablesForGeometry(e,r.geometry,r.properties)},w.prototype.addRenderablesForFeatureCollection=function(e,r){if(!e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeatureCollection","missingLayer"));if(!r)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeatureCollection","missingFeatureCollection"));if(r.features.length>0)for(var n=0;n<r.features.length;n++){var s=new o(r.features[n][i.FIELD_GEOMETRY],r.features[n][i.FIELD_PROPERTIES],r.features[n][i.FIELD_ID],r.features[n][i.FIELD_BBOX]);this.addRenderablesForFeature(e,s)}},w.prototype.setGeoJSONType=function(){switch(this.geoJSONObject[i.FIELD_TYPE]){case i.TYPE_POINT:this._geoJSONType=i.TYPE_POINT;break;case i.TYPE_MULTI_POINT:this._geoJSONType=i.TYPE_MULTI_POINT;break;case i.TYPE_LINE_STRING:this._geoJSONType=i.TYPE_LINE_STRING;break;case i.TYPE_MULTI_LINE_STRING:this._geoJSONType=i.TYPE_MULTI_LINE_STRING;break;case i.TYPE_POLYGON:this._geoJSONType=i.TYPE_POLYGON;break;case i.TYPE_MULTI_POLYGON:this._geoJSONType=i.TYPE_MULTI_POLYGON;break;case i.TYPE_GEOMETRY_COLLECTION:this._geoJSONType=i.TYPE_GEOMETRY_COLLECTION;break;case i.TYPE_FEATURE:this._geoJSONType=i.TYPE_FEATURE;break;case i.TYPE_FEATURE_COLLECTION:this._geoJSONType=i.TYPE_FEATURE_COLLECTION;break;default:throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","setGeoJSONType","invalidGeoJSONType"))}},w.prototype.getReprojectedIfRequired=function(e,r,o){if(!e&&0!==e)throw new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","getReprojectedIfRequired","missingLatitude"));if(!r&&0!==r)throw console.log(r),new t(f.logMessage(f.LEVEL_SEVERE,"GeoJSON","getReprojectedIfRequired","missingLongitude"));return!o||o.isDefault()?[r,e]:v(o.projectionString,i.EPSG4326_CRS,[r,e])},w.prototype.setProj4jsAliases=function(){v.defs([["urn:ogc:def:crs:OGC:1.3:CRS84",v.defs("EPSG:4326")],["urn:ogc:def:crs:EPSG::3857",v.defs("EPSG:3857")]])},w}),i("projections/ProjectionEquirectangular",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Vec3"],function(t,e,i,r,o){"use strict";var n=function(){i.call(this,"Equirectangular",!0,null)};return n.prototype=Object.create(i.prototype),Object.defineProperties(n.prototype,{stateKey:{get:function(){return"projection equirectangular "}}}),n.prototype.geographicToCartesian=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingResult"));return h[0]=i.equatorialRadius*n*t.DEGREES_TO_RADIANS+(a?a[0]:0),h[1]=i.equatorialRadius*o*t.DEGREES_TO_RADIANS,h[2]=s,h},n.prototype.geographicToCartesianGrid=function(i,n,s,a,h,l,u,c){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingGlobe"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingSector"));if(!h||h.length<s*a)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!c)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingResult"));var d,g,p,f,m,E=i.equatorialRadius,y=n.minLatitude*t.DEGREES_TO_RADIANS,_=n.maxLatitude*t.DEGREES_TO_RADIANS,v=n.minLongitude*t.DEGREES_TO_RADIANS,L=n.maxLongitude*t.DEGREES_TO_RADIANS,S=(_-y)/(s>1?s-1:1),T=(L-v)/(a>1?a-1:1),b=l?l:new o(0,0,0),w=u?u[0]:0,M=0,R=0;for(d=0,p=y;s>d;d++,p+=S)for(d===s-1&&(p=_),m=E*p-b[1],g=0,f=v;a>g;g++,f+=T)g===a-1&&(f=L),c[R++]=E*f-b[0]+w,c[R++]=m,c[R++]=h[M++]-b[2];return c},n.prototype.cartesianToGeographic=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingResult"));return h.latitude=n/i.equatorialRadius*t.RADIANS_TO_DEGREES,h.longitude=(o-(a?a[0]:0))/i.equatorialRadius*t.RADIANS_TO_DEGREES,h.altitude=s,h},n}),i("globe/ZeroElevationModel",["../error/ArgumentError","../globe/ElevationModel","../geom/Location","../util/Logger","../geom/Sector"],function(t,e,i,r,o){"use strict";var n=function(){e.call(this,o.FULL_SPHERE,new i(45,45),1," "," ",150,150),this.displayName="Zero Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0};return n.prototype=Object.create(e.prototype),n.prototype.minAndMaxElevationsForSector=function(t){return[0,0]},n.prototype.elevationAtLocation=function(t,e){return 0},n.prototype.elevationsForGrid=function(e,i,o,n,s){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingSector"));if(0>=i||0>=o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","numLat or numLon is less than 1"));if(!s||s.length<i*o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingArray"));for(var a=0,h=s.length;h>a;a++)s[a]=0;return 0},n}),i("globe/Globe2D",["../geom/Angle","../error/ArgumentError","../geom/BoundingBox","../projections/GeographicProjection","../globe/Globe","../util/Logger","../projections/ProjectionEquirectangular","../geom/Sector","../globe/Tessellator","../geom/Vec3","../globe/ZeroElevationModel"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(){o.call(this,new u),this._projection=new s,this._offset=0,this.offsetVector=new l(0,0,0)};return c.prototype=Object.create(o.prototype),Object.defineProperties(c.prototype,{continuous:{get:function(){return this.projection.continuous}},projection:{get:function(){return this._projection},set:function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe2D","projection","missingProjection"));this.projection!=t&&(this.tessellator=new h),this._projection=t}},projectionLimits:{get:function(){return this._projection.projectionLimits}},offset:{get:function(){return this._offset},set:function(t){this._offset=t,this.offsetVector[0]=2*t*Math.PI*this.equatorialRadius}},stateKey:{get:function(){return this._stateKey+this.elevationModel.stateKey+"offset "+this.offset.toString()+" "+this.projection.stateKey}}}),c.prototype.is2D=function(){return!0},c.prototype.computePointFromPosition=function(t,i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe2D","computePointFromPosition","missingResult"));return this.projection.geographicToCartesian(this,t,i,r,this.offsetVector,o)},c.prototype.computePointsForGrid=function(t,e,i,r,o,n){return this.projection.geographicToCartesianGrid(this,t,e,i,r,o,this.offsetVector,n)},c.prototype.computePositionFromPoint=function(t,i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe2D","computePositionFromPoint","missingResult"));return this.projection.cartesianToGeographic(this,t,i,r,this.offsetVector,o),o.longitude<-180?o.longitude+=360:o.longitude>180&&(o.longitude-=360),o},c.prototype.surfaceNormalAtLocation=function(t,i,r){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe2D","surfaceNormalAtLocation","missingResult"));return r[0]=0,r[1]=0,r[2]=1,r},c.prototype.surfaceNormalAtPoint=function(t,i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","surfaceNormalAtPoint","missingResult"));return o[0]=0,o[1]=0,o[2]=1,o},c.prototype.northTangentAtLocation=function(t,i,r){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","northTangentAtLocation","missingResult"));return this.projection.northTangentAtLocation(this,t,i,r)},c.prototype.northTangentAtPoint=function(t,i,r,o){if(!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe2D","northTangentAtPoint","missingResult"));return this.projection.northTangentAtPoint(this,t,i,r,this.offsetVector,o)},c.prototype.intersectsFrustum=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe2D","intersectsFrustum","missingFrustum"));var r=new i;return r.setToSector(a.FULL_SPHERE,this,this.elevationModel.minElevation,this.elevationModel.maxElevation),r.intersectsFrustum(t)},c.prototype.intersectsLine=function(t,i){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","intersectWithRay","missingLine"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Globe","intersectsLine","missingResult"));var r,o=t.direction[0],s=t.direction[1],a=t.direction[2],h=t.origin[0],l=t.origin[1],u=t.origin[2];return 0==a&&0!=u?!1:(r=-u/a,0>r?!1:(i[0]=h+o*r,i[1]=l+s*r,i[2]=u+a*r,!0))},c}),i("util/GoToAnimator",["../geom/Location","../util/Logger","../geom/Position","../geom/Vec3"],function(t,e,i,r){"use strict";var o=function(t){if(!t)throw new ArgumentError(e.logMessage(e.LEVEL_SEVERE,"GoToAnimator","constructor","missingWorldWindow"));this.wwd=t,this.animationFrequency=20,this.travelTime=3e3,this.cancelled=!1};return o.prototype.cancel=function(){this.cancelled=!0},o.prototype.goTo=function(o,n){if(!o)throw new ArgumentError(e.logMessage(e.LEVEL_SEVERE,"GoToAnimator","goTo","missingPosition"));this.completionCallback=n,this.cancelled=!1,this.targetPosition=new i(o.latitude,o.longitude,o.altitude||this.wwd.navigator.range),this.startPosition=new i(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),this.startTime=Date.now();var s,a=this.travelTime,h=t.greatCircleDistance(this.startPosition,this.targetPosition),l=this.wwd.globe.computePointFromLocation(this.startPosition.latitude,this.startPosition.longitude,new r(0,0,0)),u=this.wwd.globe.computePointFromLocation(this.targetPosition.latitude,this.targetPosition.longitude,new r(0,0,0));this.maxAltitude=l.distanceTo(u);var c=this.wwd.navigator.currentState().pixelSizeAtDistance(this.startPosition.altitude)*this.wwd.canvas.clientWidth/this.wwd.globe.equatorialRadius;2*c>=h&&(this.maxAltitude=this.startPosition.altitude),this.maxAltitudeReachedTime=this.maxAltitude<=this.wwd.navigator.range?Date.now():null,this.maxAltitude>this.startPosition.altitude?(s=Math.max(0,this.maxAltitude-this.startPosition.altitude),s+=Math.abs(this.targetPosition.altitude-this.maxAltitude)):s=Math.abs(this.targetPosition.altitude-this.startPosition.altitude);var d=Math.max(h,s/this.wwd.globe.equatorialRadius);if(0!==d){2*c>d&&(a=Math.min(d/c*this.travelTime,this.travelTime)),a=Math.max(1,a),this.panVelocity=h/a,this.rangeVelocity=s/a;var g=this,p=function(){return g.cancelled?void(g.completionCallback&&g.completionCallback(g)):void(g.update()?setTimeout(p,g.animationFrequency):g.completionCallback&&g.completionCallback(g))};setTimeout(p,this.animationFrequency)}},o.prototype.update=function(){var t=new i(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),e=this.updateRange(t);return e=this.updateLocation(t)||e,this.wwd.redraw(),e},o.prototype.updateRange=function(t){var e,i,r=!1;return this.maxAltitudeReachedTime?(i=Date.now()-this.maxAltitudeReachedTime,this.maxAltitude>this.targetPosition.altitude?(e=this.maxAltitude-this.rangeVelocity*i,e=Math.max(e,this.targetPosition.altitude)):(e=this.maxAltitude+this.rangeVelocity*i,e=Math.min(e,this.targetPosition.altitude)),this.wwd.navigator.range=e,r=Math.abs(this.wwd.navigator.range-this.targetPosition.altitude)>1):(i=Date.now()-this.startTime,e=Math.min(this.startPosition.altitude+this.rangeVelocity*i,this.maxAltitude),Math.abs(this.wwd.navigator.range-e)<1&&(this.maxAltitudeReachedTime=Date.now()),this.wwd.navigator.range=e,r=!0),r},o.prototype.updateLocation=function(e){var i=Date.now()-this.startTime,r=t.greatCircleDistance(this.startPosition,e),o=t.greatCircleDistance(e,this.targetPosition),n=t.greatCircleAzimuth(e,this.targetPosition),s=this.panVelocity*i,a=Math.min(s-r,o),h=t.greatCircleLocation(e,n,a,new t(0,0)),l=!1;return this.wwd.navigator.lookAtLocation.latitude=h.latitude,this.wwd.navigator.lookAtLocation.longitude=h.longitude,a<1/this.wwd.globe.equatorialRadius&&(l=!0),!l},o}),i("util/HighlightController",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"HighlightController","constructor","missingWorldWindow"));this.worldWindow=i;var r=[],o=function(t){for(var e=t.clientX,o=t.clientY,n=r.length>0,s=0;s<r.length;s++)r[s].highlighted=!1;r=[];var a=i.pick(i.canvasCoordinates(e,o));if(a.objects.length>0&&(n=!0),a.objects.length>0)for(var h=0;h<a.objects.length;h++)a.objects[h].isTerrain||(a.objects[h].userObject.highlighted=!0,r.push(a.objects[h].userObject));n&&i.redraw()};this.worldWindow.addEventListener("mousemove",o);new WorldWind.TapRecognizer(this.worldWindow,o)};return i}),i("layer/LandsatRestLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/LevelRowColumnUrlBuilder","../util/WWUtil"],function(t,e,i,r,o,n,s){"use strict";var a=function(t,i,a){var h=s.urlPath(t+"/"+i);o.call(this,r.FULL_SPHERE,new e(36,36),10,"image/png",h,512,512),this.displayName=a,this.pickEnabled=!1,this.urlBuilder=new n(t,i)};return a.prototype=Object.create(o.prototype),a}),i("navigate/Navigator",["../error/ArgumentError","../util/Logger","../geom/Matrix","../navigate/NavigatorState","../geom/Position","../error/UnsupportedOperationError","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a){"use strict";var h=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Navigator","constructor","missingWorldWindow"));this.worldWindow=i,this.heading=0,this.tilt=0,this.roll=0,this.nearDistance=1,this.farDistance=1e7};return h.prototype.currentState=function(){throw new n(e.logMessage(e.LEVEL_SEVERE,"Navigator","currentState","abstractInvocation"))},h.prototype.currentStateForModelview=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Navigator","currentStateForModelview","missingMatrix"));var h,l,u=this.worldWindow.globe,c=a.max(u.equatorialRadius,u.polarRadius),d=n.extractEyePoint(new s(0,0,0)),g=u.computePositionFromPoint(d[0],d[1],d[2],new o(0,0,0)),p=this.worldWindow.viewport,f=this.worldWindow.depthBits,m=i.fromIdentity();return this.farDistance=a.horizonDistanceForGlobeRadius(c,g.altitude),this.farDistance<1e3&&(this.farDistance=1e3),this.nearDistance=a.perspectiveNearDistanceForFarDistance(this.farDistance,10,f),h=g.altitude-u.elevationAtLocation(g.latitude,g.longitude),h>0&&(l=a.perspectiveNearDistance(p.width,p.height,h),this.nearDistance>l&&(this.nearDistance=l)),this.nearDistance<1&&(this.nearDistance=1),m.setToPerspectiveProjection(p.width,p.height,this.nearDistance,this.farDistance),new r(n,m,p,this.heading,this.tilt)},h}),i("gesture/PanRecognizer",["../gesture/GestureRecognizer"],function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.minNumberOfTouches=1,this.maxNumberOfTouches=Number.MAX_VALUE,this.interpretDistance=20};return e.prototype=Object.create(t.prototype),e.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.touchMove=function(t){this.state==WorldWind.POSSIBLE?this.shouldInterpret()&&(this.shouldRecognize()?this.state=WorldWind.BEGAN:this.state=WorldWind.FAILED):(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.CHANGED)},e.prototype.touchEnd=function(t){0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.ENDED))},e.prototype.touchCancel=function(t){0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.CANCELLED))},e.prototype.prepareToRecognize=function(){this.translationX=0,this.translationY=0},e.prototype.shouldInterpret=function(){var t=this.translationX,e=this.translationY,i=Math.sqrt(t*t+e*e);return i>this.interpretDistance},e.prototype.shouldRecognize=function(){var t=this.touchCount;return 0!=t&&t>=this.minNumberOfTouches&&t<=this.maxNumberOfTouches},e}),i("gesture/PinchRecognizer",["../gesture/GestureRecognizer"],function(t){"use strict";var e=function(e,i){t.call(this,e,i),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.interpretThreshold=20,this.weight=.4,this.pinchTouches=[]};return e.prototype=Object.create(t.prototype),Object.defineProperties(e.prototype,{scale:{get:function(){return this._scale*this._offsetScale}}}),e.prototype.reset=function(){t.prototype.reset.call(this),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.pinchTouches=[]},e.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.touchStart=function(t){this.pinchTouches.length<2&&2==this.pinchTouches.push(t)&&(this.referenceDistance=this.currentPinchDistance(),this._offsetScale*=this._scale,this._scale=1)},e.prototype.touchMove=function(t){if(2==this.pinchTouches.length)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var e=this.currentPinchDistance(),i=Math.abs(e/this.referenceDistance),r=this.weight;this._scale=this._scale*(1-r)+i*r,this.state=WorldWind.CHANGED}},e.prototype.touchEnd=function(t){var e=this.pinchTouches.indexOf(t);-1!=e&&this.pinchTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.ENDED))},e.prototype.touchCancel=function(t){var e=this.pinchTouches.indexOf(t);-1!=e&&this.pinchTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.CANCELLED))},e.prototype.prepareToRecognize=function(){this.referenceDistance=this.currentPinchDistance(),this._scale=1},e.prototype.shouldRecognize=function(){var t=this.currentPinchDistance();return Math.abs(t-this.referenceDistance)>this.interpretThreshold},e.prototype.currentPinchDistance=function(){var t=this.pinchTouches[0],e=this.pinchTouches[1],i=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(i*i+r*r)},e}),i("gesture/RotationRecognizer",["../geom/Angle","../gesture/GestureRecognizer"],function(t,e){"use strict";var i=function(t,i){e.call(this,t,i),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.interpretThreshold=20,this.weight=.4,this.rotationTouches=[]};return i.prototype=Object.create(e.prototype),Object.defineProperties(i.prototype,{rotation:{get:function(){return this._rotation+this._offsetRotation}}}),i.prototype.reset=function(){e.prototype.reset.call(this),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.rotationTouches=[]},i.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},i.prototype.touchStart=function(t){this.rotationTouches.length<2&&2==this.rotationTouches.push(t)&&(this.referenceAngle=this.currentTouchAngle(),this._offsetRotation+=this._rotation,this._rotation=0)},i.prototype.touchMove=function(e){if(2==this.rotationTouches.length)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var i=this.currentTouchAngle(),r=t.normalizedDegrees(i-this.referenceAngle),o=this.weight;this._rotation=this._rotation*(1-o)+r*o,this.state=WorldWind.CHANGED}},i.prototype.touchEnd=function(t){var e=this.rotationTouches.indexOf(t);-1!=e&&this.rotationTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.ENDED))},i.prototype.touchCancel=function(t){var e=this.rotationTouches.indexOf(t);-1!=e&&(this.rotationTouches.splice(e,1),0==this.touchCount&&(this.state==WorldWind.POSSIBLE?this.state=WorldWind.FAILED:(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)&&(this.state=WorldWind.CANCELLED)))},i.prototype.prepareToRecognize=function(){this.referenceAngle=this.currentTouchAngle(),this._rotation=0},i.prototype.shouldRecognize=function(){var e=this.currentTouchAngle(),i=t.normalizedDegrees(e-this.referenceAngle);return Math.abs(i)>this.interpretThreshold},i.prototype.currentTouchAngle=function(){var e=this.rotationTouches[0],i=this.rotationTouches[1],r=e.clientX-i.clientX,o=e.clientY-i.clientY;return Math.atan2(o,r)*t.RADIANS_TO_DEGREES},i}),i("gesture/TiltRecognizer",["../gesture/PanRecognizer"],function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.maxTouchDistance=250,this.maxTouchDivergence=50};return e.LEFT=1,e.RIGHT=2,e.UP=4,e.DOWN=8,e.prototype=Object.create(t.prototype),e.prototype.shouldInterpret=function(){for(var t=0,e=this.touchCount;e>t;t++){var i=this.touch(t),r=i.translationX,o=i.translationY,n=Math.sqrt(r*r+o*o);if(n>this.interpretDistance)return!0}return!1},e.prototype.shouldRecognize=function(){var t=this.touchCount;if(2>t)return!1;var i=this.touch(0),r=this.touch(1),o=i.clientX-r.clientX,n=i.clientY-r.clientY,s=Math.sqrt(o*o+n*n);if(s>this.maxTouchDistance)return!1;var a=i.translationX-r.translationX,h=i.translationY-r.translationY,l=Math.sqrt(a*a+h*h);if(l>this.maxTouchDivergence)return!1;var u=e.UP|e.DOWN,c=this.touchDirection(i)&u,d=this.touchDirection(r)&u;return 0!=(c&d)},e.prototype.touchDirection=function(t){var i=t.translationX,r=t.translationY,o=0;return Math.abs(i)>Math.abs(r)?(o|=0>i?e.LEFT:0,o|=i>0?e.RIGHT:0):(o|=0>r?e.UP:0,o|=r>0?e.DOWN:0),o},e}),i("navigate/LookAtNavigator",["../geom/Angle","../gesture/DragRecognizer","../geom/Frustum","../gesture/GestureRecognizer","../geom/Line","../geom/Location","../util/Logger","../geom/Matrix","../navigate/Navigator","../gesture/PanRecognizer","../gesture/PinchRecognizer","../geom/Position","../gesture/RotationRecognizer","../gesture/TiltRecognizer","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m){"use strict";var E=function(t){function i(t){t.preventDefault()}h.call(this,t),t.addEventListener("mousedown",i),t.addEventListener("touchstart",i),t.addEventListener("contextmenu",i),t.addEventListener("wheel",i),window.PointerEvent&&t.canvas.style.setProperty("touch-action","none"),this.lookAtLocation=new n(30,-110),this.range=1e7,this.enable2DLimits=!0;var r=this;this.primaryDragRecognizer=new e(t,function(t){r.handlePanOrDrag(t)}),this.secondaryDragRecognizer=new e(t,function(t){r.handleSecondaryDrag(t)}),this.secondaryDragRecognizer.button=2,this.panRecognizer=new l(t,function(t){r.handlePanOrDrag(t)}),this.pinchRecognizer=new u(t,function(t){r.handlePinch(t)}),this.rotationRecognizer=new d(t,function(t){r.handleRotation(t)}),this.tiltRecognizer=new g(t,function(t){r.handleTilt(t)}),t.addEventListener("wheel",function(t){r.handleWheelEvent(t)}),this.panRecognizer.recognizeSimultaneouslyWith(this.pinchRecognizer),this.panRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.pinchRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.panRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.pinchRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.rotationRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.beginPoint=new p(0,0),this.lastPoint=new p(0,0),this.beginHeading=0,this.beginTilt=0,this.beginRange=0,this.lastRotation=0};return E.prototype=Object.create(h.prototype),E.prototype.currentState=function(){this.applyLimits();var t=this.worldWindow.globe,e=new c(this.lookAtLocation.latitude,this.lookAtLocation.longitude,0),i=a.fromIdentity();return i.multiplyByLookAtModelview(e,this.range,this.heading,this.tilt,this.roll,t),this.currentStateForModelview(i)},E.prototype.handlePanOrDrag=function(t){this.worldWindow.globe.is2D()?this.handlePanOrDrag2D(t):this.handlePanOrDrag3D(t)},E.prototype.handlePanOrDrag3D=function(e){var i=e.state,r=e.translationX,o=e.translationY;if(i==WorldWind.BEGAN)this.lastPoint.set(0,0);else if(i==WorldWind.CHANGED){var n=this.worldWindow.canvas,s=this.worldWindow.globe,a=m.max(s.equatorialRadius,s.polarRadius),h=m.max(1,this.range),l=m.perspectivePixelSize(n.clientWidth,n.clientHeight,h),u=(o-this.lastPoint[1])*l,c=-(r-this.lastPoint[0])*l,d=u/a*t.RADIANS_TO_DEGREES,g=c/a*t.RADIANS_TO_DEGREES,p=Math.sin(this.heading*t.DEGREES_TO_RADIANS),f=Math.cos(this.heading*t.DEGREES_TO_RADIANS);this.lookAtLocation.latitude+=d*f-g*p,this.lookAtLocation.longitude+=d*p+g*f,this.lastPoint.set(r,o),this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handlePanOrDrag2D=function(t){var e=t.state,i=t.clientX,r=t.clientY,o=t.translationX,n=t.translationY;if(e==WorldWind.BEGAN)this.beginPoint.set(i,r),this.lastPoint.set(i,r);else if(e==WorldWind.CHANGED){var s=this.lastPoint[0],h=this.lastPoint[1],l=this.beginPoint[0]+o,u=this.beginPoint[1]+n;this.lastPoint.set(l,u);var c=this.currentState(),d=this.worldWindow.globe,g=c.rayFromScreenPoint(this.worldWindow.canvasCoordinates(s,h)),p=new f(0,0,0),m=new f(0,0,0),E=new f(0,0,0);if(!d.intersectsLine(g,p))return;if(g=c.rayFromScreenPoint(this.worldWindow.canvasCoordinates(l,u)),!d.intersectsLine(g,m))return;var y=a.fromIdentity();if(y.copy(c.modelview),y.multiplyByTranslation(m[0]-p[0],m[1]-p[1],m[2]-p[2]),y.extractEyePoint(g.origin),y.extractForwardVector(g.direction),!d.intersectsLine(g,E))return;var _=y.extractViewingParameters(E,this.roll,d,{});this.lookAtLocation.copy(_.origin),this.range=_.range,this.heading=_.heading,this.tilt=_.tilt,this.roll=_.roll,this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handleSecondaryDrag=function(t){var e=t.state,i=t.translationX,r=t.translationY;if(e==WorldWind.BEGAN)this.beginHeading=this.heading,this.beginTilt=this.tilt;else if(e==WorldWind.CHANGED){var o=180*i/this.worldWindow.canvas.clientWidth,n=90*r/this.worldWindow.canvas.clientHeight;this.heading=this.beginHeading+o,this.tilt=this.beginTilt+n,this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handlePinch=function(t){var e=t.state,i=t.scale;e==WorldWind.BEGAN?this.beginRange=this.range:e==WorldWind.CHANGED&&0!=i&&(this.range=this.beginRange/i,this.applyLimits(),this.worldWindow.redraw())},E.prototype.handleRotation=function(t){var e=t.state,i=t.rotation;e==WorldWind.BEGAN?this.lastRotation=0:e==WorldWind.CHANGED&&(this.heading-=i-this.lastRotation,this.lastRotation=i,this.applyLimits(),this.worldWindow.redraw())},E.prototype.handleTilt=function(t){var e=t.state,i=t.translationY;if(e==WorldWind.BEGAN)this.beginTilt=this.tilt;else if(e==WorldWind.CHANGED){var r=-90*i/this.worldWindow.canvas.clientHeight;this.tilt=this.beginTilt+r,this.applyLimits(),this.worldWindow.redraw()}},E.prototype.handleWheelEvent=function(t){var e;t.deltaMode==WheelEvent.DOM_DELTA_PIXEL?e=t.deltaY:t.deltaMode==WheelEvent.DOM_DELTA_LINE?e=40*t.deltaY:t.deltaMode==WheelEvent.DOM_DELTA_PAGE&&(e=400*t.deltaY);var i=1+e/1e3;this.range*=i,this.applyLimits(),this.worldWindow.redraw()},E.prototype.applyLimits=function(){if(this.lookAtLocation.latitude=m.clamp(this.lookAtLocation.latitude,-90,90),this.lookAtLocation.longitude=t.normalizedDegreesLongitude(this.lookAtLocation.longitude),this.range=m.clamp(this.range,1,Number.MAX_VALUE),this.heading=t.normalizedDegrees(this.heading),this.tilt=m.clamp(this.tilt,0,90),this.roll=t.normalizedDegrees(this.roll),this.worldWindow.globe.is2D()&&this.enable2DLimits){var e=2*Math.PI*this.worldWindow.globe.equatorialRadius;this.range=m.clamp(this.range,1,e),this.tilt=0}},E}),i("cache/MemoryCacheListener",["../util/Logger","../error/UnsupportedOperationError"],function(t,e){"use strict";var i=function(){};return i.prototype.entryRemoved=function(i,r){throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCacheListener","entryRemoved","abstractInvocation"))},i.prototype.removalError=function(i,r,o){throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCacheListener","removalError","abstractInvocation"))},i}),i("util/NominatimGeocoder",["../util/Logger"],function(t){"use strict";var e=function(){this.service="http://open.mapquestapi.com/nominatim/v1/search/"};return e.prototype.lookup=function(t,e,i){var r=this.service+t.replace(" ","%20")+"?format=json",o=new XMLHttpRequest,n=this;r+="&key="+(i||"lUvVRchXGGDh5Xwk3oidrXeIDAAevOUS"),o.open("GET",r,!0),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var t=JSON.parse(o.responseText);e(n,t)}},o.send(null)},e}),i("layer/OpenStreetMapImageLayer",["../geom/Angle","../util/Color","../geom/Location","../geom/Sector","../layer/MercatorTiledImageLayer"],function(t,e,i,r,o){"use strict";var n=function(t){this.imageSize=256,t=t||"Open Street Map",o.call(this,new r(-85.05,85.05,-180,180),new i(85.05,180),19,"image/png",t,this.imageSize,this.imageSize),this.displayName=t,this.pickEnabled=!1,this.detailHintOrigin=2.9,this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"),this.urlBuilder={urlForTile:function(t,e){return"http://otile1.mqcdn.com/tiles/1.0.0/osm/"+(t.level.levelNumber+1)+"/"+t.column+"/"+t.row+".png"}}};return n.prototype=Object.create(o.prototype),n.prototype.doRender=function(t){o.prototype.doRender.call(this,t),this.inCurrentFrame&&(t.screenCreditController.addStringCredit("©OpenStreetMap",e.DARK_GRAY),t.screenCreditController.addStringCredit("Tiles Courtesy of MapQuest",e.DARK_GRAY))},n.prototype.createTopLevelTiles=function(t){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},n.prototype.mapSizeForLevel=function(t){return 256<<t+1},n}),i("shapes/Path",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolyline","../geom/Vec2","../geom/Vec3"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g){"use strict";var p=function(i,r){if(!i)throw new e(s.logMessage(s.LEVEL_SEVERE,"Path","constructor","missingPositions"));t.call(this,r),this._positions=i,this._pathType=WorldWind.GREAT_CIRCLE,this._terrainConformance=10,this._numSubSegments=10,this.referencePosition=this.determineReferencePosition(this._positions),this.scratchPoint=new g(0,0,0)};return p.prototype=Object.create(t.prototype),Object.defineProperties(p.prototype,{positions:{get:function(){return this._positions},set:function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Path","constructor","missingPositions"));this._positions=t,this.referencePosition=this.determineReferencePosition(this._positions),this.reset()}},followTerrain:{get:function(){return this._followTerrain},set:function(t){this._followTerrain=t,this.reset()}},terrainConformance:{get:function(){return this._terrainConformance},set:function(t){this._terrainConformance=t,this.reset()}},numSubSegments:{get:function(){return this._numSubSegments},set:function(t){this._numSubSegments=t>=0?t:0,this.reset()}},pathType:{get:function(){return this._pathType},set:function(t){this._pathType=t,this.reset()}},extrude:{get:function(){return this._extrude},set:function(t){this._extrude=t,this.reset()}}}),p.prototype.determineReferencePosition=function(t){return t.length>0?t[0]:null},p.prototype.mustGenerateGeometry=function(t){return this.currentData.tessellatedPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior||this.currentData.drawVerticals!==this.activeAttributes.drawVerticals?!0:this.followTerrain||this.currentData.numSubSegments===this.numSubSegments?this.followTerrain&&this.currentData.terrainConformance!==this.terrainConformance?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0:!0;
},p.prototype.createSurfaceShape=function(){return new c(this.positions,null)},p.prototype.doMakeOrderedRenderable=function(t){if(!this.referencePosition)return null;if(!this.mustGenerateGeometry(t))return this;var e=this.currentData.referencePoint;t.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,e),this.currentData.transformationMatrix.setToTranslation(e[0],e[1],e[2]);var i=this.makeTessellatedPositions(t);if(i.length<2)return null;var o=this.computeRenderedPath(t,i);return this.currentData.tessellatedPoints=o,this.currentData.drawInterior=this.activeAttributes.drawInterior,this.currentData.drawVerticals=this.activeAttributes.drawVerticals,this.currentData.numSubSegments=this.numSubSegments,this.currentData.terrainConformance=this.terrainConformance,this.resetExpiration(this.currentData),this.currentData.fillVbo=!0,this.currentData.extent||(this.currentData.extent=new r),this.currentData.extent.setToPoints(o),this.currentData.extent.translate(this.currentData.referencePoint),this},p.prototype.makeTessellatedPositions=function(t){var e,i,r,o=[],n=t.navigatorState,s=this.mustDrawVerticals(t),a=new g(0,0,0),h=new g(0,0,0),l=this._positions[0];s&&(this.currentData.verticalIndices=new Int16Array(2*this.positions.length),this.currentData.verticalIndices[0]=0,this.currentData.verticalIndices[1]=1),o.push(l),t.surfacePointForMode(l.latitude,l.longitude,l.altitude,this._altitudeMode,a);for(var u=1,c=this._positions.length;c>u;u++)if(e=this._positions[u],t.surfacePointForMode(e.latitude,e.longitude,e.altitude,this._altitudeMode,h),i=n.eyePoint.distanceTo(a),r=n.pixelSizeAtDistance(i),a.distanceTo(h)<8*r&&this.altitudeMode!==WorldWind.ABSOLUTE?o.push(e):this.makeSegment(t,l,e,a,h,o),l=e,a.copy(h),s){var d=2*(o.length-1);this.currentData.verticalIndices[2*u]=d,this.currentData.verticalIndices[2*u+1]=d+1}return o},p.prototype.makeSegment=function(t,e,i,r,o,s){var a,h,u,c,d,g,p=t.navigatorState,f=p.eyePoint,m=new n(0,0),E=0;if(this._pathType===WorldWind.LINEAR&&!this._followTerrain)return void(r.equals(o)||s.push(i));if(u=this._pathType===WorldWind.LINEAR?n.linearDistance(e,i):this._pathType===WorldWind.RHUMB_LINE?n.rhumbDistance(e,i):n.greatCircleDistance(e,i),this._altitudeMode!==WorldWind.CLAMP_TO_GROUND&&(E=.5*(e.altitude+i.altitude)),a=u*(t.globe.equatorialRadius+E*t.verticalExaggeration),!(0>=a)){for(h=this._pathType===WorldWind.LINEAR?n.linearAzimuth(e,i):this._pathType===WorldWind.RHUMB_LINE?n.rhumbAzimuth(e,i):n.greatCircleAzimuth(e,i),this.scratchPoint.copy(r),c=0,d=0;1>c&&(d+=this._followTerrain?this._terrainConformance*p.pixelSizeAtDistance(this.scratchPoint.distanceTo(f)):a/this._numSubSegments,!(d>a||1e-9>a-d));)c=d/a,g=c*u,this._pathType===WorldWind.LINEAR?n.linearLocation(e,h,g,m):this._pathType===WorldWind.RHUMB_LINE?n.rhumbLocation(e,h,g,m):n.greatCircleLocation(e,h,g,m),m.altitude=(1-c)*e.altitude+c*i.altitude,s.push(new l(m.latitude,m.longitude,m.altitude)),this._followTerrain&&t.surfacePointForMode(m.latitude,m.longitude,m.altitude,WorldWind.CLAMP_TO_GROUND,this.scratchPoint);s.push(i)}},p.prototype.computeRenderedPath=function(t,e){var i,r,o,n,s=this.mustDrawInterior(t)||this.mustDrawVerticals(t),a=Number.MAX_VALUE,h=t.navigatorState.eyePoint,l=(s?2:1)*e.length,u=new Float32Array(3*l),c=s?6:3,d=new g(0,0,0);i=this._followTerrain&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND?WorldWind.RELATIVE_TO_GROUND:this.altitudeMode;for(var p=0,f=e.length;f>p;p++)r=e[p],t.surfacePointForMode(r.latitude,r.longitude,r.altitude,i,d),n=d.distanceToSquared(h),a>n&&(a=n),d.subtract(this.currentData.referencePoint),o=c*p,u[o]=d[0],u[o+1]=d[1],u[o+2]=d[2],s&&(t.surfacePointForMode(r.latitude,r.longitude,0,WorldWind.CLAMP_TO_GROUND,d),n=d.distanceToSquared(h),a>n&&(a=n),d.subtract(this.currentData.referencePoint),u[o+3]=d[0],u[o+4]=d[1],u[o+5]=d[2]);return this.currentData.pointBufferHasExtrusionPoints=s,this.currentData.eyeDistance=Math.sqrt(a),u},p.prototype.mustDrawInterior=function(t){return this.activeAttributes.drawInterior&&this._extrude&&this._altitudeMode!==WorldWind.CLAMP_TO_GROUND},p.prototype.mustDrawVerticals=function(t){return this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},p.prototype.doRenderOrdered=function(t){var e,i,r,o,n,s,a=t.currentGlContext,l=t.currentProgram,u=this.currentData,c=u.tessellatedPoints.length/3;if(this.applyMvpMatrix(t),u.vboCacheKey||(u.vboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(u.vboCacheKey),e||(e=a.createBuffer(),t.gpuResourceCache.putResource(this.currentData.vboCacheKey,e,4*u.tessellatedPoints.length),u.fillVbo=!0),a.bindBuffer(a.ARRAY_BUFFER,e),u.fillVbo&&(a.bufferData(a.ARRAY_BUFFER,u.tessellatedPoints,a.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),l.loadTextureEnabled(a,!1),t.pickingMode&&(o=t.uniquePickColor()),this.mustDrawInterior(t)&&(r=this.activeAttributes.interiorColor,i=r.alpha*t.currentLayer.opacity,1>i&&!t.pickingMode&&a.depthMask(!1),l.loadColor(a,t.pickingMode?o:r),l.loadOpacity(a,t.pickingMode?i>0?1:0:i),a.vertexAttribPointer(l.vertexPointLocation,3,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,c)),this.activeAttributes.drawOutline&&((this.mustDrawVerticals(t)&&this.mustDrawInterior(t)||this.altitudeMode===WorldWind.CLAMP_TO_GROUND)&&this.applyMvpMatrixForOutline(t),r=this.activeAttributes.outlineColor,i=r.alpha*t.currentLayer.opacity,1>i&&!t.pickingMode&&a.depthMask(!1),l.loadColor(a,t.pickingMode?o:r),l.loadOpacity(a,t.pickingMode?1:i),a.lineWidth(this.activeAttributes.outlineWidth),this.currentData.pointBufferHasExtrusionPoints?(n=24,s=c/2):(n=12,s=c),a.vertexAttribPointer(l.vertexPointLocation,3,a.FLOAT,!1,n,0),a.drawArrays(a.LINE_STRIP,0,s),this.mustDrawVerticals(t)&&(u.verticalIndicesVboCacheKey||(u.verticalIndicesVboCacheKey=t.gpuResourceCache.generateCacheKey()),e=t.gpuResourceCache.resourceForKey(u.verticalIndicesVboCacheKey),e||(e=a.createBuffer(),t.gpuResourceCache.putResource(u.verticalIndicesVboCacheKey,e,4*u.verticalIndices.length),u.fillVbo=!0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),u.fillVbo&&(a.bufferData(a.ELEMENT_ARRAY_BUFFER,u.verticalIndices,a.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1)),a.vertexAttribPointer(l.vertexPointLocation,3,a.FLOAT,!1,0,0),a.drawElements(a.LINES,u.verticalIndices.length,a.UNSIGNED_SHORT,0))),u.fillVbo=!1,t.pickingMode){var d=new h(o,this.pickDelegate?this.pickDelegate:this,null,t.currentLayer,!1);t.resolvePick(d)}},p.prototype.beginDrawing=function(t){var e=t.currentGlContext;this.mustDrawInterior(t)&&e.disable(e.CULL_FACE),t.findAndBindProgram(i),e.enableVertexAttribArray(t.currentProgram.vertexPointLocation)},p.prototype.endDrawing=function(t){var e=t.currentGlContext;e.disableVertexAttribArray(t.currentProgram.vertexPointLocation),e.depthMask(!0),e.lineWidth(1),e.enable(e.CULL_FACE)},p}),i("util/PeriodicTimeSequence",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","constructor","missingString"));var o=r.split("/");if(3!==o.length)throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","constructor","The interval string "+r+" does not contain 3 elements."));this.sequenceString=r,this.startTime=new Date(o[0]),this.endTime=new Date(o[1]),this.intervalMilliseconds=this.endTime.getTime()-this.startTime.getTime(),this._currentTime=this.startTime,this.infiniteInterval=this.startTime.getTime()==this.endTime.getTime(),this.period=i.parsePeriodString(o[2],!1)};return Object.defineProperties(i.prototype,{currentTime:{get:function(){return this._currentTime},set:function(t){this._currentTime=t}},scaleForCurrentTime:{get:function(){return this.currentTime?(this.currentTime.getTime()-this.startTime.getTime())/this.intervalMilliseconds:1}}}),i.prototype.next=function(){return this.currentTime?this.currentTime.getTime()>=this.endTime.getTime()&&!this.infiniteInterval?this.currentTime=null:this.currentTime=i.incrementTime(this.currentTime,this.period):this.currentTime=this.startTime,this.currentTime},i.prototype.previous=function(){return this.currentTime?this.currentTime.getTime()===this.startTime.getTime()?this.currentTime=null:this.currentTime=this.getTimeForScale(.9999*this.scaleForCurrentTime):this.currentTime=this.endTime,this.currentTime},i.prototype.reset=function(){this.currentTime=null},i.prototype.getTimeForScale=function(t){if(0>=t)return this.startTime;if(t>=1)return this.endTime;var e=new Date(this.startTime.getTime()),r=e,o=0;for(o=0;t>o;o=(e.getTime()-this.startTime.getTime())/this.intervalMilliseconds)r=e,e=i.incrementTime(e,this.period);return r},i.incrementTime=function(t,e){var r=new Date(t.getTime());return 0!=e[0]&&r.setUTCFullYear(r.getUTCFullYear()+e[0]),0!=e[1]&&i.addMonths(r,e[1]),0!=e[2]&&r.setUTCDate(r.getUTCDate()+7*e[2]),0!=e[3]&&r.setUTCDate(r.getUTCDate()+e[3]),0!=e[4]&&r.setUTCHours(r.getUTCHours()+e[4]),0!=e[5]&&r.setUTCMinutes(r.getUTCMinutes()+e[5]),0!=e[6]&&r.setUTCSeconds(r.getUTCSeconds()+e[6]),r},i.isLeapYear=function(t){return t%4===0&&t%100!==0||t%400===0},i.getDaysInMonth=function(t,e){return[31,i.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},i.addMonths=function(t,e){var r=t.getUTCDate();return t.setUTCDate(1),t.setUTCMonth(t.getUTCMonth()+e),t.setUTCDate(Math.min(r,i.getDaysInMonth(t.getUTCFullYear(),t.getUTCMonth()))),t},i.parsePeriodString=function(i,r){var o,n=r?r:!1,s=[2,3,4,5,7,8,9],a=[0,0,0,0,0,0,0],h=[0,12,4,7,24,60,60];if(i=i.toUpperCase(),!i)return a;if("string"!=typeof i)throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","parsePeriodString","Invalid ISO8601 period string '"+i+"'"));if(!(o=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(i)))throw new t(e.logMessage(e.LEVEL_SEVERE,"PeriodicTimeSequence","parsePeriodString","String '"+i+"' is not a valid ISO8601 period."));for(var l=0;l<s.length;l++){var u=s[l];a[l]=o[u]?+o[u].replace(/[A-Za-z]+/g,""):0}if(n)for(l=a.length-1;l>0;l--)a[l]>=h[l]&&(a[l-1]=a[l-1]+Math.floor(a[l]/h[l]),a[l]=a[l]%h[l]);return a},i}),i("projections/ProjectionGnomonic",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../util/WWMath"],function(t,e,i,r,o,n){"use strict";var s=function(t){this.north=!("South"===t);var e=this.north?new o(30,90,-180,180):new o(-90,-30,-180,180);i.call(this,"Polar Gnomonic",!1,e),this._pole=t,this.displayName=this.north?"North Gnomonic":"South Gnomonic",this._stateKey="projection polar gnomonic "+this._pole+" "};return s.prototype=Object.create(i.prototype),Object.defineProperties(s.prototype,{pole:{get:function(){return this._pole},set:function(t){this._pole=t,this.north=!("South"===this._pole),this.projectionLimits=this.north?new o(30,90,-180,180):new o(-90,-30,-180,180),this._stateKey="projection polar gnomonic "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),s.prototype.geographicToCartesian=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesian","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesian","missingResult"));if(this.north&&90===o||!this.north&&-90===o)h[0]=0,h[1]=0,h[2]=s;else{var l=this.north?1:-1,u=i.equatorialRadius/Math.tan(o*t.DEGREES_TO_RADIANS);h[0]=u*Math.sin(n*t.DEGREES_TO_RADIANS)*l,h[1]=u*-Math.cos(n*t.DEGREES_TO_RADIANS),h[2]=s}return h},s.prototype.geographicToCartesianGrid=function(i,o,s,a,h,l,u,c){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","missingGlobe"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","missingSector"));if(!h||h.length<s*a)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!c)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","missingResult"));var d,g,p,f,m,E,y=o.minLatitude*t.DEGREES_TO_RADIANS,_=o.maxLatitude*t.DEGREES_TO_RADIANS,v=o.minLongitude*t.DEGREES_TO_RADIANS,L=o.maxLongitude*t.DEGREES_TO_RADIANS,S=(_-y)/(s>1?s-1:1),T=(L-v)/(a>1?a-1:1),b=this.projectionLimits.minLatitude*t.DEGREES_TO_RADIANS,w=this.projectionLimits.maxLatitude*t.DEGREES_TO_RADIANS,M=this.north?1:-1,R=l?l:new Vec3(0,0,0),x=0,C=0;for(d=0,p=y;s>d;d++,p+=S)for(d===s-1&&(p=_),m=n.clamp(p,b,w),E=i.equatorialRadius/Math.tan(m),(this.north&&m===Math.PI/2||!this.north&&m===-Math.PI/2)&&(E=0),g=0,f=v;a>g;g++,f+=T)g===a-1&&(f=L),c[C++]=E*Math.sin(f)*M-R[0],c[C++]=E*-Math.cos(f)-R[1],c[C++]=h[x++]-R[2];return c},s.prototype.cartesianToGeographic=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","cartesianToGeographic","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","cartesianToGeographic","missingResult"));var l,u=Math.sqrt(o*o+n*n);return 1e-4>u?(h.latitude=this.north?90:-90,h.longitude=0,h.altitude=s):(l=Math.atan2(u,i.equatorialRadius),l>Math.PI&&(l=Math.PI),h.latitude=Math.asin(Math.cos(l)*(this.north?1:-1))*t.RADIANS_TO_DEGREES,h.longitude=Math.atan2(o,n*(this.north?-1:1))*t.RADIANS_TO_DEGREES,h.altitude=s),h},s.prototype.northTangentAtLocation=function(i,o,n,s){if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","northTangentAtLocation","missingResult"));return s[0]=Math.sin(n*t.DEGREES_TO_RADIANS)*(this.north?-1:1),s[1]=Math.cos(n*t.DEGREES_TO_RADIANS),s[2]=0,s},s.prototype.northTangentAtPoint=function(t,i,o,n,s,a){if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","northTangentAtLocation","missingResult"));var h=Math.sqrt(i*i+o*o);return 1e-4>h?(a[0]=0,a[1]=1,a[2]=0):(a[0]=i/h*(this.north?-1:1),a[1]=o/h*(this.north?-1:1),a[2]=0),a},s}),i("projections/ProjectionMercator",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s){"use strict";var a=function(){i.call(this,"Mercator",!0,new o(-78,78,-180,180))};return a.prototype=Object.create(i.prototype),a.prototype.geographicToCartesian=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingResult"));o>this.projectionLimits.maxLatitude&&(o=this.projectionLimits.maxLatitude),o<this.projectionLimits.minLatitude&&(o=this.projectionLimits.minLatitude);var l=Math.sqrt(i.eccentricitySquared),u=Math.sin(o*t.DEGREES_TO_RADIANS),c=(1+u)/(1-u)*Math.pow((1-l*u)/(1+l*u),l);return h[0]=i.equatorialRadius*n*t.DEGREES_TO_RADIANS+(a?a[0]:0),h[1]=.5*i.equatorialRadius*Math.log(c),h[2]=s,h},Object.defineProperties(a.prototype,{stateKey:{get:function(){return"projection mercator "}}}),a.prototype.geographicToCartesianGrid=function(i,o,a,h,l,u,c,d){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingGlobe"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingSector"));if(!l||l.length<a*h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!d)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingResult"));var g,p,f,m,E,y,_,v,L=i.equatorialRadius,S=Math.sqrt(i.eccentricitySquared),T=o.minLatitude*t.DEGREES_TO_RADIANS,b=o.maxLatitude*t.DEGREES_TO_RADIANS,w=o.minLongitude*t.DEGREES_TO_RADIANS,M=o.maxLongitude*t.DEGREES_TO_RADIANS,R=(b-T)/(a>1?a-1:1),x=(M-w)/(h>1?h-1:1),C=this.projectionLimits.minLatitude*t.DEGREES_TO_RADIANS,A=this.projectionLimits.maxLatitude*t.DEGREES_TO_RADIANS,P=u?u:new n(0,0,0),I=c?c[0]:0,N=0,O=0;for(g=0,f=T;a>g;g++,f+=R)for(g===a-1&&(f=b),E=s.clamp(f,C,A),y=Math.sin(E),_=(1+y)/(1-y)*Math.pow((1-S*y)/(1+S*y),S),v=L*Math.log(_)*.5-P[1],p=0,m=w;h>p;p++,m+=x)p===h-1&&(m=M),d[O++]=L*m-P[0]+I,d[O++]=v,d[O++]=l[N++]-P[2];return d},a.prototype.cartesianToGeographic=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingResult"));var l=i.eccentricitySquared,u=l*l,c=u*l,d=c*l,g=Math.pow(Math.E,-n/i.equatorialRadius),p=Math.PI/2-2*Math.atan(g),f=l/2+5*u/24+c/12+13*d/360,m=7*u/48+29*c/240+811*d/11520,E=7*c/120+81*d/1120,y=4279*d/161280,_=p-m+y,v=f-3*E,L=2*m-8*y,S=4*E,T=8*y,b=Math.sin(2*p),w=_+b*(v+b*(L+b*(S+T*b)));return h.latitude=w*t.RADIANS_TO_DEGREES,h.longitude=(o-(a?a[0]:0))/i.equatorialRadius*t.RADIANS_TO_DEGREES,h.altitude=s,h},a}),i("projections/ProjectionPolarEquidistant",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger"],function(t,e,i,r){"use strict";var o=function(t){i.call(this,"Polar Equidistant",!1,null),this._pole=t,this.north=!("South"===t),this.displayName=this.north?"North Polar":"South Polar",this._stateKey="projection polar equidistant "+this._pole+" "};return o.prototype=Object.create(i.prototype),Object.defineProperties(o.prototype,{pole:{get:function(){return this._pole},set:function(t){this._pole=t,this.north=!("South"===this._pole),this._stateKey="projection polar equidistant "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),o.prototype.geographicToCartesian=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesian","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesian","missingResult"));if(this.north&&90===o||!this.north&&-90===o)h[0]=0,h[1]=0,h[2]=s;else{var l=this.north?-1:1,u=i.equatorialRadius*(Math.PI/2+o*t.DEGREES_TO_RADIANS*l);h[0]=u*Math.sin(n*t.DEGREES_TO_RADIANS),h[1]=u*Math.cos(n*t.DEGREES_TO_RADIANS)*l,h[2]=s}return h},o.prototype.geographicToCartesianGrid=function(i,o,n,s,a,h,l,u){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingGlobe"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingSector"));if(!a||a.length<n*s)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!u)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingResult"));var c,d,g,p,f,m=i.equatorialRadius,E=o.minLatitude*t.DEGREES_TO_RADIANS,y=o.maxLatitude*t.DEGREES_TO_RADIANS,_=o.minLongitude*t.DEGREES_TO_RADIANS,v=o.maxLongitude*t.DEGREES_TO_RADIANS,L=(y-E)/(n>1?n-1:1),S=(v-_)/(s>1?s-1:1),T=this.north?-1:1,b=h?h:new Vec3(0,0,0),w=Math.PI/2,M=0,R=0,x=new Float64Array(s),C=new Float64Array(s);for(d=0,p=_;s>d;d++,p+=S)d===s-1&&(p=v),x[d]=Math.cos(p),C[d]=Math.sin(p);for(c=0,g=E;n>c;c++,g+=L)for(c===n-1&&(g=y),f=m*(w+g*T),(this.north&&g===w||!this.north&&g===-w)&&(f=0),d=0;s>d;d++)u[R++]=f*C[d]-b[0],u[R++]=f*x[d]*T-b[1],u[R++]=a[M++]-b[2];return u},o.prototype.cartesianToGeographic=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","cartesianToGeographic","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","cartesianToGeographic","missingResult"));var l,u=Math.sqrt(o*o+n*n);return 1e-4>u?(h.latitude=this.north?90:-90,h.longitude=0,h.altitude=s):(l=u/i.equatorialRadius,l>Math.PI&&(l=Math.PI),h.latitude=Math.asin(Math.cos(l)*(this.north?1:-1))*t.RADIANS_TO_DEGREES,h.longitude=Math.atan2(o,n*(this.north?-1:1))*t.RADIANS_TO_DEGREES,h.altitude=s),h},o.prototype.northTangentAtLocation=function(i,o,n,s){if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));return s[0]=Math.sin(n*t.DEGREES_TO_RADIANS)*(this.north?-1:1),s[1]=Math.cos(n*t.DEGREES_TO_RADIANS),s[2]=0,s},o.prototype.northTangentAtPoint=function(t,i,o,n,s,a){if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));var h=Math.sqrt(i*i+o*o);return 1e-4>h?(a[0]=0,a[1]=1,a[2]=0):(a[0]=i/h*(this.north?-1:1),a[1]=o/h*(this.north?-1:1),a[2]=0),a},o}),i("projections/ProjectionUPS",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWMath"],function(t,e,i,r,o,n,s){"use strict";var a=function(t){this.north=!("South"===t);var e=this.north?new o(0,90,-180,180):new o(-90,0,-180,180);i.call(this,"Uniform Polar Stereographic",!1,e),this._pole=t,this.displayName=this.north?"North UPS":"South UPS",this._stateKey="projection ups "+this._pole+" "};return a.prototype=Object.create(i.prototype),Object.defineProperties(a.prototype,{pole:{get:function(){return this._pole},set:function(t){this._pole=t,this.north=!("South"===this._pole),this.projectionLimits=this.north?new o(0,90,-180,180):new o(-90,0,-180,180),this._stateKey="projection ups "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),a.prototype.geographicToCartesian=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesian","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesian","missingResult"));if(this.north&&90===o||!this.north&&-90===o)h[0]=0,h[1]=0,h[2]=s;else{var l,u,c,d=this.north?1:-1,g=o*t.DEGREES_TO_RADIANS,p=n*t.DEGREES_TO_RADIANS,f=.994,m=Math.sqrt(i.eccentricitySquared),E=Math.sqrt(Math.pow(1+m,1+m)*Math.pow(1-m,1-m));(this.north&&0>g||!this.north&&g>0)&&(g=0),l=Math.sin(g*d),u=Math.sqrt((1-l)/(1+l)*Math.pow((1+m*l)/(1-m*l),m)),c=2*i.equatorialRadius*f*u/E,h[0]=c*Math.sin(p),h[1]=-c*Math.cos(p)*d,h[2]=s}return h},a.prototype.geographicToCartesianGrid=function(i,o,a,h,l,u,c,d){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingGlobe"));if(!o)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingSector"));if(!l||l.length<a*h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!d)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingResult"));var g,p,f,m,E,y,_,v,L=i.equatorialRadius,S=o.minLatitude*t.DEGREES_TO_RADIANS,T=o.maxLatitude*t.DEGREES_TO_RADIANS,b=o.minLongitude*t.DEGREES_TO_RADIANS,w=o.maxLongitude*t.DEGREES_TO_RADIANS,M=(T-S)/(a>1?a-1:1),R=(w-b)/(h>1?h-1:1),x=this.projectionLimits.minLatitude*t.DEGREES_TO_RADIANS,C=this.projectionLimits.maxLatitude*t.DEGREES_TO_RADIANS,A=.994,P=Math.sqrt(i.eccentricitySquared),I=Math.sqrt(Math.pow(1+P,1+P)*Math.pow(1-P,1-P)),N=this.north?1:-1,O=u?u:new n(0,0,0),V=0,D=0;for(g=0,f=S;a>g;g++,f+=M)for(g===a-1&&(f=T),E=s.clamp(f,x,C),y=Math.sin(E*N),_=Math.sqrt((1-y)/(1+y)*Math.pow((1+P*y)/(1-P*y),P)),v=2*L*A*_/I,p=0,m=b;h>p;p++,m+=R)p===h-1&&(m=w),d[D++]=v*Math.sin(m)-O[0],d[D++]=-v*Math.cos(m)*N-O[1],d[D++]=l[V++]-O[2];return d},a.prototype.cartesianToGeographic=function(i,o,n,s,a,h){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","cartesianToGeographic","missingGlobe"));if(!h)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","cartesianToGeographic","missingResult"));var l=Math.atan2(o,n*(this.north?-1:1)),u=.994,c=Math.sqrt(i.eccentricitySquared),d=Math.sqrt(o*o+n*n),g=Math.sqrt(Math.pow(1+c,1+c)*Math.pow(1-c,1-c)),p=d*g/(2*i.equatorialRadius*u),f=i.eccentricitySquared,m=f*f,E=m*f,y=E*f,_=Math.PI/2-2*Math.atan(p),v=f/2+5*m/24+E/12+13*y/360,L=7*m/48+29*E/240+811*y/11520,S=7*E/120+81*y/1120,T=4279*y/161280,b=_-L+T,w=v-3*S,M=2*L-8*T,R=4*S,x=8*T,C=Math.sin(2*_),A=b+C*(w+C*(M+C*(R+x*C)));return A*=this.north?1:-1,h.latitude=A*t.RADIANS_TO_DEGREES,h.longitude=l*t.RADIANS_TO_DEGREES,h.altitude=s,h},a.prototype.northTangentAtLocation=function(i,o,n,s){if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","northTangentAtLocation","missingResult"));return s[0]=Math.sin(n*t.DEGREES_TO_RADIANS)*(this.north?-1:1),s[1]=Math.cos(n*t.DEGREES_TO_RADIANS),s[2]=0,s},a.prototype.northTangentAtPoint=function(t,i,o,n,s,a){if(!a)throw new e(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));var h=Math.sqrt(i*i+o*o);return 1e-4>h?(a[0]=0,a[1]=1,a[2]=0):(a[0]=i/h*(this.north?-1:1),a[1]=o/h*(this.north?-1:1),a[2]=0),a},a}),i("util/ByteBuffer",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(r){if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"ByteBuffer","constructor","missingArray"));this.array=r,this.data=new DataView(r),this.position=0,this._order=i.LITTLE_ENDIAN};return i.prototype.getByte=function(){var t=this.data.getUint8(this.position);return this.position+=i.BYTE_SIZE,t},i.prototype.getByteArray=function(t){var e=new Uint8Array(this.array,this.position,t);return this.position+=i.BYTE_SIZE*t,e},i.prototype.getInt16=function(){var t=this.data.getInt16(this.position,this._order);return this.position+=i.INT16_SIZE,t},i.prototype.getInt16Array=function(t){var e=new Int16Array(this.array,this.position,t);return this.position+=i.INT16_SIZE*t,e},i.prototype.getInt32=function(){var t=this.data.getInt32(this.position,this._order);return this.position+=i.INT32_SIZE,t},i.prototype.getInt32Array=function(t){var e=new Int32Array(this.array,this.position,t);return this.position+=i.INT32_SIZE*t,e},i.prototype.getFloat=function(){var t=this.data.getFloat32(this.position,this._order);return this.position+=i.FLOAT_SIZE,t},i.prototype.getFloatArray=function(t){var e=new Float32Array(this.array,this.position,t);return this.position+=i.FLOAT_SIZE*t,e},i.prototype.getDouble=function(){var t=this.data.getFloat64(this.position,this._order);return this.position+=i.DOUBLE_SIZE,t},i.prototype.getDoubleArray=function(t){var e;if(this.position%8!=0){var r=this.array.slice(this.position,this.position+t*i.DOUBLE_SIZE);e=new Float64Array(r)}else e=new Float64Array(this.array,this.position,t);return this.position+=i.DOUBLE_SIZE*t,e},i.prototype.skipBytes=function(t){this.position+=t*i.BYTE_SIZE},i.prototype.skipInt16s=function(t){this.position+=t*i.INT16_SIZE},i.prototype.skipInt32s=function(t){this.position+=t*i.INT32_SIZE},i.prototype.skipFloats=function(t){this.position+=t*i.FLOAT_SIZE},i.prototype.skipDoubles=function(t){this.position+=t*i.DOUBLE_SIZE},i.prototype.seek=function(t){this.position=t},i.prototype.order=function(t){this._order=t},i.prototype.limit=function(){return this.data.byteLength},i.prototype.hasRemaining=function(){return this.position<this.data.byteLength},i.BIG_ENDIAN=!1,i.LITTLE_ENDIAN=!0,i.BYTE_SIZE=1,i.INT16_SIZE=2,i.INT32_SIZE=4,i.FLOAT_SIZE=4,i.DOUBLE_SIZE=8,i}),i("formats/shapefile/DBaseField",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseFile","../../util/Logger"],function(t,e,i,r){"use strict";var o=function(e,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"DBaseField","constructor","missingAttributeName"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"DBaseField","constructor","missingBuffer"));this.name=null,this.type=null,this.typeCode=-1,this.length=-1,this.decimals=-1,this.readFieldDescriptor(e,i)};return o.prototype.getName=function(){return this.name},o.prototype.getType=function(){return this.type},o.prototype.getLength=function(){return this.length},o.prototype.getDecimals=function(){return this.decimals},o.prototype.readFieldDescriptor=function(t,i){i.order(e.LITTLE_ENDIAN);var n=i.position;if(this.name=t.readNullTerminatedString(i,o.FIELD_NAME_LENGTH),i.seek(n+o.FIELD_NAME_LENGTH),this.typeCode=String.fromCharCode(i.getByte()),this.type=o.getFieldType(this.typeCode),null==this.type)throw new Error(r.log(r.LEVEL_SEVERE,"Shapefile dBase encountered unsupported field type: "+this.typeCode));i.skipBytes(4),this.length=i.getByte(),this.decimals=i.getByte(),i.seek(n+o.FIELD_DESCRIPTOR_LENGTH)},o.getFieldType=function(t){switch(t){case"C":return o.TYPE_CHAR;case"D":return o.TYPE_DATE;case"F":return o.TYPE_NUMBER;case"L":return o.TYPE_BOOLEAN;case"N":return o.TYPE_NUMBER;default:return null}},o.prototype.toString=function(){return this.name+"("+this.typeCode+")"},o.TYPE_CHAR="DBase.FieldTypeChar",o.TYPE_NUMBER="DBase.FieldTypeNumber",o.TYPE_DATE="DBase.FieldTypeDate",o.TYPE_BOOLEAN="DBase.FieldTypeBoolean",o.FIELD_NAME_LENGTH=11,o.FIELD_DESCRIPTOR_LENGTH=32,o}),i("formats/shapefile/DBaseRecord",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseField","../../formats/shapefile/DBaseFile","../../util/Logger"],function(t,e,i,r,o){"use strict";var n=function(e,i,r){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"DBaseRecord","constructor","missingAttributeName"));if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"DBaseRecord","constructor","missingBuffer"));this.deleted=!1,this.recordNumber=r,this.values=null,this.readFromBuffer(e,i,r)};return n.prototype.isDeleted=function(){return this.deleted},n.prototype.getRecordNumber=function(){return this.recordNumber},n.prototype.readFromBuffer=function(t,r,n){r.order(e.LITTLE_ENDIAN),this.recordNumber=n;var s=r.getByte();this.deleted=42==s;var a=t.getFields();this.values={};for(var h=0,l=a.length;l>h;h+=1){var u=a[h],c=u.getName(),d=t.readNullTerminatedString(r,u.getLength()).trim();try{if(u.getType()==i.TYPE_BOOLEAN){var g=d.charAt(0);this.values[c]="t"==g||"T"==g||"Y"==g||"y"==g}else u.getType()==i.TYPE_CHAR?this.values[c]=d:u.getType()==i.TYPE_DATE?this.values[c]=new Date(d):u.getType()==i.TYPE_NUMBER&&(this.values[c]=+d)}catch(p){o.log(o.LEVEL_WARNING,"Shapefile attribute parsing error:"+u.toString()+" -> "+d.toString()+" ["+p+"]")}}},n}),i("formats/shapefile/DBaseFile",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseField","../../formats/shapefile/DBaseRecord","../../util/Logger"],function(t,e,i,r,o){"use strict";var n=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"DBaseFile","constructor","missingUrl"));this.url=e,this.header=null,this.fields=null,this.buffer=null,this["boolean"]=!0,this.numRecordsRead=0,this._completionCallback=null};return n.prototype.getLastModificationDate=function(){return this.header.lastModificationDate},n.prototype.getNumberOfRecords=function(){return this.header.numberOfRecords},n.prototype.getHeaderLength=function(){return this.header.headerLength},n.prototype.getRecordLength=function(){return this.header.recordLength},n.prototype.getNumberOfFields=function(){return(this.header.headerLength-1-n.FIXED_HEADER_LENGTH)/n.FIELD_DESCRIPTOR_LENGTH},n.prototype.getFields=function(){return this.fields},n.prototype.hasNext=function(){return this.numRecordsRead<this.header.numberOfRecords},n.prototype.nextRecord=function(){return this.numRecordsRead>=this.getNumberOfRecords()?null:this.readNextRecord(this._buffer,this.numRecordsRead)},n.prototype.load=function(t){this._completionCallback=t,this.requestUrl(this.url)},n.prototype.requestUrl=function(t){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?(this._buffer=new e(i.response),this.parse(),this._completionCallback&&this._completionCallback(this)):(o.log(o.LEVEL_WARNING,"DBaseFile retrieval failed ("+i.statusText+"): "+t),this._completionCallback&&this._completionCallback(this)))}.bind(this),i.onerror=function(){o.log(o.LEVEL_WARNING,"DBaseFile retrieval failed: "+t),this._completionCallback&&this._completionCallback(this)},i.ontimeout=function(){o.log(o.LEVEL_WARNING,"DBaseFile retrieval timed out: "+t),this._completionCallback&&this._completionCallback(this);
},i.send(null)},n.prototype.parse=function(){this.header=this.readHeader(this._buffer),this.fields=this.readFieldDescriptors(this._buffer,this.getNumberOfFields())},n.prototype.readHeader=function(t){var i=t.position;t.order(e.LITTLE_ENDIAN);var r=t.getByte();if(r>5)throw new Error("???");var o=t.getByte(),s=t.getByte(),a=t.getByte(),h=t.getInt32(),l=t.getInt16(),u=t.getInt16(),c={year:1900+o,month:s-1,day:a},d={fileCode:r,lastModificationDate:c,numberOfRecords:h,headerLength:l,recordLength:u};return t.seek(i+n.FIXED_HEADER_LENGTH),d},n.prototype.readFieldDescriptors=function(t,e){for(var r=t.position,o=[],s=0;e>s;s+=1)o[s]=new i(this,t);var a=this.header.headerLength-n.FIXED_HEADER_LENGTH;return t.seek(r+a),o},n.prototype.readNextRecord=function(){return this.readRecordFromBuffer(this._buffer,++this.numRecordsRead)},n.prototype.readNextRecord=function(t,e){return new r(this,t,e)},n.prototype.readNullTerminatedString=function(t,e){if(0>=e)return 0;for(var i="",r=0;e>r;r+=1){var o=t.getByte();if(0==o)break;i+=String.fromCharCode(o)}return this.isStringEmpty(i)?"":i},n.prototype.isStringEmpty=function(t){return t.length<=0||n.isStringFilled(t,32)||n.isStringFilled(t,42)},n.isStringFilled=function(t,e){if(t.length<=0)return!1;for(var i=0;i<t.length;i++)if(t.charAt(i)!=e)return!1;return!0},n.FIXED_HEADER_LENGTH=32,n.FIELD_DESCRIPTOR_LENGTH=32,n}),i("formats/shapefile/PrjFile",["../../error/ArgumentError","../../util/Logger","../../error/NotYetImplementedError"],function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"DBaseFile","constructor","missingUrl"));this._url=i,this._completionCallback=null,this._params=null};return Object.defineProperties(r.prototype,{url:{get:function(){return this._url}},coordinateSystem:{get:function(){return this.params?this.params[r.COORDINATE_SYSTEM]:null}},params:{get:function(){return this._params}}}),r.prototype.load=function(t){this._completionCallback=t,this.requestUrl(this._url)},r.prototype.requestUrl=function(t){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){if(4===i.readyState){if(200===i.status){var r=String.fromCharCode.apply(null,new Uint8Array(i.response));this._params=this.decodeOGCCoordinateSystem(r)}else e.log(e.LEVEL_WARNING,"PrjFile retrieval failed ("+i.statusText+"): "+t);this._completionCallback&&this._completionCallback(this)}}.bind(this),i.onerror=function(){e.log(e.LEVEL_WARNING,"PrjFile retrieval failed: "+t),this._completionCallback&&this._completionCallback(this)}.bind(this),i.ontimeout=function(){e.log(e.LEVEL_WARNING,"PrjFile retrieval timed out: "+t),this._completionCallback&&this._completionCallback(this)}.bind(this),i.send(null)},r.prototype.decodeOGCCoordinateSystem=function(o){o||new t(e.logMessage(e.LEVEL_SEVERE,"PrjFile","decodeOGCCoordinateSystem","missingText"));var n={};if(o=o.trim().toUpperCase(),r.GEOGCS_WKT_PATTERN.test(o))n[r.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_GEOGRAPHIC;else{var s=o.match(r.PROJCS_WKT_PATTERN);if(s)throw n[PrfFile.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_PROJECTED,new i(e.log(e.LEVEL_SEVERE,"PrjFile implementation  for projected coordinate systems in incomplete."));n[r.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_UNKNOWN}return n},r.prototype.isUnknownCoordinateSystem=function(){return!this.params||this.params.coordinateSystem===r.COORDINATE_SYSTEM_UNKNOWN},r.prototype.isKnownCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem!==r.COORDINATE_SYSTEM_UNKNOWN},r.prototype.isGeographicCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem===r.COORDINATE_SYSTEM_GEOGRAPHIC},r.prototype.isProjectedCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem===r.COORDINATE_SYSTEM_PROJECTED},r.GEOGCS_WKT_PATTERN=new RegExp("\\{*GEOGCS[\\[\\(](.*)[\\]\\)]\\}*"),r.PROJCS_WKT_PATTERN=new RegExp("\\{*PROJCS[\\[\\(](.*)[\\]\\)]\\}*"),r.UTM_NAME_WKT_PATTERN=new RegExp(".*UTM.*ZONE.*?(\\d+).*?([\\w\\s]+).*?"),r.COORDINATE_SYSTEM="Coordinate_system",r.COORDINATE_SYSTEM_GEOGRAPHIC="Coordinate_system_geographic",r.COORDINATE_SYSTEM_PROJECTED="Coordinate_system_projected",r.COORDINATE_SYSTEM_UNKNOWN="Coordinate_system_unknown",r.PROJECTION_NAME="Projection_name",r.PROJECTION_UTM="Projection_UTM",r.PROJECTION_ZONE="Projection_zone",r.PROJECTION_HEMISPHERE="Projection_hemisphere",r.PROJECTION_HEMISPHERE_NORTH="Projection_hemisphere_north",r.PROJECTION_HEMISPHERE_SOUTH="Projection_hemisphere_south",r}),i("formats/shapefile/ShapefileRecord",["../../geom/Angle","../../error/ArgumentError","../../util/ByteBuffer","../../geom/Location","../../util/Logger","../../formats/shapefile/Shapefile"],function(t,e,i,r,o,n){"use strict";var s=function(t,i){if(!t)throw new e(o.logMessage(o.LEVEL_SEVERE,"ShapefileRecord","constructor","The specified shapefile is null or undefined"));if(!i)throw new e(o.logMessage(o.LEVEL_SEVERE,"ShapefileRecord","constructor","The specified buffer is null or undefined"));this._shapefile=t,this._recordNumber=-1,this._attributes={},this._numberOfParts=0,this._firstPartNumber=0,this._lastPartNumber=0,this._numberOfPoints=0,this._boundingRectangle=[],this._zRange=null,this._zValues=null,this._mRange=null,this._mValues=null,this._contentLengthInBytes=-1,this._buffer=i,this._isNormalized=!1,this._parts=[],this.readRecord()};return Object.defineProperties(s.prototype,{shapefile:{get:function(){return this._shapefile}},recordNumber:{get:function(){return this._recordNumber}},attributes:{get:function(){return this._attributes}},numberOfParts:{get:function(){return this._numberOfParts}},firstPartNumber:{get:function(){return this._firstPartNumber}},lastPartNumber:{get:function(){return this._lastPartNumber}},numberOfPoints:{get:function(){return this._numberOfPoints}},boundingRectangle:{get:function(){return this._boundingRectangle}},zRange:{get:function(){return this._zRange}},zValues:{get:function(){return this._zValues}},mRange:{get:function(){return this._mRange}},mValues:{get:function(){return this._mValues}}}),s.prototype.pointBuffer=function(t){return t>=0&&t<this._parts.length?this._parts[t]:null},s.prototype.readRecord=function(){this.readHeader(),this._buffer.order(i.LITTLE_ENDIAN);var t=this._buffer.getInt32(),e=this.shapefile.getShapeType(t);this.validateShapeType(e),this.readContents()},s.prototype.readHeader=function(){this._buffer.order(i.BIG_ENDIAN),this._recordNumber=this._buffer.getInt32(),this._contentLengthInBytes=2*this._buffer.getInt32()},s.prototype.validateShapeType=function(t){if(t!==this.shapefile.NULL&&t!==this.shapefile.shapeType)throw new Error(o.log(o.LEVEL_SEVERE,"Shapefile record is not supported."))},s.prototype.readNullContents=function(){this._numberOfParts=0,this._numberOfPoints=0,this._parts=null,this._boundingRectangle=null,this._buffer.seek(this._contentLengthInBytes-i.INT32_SIZE)},s.prototype.readPointContents=function(){this._numberOfParts=1,this._firstPartNumber=0,this._lastPartNumber=this._numberOfParts-1,this._numberOfPoints=1,this._parts=[this._buffer.getDoubleArray(2)];var t=this._parts[0][1],e=this._parts[0][0];this._boundingRectangle=[t,t,e,e],this.isZType()&&this.readZ(!0),this.isMeasureType()&&this.readOptionalMeasures(!0)},s.prototype.readPolylineContents=function(){var t=this.shapefile.readBoundingRectangle(this._buffer);if(this._boundingRectangle=t.coords,this._isNormalized=t.isNormalized,this._numberOfParts=this._buffer.getInt32(),this._firstPartNumber=0,this._lastPartNumber=this._numberOfParts-1,this._numberOfPoints=this._buffer.getInt32(),this._numberOfParts>0&&this._numberOfPoints>0)for(var e=this._buffer.getInt32Array(this.numberOfParts),i=0;i<this.numberOfParts;i+=1){var r=i==this.numberOfParts-1?this._numberOfPoints-e[i]:e[i+1]-e[i];this._parts[i]=this._buffer.getDoubleArray(2*r),s.normalizeLocations(this._parts[i])}this.isZType()&&this.readZ(!1),this.isMeasureType()&&this.readOptionalMeasures(!1)},s.prototype.readMultiPointContents=function(){var t=this.shapefile.readBoundingRectangle(this._buffer);this._boundingRectangle=t.coords,this._isNormalized=t.isNormalized,this._numberOfParts=1,this._numberOfPoints=this._buffer.getInt32(),this._parts=[this._buffer.getDoubleArray(2*this._numberOfPoints)],s.normalizeLocations(this._parts[0]),this.isZType()&&this.readZ(!1),this.isMeasureType()&&this.readOptionalMeasures(!1)},s.prototype.readZ=function(t){if(t){this._zValues=this._buffer.getDoubleArray(1);var e=this._zValues[0];this._zRange=[e,e]}else this._zRange=this._buffer.getDoubleArray(2),this._zValues=this._buffer.getDoubleArray(this.numberOfPoints)},s.prototype.readOptionalMeasures=function(t){if(this._buffer.hasRemaining()&&this._buffer.limit()-this._buffer.position>=8*this.numberOfPoints)if(t){this._mValues=this._buffer.getDoubleArray(1);var e=this._mValues[0];this._mRange=[e,e]}else this._mRange=this._buffer.getDoubleArray(2),this._mValues=this._buffer.getDoubleArray(this.numberOfPoints)},s.normalizeLocations=function(e){for(var i=0,r=e.length;r>i;i+=2){var o=e[i],n=e[i+1];e[i]=t.normalizedDegreesLongitude(o),e[i+1]=t.normalizedDegreesLatitude(n)}},s.prototype.isPointType=function(){return this.shapefile.isPointType()},s.prototype.isMultiPointType=function(){return this.shapefile.isMultiPointType()},s.prototype.isPolylineType=function(){return this.shapefile.isPolylineType()},s.prototype.isPolygonType=function(){return this.shapefile.isPolygonType()},s.prototype.isZType=function(){return this.shapefile.isZType()},s.prototype.isMeasureType=function(){return this.shapefile.isMeasureType()},s.prototype.setAttributes=function(t){this._attributes=t},s.RECORD_HEADER_LENGTH=8,s}),i("formats/shapefile/ShapefileRecordMultiPoint",["../../util/ByteBuffer","../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(t,e,i){"use strict";var r=function(t,e){i.call(this,t,e)};return r.prototype=Object.create(i.prototype),r.prototype.readContents=function(){this.readMultiPointContents()},r}),i("formats/shapefile/ShapefileRecordNull",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(t,e){"use strict";var i=function(t,i){e.call(this,t,i)};return i.prototype=Object.create(e.prototype),i.prototype.readContents=function(){this.readNullContents()},i}),i("formats/shapefile/ShapefileRecordPoint",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(t,e){"use strict";var i=function(t,i){e.call(this,t,i)};return i.prototype=Object.create(e.prototype),i.prototype.readContents=function(){this.readPointContents()},i}),i("formats/shapefile/ShapefileRecordPolygon",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(t,e){"use strict";var i=function(t,i){e.call(this,t,i)};return i.prototype=Object.create(e.prototype),i.prototype.readContents=function(){this.readPolylineContents()},i}),i("formats/shapefile/ShapefileRecordPolyline",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(t,e){"use strict";var i=function(t,i){e.call(this,t,i)};return i.prototype=Object.create(e.prototype),i.prototype.readContents=function(){this.readPolylineContents()},i}),i("formats/shapefile/Shapefile",["../../geom/Angle","../../error/ArgumentError","../../util/ByteBuffer","../../util/Color","../../formats/shapefile/DBaseFile","../../geom/Location","../../util/Logger","../../error/NotYetImplementedError","../../shapes/Path","../../shapes/Placemark","../../shapes/PlacemarkAttributes","../../shapes/Polygon","../../geom/Position","../../formats/shapefile/PrjFile","../../layer/RenderableLayer","../../shapes/ShapeAttributes","../../formats/shapefile/ShapefileRecord","../../formats/shapefile/ShapefileRecordMultiPoint","../../formats/shapefile/ShapefileRecordNull","../../formats/shapefile/ShapefileRecordPoint","../../formats/shapefile/ShapefileRecordPolygon","../../formats/shapefile/ShapefileRecordPolyline","../../shapes/SurfacePolygon","../../shapes/SurfacePolyline"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L,S,T){"use strict";var b=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Shapefile","constructor","missingUrl"));this._url=t,this._shapeType=null,this._layer=null,this._shapeConfigurationCallback=this.defaultShapeConfigurationCallback,this._parserCompletionCallback=this.defaultParserCompletionCallback,this._buffer=null,this.attributeFile=new o(t.replace(".shp",".dbf")),this.projectionFile=new g(t.replace(".shp",".prj")),this.defaultPlacemarkAttributes=new u(null),this.defaultShapeAttributes=new f(null)};return Object.defineProperties(b.prototype,{url:{get:function(){return this._url}},shapeType:{get:function(){return this._shapeType}},layer:{get:function(){return this._layer}},parserCompletionCallback:{get:function(){return this._parserCompletionCallback}},shapeConfigurationCallback:{get:function(){return this._shapeConfigurationCallback}}}),b.prototype.load=function(t,e,i){t&&(this._parserCompletionCallback=t),e&&(this._shapeConfigurationCallback=e),this._layer=i||new p;var r=function(){var t=function(){this.requestUrl(this.url)}.bind(this);this.attributeFile.load(t)}.bind(this);this.projectionFile.load(r)},b.prototype.defaultParserCompletionCallback=function(t){this.addRenderablesForShapefile(this.layer)},b.prototype.defaultShapeConfigurationCallback=function(t,e){var i={},r=t.values.name||t.values.Name||t.values.NAME;if(r&&(i.name=r),e.isPointType())i.attributes=this.defaultPlacemarkAttributes;else if(e.isMultiPointType())i.attributes=this.defaultPlacemarkAttributes;else if(e.isPolylineType())i.attributes=this.defaultShapeAttributes;else if(e.isPolygonType()){i.attributes=this.defaultShapeAttributes;var o=t.values.height||t.values.Height||t.values.HEIGHT;o&&(i.height=o)}return i},b.prototype.addRenderablesForShapefile=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Shapefile","addRenderablesForShapefile","missingLayer"));this.isPointType()?this.addRenderablesForPoints(t):this.isMultiPointType()?this.addRenderablesForMultiPoints(t):this.isPolylineType()?this.addRenderablesForPolylines(t):this.isPolygonType()&&this.addRenderablesForPolygons(t)},b.prototype.addRenderablesForPoints=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Shapefile","addRenderablesForPoints","missingLayer"));for(var i=this.next();i;i=this.next()){var r=this.shapeConfigurationCallback(i.attributes,i),o=r&&r.altitude?r.altitude:0;if(r)for(var n=0,a=i.numberOfParts;a>n;n+=1)for(var h=i.pointBuffer(n),u=0,c=h.length;c>u;u+=2){var g=h[u],p=h[u+1],f=new d(p,g,o),m=new l(f,!1,r.attributes);m.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND,r.highlightAttributes&&(m.highlightAttributes=r.highlightAttributes),r.name&&(m.label=r.name),t.addRenderable(m)}}},b.prototype.addRenderablesForMultiPoints=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Shapefile","addRenderablesForMultiPoints","missingLayer"));for(var i=this.next();i;i=this.next()){var r=this.shapeConfigurationCallback(i.attributes,i),o=r&&r.altitude?r.altitude:0;if(r)for(var n=0,a=i.numberOfParts;a>n;n+=1)for(var h=i.pointBuffer(n),u=0,c=h.length;c>u;u+=2){var g=h[u],p=h[u+1],f=new d(p,g,o),m=new l(f,!1,r.attributes);m.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND,r.highlightAttributes&&(m.highlightAttributes=r.highlightAttributes),r.name&&(m.label=r.name),t.addRenderable(m)}}},b.prototype.addRenderablesForPolylines=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Shapefile","addRenderablesForPolylines","missingLayer"));for(var i=this.next();i;i=this.next()){var r=this.shapeConfigurationCallback(i.attributes,i),o=r&&r.altitude?r.altitude:0;if(r)for(var a=0,l=i.numberOfParts;l>a;a+=1){for(var u=i.pointBuffer(a),c=[],g=0,p=u.length;p>g;g+=2){var f=u[g],m=u[g+1],E=o?new d(m,f,o):new n(m,f);c.push(E)}var y;o?(y=new h(c,r.attributes),y.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):y=new T(c,r.attributes),r.highlightAttributes&&(y.highlightAttributes=r.highlightAttributes),r.name&&(y.displayName=r.name),t.addRenderable(y)}}},b.prototype.addRenderablesForPolygons=function(t){if(!t)throw new e(s.logMessage(s.LEVEL_SEVERE,"Shapefile","addRenderablesForPolygons","missingLayer"));for(var i=this.next();i;i=this.next()){for(var r,o=this.shapeConfigurationCallback(i.attributes,i),a=[],h=o.height,l=o.altitude,u=0,g=i.numberOfParts;g>u;u+=1){for(var p=i.pointBuffer(u),f=[],m=0,E=p.length-2;E>m;m+=2){var y=p[m],_=p[m+1];r=h?new d(_,y,h):l?new d(_,y,l):new n(_,y),f.push(r)}a.push(f)}var v;h?(v=new c(a,o.attributes),v.extrude=!0,v.altitudeMode=o.altitudeMode||WorldWind.RELATIVE_TO_GROUND):l?(v=new c(a,o.attributes),v.altitudeMode=o.altitudeMode||WorldWind.RELATIVE_TO_GROUND):v=new S(a,o.attributes),o.highlightAttributes&&(v.highlightAttributes=o.highlightAttributes),o.name&&(v.displayName=o.name),t.addRenderable(v)}},b.prototype.next=function(){for(;this._buffer.position<this._buffer.limit();){var t=this.readRecord(this._buffer);if(!(t instanceof y))return t}return null},b.prototype.requestUrl=function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onreadystatechange=function(){4===e.readyState&&(200===e.status?(this._buffer=new i(e.response),this.parse()):s.log(s.LEVEL_WARNING,"Shapefile retrieval failed ("+e.statusText+"): "+t),this._parserCompletionCallback&&this._parserCompletionCallback(this))}.bind(this),e.onerror=function(){s.log(s.LEVEL_WARNING,"Shapefile retrieval failed: "+t),this._parserCompletionCallback&&this._parserCompletionCallback(this)},e.ontimeout=function(){s.log(s.LEVEL_WARNING,"Shapefile retrieval timed out: "+t),this._parserCompletionCallback&&this._parserCompletionCallback(this)},e.send(null)},b.prototype.parse=function(){try{var t=this.readHeader(this._buffer);this._shapeType=t.shapeType}catch(e){console.log(e)}finally{}},b.prototype.readHeader=function(t){t.order(i.BIG_ENDIAN);var e=t.getInt32();if(e!=b.FILE_CODE)throw new Error(s.log(s.LEVEL_SEVERE,"Shapefile header is invalid"));t.skipInt32s(5);var r=t.getInt32();t.order(i.LITTLE_ENDIAN);var o=t.getInt32(),n=t.getInt32(),a=this.readBoundingRectangle(t),h=this.getShapeType(n);if(null==h)throw new Error(s.log(s.LEVEL_SEVERE,"Shapefile type is unsupported: "+n.toString()));var l={fileLength:2*r,version:o,shapeType:h,boundingRectangle:a.coords,normalizePoints:a.isNormalized};return t.skipDoubles(4),l},b.prototype.readBoundingRectangle=function(t){return this.projectionFile?this.projectionFile.isGeographicCoordinateSystem()?this.readGeographicBoundingRectangle(t):this.projectionFile.isProjectedCoordinateSystem()?this.readProjectedBoundingRectangle(t):this.readUnspecifiedBoundingRectangle(t):this.readUnspecifiedBoundingRectangle(t)},b.prototype.readUnspecifiedBoundingRectangle=function(t){var e=this.readBoundingRectangleCoordinates(t);return{coords:e,isNormalized:!1}},b.prototype.readGeographicBoundingRectangle=function(e){var i=this.readBoundingRectangleCoordinates(e),r=!1,o=0;return i[0]<-90&&(o=t.normalizedDegreesLatitude(i[0]),i[0]=90,r=!0,i[1]<o&&(i[1]=o)),i[1]>90&&(o=t.normalizedDegreesLatitude(i[1]),i[1]=90,r=!0,i[0]>o&&(i[0]=o)),(i[2]<-180||i[3]>180)&&(i[2]=-180,i[3]=180,r=!0),{coords:i,isNormalized:r}},b.prototype.readProjectedBoundingRectangle=function(t){throw new a(s.log(s.LEVEL_SEVERE,"Shapefile.readProjectedBoundingRectangle() not yet implemented"))},b.prototype.readBoundingRectangleCoordinates=function(t){var e=t.getDouble(),i=t.getDouble(),r=t.getDouble(),o=t.getDouble();return[i,o,e,r]},b.prototype.readRecord=function(t){var e=this.createRecord(t);if(null!=e&&null!=this.attributeFile&&this.attributeFile.hasNext()){var i=this.attributeFile.nextRecord();e.setAttributes(i)}return e},b.prototype.createRecord=function(t){return this.isNullType()?this.createNull(t):this.isPointType()?this.createPoint(t):this.isMultiPointType()?this.createMultiPoint(t):this.isPolygonType()?this.createPolygon(t):this.isPolylineType()?this.createPolyline(t):null},b.prototype.createNull=function(t){return new y(this,t)},b.prototype.createPoint=function(t){return new _(this,t)},b.prototype.createMultiPoint=function(t){return new E(this,t)},b.prototype.createPolyline=function(t){return new L(this,t)},b.prototype.createPolygon=function(t){return new v(this,t)},b.prototype.getShapeType=function(t){switch(t){case 0:return b.NULL;case 1:return b.POINT;case 3:return b.POLYLINE;case 5:return b.POLYGON;case 8:return b.MULTI_POINT;case 11:return b.POINT_Z;case 13:return b.POLYLINE_Z;case 15:return b.POLYGON_Z;case 18:return b.MULTI_POINT_Z;case 21:return b.POINT_M;case 23:return b.POLYLINE_M;case 25:return b.POLYGON_M;case 28:return b.MULTI_POINT_M;default:return null}},b.prototype.isMeasureType=function(){return b.measureTypes.hasOwnProperty(this._shapeType)},b.prototype.isZType=function(){return b.zTypes.hasOwnProperty(this._shapeType)},b.prototype.isNullType=function(){return this._shapeType===b.NULL},b.prototype.isPointType=function(){return b.pointTypes.hasOwnProperty(this._shapeType)},b.prototype.isMultiPointType=function(){return b.multiPointTypes.hasOwnProperty(this._shapeType)},b.prototype.isPolylineType=function(){return b.polylineTypes.hasOwnProperty(this._shapeType)},b.prototype.isPolygonType=function(){return b.polygonTypes.hasOwnProperty(this._shapeType)},b.NULL="null",b.POINT="point",b.MULTI_POINT="multiPoint",b.POLYLINE="polyline",b.POLYGON="polygon",b.POINT_M=b.POINT+"M",b.MULTI_POINT_M=b.MULTI_POINT+"M",b.POLYLINE_M=b.POLYLINE+"M",b.POLYGON_M=b.POLYGON+"M",b.POINT_Z=b.POINT+"Z",b.MULTI_POINT_Z=b.MULTI_POINT+"Z",b.POLYLINE_Z=b.POLYLINE+"Z",b.POLYGON_Z=b.POLYGON+"Z",b.SHAPE_MULTI_PATCH="multiPatch",b.measureTypes={pointM:b.POINT_M,pointZ:b.POINT_Z,multiPointM:b.MULTI_POINT_M,multiPointZ:b.MULTI_POINT_Z,polylineM:b.POLYLINE_M,polylineZ:b.POLYLINE_Z,polygonM:b.POLYGON_M,polygonZ:b.POLYGON_Z},b.zTypes={pointZ:b.POINT_Z,multiPointZ:b.MULTI_POINT_Z,polylineZ:b.POLYLINE_Z,polygonZ:b.POLYGON_Z},b.pointTypes={point:b.POINT,pointZ:b.POINT_Z,pointM:b.POINT_M},b.multiPointTypes={multiPoint:b.MULTI_POINT,multiPointZ:b.MULTI_POINT_Z,multiPointM:b.MULTI_POINT_M},b.polylineTypes={polyline:b.POLYLINE,polylineZ:b.POLYLINE_Z,polylineM:b.POLYLINE_M},b.polygonTypes={polygon:b.POLYGON,polygonZ:b.POLYGON_Z,polygonM:b.POLYGON_M},b.FILE_CODE=9994,b}),i("layer/ShowTessellationLayer",["../shaders/BasicProgram","../layer/Layer"],function(t,e){"use strict";var i=function(){e.call(this,"Show Tessellation"),this.enableTerrainGeometry=!0,this.enableTerrainExtent=!1};return i.prototype=Object.create(e.prototype),i.prototype.doRender=function(t){try{this.beginRendering(t),this.enableTerrainGeometry&&this.drawTerrainGeometry(t),this.enableTerrainExtent&&this.drawTerrainExtent(t)}finally{this.endRendering(t)}},i.prototype.beginRendering=function(t){var e=t.currentGlContext;e.depthMask(!1)},i.prototype.endRendering=function(t){var e=t.currentGlContext;e.depthMask(!0)},i.prototype.drawTerrainGeometry=function(e){if(e.terrain&&e.terrain.tessellator){var i,r,o=e.currentGlContext,n=e.terrain,s=n.tessellator,a=n.surfaceGeometry;try{i=e.findAndBindProgram(t),s.beginRendering(e);for(var h=0,l=a.length;l>h;h++)r=a[h],s.beginRenderingTile(e,r),i.loadColorComponents(o,1,1,1,.3),s.renderWireframeTile(e,r),i.loadColorComponents(o,1,0,0,.6),s.renderTileOutline(e,r),s.endRenderingTile(e,r)}finally{s.endRendering(e)}}},i.prototype.drawTerrainExtent=function(t){for(var e,i=t.terrain.surfaceGeometry,r=0,o=i.length;o>r;r++)e=i[r],e.extent.render(t)},i}),i("shapes/SurfaceEllipse",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape","../util/WWMath"],function(t,e,i,r,o,n,s){"use strict";var a=function(t,i,o,s,h){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceEllipse","constructor","missingLocation"));if(0>i||0>o)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceEllipse","constructor","Radius is negative."));n.call(this,h),this._center=t,this._majorRadius=i,this._minorRadius=o,this._heading=s,this._intervals=a.DEFAULT_NUM_INTERVALS};return a.prototype=Object.create(n.prototype),Object.defineProperties(a.prototype,{center:{get:function(){return this._center},set:function(t){this.stateKeyInvalid=!0,this._center=t}},majorRadius:{get:function(){return this._majorRadius},set:function(t){this.stateKeyInvalid=!0,this._majorRadius=t}},minorRadius:{get:function(){return this._minorRadius},set:function(t){this.stateKeyInvalid=!0,this._minorRadius=t}},heading:{get:function(){return this._heading},set:function(t){this.stateKeyInvalid=!0,this._heading=t}},intervals:{get:function(){return this._intervals},set:function(t){this.stateKeyInvalid=!0,this._intervals=t}}}),a.staticStateKey=function(t){var e=n.staticStateKey(t);return e+" ce "+t.center.toString()+" ma "+t.majorRadius.toString()+" mi "+t.minorRadius.toString()+" he "+t.heading.toString()+" in "+t.intervals.toString()},a.prototype.computeStateKey=function(){return a.staticStateKey(this)},a.prototype.computeBoundaries=function(e){if(0==this.majorRadius&&0==this.minorRadius)return null;var r=e.globe,o=1+Math.max(a.MIN_NUM_INTERVALS,this.intervals),n=2*Math.PI/(o-1),h=r.radiusAt(this.center.latitude,this.center.longitude);this._boundaries=new Array(o);for(var l=0;o>l;l++){var u=l!=o-1?l*n:0,c=this.majorRadius*Math.cos(u),d=this.minorRadius*Math.sin(u),g=Math.sqrt(c*c+d*d),p=Math.PI/2-(Math.acos(c/g)*s.signum(d)-this.heading*t.DEGREES_TO_RADIANS);this._boundaries[l]=i.greatCircleLocation(this.center,p*t.RADIANS_TO_DEGREES,g/h,new i(0,0))}},a.MIN_NUM_INTERVALS=8,a.DEFAULT_NUM_INTERVALS=64,a}),i("shapes/SurfaceCircle",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceEllipse"],function(t,e,i,r){"use strict";var o=function(i,o,n){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceCircle","constructor","missingLocation"));if(0>o)throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceCircle","constructor","Radius is negative"));r.call(this,i,o,o,0,n),this._radius=o};return o.prototype=Object.create(r.prototype),Object.defineProperties(o.prototype,{radius:{get:function(){return this._radius},set:function(t){this.stateKeyInvalid=!0,this._radius=t}}}),o.staticStateKey=function(t){var e=r.staticStateKey(t);return e+" ra "+t.radius.toString()},o.prototype.computeStateKey=function(){return o.staticStateKey(this)},o}),i("shapes/SurfaceRectangle",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape","../util/WWMath"],function(t,e,i,r,o,n,s){"use strict";var a=function(t,i,o,s,a){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceRectangle","constructor","missingLocation"));if(0>i||0>o)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceRectangle","constructor","Size is negative."));n.call(this,a),this._center=t,this._width=i,this._height=o,this._heading=s};return a.prototype=Object.create(n.prototype),Object.defineProperties(a.prototype,{center:{get:function(){return this._center},set:function(t){this.stateKeyInvalid=!0,this._center=t}},width:{get:function(){return this._width},set:function(t){this.stateKeyInvalid=!0,this._width=t}},height:{get:function(){return this._height},set:function(t){this.stateKeyInvalid=!0,this._height=t}},heading:{get:function(){return this._heading},set:function(t){this.stateKeyInvalid=!0,this._heading=t}}}),a.staticStateKey=function(t){var e=n.staticStateKey(t);return e+" ce "+t.center.toString()+" wi "+t.width.toString()+" he "+t.height.toString()+" hd "+t.heading.toString()},a.prototype.computeStateKey=function(){return a.staticStateKey(this)},a.prototype.computeBoundaries=function(t){var e=.5*this.width,i=.5*this.height,r=t.globe.radiusAt(this.center.latitude,this.center.longitude);this._boundaries=new Array(4),this.addLocation(0,-e,-i,r),this.addLocation(1,e,-i,r),this.addLocation(2,e,i,r),this.addLocation(3,-e,i,r)},a.prototype.addLocation=function(e,r,o,n){var a=Math.sqrt(r*r+o*o),h=Math.PI/2-(Math.acos(r/a)*s.signum(o)-this.heading*t.DEGREES_TO_RADIANS);this._boundaries[e]=i.greatCircleLocation(this.center,h*t.RADIANS_TO_DEGREES,a/n,new i(0,0))},a}),i("render/SurfaceRenderable",["../util/Logger","../error/UnsupportedOperationError"],function(t,e){"use strict";var i=function(){throw this.displayName="Renderable",this.enabled=!0,new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceRenderable","constructor","abstractInvocation"))};return i.prototype.renderSurface=function(i){throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceRenderable","renderSurface","abstractInvocation"))},i}),i("shapes/SurfaceSector",["../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(t,e,i,r,o){"use strict";var n=function(e,r){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"SurfaceSector","constructor","missingSector"));o.call(this,r),this._sector=e};return n.prototype=Object.create(o.prototype),n.staticStateKey=function(t){var e=o.staticStateKey(t);return e},n.prototype.computeStateKey=function(){return n.staticStateKey(this)},n.prototype.computeBoundaries=function(t){var i=this._sector;this._boundaries=new Array(4),this._boundaries[0]=new e(i.minLatitude,i.minLongitude),this._boundaries[1]=new e(i.maxLatitude,i.minLongitude),this._boundaries[2]=new e(i.maxLatitude,i.maxLongitude),this._boundaries[3]=new e(i.minLatitude,i.maxLongitude)},n}),i("gesture/TapRecognizer",["../gesture/GestureRecognizer"],function(t){"use strict";var e=function(e,i){t.call(this,e,i),this.numberOfTaps=1,this.numberOfTouches=1,this.maxTouchMovement=20,this.maxTapDuration=500,this.maxTapInterval=400,this.taps=[],this.timeout=null};return e.prototype=Object.create(t.prototype),e.prototype.reset=function(){t.prototype.reset.call(this),this.taps=[],this.cancelFailAfterDelay()},e.prototype.mouseDown=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.touchStart=function(t){if(this.state==WorldWind.POSSIBLE){var e;this.touchCount>this.numberOfTouches?this.state=WorldWind.FAILED:1==this.touchCount?(e={touchCount:this.touchCount,clientX:this.clientX,clientY:this.clientY},this.taps.push(e),this.failAfterDelay(this.maxTapDuration)):(e=this.taps[this.taps.length-1],e.touchCount=this.touchCount,e.clientX=this.clientX,e.clientY=this.clientY)}},e.prototype.touchMove=function(t){if(this.state==WorldWind.POSSIBLE){var e=this.translationX,i=this.translationY,r=Math.sqrt(e*e+i*i);r>this.maxTouchMovement&&(this.state=WorldWind.FAILED)}},e.prototype.touchEnd=function(t){if(this.state==WorldWind.POSSIBLE&&0==this.touchCount){var e=this.taps.length,i=this.taps[e-1];i.touchCount!=this.numberOfTouches?this.state=WorldWind.FAILED:e==this.numberOfTaps?(this.clientX=this.taps[0].clientX,this.clientY=this.taps[0].clientY,this.state=WorldWind.RECOGNIZED):this.failAfterDelay(this.maxTapInterval)}},e.prototype.touchCancel=function(t){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},e.prototype.failAfterDelay=function(t){var e=this;e.timeout&&window.clearTimeout(e.timeout),e.timeout=window.setTimeout(function(){e.timeout=null,e.state==WorldWind.POSSIBLE&&(e.state=WorldWind.FAILED)},t)},e.prototype.cancelFailAfterDelay=function(){var t=this;t.timeout&&(window.clearTimeout(t.timeout),t.timeout=null)},e}),i("layer/TectonicPlatesLayer",["../error/ArgumentError","../util/Color","../geom/Location","../util/Logger","../layer/RenderableLayer","../shapes/ShapeAttributes","../shapes/SurfacePolygon"],function(t,e,i,r,o,n,s){"use strict";var a=function(t){o.call(this,"Tectonic Plates"),t?this._attributes=t:(this._attributes=new n(null),this._attributes.drawInterior=!1,this._attributes.drawOutline=!0,this._attributes.outlineColor=e.RED),this.loadPlateData()};return a.prototype=Object.create(o.prototype),Object.defineProperties(s.prototype,{attributes:{get:function(){return this._attributes},set:function(t){t&&this.renderables.map(function(e,i,r){e.attributes=t})}}}),a.prototype.loadPlateData=function(){var t="http://worldwindserver.net/webworldwind/data/TectonicPlates.json",e=new XMLHttpRequest;
e.open("GET",t,!0),e.onreadystatechange=function(){4===e.readyState&&(200===e.status?this.parse(e.responseText):r.log(r.LEVEL_WARNING,"Tectonic plate data retrieval failed ("+e.statusText+"): "+t))}.bind(this),e.onerror=function(){r.log(r.LEVEL_WARNING,"Tectonic plate data retrieval failed: "+t)},e.ontimeout=function(){r.log(r.LEVEL_WARNING,"Tectonic plate data retrieval timed out: "+t)},e.send(null)},a.prototype.parse=function(t){var e=JSON.parse(t),r=this;e.features.map(function(t,e,o){var n=[];t.geometry.coordinates.map(function(t,e,r){n.push(new i(t[1],t[0]))});var a=new s(n,r._attributes);r.addRenderable(a)})},a}),i("util/TileFactory",["../util/Logger","../error/UnsupportedOperationError"],function(t,e){"use strict";var i=function(){};return i.prototype.createTile=function(i,r,o,n){throw new e(t.logMessage(t.LEVEL_SEVERE,"TileFactory","createTile","abstractInvocation"))},i}),i("shapes/TriangleMesh",["../shapes/AbstractMesh","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p){"use strict";var f=function(i,r,o){if(!i)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","constructor","missingPositions"));if(i.length<1)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","constructor","missingPositions"));if(i.length>65536)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","constructor","Too many positions. Must be fewer than 65537. Use TriangleMesh.split to split the shape."));if(!r)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","constructor","Indices array is null or undefined"));if(r.length<3)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","constructor","Too few indices."));t.call(this,o),this._positions=i,this._indices=r,this.referencePosition=this._positions[0]};return f.prototype=Object.create(t.prototype),Object.defineProperties(f.prototype,{positions:{get:function(){return this._positions},set:function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","positions","missingPositions"));this._positions=t,this.referencePosition=this._positions[0],this.reset()}},indices:{get:function(){return this._indices},set:function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","indices","Indices array is null or undefined"));this._indices=t,this.meshIndices=null,this.reset()}},outlineIndices:{get:function(){return this._outlineIndices},set:function(t){this._outlineIndices=t,this.meshOutlineIndices=null,this.reset()}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(t){if(t&&t.length!=this._positions.length)throw new e(a.logMessage(a.LEVEL_SEVERE,"TriangleMesh","textureCoordinates","Number of texture coordinates is inconsistent with the currently specified positions."));this._textureCoordinates=t,this.reset(),this.texCoords=null}}}),f.prototype.createSurfaceShape=function(){if(this._outlineIndices){for(var t=[],e=0;e<this._outlineIndices.length;e++)t.push(this._positions[this._outlineIndices[e]]);return new d(t,null)}return null},f.prototype.computeMeshPoints=function(t,e){for(var i,r,o=Number.MAX_VALUE,n=t.navigatorState.eyePoint,s=new Float32Array(3*this._positions.length),a=new p(0,0,0),h=0,l=0;l<this._positions.length;l++)i=this._positions[l],t.surfacePointForMode(i.latitude,i.longitude,i.altitude*this._altitudeScale,this.altitudeMode,a),r=a.distanceToSquared(n),o>r&&(o=r),a.subtract(this.currentData.referencePoint),s[h++]=a[0],s[h++]=a[1],s[h++]=a[2];return e.eyeDistance=Math.sqrt(o),s},f.prototype.computeTexCoords=function(){if(this._textureCoordinates){for(var t=new Float32Array(2*this._textureCoordinates.length),e=0,i=0,r=this._textureCoordinates.length;r>i;i++){var o=this._textureCoordinates[i];t[e++]=o[0],t[e++]=o[1]}return t}return null},f.prototype.computeMeshIndices=function(){for(var t=new Uint16Array(this._indices.length),e=0,i=this._indices.length;i>e;e++)t[e]=this._indices[e];return t},f.prototype.computeOutlineIndices=function(){if(this._outlineIndices){for(var t=new Uint16Array(this._outlineIndices.length),e=0;e<this._outlineIndices.length;e++)t[e]=this._outlineIndices[e];return t}return null},f.split=function(t,e,i,r){for(var o,n,s=[],a=[],h=[],l=[],u=[],c=0;c<=e.length;c++){if(c===e.length||s.length>65533&&h.length%3===0){if(s.length>0){var d={positions:s,indices:h};if(i&&(d.textureCoords=a),r){for(var g=[],p=0;p<r.length;p++)o=r[p],n=l[o],n&&g.push(l[r[p]]);d.outlineIndices=g}u.push(d)}if(c===e.length)break;s=[],h=[],l=[]}o=e[c],n=l[o],n||(n=s.length,l[o]=n,s.push(t[o]),i&&a.push(i[o])),h.push(n)}return u},f}),i("layer/ViewControlsLayer",["../geom/Angle","../error/ArgumentError","../layer/Layer","../geom/Location","../util/Logger","../util/Offset","../shapes/ScreenImage","../geom/Vec2","../util/WWUtil"],function(t,e,i,r,o,n,s,a,h){"use strict";var l=function(t){if(!t)throw new e(o.logMessage(o.LEVEL_SEVERE,"ViewControlsLayer","constructor","missingWorldWindow"));i.call(this,"View Controls"),this.wwd=t,this.placement=new n(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,0),this.alignment=new n(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,0),this.exaggerationIncrement=.01,this.zoomIncrement=.04,this.headingIncrement=1,this.tiltIncrement=1,this.fieldOfViewIncrement=.1,this.panIncrement=.001,this._inactiveOpacity=.5,this._activeOpacity=1;var r=new n(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0),h=WorldWind.configuration.baseUrl+"images/view/";this.panControl=new s(r.clone(),h+"view-pan-64x64.png"),this.zoomInControl=new s(r.clone(),h+"view-zoom-in-32x32.png"),this.zoomOutControl=new s(r.clone(),h+"view-zoom-out-32x32.png"),this.headingLeftControl=new s(r.clone(),h+"view-heading-left-32x32.png"),this.headingRightControl=new s(r.clone(),h+"view-heading-right-32x32.png"),this.tiltUpControl=new s(r.clone(),h+"view-pitch-up-32x32.png"),this.tiltDownControl=new s(r.clone(),h+"view-pitch-down-32x32.png"),this.exaggerationUpControl=new s(r.clone(),h+"view-elevation-up-32x32.png"),this.exaggerationDownControl=new s(r.clone(),h+"view-elevation-down-32x32.png"),this.fovNarrowControl=new s(r.clone(),h+"view-fov-narrow-32x32.png"),this.fovWideControl=new s(r.clone(),h+"view-fov-wide-32x32.png"),this.fovNarrowControl.enabled=!1,this.fovWideControl.enabled=!1,this.controls=[this.panControl,this.zoomInControl,this.zoomOutControl,this.headingLeftControl,this.headingRightControl,this.tiltUpControl,this.tiltDownControl,this.exaggerationUpControl,this.exaggerationDownControl,this.fovNarrowControl,this.fovWideControl];for(var l=0;l<this.controls.length;l++)this.controls[l].imageOffset=r.clone(),this.controls[l].opacity=this._inactiveOpacity,this.controls[l]===this.panControl?this.controls[l].size=64:this.controls[l].size=32;this.panControlCenter=new a(0,0),this.isTouchDevice=!1,this.pickEnabled=!1,this.setupInteraction()};return l.prototype=Object.create(i.prototype),Object.defineProperties(l.prototype,{showPanControl:{get:function(){return this.panControl.enabled},set:function(t){this.panControl.enabled=t}},showZoomControl:{get:function(){return this.zoomInControl.enabled},set:function(t){this.zoomInControl.enabled=t,this.zoomOutControl.enabled=t}},showHeadingControl:{get:function(){return this.headingLeftControl.enabled},set:function(t){this.headingLeftControl.enabled=t,this.headingRightControl.enabled=t}},showTiltControl:{get:function(){return this.tiltUpControl.enabled},set:function(t){this.tiltUpControl.enabled=t,this.tiltDownControl.enabled=t}},showExaggerationControl:{get:function(){return this.exaggerationUpControl.enabled},set:function(t){this.exaggerationUpControl.enabled=t,this.exaggerationDownControl.enabled=t}},showFieldOfViewControl:{get:function(){return this.fovNarrowControl.enabled},set:function(t){this.fovNarrowControl.enabled=t,this.fovWideControl.enabled=t}},inactiveOpacity:{get:function(){return this._inactiveOpacity},set:function(t){this._inactiveOpacity=t;for(var e=0;e<this.controls.length;e++)this.controls[e].opacity=t}},activeOpacity:{get:function(){return this._activeOpacity},set:function(t){this._activeOpacity=t;for(var e=0;e<this.controls.length;e++)this.controls[e].opacity=t}}}),l.prototype.doRender=function(t){var e,i,r,o,n=0,s=64;this.inCurrentFrame=!1,this.showPanControl&&(n+=this.panControl.size,this.inCurrentFrame=!0),this.showZoomControl&&(n+=this.zoomInControl.size,this.inCurrentFrame=!0),this.showHeadingControl&&(n+=this.headingLeftControl.size,this.inCurrentFrame=!0),this.showTiltControl&&(n+=this.tiltDownControl.size,this.inCurrentFrame=!0),this.showExaggerationControl&&(n+=this.exaggerationDownControl.size,this.inCurrentFrame=!0),this.showFieldOfViewControl&&(n+=this.fovNarrowControl.size,this.inCurrentFrame=!0),i=this.placement.offsetForSize(t.navigatorState.viewport.width,t.navigatorState.viewport.height),e=this.alignment.offsetForSize(n,s),r=i[0]-e[0],o=i[1]-e[1],this.showPanControl&&(this.panControl.screenOffset.x=r,this.panControl.screenOffset.y=o,this.panControl.render(t),this.panControlCenter[0]=r+this.panControl.size/2,this.panControlCenter[1]=o+this.panControl.size/2,r+=this.panControl.size),this.showZoomControl&&(this.zoomOutControl.screenOffset.x=r,this.zoomOutControl.screenOffset.y=o,this.zoomInControl.screenOffset.x=r,this.zoomInControl.screenOffset.y=o+this.zoomOutControl.size,this.zoomOutControl.render(t),this.zoomInControl.render(t),r+=this.zoomOutControl.size),this.showHeadingControl&&(this.headingRightControl.screenOffset.x=r,this.headingRightControl.screenOffset.y=o,this.headingLeftControl.screenOffset.x=r,this.headingLeftControl.screenOffset.y=o+this.headingLeftControl.size,this.headingRightControl.render(t),this.headingLeftControl.render(t),r+=this.headingLeftControl.size),this.showTiltControl&&(this.tiltDownControl.screenOffset.x=r,this.tiltDownControl.screenOffset.y=o,this.tiltUpControl.screenOffset.x=r,this.tiltUpControl.screenOffset.y=o+this.tiltDownControl.size,this.tiltDownControl.render(t),this.tiltUpControl.render(t),r+=this.tiltDownControl.size),this.showExaggerationControl&&(this.exaggerationDownControl.screenOffset.x=r,this.exaggerationDownControl.screenOffset.y=o,this.exaggerationUpControl.screenOffset.x=r,this.exaggerationUpControl.screenOffset.y=o+this.exaggerationDownControl.size,this.exaggerationUpControl.render(t),this.exaggerationDownControl.render(t),r+=this.exaggerationDownControl.size),this.showFieldOfViewControl&&(this.fovNarrowControl.screenOffset.x=r,this.fovNarrowControl.screenOffset.y=o,this.fovWideControl.screenOffset.x=r,this.fovWideControl.screenOffset.y=o+this.fovNarrowControl.size,this.fovNarrowControl.render(t),this.fovWideControl.render(t))},l.prototype.setupInteraction=function(){var t=this.wwd,e=this,i=function(i){if(e.enabled&&!e.isTouchDevice){var r,o;e.highlightedControl&&(e.highlight(e.highlightedControl,!1),e.wwd.redraw()),i.type&&"mouseup"===i.type&&1===i.which&&e.activeControl?(e.activeControl=null,e.activeOperation=null,i.preventDefault()):(e.activeOperation?(e.activeOperation.call(e,i,null),i.preventDefault()):(r=e.pickControl(t.canvasCoordinates(i.clientX,i.clientY)),o=e.determineOperation(i,r),o&&o.call(e,i,r)),e.handleHighlight(i,r),e.wwd.redraw())}};t.addEventListener("mousedown",i),t.addEventListener("mouseup",i),t.addEventListener("mousemove",i),window.addEventListener("mouseup",i),window.addEventListener("mousemove",i);var r=function(i){if(this.isTouchDevice=!0,e.enabled){if(e.highlightedControl&&(e.highlight(e.highlightedControl,!1),e.wwd.redraw()),!i.type||"touchend"!==i.type&&"touchcancel"!==i.type)if(e.activeOperation)e.activeOperation.call(e,i,null),i.preventDefault();else{var r,o,n=i.changedTouches.item(0);r=e.pickControl(t.canvasCoordinates(n.clientX,n.clientY)),o=e.determineOperation(i,r),o&&o.call(e,i,r)}else e.activeControl&&e.isCurrentTouch(i)&&(e.activeControl=null,e.activeOperation=null,i.preventDefault());e.handleHighlight(i,r),e.wwd.redraw()}};t.addEventListener("touchstart",r),t.addEventListener("touchend",r),t.addEventListener("touchcancel",r),t.addEventListener("touchmove",r)},l.prototype.isControl=function(t){for(var e=0;e<this.controls.length;e++)if(this.controls[e]==t)return!0;return!1},l.prototype.pickControl=function(t){for(var e,i=t[0],r=this.wwd.canvas.height-t[1],o=0;o<this.controls.length;o++)if(e=this.controls[o],e.enabled&&i>=e.screenOffset.x&&i<=e.screenOffset.x+e.size&&r>=e.screenOffset.y&&r<=e.screenOffset.y+e.size)return e;return null},l.prototype.determineOperation=function(t,e){var i=null;return e&&e instanceof s&&(e===this.panControl?i=this.handlePan:e===this.zoomInControl||e===this.zoomOutControl?i=this.handleZoom:e===this.headingLeftControl||e===this.headingRightControl?i=this.handleHeading:e===this.tiltUpControl||e===this.tiltDownControl?i=this.handleTilt:e===this.exaggerationUpControl||e===this.exaggerationDownControl?i=this.handleExaggeration:(e===this.fovNarrowControl||e===this.fovWideControl)&&(i=this.handleFov)),i},l.prototype.isCurrentTouch=function(t){for(var e=0;e<t.changedTouches.length;e++)if(t.changedTouches.item(e).identifier===this.currentTouchId)return!0;return!1},l.prototype.handlePan=function(e,i){if("mousedown"===e.type||"mousemove"===e.type)this.currentEventPoint=this.wwd.canvasCoordinates(e.clientX,e.clientY);else if("touchstart"===e.type||"touchmove"===e.type){var o=e.changedTouches.item(0);this.currentEventPoint=this.wwd.canvasCoordinates(o.clientX,o.clientY)}if("mousedown"===e.type&&1===e.which||"touchstart"===e.type){this.activeControl=i,this.activeOperation=this.handlePan,e.preventDefault(),"touchstart"===e.type&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,s=function(){if(n.activeControl){var e=n.panControlCenter[0]-n.currentEventPoint[0],i=n.panControlCenter[1]-(n.wwd.viewport.height-n.currentEventPoint[1]),o=n.wwd.navigator.lookAtLocation.latitude,a=n.wwd.navigator.lookAtLocation.longitude,h=n.panIncrement*(n.wwd.navigator.range/n.wwd.globe.radiusAt(o,a)),l=n.wwd.navigator.heading+Math.atan2(e,i)*t.RADIANS_TO_DEGREES,u=h*Math.sqrt(e*e+i*i);r.greatCircleLocation(n.wwd.navigator.lookAtLocation,l,-u,n.wwd.navigator.lookAtLocation),n.wwd.redraw(),setTimeout(s,50)}};setTimeout(s,50)}},l.prototype.handleZoom=function(t,e){if("mousedown"===t.type&&1===t.which||"touchstart"===t.type){this.activeControl=e,this.activeOperation=this.handleZoom,t.preventDefault(),"touchstart"===t.type&&(this.currentTouchId=t.changedTouches.item(0).identifier);var i=this,r=function(){i.activeControl&&(i.activeControl===i.zoomInControl?i.wwd.navigator.range*=1-i.zoomIncrement:i.activeControl===i.zoomOutControl&&(i.wwd.navigator.range*=1+i.zoomIncrement),i.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},l.prototype.handleHeading=function(t,e){if("mousedown"===t.type&&1===t.which||"touchstart"===t.type){this.activeControl=e,this.activeOperation=this.handleHeading,t.preventDefault(),"touchstart"===t.type&&(this.currentTouchId=t.changedTouches.item(0).identifier);var i=this,r=function(){i.activeControl&&(i.activeControl===i.headingLeftControl?i.wwd.navigator.heading+=i.headingIncrement:i.activeControl===i.headingRightControl&&(i.wwd.navigator.heading-=i.headingIncrement),i.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},l.prototype.handleTilt=function(t,e){if("mousedown"===t.type&&1===t.which||"touchstart"===t.type){this.activeControl=e,this.activeOperation=this.handleTilt,t.preventDefault(),"touchstart"===t.type&&(this.currentTouchId=t.changedTouches.item(0).identifier);var i=this,r=function(){i.activeControl&&(i.activeControl===i.tiltUpControl?i.wwd.navigator.tilt=Math.max(0,i.wwd.navigator.tilt-i.tiltIncrement):i.activeControl===i.tiltDownControl&&(i.wwd.navigator.tilt=Math.min(90,i.wwd.navigator.tilt+i.tiltIncrement)),i.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},l.prototype.handleExaggeration=function(t,e){if("mousedown"===t.type&&1===t.which||"touchstart"===t.type){this.activeControl=e,this.activeOperation=this.handleExaggeration,t.preventDefault(),"touchstart"===t.type&&(this.currentTouchId=t.changedTouches.item(0).identifier);var i=this,r=function(){i.activeControl&&(i.activeControl===i.exaggerationUpControl?i.wwd.verticalExaggeration+=i.exaggerationIncrement:i.activeControl===i.exaggerationDownControl&&(i.wwd.verticalExaggeration=Math.max(1,i.wwd.verticalExaggeration-i.exaggerationIncrement)),i.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},l.prototype.handleFov=function(t,e){if("mousedown"===t.type&&1===t.which||"touchstart"===t.type){this.activeControl=e,this.activeOperation=this.handleFov,t.preventDefault(),"touchstart"===t.type&&(this.currentTouchId=t.changedTouches.item(0).identifier);var i=this,r=function(){i.activeControl&&(i.activeControl===i.fovWideControl?i.wwd.navigator.fieldOfView=Math.max(90,i.wwd.navigator.fieldOfView+i.fieldOfViewIncrement):i.activeControl===i.fovNarrowControl&&(i.wwd.navigator.fieldOfView=Math.min(0,i.wwd.navigator.fieldOfView-i.fieldOfViewIncrement)),i.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},l.prototype.handleHighlight=function(t,e){this.activeControl?this.highlight(this.activeControl,!0):e&&this.isControl(e)&&this.highlight(e,!0)},l.prototype.highlight=function(t,e){t.opacity=e?this._activeOpacity:this._inactiveOpacity,e?this.highlightedControl=t:this.highlightedControl=null},l}),i("ogc/WmsLayerCapabilities",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsLayerCapabilities","constructor","Layer element is null or undefined."));this.parent=r,this.layers,this.name,this.title,this["abstract"],this.keywordList,this.identifiers,this.metadataUrls,this.dataUrls,this.featureListUrls,this.assembleLayer(i)};return Object.defineProperties(i.prototype,{capability:{get:function(){for(var t=this;t&&t instanceof i;)t=t.parent;return t}},queryable:{get:function(){return i.replace(this,"_queryable")}},cascaded:{get:function(){return i.replace(this,"_cascaded")}},opaque:{get:function(){return i.replace(this,"_opaque")}},noSubsets:{get:function(){return i.replace(this,"_noSubsets")}},fixedWidth:{get:function(){return i.replace(this,"_fixedWidth")}},fixedHeight:{get:function(){return i.replace(this,"_fixedHeight")}},styles:{get:function(){return i.accumulate(this,"_styles",[])}},crses:{get:function(){return i.accumulate(this,"_crses",[])}},srses:{get:function(){return i.accumulate(this,"_srses",[])}},geographicBoundingBox:{get:function(){return i.replace(this,"_geographicBoundingBox")}},latLonBoundingBox:{get:function(){return i.replace(this,"_latLonBoundingBox")}},boundingBoxes:{get:function(){return i.replace(this,"_boundingBoxes")}},dimensions:{get:function(){for(var t=[],e=this;e&&e instanceof i;)e._dimensions&&e._dimensions.length>0&&e._dimensions.forEach(function(e){var i=e.name,r=!0;t.forEach(function(t){t.name===i&&(r=!1)}),r&&t.push(e)}),e=e.parent;return t.length>0?t:void 0}},extents:{get:function(){for(var t=[],e=this;e&&e instanceof i;)e._extents&&e._extents.length>0&&e._extents.forEach(function(e){var i=e.name,r=!0;t.forEach(function(t){t.name===i&&(r=!1)}),r&&t.push(e)}),e=e.parent;return t.length>0?t:void 0}},attribution:{get:function(){return i.replace(this,"_attribution")}},authorityUrls:{get:function(){return i.accumulate(this,"_authorityUrls",[])}},minScaleDenominator:{get:function(){return i.replace(this,"_minScaleDenominator")}},maxScaleDenominator:{get:function(){return i.replace(this,"_maxScaleDenominator")}},scaleHint:{get:function(){return i.replace(this,"_scaleHint")}}}),i.accumulate=function(t,e,r){for(;t&&t instanceof i;){var o=t[e];if(o)for(var n=0;n<o.length;n++)r.push(o[n]);t=t.parent}return r.length>0?r:null},i.replace=function(t,e){for(;t&&t instanceof i;){var r=t[e];if(r)return r;t=t.parent}},i.prototype.assembleLayer=function(t){var e,r;e=t.getAttribute("queryable"),e&&(this._queryable="1"===e||"true"===e),e=t.getAttribute("opaque"),e&&(this._opaque="1"===e||"true"===e),e=t.getAttribute("noSubsets"),e&&(this._noSubsets="1"===e||"true"===e),e=t.getAttribute("cascaded"),e&&(this._cascaded=parseInt("10")),e=t.getAttribute("fixedWidth"),e&&(this._fixedWidth=parseInt("10")),e=t.getAttribute("fixedHeight"),e&&(this._fixedHeight=parseInt("10"));var o=t.children||t.childNodes;for(r=0;r<o.length;r++){var n=o[r];if("Layer"===n.localName)this.layers||(this.layers=[]),this.layers.push(new i(n,this));else if("Name"===n.localName)this.name=n.textContent;else if("Title"===n.localName)this.title=n.textContent;else if("Abstract"===n.localName)this["abstract"]=n.textContent;else if("KeywordList"===n.localName){this.keywordList=this.keywordList||[];for(var s=n.children||n.childNodes,a=0;a<s.length;a++){var h=s[a];"Keyword"===h.localName&&this.keywordList.push(h.textContent)}}else"Style"===n.localName?(this._styles||(this._styles=[]),this._styles.push(i.assembleStyle(n))):"CRS"===n.localName?(this._crses||(this._crses=[]),this._crses.push(n.textContent)):"SRS"===n.localName?(this._srses||(this._srses=[]),this._srses.push(n.textContent)):"EX_GeographicBoundingBox"===n.localName?this._geographicBoundingBox=i.assembleGeographicBoundingBox(n):"LatLonBoundingBox"===n.localName?this._geographicBoundingBox=i.assembleLatLonBoundingBox(n):"BoundingBox"===n.localName?(this._boundingBoxes||(this._boundingBoxes=[]),this._boundingBoxes.push(i.assembleBoundingBox(n))):"Dimension"===n.localName?(this._dimensions||(this._dimensions=[]),this._dimensions.push(i.assembleDimension(n))):"Extent"===n.localName?(this._extents||(this._extents=[]),this._extents.push(i.assembleDimension(n))):"Attribution"===n.localName?this._attribution=i.assembleAttribution(n):"AuthorityURL"===n.localName?(this._authorityUrls||(this._authorityUrls=[]),this._authorityUrls.push(i.assembleAuthorityUrl(n))):"Identifier"===n.localName?(this.identifiers||(this.identifiers=[]),this.identifiers.push(i.assembleIdentifier(n))):"MetadataURL"===n.localName?(this.metadataUrls||(this.metadataUrls=[]),this.metadataUrls.push(i.assembleMetadataUrl(n))):"DataURL"===n.localName?(this.dataUrls||(this.dataUrls=[]),this.dataUrls.push(i.assembleUrl(n))):"FeatureListURL"===n.localName?(this.featureListUrls||(this.featureListUrls=[]),this.featureListUrls.push(i.assembleUrl(n))):"MinScaleDenominator"===n.localName?this._minScaleDenominator=parseFloat(n.textContent):"MaxScaleDenominator"===n.localName?this._maxScaleDenominator=parseFloat(n.textContent):"ScaleHint"===n.localName&&(this._scaleHint={},this._scaleHint.min=i.getFloatAttribute(n,"min"),this._scaleHint.max=i.getFloatAttribute(n,"max"))}},i.assembleStyle=function(t){for(var e={},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Name"===n.localName?e.name=n.textContent:"Title"===n.localName?e.title=n.textContent:"Abstract"===n.localName?e["abstract"]=n.textContent:"LegendURL"===n.localName?(e.legendUrls||(e.legendUrls=[]),e.legendUrls.push(i.assembleLegendUrl(n))):"StyleSheetURL"===n.localName?e.styleSheetUrl=i.assembleUrl(n):"StyleURL"===n.localName&&(e.styleUrl=i.assembleUrl(n))}return e},i.assembleGeographicBoundingBox=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"westBoundLongitude"===o.localName?e.westBoundLongitude=parseFloat(o.textContent):"eastBoundLongitude"===o.localName?e.eastBoundLongitude=parseFloat(o.textContent):"southBoundLatitude"===o.localName?e.southBoundLatitude=parseFloat(o.textContent):"northBoundLatitude"===o.localName&&(e.northBoundLatitude=parseFloat(o.textContent))}return e},i.assembleLatLonBoundingBox=function(t){var e={};return e.minx=i.getFloatAttribute(t,"minx"),e.miny=i.getFloatAttribute(t,"miny"),e.maxx=i.getFloatAttribute(t,"maxx"),e.maxy=i.getFloatAttribute(t,"maxy"),e},i.assembleBoundingBox=function(t){var e={};return e.crs=t.getAttribute("CRS"),e.minx=i.getFloatAttribute(t,"minx"),e.miny=i.getFloatAttribute(t,"miny"),e.maxx=i.getFloatAttribute(t,"maxx"),e.maxy=i.getFloatAttribute(t,"maxy"),e.resx=i.getFloatAttribute(t,"resx"),e.resy=i.getFloatAttribute(t,"resy"),e},i.assembleDimension=function(t){var e={};return e.name=t.getAttribute("name"),e.units=t.getAttribute("units"),e.unitSymbol=t.getAttribute("unitSymbol"),e["default"]=t.getAttribute("default"),e.multipleValues=t.getAttribute("multipleValues"),e.multipleValues&&(e.multipleValues="true"===e.multipleValues||"1"===e.multipleValues),e.nearestValue=t.getAttribute("nearestValue"),e.nearestValue&&(e.nearestValue="true"===e.nearestValue||"1"===e.nearestValue),e.current=t.getAttribute("current"),e.current&&(e.current="true"===e.current||"1"===e.current),e.content=t.textContent,e},i.assembleAttribution=function(t){for(var e={},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Title"===n.localName?e.title=n.textContent:"OnlineResource"===n.localName?e.url=n.getAttribute("xlink:href"):"LogoUrul"===n.localName&&(e.logoUrl=i.assembleLogoUrl(n))}return e},i.assembleAuthorityUrl=function(t){var e={};e.name=t.getAttribute("name");for(var i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"OnlineResource"===o.localName&&(e.url=o.getAttribute("xlink:href"))}return e},i.assembleIdentifier=function(t){var e={};return e.authority=t.getAttribute("authority"),e.content=t.textContent,e},i.assembleMetadataUrl=function(t){var e={};e.type=t.getAttribute("type");for(var i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"Format"===o.localName?e.format=o.textContent:"OnlineResource"===o.localName&&(e.url=o.getAttribute("xlink:href"))}return e},i.assembleLegendUrl=function(t){var e={};e.width=i.getIntegerAttribute(t,"width"),e.height=i.getIntegerAttribute(t,"height");for(var r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Format"===n.localName?e.format=n.textContent:"OnlineResource"===n.localName&&(e.url=n.getAttribute("xlink:href"))}return e},i.assembleLogoUrl=function(t){var e={};e.width=i.getIntegerAttribute(t,"width"),e.height=i.getIntegerAttribute(t,"height");for(var r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Format"===n.localName?e.format=n.textContent:"OnlineResource"===n.localName&&(e.url=n.getAttribute("xlink:href"))}return e},i.assembleUrl=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"Format"===o.localName?e.format=o.textContent:"OnlineResource"===o.localName&&(e.url=o.getAttribute("xlink:href"))}return e},i.getIntegerAttribute=function(t,e){var i=t.getAttribute(e);return i=i?parseInt(i):void 0},i.getFloatAttribute=function(t,e){var i=t.getAttribute(e);return i=i?parseFloat(i):void 0},i}),i("ogc/WmsCapabilities",["../error/ArgumentError","../util/Logger","../ogc/WmsLayerCapabilities"],function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(i)};return r.prototype.assembleDocument=function(t){var e=t.documentElement;this.version=e.getAttribute("version"),this.updateSequence=e.getAttribute("updateSequence");for(var i=e.children||e.childNodes,r=0;r<i.length;r++){var o=i[r];"Service"===o.localName?this.service=this.assembleService(o):"Capability"===o.localName&&(this.capability=this.assembleCapability(o))}},r.prototype.assembleService=function(t){for(var e={capsDoc:this},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"Name"===o.localName?e.name=o.textContent:"Title"===o.localName?e.title=o.textContent:"Abstract"===o.localName?e["abstract"]=o.textContent:"KeywordList"===o.localName?e.keywordList=this.assembleKeywordList(o):"OnlineResource"===o.localName?e.onlineResource=o.getAttribute("xlink:href"):"Fees"===o.localName?e.fees=o.textContent:"AccessConstraints"===o.localName?e.accessConstraints=o.textContent:"LayerLimit"==o.localName?e.layerLimit=parseInt(o.textContent):"MaxWidth"==o.localName?e.maxWidth=parseInt(o.textContent):"MaxHeight"==o.localName?e.maxHeight=parseInt(o.textContent):"ContactInformation"===o.localName&&(e.contactInformation=this.assembleContactInformation(o))}return e},r.prototype.assembleKeywordList=function(t){for(var e=[],i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"Keyword"===o.localName&&e.push(o.textContent)}return e},r.prototype.assembleContactInformation=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"ContactPersonPrimary"===o.localName?e.contactPersonPrimary=this.assembleContactPersonPrimary(o):"ContactPosition"===o.localName?e.contactPosition=o.textContent:"ContactVoiceTelephone"===o.localName?e.contactVoiceTelephone=o.textContent:"ContactFacsimileTelephone"===o.localName?e.contactFacsimileTelephone=o.textContent:"ContactElectronicMailAddress"===o.localName?e.contactElectronicMailAddress=o.textContent:"ContactAddress"===o.localName&&(e.contactAddress=this.assembleContactAddress(o))}return e},r.prototype.assembleContactPersonPrimary=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"ContactPerson"===o.localName?e.contactPerson=o.textContent:"ContactOrganization"===o.localName&&(e.contactOrganization=o.textContent)}return e},r.prototype.assembleContactAddress=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"AddressType"===o.localName?e.addressType=o.textContent:"Address"===o.localName?e.address=o.textContent:"City"===o.localName?e.city=o.textContent:"StateOrProvince"===o.localName?e.stateOrProvince=o.textContent:"PostCode"===o.localName?e.postCode=o.textContent:"Country"===o.localName&&(e.country=o.textContent)}return e},r.prototype.assembleCapability=function(t){for(var e={capsDoc:this},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Request"===n.localName?e.request=this.assembleRequests(n):"Exception"===n.localName?e.exception=this.assembleException(n):"Layer"===n.localName&&(e.layers=e.layers||[],e.layers.push(new i(n,e)))}return e},r.prototype.assembleRequests=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"GetCapabilities"===o.localName?e.getCapabilities=this.assembleRequest(o):"GetMap"===o.localName?e.getMap=this.assembleRequest(o):"GetFeatureInfo"===o.localName&&(e.getFeatureInfo=this.assembleRequest(o))}return e},r.prototype.assembleRequest=function(t){for(var e={name:t.localName},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];if("Format"===o.localName)e.formats=e.formats||[],e.formats.push(o.textContent);else if("DCPType"===o.localName)for(var n=o.children||o.childNodes,s=0;s<n.length;s++){var a=n[s];if("HTTP"===a.localName)for(var h=a.children||a.childNodes,l=0;l<h.length;l++){var u=h[l];if("Get"===u.localName)for(var c=u.children||u.childNodes,d=0;d<c.length;d++){var g=c[d];"OnlineResource"===g.localName&&(e.url=g.getAttribute("xlink:href"))}}}}return e},r.prototype.assembleException=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"Format"===o.localName&&(e.formats=e.formats||[],e.formats.push(o.textContent))}return e},r}),i("layer/WmsLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../util/PeriodicTimeSequence","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(t,e,i,r,o,n,s){"use strict";var a=function(e,r){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"WmsLayer","constructor","No configuration specified."));var o=e.service+e.layerNames+e.styleNames;r&&(o+=r),n.call(this,e.sector,e.levelZeroDelta,e.numLevels,e.format,o,e.size,e.size),this.displayName=e.title,this.pickEnabled=!1,this.urlBuilder=new s(e.service,e.layerNames,e.styleNames,e.version,r),e.coordinateSystem&&(this.urlBuilder.crs=e.coordinateSystem),this.timeString=r};return a.prototype=Object.create(n.prototype),a.formLayerConfiguration=function(t){var i={title:t.title,version:t.capability.capsDoc.version},r=t.geographicBoundingBox||t.latLonBoundingBox;r&&r.westBoundLongitude?i.sector=new o(r.southBoundLatitude,r.northBoundLatitude,r.westBoundLongitude,r.eastBoundLongitude):r&&r.minx?i.sector=new o(r.miny,r.maxy,r.minx,r.maxx):i.sector=o.FULL_SPHERE,
i.levelZeroDelta=new e(36,36),i.numLevels=19,i.size=256,i.layerNames=t.name;var n=t.capability.request.getMap,s=n.formats;s.indexOf("image/png")>=0?i.format="image/png":s.indexOf("image/jpeg")>=0?i.format="image/jpeg":s.indexOf("image/tiff")>=0?i.format="image/tiff":s.indexOf("image/gif")>=0&&(i.format="image/gif"),i.service=n.url;var h=t.crses;h||(h=t.srses),h&&(h.indexOf("EPSG:4326")>=0||h.indexOf("epsg:4326")>=0?i.coordinateSystem="EPSG:4326":(h.indexOf("CRS84")>=0||h.indexOf("CRS:84")>=0)&&(i.coordinateSystem="CRS:84"));var l=a.parseTimeDimensions(t);return l&&l.length>0&&(i.timeSequences=l),i},a.parseTimeDimensions=function(t){var e=t.extents||t.dimensions,i=null;if(e){i=[];for(var o=0;o<e.length;o++){var n=e[o];if("time"===n.name.toLowerCase()&&(!n.units||"iso8601"===n.units.toLowerCase()))for(var s=n.content.split(","),a=0;a<s.length;a++){var h=s[a],l=h.split("/");1===l.length?i.push(new Date(h)):3===l.length&&i.push(new r(h))}}}return i},a}),i("layer/WmsTimeDimensionedLayer",["../error/ArgumentError","../layer/Layer","../util/Logger","../layer/WmsLayer"],function(t,e,i,r){"use strict";var o=function(r){if(!r)throw new t(i.logMessage(i.LEVEL_SEVERE,"WmsTimeDimensionedLayer","constructor","No configuration specified."));e.call(this,"WMS Time Dimensioned Layer"),this.config=r,this.time=null,this.displayName=r.title,this.pickEnabled=!1,this.layers={}};return o.prototype=Object.create(e.prototype),o.prototype.doRender=function(t){if(this.time){var e=this.time.toISOString(),i=this.layers[e];i||(i=new r(this.config,e),this.layers[e]=i),i.opacity=this.opacity,i.doRender(t),this.inCurrentFrame=i.inCurrentFrame}},o}),i("ogc/OwsLanguageString",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"LanguageString","constructor","missingDomElement"));this.value=i.textContent;var r=i.getAttribute("lang");r&&(this.lang=r)};return i}),i("ogc/OwsConstraint",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsConstraint","constructor","missingDomElement"));this.name=i.getAttribute("name");for(var r=i.children,o=0;o<r.length;o++){var n=r[o];if("AllowedValues"===n.localName){this.allowedValues=this.allowedValues||[];for(var s=0;s<n.children.length;s++)"Value"===n.children[s].localName&&this.allowedValues.push(n.children[s].textContent)}else"AnyValue"===n.localName?this.anyValue=!0:"NoValues"===n.localName&&(this.noValues=!0)}};return i}),i("ogc/OwsOperationsMetadata",["../error/ArgumentError","../util/Logger","../ogc/OwsConstraint"],function(t,e,i){"use strict";var r=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsOperationsMetadata","constructor","missingDomElement"));for(var o=i.children,n=0;n<o.length;n++){var s=o[n];"Operation"===s.localName&&(this.operation=this.operation||[],this.operation.push(r.assembleOperation(s)))}};return r.assembleOperation=function(t){var e={};e.name=t.getAttribute("name");for(var i=t.children,o=0;o<i.length;o++){var n=i[o];"DCP"===n.localName&&(e.dcp=e.dcp||[],e.dcp.push(r.assembleDcp(n)))}return e},r.assembleDcp=function(t){for(var e={},i=t.children,o=0;o<i.length;o++){var n=i[o];"HTTP"===n.localName&&(e.http=r.assembleHttp(n))}return e},r.assembleHttp=function(t){for(var e={},i=t.children,o=0;o<i.length;o++){var n=i[o];"Get"===n.localName&&(e.get=e.get||[],e.get.push(r.assembleGet(n)))}return e},r.assembleGet=function(t){var e={};e.href=t.getAttribute("xlink:href");for(var r=t.children,o=0;o<r.length;o++){var n=r[o];"Constraint"===n.localName&&(e.constraint=e.constraint||[],e.constraint.push(new i(n)))}return e},r}),i("ogc/OwsServiceIdentification",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsServiceIdentification","constructor","missingDomElement"));for(var r=i.children,o=0;o<r.length;o++){var n=r[o];"ServiceType"===n.localName?this.serviceType=n.textContent:"ServiceTypeVersion"===n.localName?this.serviceTypeVersion=n.textContent:"Profile"===n.localName?(this.profile=this.profiles||[],this.profile.push(n.textContent)):"Title"===n.localName?(this.title=this.title||[],this.title.push(n.textContent)):"Abstract"===n.localName?(this["abstract"]=this.title||[],this["abstract"].push(n.textContent)):"Fees"===n.localName?this.fees=n.textContent:"AccessConstraints"===n.localName&&(this.accessConstraints=this.accessConstraints||[],this.accessConstraints.push(n.textContent))}};return i}),i("ogc/OwsServiceProvider",["../error/ArgumentError","../util/Logger"],function(t,e){"use strict";var i=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"OwsServiceProvider","constructor","missingDomElement"));for(var r=i.children,o=0;o<r.length;o++){var n=r[o];"ProviderName"===n.localName?this.providerName=n.textContent:"ProviderSite"===n.localName&&(this.providerSite=n.getAttribute("xlink:href"))}};return i}),i("ogc/WmtsLayerCapabilities",["../error/ArgumentError","../util/Logger","../ogc/OwsLanguageString","../ogc/WmsCapabilities"],function(t,e,i,r){"use strict";var o=function(i,r){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmtsLayerCapabilities","constructor","missingDomElement"));this.capabilities=r,this.identifier,this.title,this["abstract"],this.keywords,this.wgs84BoundingBox,this.boundingBox,this.styles,this.formats,this.infoFormat,this.dimension,this.metadata,this.tileMatrixSetLink,this.resourceUrl,this.assembleLayer(i)};return o.prototype.assembleLayer=function(t){for(var e=t.children||t.childNodes,r=0;r<e.length;r++){var n=e[r];"Identifier"===n.localName?this.identifier=n.textContent:"Title"===n.localName?(this.title=this.title||[],this.title.push(new i(n))):"Abstract"===n.localName?(this["abstract"]=this["abstract"]||[],this["abstract"].push(new i(n))):"WGS84BoundingBox"===n.localName?this.wgs84BoundingBox=o.assembleBoundingBox(n):"BoundingBox"===n.localName?(this.boundingBox=this.boundingBox||[],this.boundingBox.push(o.assembleBoundingBox(n))):"Style"===n.localName?(this.style=this.style||[],this.style.push(o.assembleStyle(n))):"Format"===n.localName?(this.format=this.format||[],this.format.push(n.textContent)):"InfoFormat"===n.localName?(this.infoFormat=this.infoFormat||[],this.infoFormat.push(n.textContent)):"Dimension"===n.localName?(this.dimension=this.dimension||[],this.dimension.push(o.assembleDimension(n))):"Metadata"===n.localName?(this.metadata=this.metadata||[],this.metadata.push(o.assembleMetadata(n))):"ResourceURL"===n.localName?(this.resourceUrl=this.resourceUrl||[],this.resourceUrl.push(o.assembleResourceUrl(n))):"TileMatrixSetLink"===n.localName&&(this.tileMatrixSetLink=this.tileMatrixSetLink||[],this.tileMatrixSetLink.push(o.assembleTileMatrixSetLink(n)))}},o.assembleStyle=function(t){var e={};e.isDefault=t.getAttribute("isDefault");for(var r=t.children||t.childNodes,n=0;n<r.length;n++){var s=r[n];"Identifier"===s.localName?e.identifier=s.textContent:"Title"===s.localName?(e.title=e.title||[],e.title.push(new i(s))):"Abstract"===s.localName?(e["abstract"]=e["abstract"]||[],e["abstract"].push(new i(s))):"LegendURL"===s.localName&&(e.legendUrl=e.legendUrl||[],e.legendUrl.push(o.assembleLegendUrl(s)))}return e},o.assembleBoundingBox=function(t){var e={},i=t.getAttribute("crs");i&&(e.crs=i);for(var r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];if("LowerCorner"===n.localName){var s=n.textContent.split(" ");e.lowerCorner=[parseFloat(s[0]),parseFloat(s[1])]}else if("UpperCorner"===n.localName){var a=n.textContent.split(" ");e.upperCorner=[parseFloat(a[0]),parseFloat(a[1])]}}return e},o.assembleDimension=function(t){for(var e={},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Identifier"===n.localName?e.identifier=n.textContent:"Title"===n.localName?(e.title=e.title||[],e.title.push(new i(n))):"Abstract"===n.localName?(e["abstract"]=e["abstract"]||[],e["abstract"].push(new i(n))):"UOM"===n.localName?e.uom={name:n.getAttribute("name"),reference:n.getAttribute("reference")}:"UnitSymbol"==n.localName?e.unitSymbol=n.textContent:"Default"===n.localName?e["default"]=n.textContent:"Current"===n.localName?e.current="true"===n.textContent:"Value"===n.localName&&(e.value=e.value||[],e.value.push(n.textContent))}return e},o.assembleMetadata=function(t){var e={};return e},o.assembleResourceUrl=function(t){var e={};return e.format=t.getAttribute("format"),e.resourceType=t.getAttribute("resourceType"),e.template=t.getAttribute("template"),e},o.assembleLegendUrl=function(t){var e={};return e.format=t.getAttribute("format"),e.minScaleDenominator=t.getAttribute("minScaleDenominator"),e.maxScaleDenominator=t.getAttribute("maxScaleDenominator"),e.href=t.getAttribute("xlink:href"),e.width=t.getAttribute("width"),e.height=t.getAttribute("height"),e},o.assembleTileMatrixSetLink=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"TileMatrixSet"===n.localName?e.tileMatrixSet=n.textContent:"TileMatrixSetLimits"===n.localName&&(e.tileMatrixSetLimits=o.assembleTileMatrixSetLimits(n))}return e},o.assembleTileMatrixSetLimits=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var n=i[r];"TileMatrixLimits"===n.localName&&(e.tileMatrixLimits=e.tileMatrixLimits||[],e.tileMatrixLimits.push(o.assembleTileMatrixLimits(n)))}return e},o.assembleTileMatrixLimits=function(t){for(var e={},i=t.children||t.childNodes,r=0;r<i.length;r++){var o=i[r];"TileMatrix"===o.localName?e.tileMatrix=o.textContent:"MinTileRow"===o.localName?e.minTileRow=parseInt(o.textContent):"MaxTileRow"===o.localName?e.maxTileRow=parseInt(o.textContent):"MinTileCol"===o.localName?e.minTileCol=parseInt(o.textContent):"maxTileCol"===o.localName&&(e.maxTileCol=parseInt(o.textContent))}return e},o}),i("ogc/WmtsCapabilities",["../error/ArgumentError","../util/Logger","../ogc/OwsLanguageString","../ogc/OwsOperationsMetadata","../ogc/OwsServiceIdentification","../ogc/OwsServiceProvider","../ogc/WmsCapabilities","../ogc/WmtsLayerCapabilities"],function(t,e,i,r,o,n,s,a){"use strict";var h=function(i){if(!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"WmtsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(i)};return h.prototype.assembleDocument=function(t){var e=t.documentElement;this.version=e.getAttribute("version"),this.updateSequence=e.getAttribute("updateSequence");for(var i=e.children||e.childNodes,s=0;s<i.length;s++){var a=i[s];"ServiceIdentification"===a.localName?this.serviceIdentification=new o(a):"ServiceProvider"===a.localName?this.serviceProvider=new n(a):"OperationsMetadata"===a.localName?this.operationsMetadata=new r(a):"Contents"===a.localName&&(this.contents=this.assembleContents(a))}this.resolveTileMatrixSetLinks()},h.prototype.assembleContents=function(t){for(var i={},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];if("Layer"===n.localName){i.layer=i.layer||[];try{i.layer.push(new a(n,this))}catch(s){e.logMessage(e.LEVEL_SEVERE,"WmtsCapabilities","constructor","Exception reading WMTS layer description: "+s.message)}}else if("TileMatrixSet"===n.localName){i.tileMatrixSet=i.tileMatrixSet||[];try{i.tileMatrixSet.push(h.assembleTileMatrixSet(n))}catch(s){e.logMessage(e.LEVEL_SEVERE,"WmtsCapabilities","constructor","Exception reading WMTS tile matrix set description: "+s.message)}}}return i},h.assembleTileMatrixSet=function(t){for(var e={},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];"Identifier"===n.localName?e.identifier=n.textContent:"SupportedCRS"===n.localName?e.supportedCRS=n.textContent:"WellKnownScaleSet"===n.localName?e.wellKnownScaleSet=n.textContent:"BoundingBox"===n.localName?e.boundingBox=a.assembleBoundingBox(n):"TileMatrix"===n.localName?(e.tileMatrix=e.tileMatrix||[],e.tileMatrix.push(h.assembleTileMatrix(n))):"Title"===n.localName?(e.title=e.title||[],e.title.push(new i(n))):"Abstract"===n.localName&&(e["abstract"]=e["abstract"]||[],e["abstract"].push(new i(n)))}for(var s=0;s<e.tileMatrix.length;s++)e.tileMatrix[s].levelNumber=s;return e},h.assembleTileMatrix=function(t){for(var e={},r=t.children||t.childNodes,o=0;o<r.length;o++){var n=r[o];if("Identifier"===n.localName)e.identifier=n.textContent;else if("Title"===n.localName)e.title=tileMatrixSet.title||[],e.title.push(new i(n));else if("Abstract"===n.localName)e["abstract"]=tileMatrixSet["abstract"]||[],e["abstract"].push(new i(n));else if("ScaleDenominator"===n.localName)e.scaleDenominator=parseFloat(n.textContent);else if("TileWidth"===n.localName)e.tileWidth=parseFloat(n.textContent);else if("TileHeight"===n.localName)e.tileHeight=parseFloat(n.textContent);else if("MatrixWidth"===n.localName)e.matrixWidth=parseFloat(n.textContent);else if("MatrixHeight"===n.localName)e.matrixHeight=parseFloat(n.textContent);else if("TopLeftCorner"===n.localName){var s=n.textContent.split(" ");e.topLeftCorner=[parseFloat(s[0]),parseFloat(s[1])]}}return e},h.prototype.resolveTileMatrixSetLinks=function(){for(var t=0;t<this.contents.layer.length;t++)for(var e=this.contents.layer[t],i=0;i<e.tileMatrixSetLink.length;i++)for(var r=e.tileMatrixSetLink[i],o=0;o<this.contents.tileMatrixSet.length;o++)if(this.contents.tileMatrixSet[o].identifier===r.tileMatrixSet){r.tileMatrixSetRef=this.contents.tileMatrixSet[o];break}},h.prototype.getGetTileKvpAddress=function(){for(var t=0;t<this.operationsMetadata.operation.length;t++){var e=this.operationsMetadata.operation[t];if("GetTile"===e.name)return e.dcp[0].http.get[0].href}return null},h}),i("layer/WmtsLayerTile",["../geom/Angle","../error/ArgumentError","../geom/BoundingBox","../util/Logger","../geom/Vec3","../util/WWUtil"],function(t,e,i,r,o,n){"use strict";var s=function(e,i,r,o,n){this.sector=e,this.tileMatrix=i,this.row=r,this.column=o,this.imagePath=n,this.texelSize=e.deltaLatitude()*t.DEGREES_TO_RADIANS/i.tileHeight,this.tileKey=i.levelNumber.toString()+"."+r.toString()+"."+o.toString(),this.gpuCacheKey=n};return s.prototype.isEqual=function(t){return t&&t.tileKey?this.tileKey==t.tileKey:!1},s.prototype.distanceTo=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));for(var i,o,n,s=t[0],a=t[1],h=t[2],l=this.samplePoints,u=Number.POSITIVE_INFINITY,c=0,d=l.length;d>c;c+=3)i=s-l[c],o=a-l[c+1],n=h-l[c+2],u=Math.min(u,i*i+o*o+n*n);return Math.sqrt(u)},s.prototype.subdivide=function(t,i){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"WmtsLayerTile","subdivide","The specified tile matrix is null or undefined."));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"WmtsLayerTile","subdivide","The specified tile factory is null or undefined."));var o,n,s,a,h=[];return o=t.matrixHeight/this.tileMatrix.matrixHeight,n=t.matrixWidth/this.tileMatrix.matrixWidth,s=o*this.row,a=n*this.column,h.push(i.createTile(t,s,a)),s=o*this.row,a=n*this.column+1,h.push(i.createTile(t,s,a)),s=o*this.row+1,a=n*this.column,h.push(i.createTile(t,s,a)),s=o*this.row+1,a=n*this.column+1,h.push(i.createTile(t,s,a)),h},s.prototype.subdivideToCache=function(t,i,o){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile matrix is null or undefined."));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var n=o?o.entryForKey(this.tileKey):null;return n||(n=this.subdivide(t,i),n&&o&&o.putEntry(this.tileKey,n,n.length)),n},s.prototype.mustSubdivide=function(t,e){var i=t.globe.equatorialRadius*this.texelSize,r=this.distanceTo(t.navigatorState.eyePoint);return i>r*Math.pow(10,-e)},s.prototype.update=function(t){var e=t.globe.elevationTimestamp(),i=t.verticalExaggeration,r=t.globeStateKey;(this.updateTimestamp!=e||this.updateVerticalExaggeration!=i||this.updateGlobeStateKey!=r)&&(this.doUpdate(t),t.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=e,this.updateVerticalExaggeration=i,this.updateGlobeStateKey=r)},s.prototype.doUpdate=function(t){var e=t.globe,r=t.verticalExaggeration,s=e.minAndMaxElevationsForSector(this.sector),a=s?s[0]*r:0,h=s?s[1]*r:0;a==h&&(a=h+10),this.extent||(this.extent=new i),this.extent.setToSector(this.sector,e,a,h),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),n.fillArray(this.sampleElevations,.5*(a+h)),e.computePointsForGrid(this.sector,3,3,this.sampleElevations,o.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new o(0,0,0)),e.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},s.prototype.bind=function(t){var e=t.gpuResourceCache.resourceForKey(this.gpuCacheKey);return e&&e.bind(t)?!0:this.fallbackTile?this.fallbackTile.bind(t):!1},s.prototype.applyInternalTransform=function(t,e){},s}),i("layer/WmtsLayer",["../util/AbsentResourceList","../error/ArgumentError","../util/Logger","../geom/Sector","../layer/Layer","../cache/MemoryCache","../render/Texture","../util/WmsUrlBuilder","../layer/WmtsLayerTile","../util/WWMath","../util/WWUtil"],function(t,e,i,r,o,n,s,a,h,l,u){"use strict";var c=function(s,h,l){if(!s)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No layer configuration specified."));o.call(this,"WMTS Layer"),this.layerIdentifier=s.identifier,this.styleIdentifier=h,this.timeString=l;var u=s.format;if(u.indexOf("image/png")>=0?this.imageFormat="image/png":u.indexOf("image/jpeg")>=0?this.imageFormat="image/jpeg":u.indexOf("image/tiff")>=0?this.imageFormat="image/tiff":u.indexOf("image/gif")>=0?this.imageFormat="image/gif":this.imageFormat=u[0],!this.imageFormat)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","Layer does not provide a supported image format."));if(s.resourceUrl&&s.resourceUrl.length>1){for(var d=0;d<s.resourceUrl.length;d++)if(this.imageFormat===s.resourceUrl[d].format){this.resourceUrl=s.resourceUrl[d].template;break}}else this.serviceUrl=s.capabilities.getGetTileKvpAddress(),this.serviceUrl&&(this.serviceUrl=a.fixGetMapString(this.serviceUrl));if(!this.resourceUrl&&!this.serviceUrl)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No resource URL or KVP GetTile service URL specified in WMTS capabilities."));if(this.styleIdentifier){for(var g=!1,d=0;d<s.style.length;d++)if(s.style[d].identifier===this.styleIdentifier){g=!0;break}g||(i.logMessage(i.LEVEL_WARNING,"WmtsLayer","constructor","The specified style identifier is not available. The server's default style will be used."),this.styleIdentifier=null)}if(!this.styleIdentifier)for(d=0;d<s.style.length;d++)if(s.style[d].isDefault){this.styleIdentifier=s.style[d].identifier;break}this.styleIdentifier||i.logMessage(i.LEVEL_WARNING,"WmtsLayer","constructor","No default style available. A style will not be specified in tile requests.");var p,f=null,m=null;for(d=0;d<s.tileMatrixSetLink.length;d++)p=s.tileMatrixSetLink[d].tileMatrixSetRef,c.isEpsg4326Crs(p.supportedCRS)?f=f||p:c.isEpsg3857Crs(p.supportedCRS)&&(m=m||p);if(this.tileMatrixSet=f||m,!this.tileMatrixSet)throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No supported Tile Matrix Set could be found."));if(s.wgs84BoundingBox)this.sector=new r(s.wgs84BoundingBox.lowerCorner[1],s.wgs84BoundingBox.upperCorner[1],s.wgs84BoundingBox.lowerCorner[0],s.wgs84BoundingBox.upperCorner[0]);else if(this.tileMatrixSet.boundingBox&&WmtsLayerCapabilities.isEpsg4326Crs(this.tileMatrixSet.boundingBox.crs))this.sector=new r(this.tileMatrixSet.boundingBox.lowerCorner[1],this.tileMatrixSet.boundingBox.upperCorner[1],this.tileMatrixSet.boundingBox.lowerCorner[0],this.tileMatrixSet.boundingBox.upperCorner[0]);else if(WmtsLayerCapabilities.isEpsg4326Crs(this.tileMatrixSet.supportedCRS))throw new e(i.logMessage(i.LEVEL_SEVERE,"WmtsLayer","constructor","No EPSG:4326 bounding box was specified in the layer or tile matrix set capabilities."));this.cachePath=(this.resourceUrl||this.serviceUrl)+this.layerIdentifier+this.styleIdentifier+this.tileMatrixSet.identifier,l&&(this.cachePath=this.cachePath+l),s.title.length>0?this.displayName=s.title[0].value:this.displayName=s.identifier,this.pickEnabled=!1,this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new n(500,400),this.currentRetrievals=[],this.absentResourceList=new t(3,5e4),this.pickEnabled=!1,this.detailHintOrigin=2.4,this.detailHint=0};return c.prototype=Object.create(o.prototype),c.prototype.doRender=function(t){t.terrain&&(!this.currentTilesInvalid&&this.lasTtMVP&&t.navigatorState.modelviewProjection.equals(this.lasTtMVP)&&t.globeStateKey==this.lastGlobeStateKey||(this.currentTilesInvalid=!1,this.assembleTiles(t)),this.lasTtMVP=t.navigatorState.modelviewProjection,this.lastGlobeStateKey=t.globeStateKey,this.currentTiles.length>0&&(t.surfaceTileRenderer.renderTiles(t,this.currentTiles,this.opacity),t.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0))},c.prototype.isLayerInView=function(t){return t.terrain&&t.terrain.sector&&t.terrain.sector.intersects(this.sector)},c.prototype.isTileVisible=function(t,e){return t.globe.projectionLimits&&!e.sector.overlaps(t.globe.projectionLimits)?!1:e.extent.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)},c.prototype.assembleTiles=function(t){this.currentTiles=[],this.topLevelTiles&&0!==this.topLevelTiles.length||this.createTopLevelTiles(t);for(var e=0,i=this.topLevelTiles.length;i>e;e++){var r=this.topLevelTiles[e];r.update(t),this.currentAncestorTile=null,this.isTileVisible(t,r)&&this.addTileOrDescendants(t,r)}},c.prototype.addTileOrDescendants=function(t,e){if(this.tileMeetsRenderingCriteria(t,e))return void this.addTile(t,e);var i=null;try{(this.isTileTextureInMemory(t,e)||0===e.tileMatrix.levelNumber)&&(i=this.currentAncestorTile,this.currentAncestorTile=e);for(var r=this.tileMatrixSet.tileMatrix[e.tileMatrix.levelNumber+1],o=e.subdivideToCache(r,this,this.tileCache),n=0,s=o.length;s>n;n++){var a=o[n];a.update(t),this.sector.intersects(a.sector)&&this.isTileVisible(t,a)&&this.addTileOrDescendants(t,a)}}finally{i&&(this.currentAncestorTile=i)}},c.prototype.addTile=function(t,e){e.fallbackTile=null;var i=t.gpuResourceCache.resourceForKey(e.imagePath);return i?(this.currentTiles.push(e),void(this.expiration&&this.isTextureExpired(i)&&this.retrieveTileImage(t,e))):(this.retrieveTileImage(t,e),void(this.currentAncestorTile&&this.isTileTextureInMemory(t,this.currentAncestorTile)&&this.currentTiles.push(this.currentAncestorTile)))},c.prototype.isTextureExpired=function(t){return this.expiration&&t.creationTime.getTime()<=this.expiration.getTime()},c.prototype.isTileTextureInMemory=function(t,e){return t.gpuResourceCache.containsResource(e.imagePath)},c.prototype.tileMeetsRenderingCriteria=function(t,e){var i=this.detailHintOrigin+this.detailHint;return(e.sector.minLatitude>=75||e.sector.maxLatitude<=-75)&&(i*=.9),e.tileMatrix.levelNumber===this.tileMatrixSet.tileMatrix.length-1||!e.mustSubdivide(t,i)},c.prototype.retrieveTileImage=function(t,e){if(this.currentRetrievals.indexOf(e.imagePath)<0){if(this.absentResourceList.isResourceAbsent(e.imagePath))return;var r=this.resourceUrlForTile(e,this.imageFormat),o=new Image,n=e.imagePath,s=t.gpuResourceCache,a=t.currentGlContext.canvas,h=this;if(!r)return void(this.currentTilesInvalid=!0);o.onload=function(){i.log(i.LEVEL_INFO,"Image retrieval succeeded: "+r);var l=h.createTexture(t,e,o);if(h.removeFromCurrentRetrievals(n),l){s.putResource(n,l,l.size),h.currentTilesInvalid=!0,h.absentResourceList.unmarkResourceAbsent(n);var u=document.createEvent("Event");u.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),a.dispatchEvent(u)}},o.onerror=function(){h.removeFromCurrentRetrievals(n),h.absentResourceList.markResourceAbsent(n),i.log(i.LEVEL_WARNING,"Image retrieval failed: "+r)},this.currentRetrievals.push(n),o.crossOrigin="anonymous",o.src=r}},c.prototype.resourceUrlForTile=function(t,e){var i;return this.resourceUrl?(i=this.resourceUrl.replace("{Style}",this.styleIdentifier).replace("{TileMatrixSet}",this.tileMatrixSet.identifier).replace("{TileMatrix}",t.tileMatrix.identifier).replace("{TileCol}",t.column).replace("{TileRow}",t.row),this.timeString&&i.replace("{Time}",this.timeString)):(i=this.serviceUrl+"service=WMTS&request=GetTile&version=1.0.0",i+="&Layer="+this.layerIdentifier,this.styleIdentifier&&(i+="&Style="+this.styleIdentifier),i+="&Format="+e,this.timeString&&(i+="&Time="+this.timeString),i+="&TileMatrixSet="+this.tileMatrixSet.identifier,i+="&TileMatrix="+t.tileMatrix.identifier,i+="&TileRow="+t.row,i+="&TileCol="+t.column),i},c.prototype.removeFromCurrentRetrievals=function(t){var e=this.currentRetrievals.indexOf(t);e>-1&&this.currentRetrievals.splice(e,1)},c.prototype.createTopLevelTiles=function(t){var e=this.tileMatrixSet.tileMatrix[0];this.topLevelTiles=[];for(var i=0;i<e.matrixHeight;i++)for(var r=0;r<e.matrixWidth;r++)this.topLevelTiles.push(this.createTile(e,i,r))},c.prototype.createTile=function(t,e,i){return c.isEpsg4326Crs(this.tileMatrixSet.supportedCRS)?this.createTile4326(t,e,i):c.isEpsg3857Crs(this.tileMatrixSet.supportedCRS)?this.createTile3857(t,e,i):void 0},c.prototype.createTile4326=function(t,e,i){var o=this.sector.deltaLatitude()/t.matrixHeight,n=this.sector.deltaLongitude()/t.matrixWidth,s=t.topLeftCorner[0]-e*o,a=s-o,h=t.topLeftCorner[1]+n*i,l=h+n,u=new r(a,s,h,l);return this.makeTile(u,t,e,i)},c.prototype.createTile3857=function(t,e,i){t.mapWidth||this.computeTileMatrixValues3857(t);var o,n,s,a,h,u,c=l.clamp(i*t.tileWidth-.5,0,t.mapWidth),d=l.clamp(e*t.tileHeight-.5,0,t.mapHeight),g=l.clamp(c+t.tileWidth+.5,0,t.mapWidth),p=l.clamp(d+t.tileHeight+.5,0,t.mapHeight);o=c/t.mapWidth,n=p/t.mapHeight,a=t.topLeftCorner[0]+o*t.tileMatrixDeltaX,s=t.topLeftCorner[1]-n*t.tileMatrixDeltaY;var f=l.epsg3857ToEpsg4326(a,s);o=g/t.mapWidth,n=d/t.mapHeight,u=t.topLeftCorner[0]+o*t.tileMatrixDeltaX,h=t.topLeftCorner[1]-n*t.tileMatrixDeltaY;var m=l.epsg3857ToEpsg4326(u,h),E=new r(f[0],m[0],f[1],m[1]);return this.makeTile(E,t,e,i)},c.prototype.computeTileMatrixValues3857=function(t){var e=28e-5*t.scaleDenominator,i=t.tileWidth*e,r=t.tileHeight*e,o=t.topLeftCorner[0]+i*t.matrixWidth,n=t.topLeftCorner[1]-r*t.matrixHeight,s=[o,n],a=t.topLeftCorner;t.tileMatrixDeltaX=s[0]-a[0],t.tileMatrixDeltaY=a[1]-s[1],t.mapWidth=t.tileWidth*t.matrixWidth,t.mapHeight=t.tileHeight*t.matrixHeight},c.prototype.makeTile=function(t,e,i,r){var o=this.cachePath+"-layer/"+e.identifier+"/"+i+"/"+r+"."+u.suffixForMimeType(this.imageFormat);return new h(t,e,i,r,o)},c.prototype.createTexture=function(t,e,i){return c.isEpsg4326Crs(this.tileMatrixSet.supportedCRS)?new s(t.currentGlContext,i):c.isEpsg3857Crs(this.tileMatrixSet.supportedCRS)?this.createTexture3857(t,e,i):void 0},c.prototype.createTexture3857=function(t,e,i){this.destCanvas||(this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"));var r,o,n,a,h,u,c,d,g=t.canvas2D,p=t.ctx2D,f=this.destCanvas,m=this.destContext,E=m.createImageData(i.width,i.height),y=e.sector,_=l.gudermannianInverse(y.minLatitude),v=l.gudermannianInverse(y.maxLatitude);g.width=i.width,g.height=i.height,f.width=i.width,f.height=i.height,p.drawImage(i,0,0,i.width,i.height),r=p.getImageData(0,0,i.width,i.height);for(var L=0;1>L;L++)for(var S=0;S<i.height;S++){c=1-S/(i.height-1),o=c*y.deltaLatitude()+y.minLatitude,n=l.gudermannianInverse(o),d=1-(n-_)/(v-_),d=l.clamp(d,0,1),a=Math.floor(d*(i.height-1));for(var T=0;T<i.width;T++)h=4*(T+a*i.width),u=4*(T+S*i.width),E.data[u]=r.data[h],E.data[u+1]=r.data[h+1],E.data[u+2]=r.data[h+2],E.data[u+3]=r.data[h+3]}return m.putImageData(E,0,0),new s(t.currentGlContext,f)},c.isEpsg4326Crs=function(t){return t.indexOf("EPSG")>=0&&t.indexOf("4326")>=0},c.isEpsg3857Crs=function(t){return t.indexOf("EPSG")>=0&&(t.indexOf("3857")>=0||t.indexOf("900913")>=0)},c}),i("WorldWindow",["./error/ArgumentError","./render/DrawContext","./globe/EarthElevationModel","./util/FrameStatistics","./globe/Globe","./globe/Globe2D","./util/GoToAnimator","./cache/GpuResourceCache","./util/Logger","./navigate/LookAtNavigator","./navigate/NavigatorState","./pick/PickedObjectList","./geom/Rectangle","./geom/Sector","./shapes/SurfaceShape","./shapes/SurfaceShapeTileBuilder","./globe/Terrain","./geom/Vec2"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E){"use strict";var y=function(n,a){function u(t){m.handleContextLost(t)}function c(t){m.handleContextRestored(t)}function g(t){m.handleRedrawEvent(t)}if(!window.WebGLRenderingContext)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas does not support WebGL."));var p=document.getElementById(n);if(!p)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas name is not in the document."));var f=this.createContext(p);this.drawContext=new e(f),this.eventListeners={},this.redrawRequested=!0,this.redrawRequestId=null,this.canvas=p,this.depthBits=f.getParameter(f.DEPTH_BITS),this.viewport=new d(0,0,f.drawingBufferWidth,f.drawingBufferHeight),this.globe=new o(a||new i),this.layers=[],this.navigator=new l(this),this.verticalExaggeration=1,this.deepPicking=!1,this.subsurfaceMode=!1,this.surfaceOpacity=1,this.frameStatistics=new r,this.goToAnimator=new s(this),this._redrawCallbacks=[],this._orderedRenderingFilters=[function(t){m.declutter(t,1)},function(t){m.declutter(t,2)}],this.pixelScale=1;var m=this;this.canvas.addEventListener("webglcontextlost",u,!1),this.canvas.addEventListener("webglcontextrestored",c,!1),this.canvas.addEventListener(WorldWind.REDRAW_EVENT_TYPE,g,!1),window.addEventListener(WorldWind.REDRAW_EVENT_TYPE,g,!1),this.animationFrameLoop()};return Object.defineProperties(y.prototype,{orderedRenderingFilters:{get:function(){return this._orderedRenderingFilters}},redrawCallbacks:{get:function(){return this._redrawCallbacks}}}),y.prototype.canvasCoordinates=function(t,e){var i=this.canvas.getBoundingClientRect(),r=t-(i.left+this.canvas.clientLeft),o=e-(i.top+this.canvas.clientTop);return new E(r,o)},y.prototype.addEventListener=function(e,i){if(!e)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","addEventListener","missingType"));if(!i)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","addEventListener","missingListener"));var r=this,o=this.eventListeners[e];o||(o={listeners:[],callback:function(t){t.worldWindow=r;for(var e=0,i=o.listeners.length;i>e;e++)o.listeners[e](t)}},this.eventListeners[e]=o);var n=o.listeners.indexOf(i);-1==n&&(o.listeners.splice(0,0,i),1==o.listeners.length&&this.canvas.addEventListener(e,o.callback,!1))},y.prototype.removeEventListener=function(e,i){if(!e)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingType"));if(!i)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingListener"));var r=this.eventListeners[e];if(r){var o=r.listeners.indexOf(i);-1!=o&&(r.listeners.splice(o,1),0==r.listeners.length&&this.canvas.removeEventListener(e,r.callback,!1))}},y.prototype.redraw=function(){this.redrawRequested=!0},y.prototype.pick=function(e){if(!e)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","pick","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickPoint=e,this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.pickTerrain=function(e){if(!e)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","pickTerrain","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickTerrainOnly=!0,this.drawContext.pickPoint=e,this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.pickShapesInRegion=function(e){if(!e)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","pickShapesInRegion","missingRectangle"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.regionPicking=!0,
this.drawContext.pickRectangle=new d(e.x,this.canvas.height-e.y,e.width,e.height),this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.createContext=function(t){var e={antialias:!1,stencil:!0},i=t.getContext("webgl",e);i||(i=t.getContext("experimental-webgl",e));var r=i.getContextAttributes();return this.hasStencilBuffer=r.stencil,i},y.prototype.handleContextLost=function(t){h.log(h.LEVEL_INFO,"WebGL context event: "+t.statusMessage),t.preventDefault(),this.drawContext.contextLost(),window.cancelAnimationFrame(this.redrawRequestId)},y.prototype.handleContextRestored=function(t){h.log(h.LEVEL_INFO,"WebGL context event: "+t.statusMessage),this.drawContext.contextRestored(),this.redraw(),this.animationFrameLoop()},y.prototype.handleRedrawEvent=function(t){this.redraw()},y.prototype.animationFrameLoop=function(){function t(){e.animationFrameLoop()}this.redrawIfNeeded();var e=this;this.redrawRequestId=window.requestAnimationFrame(t)},y.prototype.redrawIfNeeded=function(){if(this.resize(),this.redrawRequested)try{this.redrawRequested=!1,this.drawContext.previousRedrawTimestamp=this.drawContext.timestamp,this.callRedrawCallbacks(WorldWind.BEFORE_REDRAW),this.resetDrawContext(),this.drawFrame()}catch(t){h.logMessage(h.LEVEL_SEVERE,"WorldWindow","redrawIfNeeded","Exception occurred during redrawing.\n"+t.toString())}finally{this.callRedrawCallbacks(WorldWind.AFTER_REDRAW),this.drawContext.redrawRequested&&(this.redrawRequested=!0)}},y.prototype.resize=function(){var t=this.drawContext.currentGlContext,e=t.canvas.clientWidth*this.pixelScale,i=t.canvas.clientHeight*this.pixelScale;(t.canvas.width!=e||t.canvas.height!=i)&&(t.canvas.width=e,t.canvas.height=i,t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),this.viewport=new d(0,0,t.drawingBufferWidth,t.drawingBufferHeight),this.redrawRequested=!0)},y.prototype.resetDrawContext=function(){this.globe.offset=0;var t=this.drawContext;t.reset(),t.globe=this.globe,t.layers=this.layers,t.navigatorState=this.navigator.currentState(),t.verticalExaggeration=this.verticalExaggeration,t.surfaceOpacity=this.surfaceOpacity,t.deepPicking=this.deepPicking,t.frameStatistics=this.frameStatistics,t.pixelScale=this.pixelScale,t.update()},y.prototype.drawFrame=function(){try{this.drawContext.frameStatistics.beginFrame(),this.beginFrame(),this.drawContext.globe.is2D()&&this.drawContext.globe.continuous?this.do2DContiguousRepaint():this.doNormalRepaint()}finally{this.endFrame(),this.drawContext.frameStatistics.endFrame()}},y.prototype.doNormalRepaint=function(){this.createTerrain(),this.clearFrame(),this.deferOrderedRendering=!1,this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.doPick(),this.resolvePick()):(this.doDraw(),this.subsurfaceMode&&this.hasStencilBuffer&&this.redrawSurface())},y.prototype.do2DContiguousRepaint=function(){this.createTerrain2DContiguous(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.pick2DContiguous(),this.resolvePick()):this.draw2DContiguous()},y.prototype.resolvePick=function(){this.drawContext.pickTerrainOnly?this.resolveTerrainPick():this.drawContext.regionPicking?this.resolveRegionPick():this.resolveTopPick()},y.prototype.beginFrame=function(){var t=this.drawContext.currentGlContext;t.enable(t.BLEND),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.depthFunc(t.LEQUAL),this.drawContext.pickingMode&&(this.drawContext.makePickFramebuffer(),this.drawContext.bindFramebuffer(this.drawContext.pickFramebuffer))},y.prototype.endFrame=function(){var t=this.drawContext.currentGlContext;t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.blendFunc(t.ONE,t.ZERO),t.depthFunc(t.LESS),t.clearColor(0,0,0,1),this.drawContext.bindFramebuffer(null),this.drawContext.bindProgram(null)},y.prototype.clearFrame=function(){var t=this.drawContext,e=t.currentGlContext;e.clearColor(t.clearColor.red,t.clearColor.green,t.clearColor.blue,t.clearColor.alpha),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},y.prototype.doDraw=function(){this.drawContext.renderShapes=!0,this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.screenCreditController.drawCredits(this.drawContext))):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||this.drawOrderedRenderables(),this.drawContext.screenCreditController.drawCredits(this.drawContext))},y.prototype.redrawSurface=function(){this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.EQUAL,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!1),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext)},y.prototype.doPick=function(){this.drawContext.terrain&&this.drawContext.terrain.pick(this.drawContext),this.drawContext.pickTerrainOnly||(this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.terrain.pick(this.drawContext))):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||this.drawOrderedRenderables()))},y.prototype.createTerrain=function(){var t=this.drawContext;t.terrain=this.globe.tessellator.tessellate(t),t.frameStatistics.setTerrainTileCount(t.terrain?t.terrain.surfaceGeometry.length:0)},y.prototype.makeCurrent=function(t){var e=this.drawContext;switch(e.globe.offset=t,e.globeStateKey=e.globe.stateKey,t){case-1:e.terrain=this.terrainLeft;break;case 0:e.terrain=this.terrainCenter;break;case 1:e.terrain=this.terrainRight}},y.prototype.createTerrain2DContiguous=function(){var t=this.drawContext;this.terrainCenter=null,t.globe.offset=0,t.globeStateKey=t.globe.stateKey,t.globe.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)&&(this.terrainCenter=t.globe.tessellator.tessellate(t)),this.terrainRight=null,t.globe.offset=1,t.globeStateKey=t.globe.stateKey,t.globe.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)&&(this.terrainRight=t.globe.tessellator.tessellate(t)),this.terrainLeft=null,t.globe.offset=-1,t.globeStateKey=t.globe.stateKey,t.globe.intersectsFrustum(t.navigatorState.frustumInModelCoordinates)&&(this.terrainLeft=t.globe.tessellator.tessellate(t))},y.prototype.draw2DContiguous=function(){var t="";this.terrainCenter&&(t+=" 0 ",this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doDraw()),this.terrainRight&&(t+=" 1 ",this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doDraw()),this.deferOrderedRendering=!1,this.terrainLeft&&(t+=" -1 ",this.makeCurrent(-1),this.doDraw()),this.subsurfaceMode&&this.hasStencilBuffer&&(this.deferOrderedRendering=!0,this.terrainCenter&&(t+=" 0 ",this.makeCurrent(0),this.redrawSurface()),this.terrainRight&&(t+=" 1 ",this.makeCurrent(1),this.redrawSurface()),this.terrainLeft&&(t+=" -1 ",this.makeCurrent(-1),this.redrawSurface()))},y.prototype.pick2DContiguous=function(){this.terrainCenter&&(this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doPick()),this.terrainRight&&(this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doPick()),this.deferOrderedRendering=!1,this.terrainLeft&&(this.makeCurrent(-1),this.doPick())},y.prototype.drawLayers=function(t){var e,i=Date.now(),r=this.drawContext,o=r.layers;r.accumulateOrderedRenderables=t;for(var n=0,s=o.length;s>n;n++)if(e=o[n]){r.currentLayer=e;try{e.render(r)}catch(a){h.log(h.LEVEL_SEVERE,"Error while rendering layer "+e.displayName+".\n"+a.toString())}}var l=Date.now();r.frameStatistics.layerRenderingTime=l-i},y.prototype.addLayer=function(t){this.layers.push(t)},y.prototype.removeLayer=function(t){if(t){for(var e=-1,i=0,r=this.layers.length;r>i;i++)if(this.layers[i]==t){e=i;break}e>=0&&this.layers.splice(e,1)}},y.prototype.insertLayer=function(t,e){e&&this.layers.splice(t,0,e)},y.prototype.drawSurfaceRenderables=function(){var t,e=this.drawContext;for(e.reverseSurfaceRenderables();t=e.popSurfaceRenderable();)try{t.renderSurface(e)}catch(i){h.logMessage(h.LEVEL_WARNING,"WorldWindow","drawSurfaceRenderables","Error while rendering a surface renderable.\n"+i.message)}},y.prototype.drawOrderedRenderables=function(){var t,e=Date.now(),i=this.drawContext;if(i.sortOrderedRenderables(),this._orderedRenderingFilters)for(var r=0;r<this._orderedRenderingFilters.length;r++)this._orderedRenderingFilters[r](this.drawContext);for(i.orderedRenderingMode=!0;t=i.popOrderedRenderable();)try{t.renderOrdered(i)}catch(o){h.logMessage(h.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering an ordered renderable.\n"+o.message)}i.orderedRenderingMode=!1,i.frameStatistics.orderedRenderingTime=Date.now()-e},y.prototype.resolveTopPick=function(){if(0!=this.drawContext.objectsAtPickPoint.objects.length){var t=this.drawContext.objectsAtPickPoint,e=this.drawContext.readPickColor(this.drawContext.pickPoint),i=null,r=null;if(e){for(var o=0,n=t.objects.length;n>o;o++){var s=t.objects[o];if(s.isTerrain&&(r=s),s.color.equals(e)&&(s.isOnTop=!0,i=s,r))break}this.drawContext.deepPicking||(t.clear(),i&&t.add(i),r&&r!=i&&t.add(r))}else t.clear()}},y.prototype.resolveTerrainPick=function(){for(var t,e=this.drawContext.objectsAtPickPoint,i=0,r=e.objects.length;r>i;i++)if(t=e.objects[i],t.isTerrain){t.isOnTop=!0;break}},y.prototype.resolveRegionPick=function(){if(0!=this.drawContext.objectsAtPickPoint.objects.length)for(var t,e,i=this.drawContext.objectsAtPickPoint,r=this.drawContext.readPickColors(this.drawContext.pickRectangle),o=0,n=i.objects.length;n>o;o++)if(t=i.objects[o]){var s=t.color.toByteString();e=r[s],e?t.isOnTop=!0:t.userObject instanceof p&&(i.objects.splice(o,1),o-=1)}},y.prototype.callRedrawCallbacks=function(t){for(var e=0,i=this._redrawCallbacks.length;i>e;e++)try{this._redrawCallbacks[e](this,t)}catch(r){h.log(h.LEVEL_SEVERE,"Exception calling redraw callback.\n"+r.toString())}},y.prototype.goTo=function(t,e){this.goToAnimator.goTo(t,e)},y.prototype.declutter=function(e,i){if(!i)throw new t(h.logMessage(h.LEVEL_SEVERE,"WorldWindow","declutter","Group ID is null, undefined or 0."));for(var r=[],o=0;o<e.orderedRenderables.length;o++){var n=e.orderedRenderables[o].orderedRenderable;n.declutterGroup===i&&r.push(n)}for(var s=[],a=0;a<r.length;a++){var l=r[a],u=l.screenBounds;u&&u.intersectsRectangles(s)?l.targetVisibility=0:(l.targetVisibility=1,u&&s.push(u))}},y}),i("util/WWMessage",[],function(){"use strict";var t=function(t,e){this.type=t,this.source=e};return t}),i("WorldWind",["./error/AbstractError","./geom/Angle","./error/ArgumentError","./shaders/BasicProgram","./shaders/BasicTextureProgram","./layer/BingAerialLayer","./layer/BingAerialWithLabelsLayer","./layer/BingRoadsLayer","./layer/BingWMSLayer","./layer/BlueMarbleLayer","./layer/BMNGLandsatLayer","./layer/BMNGLayer","./layer/BMNGOneImageLayer","./layer/BMNGRestLayer","./geom/BoundingBox","./gesture/ClickRecognizer","./util/Color","./shapes/Compass","./layer/CompassLayer","./layer/CoordinatesDisplayLayer","./layer/DigitalGlobeTiledImageLayer","./gesture/DragRecognizer","./render/DrawContext","./globe/EarthElevationModel","./globe/EarthRestElevationModel","./globe/ElevationModel","./util/Font","./util/FrameStatistics","./layer/FrameStatisticsLayer","./render/FramebufferTexture","./render/FramebufferTile","./render/FramebufferTileController","./geom/Frustum","./shapes/GeographicMesh","./projections/GeographicProjection","./shapes/GeographicText","./formats/geojson/GeoJSONParser","./gesture/GestureRecognizer","./globe/Globe","./globe/Globe2D","./util/GoToAnimator","./shaders/GpuProgram","./cache/GpuResourceCache","./shaders/GpuShader","./util/HighlightController","./util/ImageSource","./render/ImageTile","./layer/LandsatRestLayer","./layer/Layer","./util/Level","./util/LevelRowColumnUrlBuilder","./util/LevelSet","./geom/Line","./geom/Location","./util/Logger","./navigate/LookAtNavigator","./geom/Matrix","./cache/MemoryCache","./cache/MemoryCacheListener","./layer/MercatorTiledImageLayer","./navigate/Navigator","./navigate/NavigatorState","./util/NominatimGeocoder","./error/NotYetImplementedError","./util/Offset","./layer/OpenStreetMapImageLayer","./gesture/PanRecognizer","./shapes/Path","./util/PeriodicTimeSequence","./pick/PickedObject","./pick/PickedObjectList","./gesture/PinchRecognizer","./shapes/Placemark","./shapes/PlacemarkAttributes","./geom/Plane","./shapes/Polygon","./geom/Position","./projections/ProjectionEquirectangular","./projections/ProjectionGnomonic","./projections/ProjectionMercator","./projections/ProjectionPolarEquidistant","./projections/ProjectionUPS","./geom/Rectangle","./render/Renderable","./layer/RenderableLayer","./gesture/RotationRecognizer","./shapes/ScreenImage","./shapes/ScreenText","./geom/Sector","./shapes/ShapeAttributes","./formats/shapefile/Shapefile","./layer/ShowTessellationLayer","./shapes/SurfaceImage","./shapes/SurfaceCircle","./shapes/SurfaceEllipse","./shapes/SurfacePolygon","./shapes/SurfacePolyline","./shapes/SurfaceRectangle","./render/SurfaceRenderable","./shapes/SurfaceSector","./shapes/SurfaceShape","./shapes/SurfaceShapeTile","./shapes/SurfaceShapeTileBuilder","./render/SurfaceTile","./render/SurfaceTileRenderer","./shaders/SurfaceTileRendererProgram","./gesture/TapRecognizer","./layer/TectonicPlatesLayer","./globe/Terrain","./globe/TerrainTile","./globe/TerrainTileList","./globe/Tessellator","./shapes/Text","./shapes/TextAttributes","./render/TextSupport","./render/Texture","./render/TextureTile","./util/Tile","./layer/TiledImageLayer","./util/TileFactory","./gesture/TiltRecognizer","./gesture/Touch","./shapes/TriangleMesh","./error/UnsupportedOperationError","./geom/Vec2","./geom/Vec3","./layer/ViewControlsLayer","./ogc/WmsCapabilities","./layer/WmsLayer","./ogc/WmsLayerCapabilities","./layer/WmsTimeDimensionedLayer","./util/WmsUrlBuilder","./ogc/WmtsCapabilities","./layer/WmtsLayer","./ogc/WmtsLayerCapabilities","./WorldWindow","./util/WWMath","./util/WWMessage","./util/WWUtil","./globe/ZeroElevationModel"],function(t,e,i,r,o,n,s,a,h,l,u,c,d,g,p,f,m,E,y,_,v,L,S,T,b,w,M,R,x,C,A,P,I,N,O,V,D,F,G,W,k,B,U,j,z,q,K,H,Y,X,J,Z,Q,$,tt,et,it,rt,ot,nt,st,at,ht,lt,ut,ct,dt,gt,pt,ft,mt,Et,yt,_t,vt,Lt,St,Tt,bt,wt,Mt,Rt,xt,Ct,At,Pt,It,Nt,Ot,Vt,Dt,Ft,Gt,Wt,kt,Bt,Ut,jt,zt,qt,Kt,Ht,Yt,Xt,Jt,Zt,Qt,$t,te,ee,ie,re,oe,ne,se,ae,he,le,ue,ce,de,ge,pe,fe,me,Ee,ye,_e,ve,Le,Se,Te,be,we,Me,Re,xe,Ce,Ae,Pe){"use strict";var Ie={VERSION:"0.0.0",ABSOLUTE:"absolute",AFTER_REDRAW:"afterRedraw",BEFORE_REDRAW:"beforeRedraw",BEGAN:"began",CANCELLED:"cancelled",CHANGED:"changed",CLAMP_TO_GROUND:"clampToGround",EARTH_RADIUS:6371e3,EAST:"east",ENDED:"ended",FAILED:"failed",GREAT_CIRCLE:"greatCircle",LINEAR:"linear",MULTI_POINT:"multiPoint",NORTH:"north",NULL:"null",OFFSET_FRACTION:"fraction",OFFSET_INSET_PIXELS:"insetPixels",OFFSET_PIXELS:"pixels",POINT:"point",POLYLINE:"polyline",POLYGON:"polygon",POSSIBLE:"possible",RECOGNIZED:"recognized",REDRAW_EVENT_TYPE:"WorldWindRedraw",RELATIVE_TO_GLOBE:"relativeToGlobe",RELATIVE_TO_GROUND:"relativeToGround",RELATIVE_TO_SCREEN:"relativeToScreen",RHUMB_LINE:"rhumbLine",SOUTH:"south",WEST:"west"};return Ie.AbstractError=t,Ie.Angle=e,Ie.ArgumentError=i,Ie.BasicProgram=r,Ie.BasicTextureProgram=o,Ie.BingAerialLayer=n,Ie.BingAerialWithLabelsLayer=s,Ie.BingRoadsLayer=a,Ie.BingWMSLayer=h,Ie.BlueMarbleLayer=l,Ie.BMNGLandsatLayer=u,Ie.BMNGLayer=c,Ie.BMNGOneImageLayer=d,Ie.BMNGRestLayer=g,Ie.BoundingBox=p,Ie.ClickRecognizer=f,Ie.Color=m,Ie.Compass=E,Ie.CompassLayer=y,Ie.CoordinatesDisplayLayer=_,Ie.DigitalGlobeTiledImageLayer=v,Ie.DragRecognizer=L,Ie.DrawContext=S,Ie.EarthElevationModel=T,Ie.EarthRestElevationModel=b,Ie.ElevationModel=w,Ie.Font=M,Ie.FrameStatistics=R,Ie.FrameStatisticsLayer=x,Ie.FramebufferTexture=C,Ie.FramebufferTile=A,Ie.FramebufferTileController=P,Ie.Frustum=I,Ie.GeographicMesh=N,Ie.GeographicProjection=O,Ie.GeographicText=V,Ie.GeoJSONParser=D,Ie.GestureRecognizer=F,Ie.Globe=G,Ie.Globe2D=W,Ie.GoToAnimator=k,Ie.GpuProgram=B,Ie.GpuResourceCache=U,Ie.GpuShader=j,Ie.HighlightController=z,Ie.ImageSource=q,Ie.ImageTile=K,Ie.LandsatRestLayer=H,Ie.Layer=Y,Ie.Level=X,Ie.LevelRowColumnUrlBuilder=J,Ie.LevelSet=Z,Ie.Line=Q,Ie.Location=$,Ie.Logger=tt,Ie.LookAtNavigator=et,Ie.Matrix=it,Ie.MemoryCache=rt,Ie.MemoryCacheListener=ot,Ie.MercatorTiledImageLayer=nt,Ie.Navigator=st,Ie.NavigatorState=at,Ie.NominatimGeocoder=ht,Ie.NotYetImplementedError=lt,Ie.Offset=ut,Ie.OpenStreetMapImageLayer=ct,Ie.PanRecognizer=dt,Ie.Path=gt,Ie.PeriodicTimeSequence=pt,Ie.PickedObject=ft,Ie.PickedObjectList=mt,Ie.PinchRecognizer=Et,Ie.Placemark=yt,Ie.PlacemarkAttributes=_t,Ie.Plane=vt,Ie.Polygon=Lt,Ie.Position=St,Ie.ProjectionEquirectangular=Tt,Ie.ProjectionGnomonic=bt,Ie.ProjectionMercator=wt,Ie.ProjectionPolarEquidistant=Mt,Ie.ProjectionUPS=Rt,Ie.Rectangle=xt,Ie.Renderable=Ct,Ie.RenderableLayer=At,Ie.RotationRecognizer=Pt,Ie.ScreenText=Nt,Ie.ScreenImage=It,Ie.Sector=Ot,Ie.ShapeAttributes=Vt,Ie.Shapefile=Dt,Ie.ShowTessellationLayer=Ft,Ie.SurfaceImage=Gt,Ie.SurfaceCircle=Wt,Ie.SurfaceEllipse=kt,Ie.SurfacePolygon=Bt,Ie.SurfacePolyline=Ut,Ie.SurfaceRectangle=jt,Ie.SurfaceRenderable=zt,Ie.SurfaceSector=qt,Ie.SurfaceShape=Kt,Ie.SurfaceShapeTile=Ht,Ie.SurfaceShapeTileBuilder=Yt,Ie.SurfaceTile=Xt,Ie.SurfaceTileRenderer=Jt,Ie.SurfaceTileRendererProgram=Zt,Ie.TapRecognizer=Qt,Ie.TectonicPlatesLayer=$t,Ie.Terrain=te,Ie.TerrainTile=ee,Ie.TerrainTileList=ie,Ie.Tessellator=re,Ie.Text=oe,Ie.TextAttributes=ne,Ie.TextSupport=se,Ie.Texture=ae,Ie.TextureTile=he,Ie.Tile=le,Ie.TiledImageLayer=ue,Ie.TileFactory=ce,Ie.TiltRecognizer=de,Ie.Touch=ge,Ie.TriangleMesh=pe,Ie.UnsupportedOperationError=fe,Ie.Vec2=me,Ie.Vec3=Ee,Ie.ViewControlsLayer=ye,Ie.WmsCapabilities=_e,Ie.WmsLayer=ve,Ie.WmsLayerCapabilities=Le,Ie.WmsTimeDimensionedLayer=Se,Ie.WmsUrlBuilder=Te,Ie.WmtsCapabilities=be,Ie.WmtsLayer=we,Ie.WmtsLayerCapabilities=Me,Ie.WWMath=xe,Ie.WWMessage=Ce,Ie.WWUtil=Ae,Ie.WorldWindow=Re,Ie.ZeroElevationModel=Pe,Ie.configuration={gpuCacheSize:25e7,baseUrl:Ae.worldwindlibLocation()||Ae.currentUrlSansFilePart()+"/../"},Ie.BingMapsKey=null,window.WorldWind=Ie,Ie}),e("WorldWind")});